{"id":"MOD_mdlOutlook_HTML_Serienemail_SAP","name":"mdlOutlook_HTML_Serienemail_SAP","kind":"standard","procedures":["Sub xSendMessage(ByRef theSubject, theRecipient, ByVal html As String, _","Function xTestsend1()","Function xTestsend2()","Function xTestsend3()"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n\n' This function sends an HTML-type email via Outlook\nSub xSendMessage(ByRef theSubject, theRecipient, ByVal html As String, _\nOptional ByVal theCCRecepients As String = \"\", Optional ByVal theBCCRecepients As String = \"\", _\nOptional iImportance As Long = 1, Optional myattach, _\nOptional theVoting As String = \"\")\n'Optional theVoting As String = \"Opt-in all;Opt-out all;Some (please specify)\")\n   \n' theCCRecepients and theBCCRecepients only one String, spearated recepients with colon\n' if you hand over attachments, it must be a two dimensional - 0 based Array containing one Pathname per field.\n' if theVoting = \"\" - not Voting buttons, Votings separated by colon.\n' .Importance 2 = olImportanceHigh        .Importance 1 = olImportanceNormal        .Importance 0 = olImportanceLow\n' if you hand over attachments, it must be a one dimensional - 0 based Array containing one Pathname per field.\n\n''' #########################\n''' Late Binding\n'\n'   Dim objOutlook As Outlook.Application\n'   Dim objMail As Outlook.MailItem\n'   Dim objOutlookRecip As Outlook.Recipient\n'   Dim objOutlookAttach As Outlook.Attachments\n'\n''' #########################\n''' Early Binding\n'\n   Dim objOutlook As Object\n   Dim objMail As Object\n   Dim objOutlookRecip As Object\n   Dim objOutlookAttach As Object\n\n   Const olFormatHTML As Long = 2\n   Const olMailItem As Long = 0\n   Const olTo As Long = 1\n   Const olCC As Long = 2\n   Const olBCC As Long = 3\n'\n''' ##########################\n   \n  \n   Dim myHTML As String\n   Dim i As Long\n   \n   'Dim theCCRecepients As String\n         \n   ' encapsulate html code in standard stuff\n   myHTML = \"<!DOCTYPE HTML PUBLIC \"\"-//W3C//DTD HTML 4.0 Transitional//EN\"\"> \"\n   myHTML = myHTML & \"<html><head><style>\"\n   myHTML = myHTML & \"p { FONT-SIZE: 11pt; MARGIN: 3pt 0cm; FONT-FAMILY: Arial } \"\n   myHTML = myHTML & \"th { FONT-SIZE: 10pt; MARGIN: 3pt 0cm; FONT-FAMILY: Arial; background-color: #d8c8e8 } \"\n   myHTML = myHTML & \"td { FONT-SIZE: 10pt; MARGIN: 3pt 0cm; FONT-FAMILY: Arial; background-color: #e8dcf4 } \"\n   myHTML = myHTML & \"</style></head><body>\"\n   myHTML = myHTML & html & \"</body></html>\"\n   \n   ' Create the Outlook session.\n   Set objOutlook = CreateObject(\"Outlook.Application\")\n   \n   Set objMail = objOutlook.CreateItem(olMailItem)\n   \n   With objMail\n       'Set body format to HTML\n       .Bodyformat = olFormatHTML\n       .htmlBody = myHTML\n       .Display\n'       .To = theRecipient\n       .CC = Nz(theCCRecepients)\n       .BCC = Nz(theBCCRecepients)\n\n'       .SentOnBehalfOfName = \"Absender@Absender.de\"\n\n'If Using Outlook Objects, you can insert more than one Recepient per Object\n'.To  .CC   .BB    allows only ONE string\n       \n       If Len(Trim(Nz(theVoting))) > 0 Then\n           .VotingOptions = theVoting\n       End If\n                \n\n'########### Recepients ################\n\n'olBCC          3   The recipient is specified in the BCC property of the Item.\n'olCC           2   The recipient is specified in the CC property of the Item.\n'olOriginator   0   Originator (sender) of the Item.\n'olTo           1   The recipient is specified in the To property of the Item.\n\n'       'Bug: CCRecepients only work, if set in sort order 3 - 2 - 1 (BCC, CC, To)\n'       ' When set different, all Recepients are sent to the TO field\n'       ' Set (B)CCRecipients - The (B)CCRecepients must already contain ALL Recepients, separated with a colon\n'\n'        If Len(Trim(Nz(theBCCRecepients))) > 0 Then\n'            Set objOutlookRecip = .Recipients.Add(theBCCRecepients)\n'            objOutlookRecip.Type = olBCC\n'        End If\n'\n'        If Len(Trim(Nz(theCCRecepients))) > 0 Then\n'            Set objOutlookRecip = .Recipients.Add(theCCRecepients)\n'            objOutlookRecip.Type = olCC\n'        End If\n'\n        Set objOutlookRecip = .Recipients.Add(theRecipient)\n        objOutlookRecip.Type = olTo\n'#########################################\n       \n       .Subject = theSubject\n   \n'      .Importance 2 = olImportanceHigh        .Importance 1 = olImportanceNormal        .Importance 0 = olImportanceLow\n       .Importance = iImportance\n\n'       .SentOnBehalfOfName = \"Absender@Absender.de\"\n\n        If Not IsMissing(myattach) Then\n            If IsArray(myattach) Then\n        \n                Set objOutlookAttach = .Attachments\n                \n                For i = LBound(myattach) To UBound(myattach)\n                    If File_exist(myattach(i)) Then\n                        objOutlookAttach.Add myattach(i)\n                    End If\n                Next i\n            End If\n        End If\n        \n        'Hier wird die Mail \"angezeigt\"\n        'aber gleich versendet,... OHNE Sicherheitsabfrage!\n        .Display\n        SendKeys \"%s\", True\n\n   End With\n   Set objOutlook = Nothing\n   Set objMail = Nothing\n   Set objOutlookRecip = Nothing\n   Set objOutlookAttach = Nothing\n   \n   Sleep 5000\n   DoEvents\n\nEnd Sub\n\nFunction xTestsend1()\nDim strhtml As String\nDim att\n\nDim SSuch(9) As String\nDim SErse(9) As String\n\nDim i As Long\n\n'att = Array(\"\\\\Majestix\\d\\GEZSpruch.jpg\", \"\\\\Majestix\\d\\Kulturverlust.pdf\")\n'strhtml = \"<p>Dear Anne-Lise Lindop,</p><br><p>please notice that the following content will be ready for localization by 1/23/2011. You can preview the original version by clicking on the title.</p><br><table border><tr><th>Asset Type</th><th>Title</th><th>Solution</th><th>Abstract</th></tr> <tr><td>Brochure</td><td><a href=\"\"\\\\Majestix\\d\\SAP_NEU\\regression_test.xlsx\"\">Brooooooooooo1111111111</a></td><td>Business One</td><td>Brooooooooooo1111111111 Abstract</td></tr><tr><td>Video</td><td><a href=\"\"\\\\Majestix\\d\\SAP_NEU\\regression_test.xlsx\"\">TestVideo</a></td><td>Business One</td><td>TestVideo Abstract</td></tr></table><br><p>Please let us know if you opt in or out. If you opt-in (or out) for all assets, you just need to use the voting button.</p>\"\nstrhtml = Get_Priv_Property(\"prp_HTML_Mandatory\")\n\nSSuch(0) = \"*$*LocalReviewer*$*\"\nSSuch(1) = \"*$*Handover_Date*$*\"\nSSuch(2) = \"*$*3_business_days_prior_to_Handover_Date*$*\"\nSSuch(3) = \"*$*AssetName*$*\"\nSSuch(4) = \"*$*AssetUse*$*\"\nSSuch(5) = \"*$*LaunchDate*$*\"\nSSuch(6) = \"*$*TargetAudience*$*\"\nSSuch(7) = \"*$*CallToAction*$*\"\nSSuch(8) = \"*$*UseOnTheWeb*$*\"\nSSuch(9) = \"*$*OverallImportanceMandatory*$*\"\n\nSErse(0) = \"'Klaus Oberdalhoff' (C5149570)\"\nSErse(1) = \"4/13/2011\"\nSErse(2) = \"4/10/2011\"\nSErse(3) = \"Business One Overview Video: Software Designed With Small Businesses in Mind\"\nSErse(4) = fCnvQM(Get_Priv_Property(\"prp_Erse_AssetUse\"))\nSErse(5) = \"English version Sept 20th and localized versions are planned to be launched end of Sept\"\nSErse(6) = \"Owner/president, CIO, head of  IT or finance at SME's\"\nSErse(7) = \"The Overview video is going to be one of the Three CTAs in the iTour campaign (other two are the \"\"Business One Solution Brief\"\" and the \"\"link to B1 page on sap.com/sme\"\")\"\nSErse(8) = \"http://www.sap.com/sme/seeitinaction/OverviewVideos.epx?sol=SAP%20Business%20One\"\nSErse(9) = \"This video is the ONLY high level product-specific video used to move prospects that are very early in the buying cycle in L1-L2 (discovery/motivation) to L3-L4 (evaluation/consideration).\"\n\nFor i = 0 To 9\n  strhtml = Replace(strhtml, SSuch(i), SErse(i))\nNext i\n\nCall xSendMessage(\"Testbetreffffffffff\", \"\", strhtml, \";siegert@consec-nuernberg.de\")\nEnd Function\n\nFunction xTestsend2()\nDim strhtml As String\nstrhtml = \"<p>Dear Anne-Lise Lindop,</p><p>please notice that the following content will be ready for localization by 1/23/2011. You can preview the original version by clicking on the title.</p><br><table border><tr><th>Asset Type</th><th>Title</th><th>Solution</th><th>Abstract</th></tr> <tr><td>Brochure</td><td><a href=\"\"\\\\Majestix\\d\\SAP_NEU\\regression_test.xlsx\"\">Brooooooooooo1111111111</a></td><td>Business One</td><td>Brooooooooooo1111111111 Abstract</td></tr><tr><td>Video</td><td><a href=\"\"\\\\Majestix\\d\\SAP_NEU\\regression_test.xlsx\"\">TestVideo</a></td><td>Business One</td><td>TestVideo Abstract</td></tr></table><br><p>Please let us know if you opt in or out. If you opt-in (or out) for all assets, you just need to use the voting button.</p>\"\nCall xSendMessage(\"Testbetreffffffffff\", \"siegert@consec-nuernberg.de\", strhtml, \"siegert@consec-nuernberg.de; siegert@consec-nuernberg.de\", \"siegert@consec-nuernberg.de\")\nEnd Function\n\nFunction xTestsend3()\nDim strhtml As String\nstrhtml = \"<p>Dear Anne-Lise Lindop,</p><p>please notice that the following content will be ready for localization by 1/23/2011. You can preview the original version by clicking on the title.</p><br><table border><tr><th>Asset Type</th><th>Title</th><th>Solution</th><th>Abstract</th></tr> <tr><td>Brochure</td><td><a href=\"\"\\\\Majestix\\d\\SAP_NEU\\regression_test.xlsx\"\">Brooooooooooo1111111111</a></td><td>Business One</td><td>Brooooooooooo1111111111 Abstract</td></tr><tr><td>Video</td><td><a href=\"\"\\\\Majestix\\d\\SAP_NEU\\regression_test.xlsx\"\">TestVideo</a></td><td>Business One</td><td>TestVideo Abstract</td></tr></table><br><p>Please let us know if you opt in or out. If you opt-in (or out) for all assets, you just need to use the voting button.</p>\"\nCall xSendMessage(\"Testbetreffffffffff\", \"siegert@consec-nuernberg.de\", strhtml)\nEnd Function\n\n\n\n''########################################################################################################################\n'' based on KB article  Collaboration Data Objects (CDO) 1.2.1 is not supported with Outlook 2010\n''it looks like Visual Basic for Excel code that used Outlook 2007 in Vista will no longer work with Outlook 2010 (esp 64bit versions)\n''\n''\"...CDO 1.2.1 is a 32-bit client library and will not operate with 64-bit Outlook 2010. Given all these factors,\n''CDO 1.2.1 is not supported for use with Outlook 2010, and we do not recommend its use with Outlook 2010. ...\n''Programs that use CDO should be re-designed to use other Application Programming Interfaces (APIs) instead of CDO.\"\n''\n''########################################################################################################################\n''\n'''You should use CDO, this bypasses outlook and works a lot quicker. Used it with ACC2K and Acc2K10.\n''\n'' Function Send_eMail(strTo As String, strFrom As String, strSubject As String, strMsg As String, Optional strCC As String, Optional strBCC As String, Optional strAttachmentPath As String) As Boolean\n'' Dim objCDOSysCon As Object\n'' Dim objMessage As Object\n''\n'' On Error GoTo Send_eMail_Error\n''\n'' DoCmd.SetWarnings False\n'' Send_eMail = False\n''\n'' Set objCDOSysCon = CreateObject(\"CDO.Configuration\")\n'' Set objMessage = CreateObject(\"CDO.Message\")\n''\n'' 'Outgoing SMTP server\n'' objCDOSysCon.Fields(\" http://schemas.microsoft.com/cdo/configuration/smtpserver \") = \"10.0.0.17\"\n'' 'SMTP port\n'' objCDOSysCon.Fields(\" http://schemas.microsoft.com/cdo/configuration/smtpserverport \") = 25\n'' 'CDO Port\n'' objCDOSysCon.Fields(\" http://schemas.microsoft.com/cdo/configuration/sendusing \") = 2\n'' 'Timeout\n'' objCDOSysCon.Fields(\" http://schemas.microsoft.com/cdo/configuration/smtpconnectiontimeout \") = 60\n'' 'Authenticatie\n'' '2010-12-07 Changed cdoBasic to \"cdoBasic\" (so quoted..)\n'' '2011-02-18 Changed to 1 after migration to office 2010\n'' objCDOSysCon.Fields(\" http://schemas.microsoft.com/cdo/configuration/smtpauthenticate \") = 1\n'' objCDOSysCon.Fields(\" http://schemas.microsoft.com/cdo/configuration/sendusername \") = strSMTPUser\n'' objCDOSysCon.Fields(\" http://schemas.microsoft.com/cdo/configuration/sendpassword \") = strSMTPPassword\n''\n'' objCDOSysCon.Fields.Update\n''\n'' 'Update the CDOSYS Configuration\n'' Set objMessage.Configuration = objCDOSysCon\n''\n'' 'Create Message\n'' objMessage.Subject = strSubject\n'' objMessage.from = strFrom\n'' objMessage.to = strTo\n'' objMessage.CC = strCC\n'' objMessage.bcc = strBCC '& \";\" & strFrom\n'' objMessage.TextBody = strMsg\n'' If Len(Nz(strAttachmentPath, \"\")) > 0 Then\n'' objMessage.addAttachment strAttachmentPath\n'' End If\n''\n'' 'Send the message\n'' objMessage.Send\n''\n'' 'Close the server mail object\n'' Set objMessage = Nothing\n'' Set objCDOSysCon = Nothing\n''\n''Exit_Send_eMail:\n'' 'Report Succes\n'' Send_eMail = True\n'' On Error GoTo 0\n'' Exit Function\n''\n''Send_eMail_Error:\n'' MsgBox \"Error \" & err.Number & \" (\" & err.Description & \") in procedure Send_eMail of Module Mod_Exchange\"\n'' End Function\n''\n"}
