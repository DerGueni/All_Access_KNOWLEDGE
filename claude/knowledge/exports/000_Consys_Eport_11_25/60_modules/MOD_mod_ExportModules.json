{"id":"MOD_mod_ExportModules","name":"mod_ExportModules","kind":"standard","procedures":["Public Sub ExportModulesToJSON(ByVal exportPath As String)","Private Sub ExportSingleModule(fileNum As Integer, moduleName As String)","Private Sub ExportFormModules(fileNum As Integer, ByRef isFirst As Boolean, ByRef moduleCount As Integer)","Private Sub ExportReportModules(fileNum As Integer, ByRef isFirst As Boolean, ByRef moduleCount As Integer)","Private Function CountProcedures(mdl As Module) As Integer","Private Function GetProcedureList(mdl As Module) As String","Private Function GetProcKindName(procKind As Long) As String"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' Modul:     mod_ExportModules\n' Zweck:     Export aller VBA-Module zu JSON\n' Autor:     Access-Forensiker Agent\n' Datum:     2025-10-31\n' Version:   1.0\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nOption Compare Database\nOption Explicit\nPrivate Const pk_Proc As Long = 0\nPrivate Const pk_Get  As Long = 1\nPrivate Const pk_Let  As Long = 2\nPrivate Const pk_Set  As Long = 3\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' HAUPT-EXPORT-FUNKTION\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nPublic Sub ExportModulesToJSON(ByVal exportPath As String)\n    On Error GoTo ErrorHandler\n    \n    Dim f As Integer\n    Dim filePath As String\n    Dim i As Integer\n    Dim firstModule As Boolean\n    Dim moduleCount As Integer\n    Dim am As Access.AccessObject\n    \n    filePath = exportPath & \"\\modules.json\"\n    f = FreeFile\n    \n    Open filePath For Output As #f\n    \n    ' JSON-Array starten\n    Print #f, \"[\"\n    \n    firstModule = True\n    moduleCount = 0\n    \n    ' Alle Standard-Module durchgehen\n    For i = 0 To CurrentProject.AllModules.Count - 1\n        Set am = CurrentProject.AllModules(i)\n        \n        ' Modul Ã¶ffnen\n        On Error Resume Next\n        DoCmd.OpenModule am.Name\n        \n        If err.Number = 0 Then\n            On Error GoTo ErrorHandler\n            \n            ' Komma vor weiteren EintrÃ¤gen\n            If Not firstModule Then\n                Print #f, \",\"\n            End If\n            firstModule = False\n            moduleCount = moduleCount + 1\n            \n            ' Modul-Objekt exportieren\n            ExportSingleModule f, am.Name\n            \n            ' Modul schlieÃŸen\n            DoCmd.Close acModule, am.Name, acSaveNo\n        Else\n            ' Fehler beim Ã–ffnen - Ã¼berspringen\n            Debug.Print \"      âš  Modul '\" & am.Name & \"' konnte nicht geÃ¶ffnet werden\"\n            On Error GoTo ErrorHandler\n        End If\n    Next i\n    \n    ' Auch Formular- und Report-Module exportieren\n    ExportFormModules f, firstModule, moduleCount\n    ExportReportModules f, firstModule, moduleCount\n    \n    ' JSON-Array schlieÃŸen\n    Print #f, \"]\"\n    \n    Close #f\n    \n    Debug.Print \"      â†’ \" & moduleCount & \" Module exportiert (inkl. Formular-/Report-Module)\"\n    \n    Exit Sub\n\nErrorHandler:\n    On Error Resume Next\n    Close #f\n    DoCmd.Close acModule, , acSaveNo\n    On Error GoTo 0\n    Debug.Print \"      âœ— Fehler: \" & err.description\n    err.Raise err.Number, \"ExportModulesToJSON\", err.description\nEnd Sub\n\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' EINZELNES MODUL EXPORTIEREN\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nPrivate Sub ExportSingleModule(fileNum As Integer, moduleName As String)\n    Dim mdl As Module\n    Dim codeText As String\n    Dim lineCount As Long\n    Dim procCount As Integer\n    \n    Set mdl = Modules(moduleName)\n    lineCount = mdl.CountOfLines\n    \n    ' Gesamten Code auslesen\n    If lineCount > 0 Then\n        codeText = mdl.lines(1, lineCount)\n    Else\n        codeText = \"\"\n    End If\n    \n    ' Prozeduren zÃ¤hlen\n    procCount = CountProcedures(mdl)\n    \n    ' JSON-Objekt schreiben\n    Print #fileNum, \"  {\"\n    Print #fileNum, \"    \"\"name\"\": \"\"\" & mod_ExportConsys.EscapeJSON(moduleName) & \"\"\",\"\n    Print #fileNum, \"    \"\"type\"\": \"\"StandardModule\"\",\"\n    Print #fileNum, \"    \"\"lineCount\"\": \" & lineCount & \",\"\n    Print #fileNum, \"    \"\"procedureCount\"\": \" & procCount & \",\"\n    Print #fileNum, \"    \"\"procedures\"\": \" & GetProcedureList(mdl) & \",\"\n    Print #fileNum, \"    \"\"code\"\": \"\"\" & mod_ExportConsys.EscapeJSON(codeText) & \"\"\"\"\n    Print #fileNum, \"  }\"\nEnd Sub\n\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' FORMULAR-MODULE EXPORTIEREN\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nPrivate Sub ExportFormModules(fileNum As Integer, ByRef isFirst As Boolean, ByRef moduleCount As Integer)\n    On Error Resume Next\n    Dim i As Integer\n    Dim frm As Form\n    Dim mdl As Module\n    \n    For i = 0 To CurrentProject.AllForms.Count - 1\n        Dim formName As String\n        formName = CurrentProject.AllForms(i).Name\n        \n        ' Formular im Design-Modus Ã¶ffnen\n        DoCmd.OpenForm formName, acDesign, , , , acHidden\n        \n        If err.Number = 0 Then\n            Set frm = Forms(formName)\n            \n            ' PrÃ¼fen ob Modul vorhanden\n            If frm.HasModule Then\n                Set mdl = frm.Module\n                \n                If mdl.CountOfLines > 0 Then\n                    If Not isFirst Then\n                        Print #fileNum, \",\"\n                    End If\n                    isFirst = False\n                    moduleCount = moduleCount + 1\n                    \n                    ' Modul exportieren\n                    Print #fileNum, \"  {\"\n                    Print #fileNum, \"    \"\"name\"\": \"\"Form_\" & mod_ExportConsys.EscapeJSON(formName) & \"\"\",\"\n                    Print #fileNum, \"    \"\"type\"\": \"\"FormModule\"\",\"\n                    Print #fileNum, \"    \"\"parentForm\"\": \"\"\" & mod_ExportConsys.EscapeJSON(formName) & \"\"\",\"\n                    Print #fileNum, \"    \"\"lineCount\"\": \" & mdl.CountOfLines & \",\"\n                    Print #fileNum, \"    \"\"procedureCount\"\": \" & CountProcedures(mdl) & \",\"\n                    Print #fileNum, \"    \"\"procedures\"\": \" & GetProcedureList(mdl) & \",\"\n                    Print #fileNum, \"    \"\"code\"\": \"\"\" & mod_ExportConsys.EscapeJSON(mdl.lines(1, mdl.CountOfLines)) & \"\"\"\"\n                    Print #fileNum, \"  }\"\n                End If\n            End If\n            \n            DoCmd.Close acForm, formName, acSaveNo\n        End If\n        \n        err.clear\n    Next i\n    On Error GoTo 0\nEnd Sub\n\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' REPORT-MODULE EXPORTIEREN\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nPrivate Sub ExportReportModules(fileNum As Integer, ByRef isFirst As Boolean, ByRef moduleCount As Integer)\n    On Error Resume Next\n    Dim i As Integer\n    Dim rpt As Report\n    Dim mdl As Module\n    \n    For i = 0 To CurrentProject.AllReports.Count - 1\n        Dim reportName As String\n        reportName = CurrentProject.AllReports(i).Name\n        \n        ' Report im Design-Modus Ã¶ffnen\n        DoCmd.OpenReport reportName, acViewDesign, , , acHidden\n        \n        If err.Number = 0 Then\n            Set rpt = Reports(reportName)\n            \n            ' PrÃ¼fen ob Modul vorhanden\n            If rpt.HasModule Then\n                Set mdl = rpt.Module\n                \n                If mdl.CountOfLines > 0 Then\n                    If Not isFirst Then\n                        Print #fileNum, \",\"\n                    End If\n                    isFirst = False\n                    moduleCount = moduleCount + 1\n                    \n                    ' Modul exportieren\n                    Print #fileNum, \"  {\"\n                    Print #fileNum, \"    \"\"name\"\": \"\"Report_\" & mod_ExportConsys.EscapeJSON(reportName) & \"\"\",\"\n                    Print #fileNum, \"    \"\"type\"\": \"\"ReportModule\"\",\"\n                    Print #fileNum, \"    \"\"parentReport\"\": \"\"\" & mod_ExportConsys.EscapeJSON(reportName) & \"\"\",\"\n                    Print #fileNum, \"    \"\"lineCount\"\": \" & mdl.CountOfLines & \",\"\n                    Print #fileNum, \"    \"\"procedureCount\"\": \" & CountProcedures(mdl) & \",\"\n                    Print #fileNum, \"    \"\"procedures\"\": \" & GetProcedureList(mdl) & \",\"\n                    Print #fileNum, \"    \"\"code\"\": \"\"\" & mod_ExportConsys.EscapeJSON(mdl.lines(1, mdl.CountOfLines)) & \"\"\"\"\n                    Print #fileNum, \"  }\"\n                End If\n            End If\n            \n            DoCmd.Close acReport, reportName, acSaveNo\n        End If\n        \n        err.clear\n    Next i\n    On Error GoTo 0\nEnd Sub\n\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' HILFSFUNKTIONEN\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n' ZÃ¤hlt Prozeduren in einem Modul\nPrivate Function CountProcedures(mdl As Module) As Integer\n    Dim lineNum As Long\n    Dim procName As String\n    Dim procKind As Long\n    Dim Count As Integer\n    \n    Count = 0\n    lineNum = 1\n    \n    On Error Resume Next\n    Do While lineNum < mdl.CountOfLines\n        procName = mdl.ProcOfLine(lineNum, procKind)\n        If Len(procName) > 0 And err.Number = 0 Then\n            Count = Count + 1\n            ' Zur nÃ¤chsten Prozedur springen\n            lineNum = mdl.ProcStartLine(procName, procKind) + mdl.ProcCountLines(procName, procKind)\n        Else\n            lineNum = lineNum + 1\n        End If\n    Loop\n    On Error GoTo 0\n    \n    CountProcedures = Count\nEnd Function\n\n' Erstellt Liste aller Prozeduren als JSON-Array\nPrivate Function GetProcedureList(mdl As Module) As String\n    Dim lineNum As Long\n    Dim procName As String\n    Dim procKind As Long\n    Dim procList As String\n    Dim visitedProcs As Object\n    Dim isFirst As Boolean\n    \n    Set visitedProcs = CreateObject(\"Scripting.Dictionary\")\n    procList = \"[\"\n    isFirst = True\n    lineNum = 1\n    \n    On Error Resume Next\n    Do While lineNum < mdl.CountOfLines\n        procName = mdl.ProcOfLine(lineNum, procKind)\n        \n        If Len(procName) > 0 And err.Number = 0 Then\n            ' PrÃ¼fen ob bereits verarbeitet\n            If Not visitedProcs.exists(procName) Then\n                visitedProcs.Add procName, True\n                \n                If Not isFirst Then\n                    procList = procList & \",\"\n                End If\n                isFirst = False\n                \n                procList = procList & \"{\"\"name\"\":\"\"\" & mod_ExportConsys.EscapeJSON(procName) & \"\"\",\"\n                procList = procList & \"\"\"type\"\":\"\"\" & GetProcKindName(procKind) & \"\"\",\"\n                procList = procList & \"\"\"startLine\"\":\" & mdl.ProcStartLine(procName, procKind) & \",\"\n                procList = procList & \"\"\"lineCount\"\":\" & mdl.ProcCountLines(procName, procKind) & \"}\"\n                \n                ' Zur nÃ¤chsten Prozedur springen\n                lineNum = mdl.ProcStartLine(procName, procKind) + mdl.ProcCountLines(procName, procKind)\n            Else\n                lineNum = lineNum + 1\n            End If\n        Else\n            lineNum = lineNum + 1\n        End If\n    Loop\n    On Error GoTo 0\n    \n    procList = procList & \"]\"\n    GetProcedureList = procList\nEnd Function\n\n' Keine VBIDE-Referenz nötig\n\n\nPrivate Function GetProcKindName(procKind As Long) As String\n    Select Case procKind\n        Case pk_Proc: GetProcKindName = \"Sub/Function\"\n        Case pk_Get:  GetProcKindName = \"Property Get\"\n        Case pk_Let:  GetProcKindName = \"Property Let\"\n        Case pk_Set:  GetProcKindName = \"Property Set\"\n        Case Else:    GetProcKindName = \"Unknown\"\n    End Select\nEnd Function\n"}
