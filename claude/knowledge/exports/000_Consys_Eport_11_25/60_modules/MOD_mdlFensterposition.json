{"id":"MOD_mdlFensterposition","name":"mdlFensterposition","kind":"standard","procedures":["Public Function PosSpeichern(FormObject As Form) As Boolean","Public Function PosWiederherstellen(FormObject As Form) As Boolean","Function FensterVerschieb(FormObject As Form, Optional iLinks As Long = 100, Optional iTop As Long = 100)"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n' vraschke@t-online.de\n\n'16 bit\n'Private Type RECT\n'    left As Integer\n'    top As Integer\n'    right As Integer\n'    bottom As Integer\n'End Type\n'\n'Private Declare PtrSafe Sub GetWindowRect Lib \"User\" (ByVal hWnd As Integer, lpRect As RECT)\n'Private Declare PtrSafe Function GetParent Lib \"User\" (ByVal hWnd As Integer) As Integer\n'Private Declare PtrSafe Sub MoveWindow Lib \"User\" (ByVal hWnd As Integer, ByVal X As Integer, ByVal Y As Integer, ByVal nWidth As Integer, ByVal nHeight As Integer, ByVal bRepaint As Integer)\n\n'32 bit\nPrivate Type RECT\n        Left As Long\n        Top As Long\n        Right As Long\n        Bottom As Long\nEnd Type\n\nPrivate Declare PtrSafe Function GetWindowRect Lib \"user32\" (ByVal hwnd As Long, lpRect As RECT) As Long\nPrivate Declare PtrSafe Function GetParent Lib \"user32\" (ByVal hwnd As Long) As Long\nPrivate Declare PtrSafe Function MoveWindow Lib \"user32\" (ByVal hwnd As Long, ByVal X As Long, ByVal Y As Long, ByVal nWidth As Long, ByVal nHeight As Long, ByVal bRepaint As Long) As Long\n\nPublic Function PosSpeichern(FormObject As Form) As Boolean\n' Speichert die Fensterkoordinaten des angegebenen Formulars in die Tabelle tblFensterpositionen\nOn Error GoTo Err_Speichern\n\n    Dim rectForm As RECT\n    Dim hwndParent As Long\n    Dim rectParent As RECT\n    Dim db As DAO.Database\n    Dim rstFensterPos As DAO.Recordset\n    \n    ' Koordinaten des Formulars ermitteln\n    GetWindowRect FormObject.hwnd, rectForm\n\n    ' Koordinaten des Parent-Fensters ermitteln\n    hwndParent = GetParent(FormObject.hwnd)\n    \n    If hwndParent <> Application.hWndAccessApp Then\n    ' Ist das Formular gebunden, so ist das Parent-Fenster nicht das Access-Fenster.\n    ' In diesem Fall müssen wir die Parent-Koordinaten abschneiden\n    \n        GetWindowRect hwndParent, rectParent\n        rectForm.Left = rectForm.Left - rectParent.Left\n        rectForm.Top = rectForm.Top - rectParent.Top\n        rectForm.Right = rectForm.Right - rectParent.Left\n        rectForm.Bottom = rectForm.Bottom - rectParent.Top\n    \n    End If\n    \n    ' Koordinaten in Tabelle speichern\n    Set db = CurrentDb\n    Set rstFensterPos = db.OpenRecordset(\"SELECT * FROM tblFensterpositionen WHERE FormName='\" & _\n                            FormObject.Name & \"';\", dbOpenDynaset)\n    \n    With rstFensterPos\n        If .RecordCount = 0 Then\n            .AddNew\n            !formName = FormObject.Name\n        Else\n            .Edit\n        End If\n            \n        !Left = rectForm.Left\n        !Top = rectForm.Top\n        !Right = rectForm.Right\n        !Bottom = rectForm.Bottom\n        \n        .update\n        .Close\n    End With\n\n    PosSpeichern = True\n\nExit_Speichern:\n    Exit Function\n    \nErr_Speichern:\n    PosSpeichern = False\n    Resume Exit_Speichern\n    \nEnd Function\n\n' --------------------------------------------\n'Jörg Ackermann meinte zu PosWiederherstellen:\n'\n'kleines Fehlerchen entdeckt:\n'\n'mdlFensterpos_PosWiederherstellen()\n'\n'-------------------------------------------\n' ' Breite und Höhe des Fensters ermitteln\n'    lBreite = rectForm.Right - rectForm.Left\n'    lHöhe = rectForm.Bottom - rectForm.Top\n'-------------------------------------------\n'\n'dieser Abschnitt gehört nach unten, macht erst Sinn,\n'nachdem Koordinaten aus Tabelle gelesen wurden, da\n'sonst die Fenster-Breite u. -Höhe zwar ausgelesen,\n'aber nicht angepaßt wird.\n'\n'Man könnte in dieser Function noch so einige Zeilen sparen...\n'\n'    If hwndParent <> Application.hWndAccessApp Then\n'    ' Ist das Formular gebunden, so ist das Parent-Fenster nicht das Access-Fenster.\n'    ' In diesem Fall müssen wir die Parent-Koordinaten abschneiden\n'\n'        GetWindowRect hwndParent, rectParent\n'        rectForm.Left = rectForm.Left - rectParent.Left\n'        rectForm.Top = rectForm.Top - rectParent.Top\n'        rectForm.Right = rectForm.Right - rectParent.Left\n'        rectForm.Bottom = rectForm.Bottom - rectParent.Top\n'\n'    End If\n'\n'ist unnötig !\n'\n'\n'\n'\n' --------------------------------------------\n\nPublic Function PosWiederherstellen(FormObject As Form) As Boolean\n' Liest die Koordinaten des angegebenen Formulars ein und verschiebt das Formular\nOn Error GoTo Err_Wiederherstellen\n\n    Dim db As DAO.Database\n    Dim rstFensterPos As DAO.Recordset\n    Dim rectForm As RECT\n    Dim hwndParent As Long\n    Dim rectParent As RECT\n    Dim lBreite As Long\n    Dim lHöhe As Long\n    \n    ' Koordinaten des Formulars ermitteln\n    GetWindowRect FormObject.hwnd, rectForm\n    \n    ' Koordinaten des Parent-Fensters ermitteln\n    hwndParent = GetParent(FormObject.hwnd)\n    \n    If hwndParent <> Application.hWndAccessApp Then\n    ' Ist das Formular gebunden, so ist das Parent-Fenster nicht das Access-Fenster.\n    ' In diesem Fall müssen wir die Parent-Koordinaten abschneiden\n    \n        GetWindowRect hwndParent, rectParent\n        rectForm.Left = rectForm.Left - rectParent.Left\n        rectForm.Top = rectForm.Top - rectParent.Top\n        rectForm.Right = rectForm.Right - rectParent.Left\n        rectForm.Bottom = rectForm.Bottom - rectParent.Top\n    \n    End If\n    \n    ' Breite und Höhe des Fensters ermitteln\n    lBreite = rectForm.Right - rectForm.Left\n    lHöhe = rectForm.Bottom - rectForm.Top\n    \n    ' Koordinaten aus Tabelle einlesen\n    Set db = CurrentDb\n    Set rstFensterPos = db.OpenRecordset(\"SELECT * FROM tblFensterpositionen WHERE FormName='\" & _\n                                FormObject.Name & \"';\", dbOpenSnapshot)\n\n    With rstFensterPos\n        If .BOF And .EOF Then\n            PosWiederherstellen = False\n            Exit Function\n        End If\n            \n        rectForm.Left = !Left\n        rectForm.Top = !Top\n        rectForm.Right = !Right\n        rectForm.Bottom = !Bottom\n        \n        .Close\n    End With\n\n    ' Formular verschieben\n    MoveWindow FormObject.hwnd, rectForm.Left, rectForm.Top, lBreite, lHöhe, True\n    \nExit_Wiederherstellen:\n    Exit Function\n    \nErr_Wiederherstellen:\n    PosWiederherstellen = False\n    Resume Exit_Wiederherstellen\n\nEnd Function\n\n\n\nFunction FensterVerschieb(FormObject As Form, Optional iLinks As Long = 100, Optional iTop As Long = 100)\n\n    Dim rectForm As RECT\n    \n    GetWindowRect FormObject.hwnd, rectForm\n    \n    rectForm.Left = rectForm.Left + iLinks\n    rectForm.Top = rectForm.Top + iTop\n\n    MoveWindow FormObject.hwnd, rectForm.Left, rectForm.Top, rectForm.Right, rectForm.Bottom, True\n\nEnd Function\n"}
