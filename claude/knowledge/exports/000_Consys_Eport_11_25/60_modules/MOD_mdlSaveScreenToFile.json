{"id":"MOD_mdlSaveScreenToFile","name":"mdlSaveScreenToFile","kind":"standard","procedures":["Public Sub prcSave_Picture_Screen(strPath As String) 'ganzer bildschirm","Public Sub prcSave_Picture_Active_Window(strPath As String) 'aktives Fenster","Public Sub prcSave_Picture_Active_Window_part(strPath As String, hwnd As Long) 'aktives Fenster'","Public Sub prcSave_Picture_Active_Window_part_cm(strPath As String, hwnd As Long, Optional Linkscm As Double = 0#, Optional Obencm As Double = 0#, Optional Breitecm As Double = 0#, Optional Hoehecm As Double = 0#)   'aktives Fenster'","Private Function CreateBitmapPicture(ByVal hBmp As Long, ByVal hPal As Long) As Object","Private Function hDCToPicture(ByVal hDCSrc As Long, ByVal LeftSrc As Long, _","Function fhWnd(ctl As control) As Long","Function TwipsToPixelsX(Twips As Long) As Long","Function PixelsToTwipsX(Pixels As Long) As Long","Function cmToPixelsX(cm As Double) As Long","Function PixelsTocmX(Pixels As Long) As Double","Function TwipsToPixelsY(Twips As Long) As Long","Function PixelsToTwipsY(Pixels As Long) As Long","Function PixelsTocmY(Pixels As Long) As Double","Function cmToPixelsY(cm As Double) As Long"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n\n' Herkunft\n' http://www.office-loesung.de/ftopic208796_0_0_asc.php&sid=f0e83b0b6fc6a2742977dd60d417c244\n\nPrivate Declare PtrSafe Sub Sleep Lib \"kernel32.dll\" ( _\n    ByVal dwMilliseconds As Long)\nPrivate Declare PtrSafe Function OleCreatePictureIndirect Lib \"olepro32.dll\" ( _\n    ByRef PicDesc As PicBmp, _\n    ByRef RefIID As guid, _\n    ByVal fPictureOwnsHandle As Long, _\n    ByRef IPic As IPicture) As Long\nPrivate Declare PtrSafe Function CreateCompatibleDC Lib \"gdi32.dll\" ( _\n    ByVal hdc As Long) As Long\nPrivate Declare PtrSafe Function CreateCompatibleBitmap Lib \"gdi32.dll\" ( _\n    ByVal hdc As Long, _\n    ByVal nWidth As Long, _\n    ByVal nHeight As Long) As Long\nPrivate Declare PtrSafe Function SelectObject Lib \"gdi32.dll\" ( _\n    ByVal hdc As Long, _\n    ByVal hObject As Long) As Long\nPrivate Declare PtrSafe Function GetDeviceCaps Lib \"gdi32.dll\" ( _\n    ByVal hdc As Long, _\n    ByVal iCapabilitiy As Long) As Long\nPrivate Declare PtrSafe Function GetSystemPaletteEntries Lib \"gdi32.dll\" ( _\n    ByVal hdc As Long, _\n    ByVal wStartIndex As Long, _\n    ByVal wNumEntries As Long, _\n    ByRef lpPaletteEntries As PALETTEENTRY) As Long\nPrivate Declare PtrSafe Function CreatePalette Lib \"gdi32.dll\" ( _\n    ByRef lpLogPalette As LOGPALETTE) As Long\nPrivate Declare PtrSafe Function SelectPalette Lib \"gdi32.dll\" ( _\n    ByVal hdc As Long, _\n    ByVal hPalette As Long, _\n    ByVal bForceBackground As Long) As Long\nPrivate Declare PtrSafe Function RealizePalette Lib \"gdi32.dll\" ( _\n    ByVal hdc As Long) As Long\nPrivate Declare PtrSafe Function BitBlt Lib \"gdi32.dll\" ( _\n    ByVal hDestDC As Long, _\n    ByVal X As Long, _\n    ByVal Y As Long, _\n    ByVal nWidth As Long, _\n    ByVal nHeight As Long, _\n    ByVal hSrcDC As Long, _\n    ByVal xSrc As Long, _\n    ByVal ySrc As Long, _\n    ByVal dwRop As Long) As Long\nPrivate Declare PtrSafe Function DeleteDC Lib \"gdi32.dll\" ( _\n    ByVal hdc As Long) As Long\nPrivate Declare PtrSafe Function GetDC Lib \"user32.dll\" ( _\n    ByVal hwnd As Long) As Long\nPrivate Declare PtrSafe Function GetWindowRect Lib \"user32.dll\" ( _\n    ByVal hwnd As Long, _\n    ByRef lpRect As RECT) As Long\nPrivate Declare PtrSafe Function GetSystemMetrics Lib \"user32.dll\" ( _\n    ByVal nIndex As Long) As Long\nPrivate Declare PtrSafe Function GetForegroundWindow Lib \"user32.dll\" () As Long\n\nPrivate Declare PtrSafe Function apiGetFocus Lib \"user32\" Alias \"GetFocus\" () As Long\n\nPrivate Const SM_CXSCREEN = 0&\nPrivate Const SM_CYSCREEN = 1&\nPrivate Const RC_PALETTE As Long = &H100\nPrivate Const SIZEPALETTE As Long = 104\nPrivate Const RASTERCAPS As Long = 38\n\nPrivate Type RECT\n    Left As Long\n    Top As Long\n    Right As Long\n    Bottom As Long\nEnd Type\n\nPrivate Type PALETTEENTRY\n    peRed As Byte\n    peGreen As Byte\n    peBlue As Byte\n    peFlags As Byte\nEnd Type\n\nPrivate Type LOGPALETTE\n    palVersion As Integer\n    palNumEntries As Integer\n    palPalEntry(255) As PALETTEENTRY\nEnd Type\n\nPrivate Type guid\n    Data1 As Long\n    Data2 As Integer\n    Data3 As Integer\n    Data4(7) As Byte\nEnd Type\n\nPrivate Type PicBmp\n    Size As Long\n    Type As Long\n    hBmp As Long\n    hPal As Long\n    Reserved As Long\nEnd Type\n\nPublic Sub prcSave_Picture_Screen(strPath As String) 'ganzer bildschirm\n    stdole.SavePicture hDCToPicture(GetDC(0&), 0&, 0&, _\n        GetSystemMetrics(SM_CXSCREEN), GetSystemMetrics(SM_CYSCREEN)), _\n        strPath 'anpassen !!!\nEnd Sub\n\nPublic Sub prcSave_Picture_Active_Window(strPath As String) 'aktives Fenster\n    Dim hwnd As Long\n    Dim udtRect As RECT\n    Sleep 3000 '3 sekunden pause um ein anderes Fenster zu aktivieren\n    hwnd = GetForegroundWindow\n    GetWindowRect hwnd, udtRect\n    stdole.SavePicture hDCToPicture(GetDC(0&), udtRect.Left, udtRect.Top, _\n        udtRect.Right - udtRect.Left, udtRect.Bottom - udtRect.Top), _\n        strPath 'anpassen !!!\nEnd Sub\n\n'Kobd\nPublic Sub prcSave_Picture_Active_Window_part(strPath As String, hwnd As Long) 'aktives Fenster'\n'    Dim Hwnd As Long\n    Dim udtRect As RECT\n    Const itwips As Long = 567\n    Sleep 100\n'    Hwnd = GetForegroundWindow\n    GetWindowRect hwnd, udtRect\n    stdole.SavePicture hDCToPicture(GetDC(0&), udtRect.Left, udtRect.Top, _\n        (udtRect.Right - udtRect.Left), (udtRect.Bottom - udtRect.Top)), _\n        strPath 'anpassen !!!\nEnd Sub\n\n\n'Kobd\n'Selbstdefinierter Ausschnitt eines Screens\nPublic Sub prcSave_Picture_Active_Window_part_cm(strPath As String, hwnd As Long, Optional Linkscm As Double = 0#, Optional Obencm As Double = 0#, Optional Breitecm As Double = 0#, Optional Hoehecm As Double = 0#)   'aktives Fenster'\nDim XYWert(3) As Long\n'cmToPixelsX\n'cmToPixelsY\n'    Dim Hwnd As Long\n    Dim udtRect As RECT\n    Const itwips As Long = 567\n    Sleep 100\n'    Hwnd = GetForegroundWindow\n    GetWindowRect hwnd, udtRect\n    \nIf Linkscm <> 0 Then\n    XYWert(0) = cmToPixelsX(Linkscm)\nElse\n    XYWert(0) = udtRect.Left\nEnd If\nIf Obencm <> 0 Then\n    XYWert(1) = cmToPixelsY(Obencm)\nElse\n    XYWert(1) = udtRect.Top\nEnd If\nIf Breitecm <> 0 Then\n    XYWert(2) = cmToPixelsX(Breitecm)\nElse\n    XYWert(2) = (udtRect.Right - udtRect.Left)\nEnd If\nIf Hoehecm <> 0 Then\n    XYWert(3) = cmToPixelsY(Hoehecm)\nElse\n    XYWert(3) = (udtRect.Bottom - udtRect.Top)\nEnd If\n    stdole.SavePicture hDCToPicture(GetDC(0&), XYWert(0), XYWert(1), _\n        XYWert(2), XYWert(3)), _\n        strPath 'anpassen !!!\nEnd Sub\n\n\nPrivate Function CreateBitmapPicture(ByVal hBmp As Long, ByVal hPal As Long) As Object\n    Dim Pic As PicBmp, IPic As IPicture, IID_IDispatch As guid\n    With IID_IDispatch\n        .Data1 = &H20400\n        .Data4(0) = &HC0\n        .Data4(7) = &H46\n    End With\n    With Pic\n        .Size = Len(Pic)\n        .Type = 1\n        .hBmp = hBmp\n        .hPal = hPal\n    End With\n    Call OleCreatePictureIndirect(Pic, IID_IDispatch, 1, IPic)\n    Set CreateBitmapPicture = IPic\nEnd Function\n\nPrivate Function hDCToPicture(ByVal hDCSrc As Long, ByVal LeftSrc As Long, _\n    ByVal TopSrc As Long, ByVal WidthSrc As Long, ByVal HeightSrc As Long) As Object\n    Dim hDCMemory As Long, hBmp As Long, hBmpPrev As Long\n    Dim hPal As Long, hPalPrev As Long, RasterCapsScrn As Long, HasPaletteScrn As Long\n    Dim PaletteSizeScrn As Long, LogPal As LOGPALETTE\n    hDCMemory = CreateCompatibleDC(hDCSrc)\n    hBmp = CreateCompatibleBitmap(hDCSrc, WidthSrc, HeightSrc)\n    hBmpPrev = SelectObject(hDCMemory, hBmp)\n    RasterCapsScrn = GetDeviceCaps(hDCSrc, RASTERCAPS)\n    HasPaletteScrn = RasterCapsScrn And RC_PALETTE\n    PaletteSizeScrn = GetDeviceCaps(hDCSrc, SIZEPALETTE)\n    If HasPaletteScrn And (PaletteSizeScrn = 256) Then\n        LogPal.palVersion = &H300\n        LogPal.palNumEntries = 256\n        Call GetSystemPaletteEntries(hDCSrc, 0, 256, LogPal.palPalEntry(0))\n        hPal = CreatePalette(LogPal)\n        hPalPrev = SelectPalette(hDCMemory, hPal, 0)\n        Call RealizePalette(hDCMemory)\n    End If\n    Call BitBlt(hDCMemory, 0, 0, WidthSrc, HeightSrc, hDCSrc, LeftSrc, TopSrc, 13369376)\n    hBmp = SelectObject(hDCMemory, hBmpPrev)\n    If HasPaletteScrn And (PaletteSizeScrn = 256) Then\n        hPal = SelectPalette(hDCMemory, hPalPrev, 0)\n    End If\n    Call DeleteDC(hDCMemory)\n    Set hDCToPicture = CreateBitmapPicture(hBmp, hPal)\nEnd Function\n\n\n'Private Declare PtrSafe Function apiGetFocus Lib \"user32\" Alias \"GetFocus\" () As Long\n\n         \nFunction fhWnd(ctl As control) As Long\n    On Error Resume Next\n    ctl.SetFocus\n    If err Then\n        fhWnd = 0\n    Else\n        fhWnd = apiGetFocus\n    End If\n    On Error GoTo 0\nEnd Function\n\n\n\n'''''Sample -Aufruf\n'Dim strPath As String\n'strPath = \"D:\\testxx.bmp\"\n'Call prcSave_Picture_Active_Window_part_cm(strPath, Me.hwnd, 21, 7, 10, 8) 'aktive hwnd'\n\n\n'''''#######################################\n\n' Anzeige in Pixel !!\n' 1 cm = 567 twips\n\n'Pixel X\n\n'Twips in Pixel X\nFunction TwipsToPixelsX(Twips As Long) As Long\n   TwipsToPixelsX = Twips / TwipsPerPixelX\nEnd Function\n\n'Pixel in Twips X\nFunction PixelsToTwipsX(Pixels As Long) As Long\n   PixelsToTwipsX = Pixels * TwipsPerPixelX\nEnd Function\n\n'cm in Pixel X\nFunction cmToPixelsX(cm As Double) As Long\nConst cm2Twips As Long = 567\nDim zwTwips As Long\nzwTwips = CLng(cm * cm2Twips)\ncmToPixelsX = TwipsToPixelsX(zwTwips)\nEnd Function\n\n'Pixel in cm X\nFunction PixelsTocmX(Pixels As Long) As Double\nConst cm2Twips As Long = 567\n   PixelsTocmX = (Pixels * TwipsPerPixelX) / cm2Twips\nEnd Function\n\n\n'Pixel Y\n\n'Twips in Pixel Y\nFunction TwipsToPixelsY(Twips As Long) As Long\n   TwipsToPixelsY = Twips / TwipsPerPixelY\nEnd Function\n\n'Pixel in Twips Y\nFunction PixelsToTwipsY(Pixels As Long) As Long\n   PixelsToTwipsY = Pixels * TwipsPerPixelY\nEnd Function\n\n'Pixel in cm Y\nFunction PixelsTocmY(Pixels As Long) As Double\nConst cm2Twips As Long = 567\n   PixelsTocmY = (Pixels * TwipsPerPixelY) / cm2Twips\nEnd Function\n\n\n'cm in Pixel Y\nFunction cmToPixelsY(cm As Double) As Long\nConst cm2Twips As Long = 567\nDim zwTwips As Long\nzwTwips = CLng(cm * cm2Twips)\ncmToPixelsY = TwipsToPixelsY(zwTwips)\nEnd Function\n"}
