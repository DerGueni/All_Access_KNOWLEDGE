{"id":"MOD_mdlNTGetIPAddress","name":"mdlNTGetIPAddress","kind":"standard","procedures":["Public Function GetIPAddress() As String","Public Function GetIPHostName() As String","Private Function HiByte(ByVal wParam As Integer)","Private Function LoByte(ByVal wParam As Integer)","Private Sub SocketsCleanup()","Private Function SocketsInitialize() As Boolean"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n\n'Wie kann ich die IP-Adresse einer NT4-Workstation herausfinden ?\n'Newsgroup - From: \"Marc\" <mveltrup@jjk.de>\n\nPrivate Const MAX_WSADescription = 256\nPrivate Const MAX_WSASYSStatus = 128\nPrivate Const ERROR_SUCCESS       As Long = 0\nPrivate Const WS_VERSION_REQD     As Long = &H101\nPrivate Const WS_VERSION_MAJOR    As Long = WS_VERSION_REQD \\ &H100 And &HFF&\nPrivate Const WS_VERSION_MINOR    As Long = WS_VERSION_REQD And &HFF&\nPrivate Const MIN_SOCKETS_REQD    As Long = 1\nPrivate Const SOCKET_ERROR        As Long = -1\n\nPrivate Type HOSTENT\n   hName      As Long\n   hAliases   As Long\n   hAddrType  As Integer\n   hLen       As Integer\n   hAddrList  As Long\nEnd Type\n\nPrivate Type WSADATA\n   wVersion      As Integer\n   wHighVersion  As Integer\n   szDescription(0 To MAX_WSADescription)   As Byte\n   szSystemStatus(0 To MAX_WSASYSStatus)    As Byte\n   wMaxSockets   As Integer\n   wMaxUDPDG     As Integer\n   dwVendorInfo  As Long\nEnd Type\n\nPrivate Declare PtrSafe Function WSAGetLastError Lib \"WSOCK32.DLL\" () As Long\n\nPrivate Declare PtrSafe Function WSAStartup Lib \"WSOCK32.DLL\" _\n   (ByVal wVersionRequired As Long, lpWSADATA As WSADATA) As Long\n\nPrivate Declare PtrSafe Function WSACleanup Lib \"WSOCK32.DLL\" () As Long\n\nPrivate Declare PtrSafe Function gethostname Lib \"WSOCK32.DLL\" _\n   (ByVal szHost As String, ByVal dwHostLen As Long) As Long\n\nPrivate Declare PtrSafe Function gethostbyname Lib \"WSOCK32.DLL\" _\n   (ByVal szHost As String) As Long\n\nPrivate Declare PtrSafe Sub CopyMemory Lib \"kernel32\" Alias \"RtlMoveMemory\" _\n   (hpvDest As Any, ByVal hpvSource As Long, ByVal cbCopy As Long)\n\nPublic Function GetIPAddress() As String\n\n   Dim sHostName    As String * 256\n   Dim lpHost    As Long\n   Dim host      As HOSTENT\n   Dim dwIPAddr  As Long\n   Dim tmpIPAddr() As Byte\n   Dim i         As Integer\n   Dim sIPAddr  As String\n      If Not SocketsInitialize() Then\n      GetIPAddress = \"\"\n      Exit Function\n   End If\n\n   If gethostname(sHostName, 256) = SOCKET_ERROR Then\n   GetIPAddress = \"\"\n      MsgBox \"Windows Sockets error \" & str$(WSAGetLastError()) & _\n              \" has occurred. Unable to successfully get Host Name.\"\n      SocketsCleanup\n      Exit Function\n      End If\n\n   lpHost = gethostbyname(sHostName)\n   If lpHost = 0 Then\n      GetIPAddress = \"\"\n      MsgBox \"Windows Sockets are not responding. \" & _\n              \"Unable to successfully get Host Name.\"\n              SocketsCleanup\n      Exit Function\n      End If\n\n  CopyMemory host, lpHost, Len(host)\n   CopyMemory dwIPAddr, host.hAddrList, 4\n\n  ReDim tmpIPAddr(1 To host.hLen)\n   CopyMemory tmpIPAddr(1), dwIPAddr, host.hLen\n\n  For i = 1 To host.hLen\n      sIPAddr = sIPAddr & tmpIPAddr(i) & \".\"\n      Next\n\n   GetIPAddress = Mid$(sIPAddr, 1, Len(sIPAddr) - 1)\n   SocketsCleanup\nEnd Function\n\nPublic Function GetIPHostName() As String\n\n    Dim sHostName As String * 256\n    If Not SocketsInitialize() Then\n        GetIPHostName = \"\"\n        Exit Function\n    End If\n    If gethostname(sHostName, 256) = SOCKET_ERROR Then\n        GetIPHostName = \"\"\n        MsgBox \"Windows Sockets error \" & str$(WSAGetLastError()) & _\n                \" has occurred.  Unable to successfully get Host Name.\"\n        SocketsCleanup\n        Exit Function\n        End If\n    GetIPHostName = Left$(sHostName, InStr(sHostName, Chr(0)) - 1)\n    SocketsCleanup\n    End Function\n    \n    \nPrivate Function HiByte(ByVal wParam As Integer)\n\n    HiByte = wParam \\ &H100 And &HFF&\nEnd Function\n\n\nPrivate Function LoByte(ByVal wParam As Integer)\n    \n    LoByte = wParam And &HFF&\nEnd Function\n\n\nPrivate Sub SocketsCleanup()\n\nIf WSACleanup() <> ERROR_SUCCESS Then\n        MsgBox \"Socket error occurred in Cleanup.\"\n        End If\n        End Sub\n\n\nPrivate Function SocketsInitialize() As Boolean\n\nDim WSAD As WSADATA\n   Dim sLoByte As String\n   Dim sHiByte As String\n   If WSAStartup(WS_VERSION_REQD, WSAD) <> ERROR_SUCCESS Then\n      MsgBox \"The 32-bit Windows Socket is not responding.\"\n      SocketsInitialize = False\n      Exit Function\n      End If\n   If WSAD.wMaxSockets < MIN_SOCKETS_REQD Then\n        MsgBox \"This application requires a minimum of \" & _\n                CStr(MIN_SOCKETS_REQD) & \" supported sockets.\"\n        SocketsInitialize = False\n        Exit Function\n        End If\n   If LoByte(WSAD.wVersion) < WS_VERSION_MAJOR Or _\n     (LoByte(WSAD.wVersion) = WS_VERSION_MAJOR And _\n      HiByte(WSAD.wVersion) < WS_VERSION_MINOR) Then\n      sHiByte = CStr(HiByte(WSAD.wVersion))\n      sLoByte = CStr(LoByte(WSAD.wVersion))\n      MsgBox \"Sockets version \" & sLoByte & \".\" & sHiByte & _\n             \" is not supported by 32-bit Windows Sockets.\"\n      SocketsInitialize = False\n      Exit Function\n      End If\n  'must be OK, so lets do it\n  SocketsInitialize = True\n  End Function\n"}
