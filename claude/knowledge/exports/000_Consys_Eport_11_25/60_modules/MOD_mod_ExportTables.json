{"id":"MOD_mod_ExportTables","name":"mod_ExportTables","kind":"standard","procedures":["Public Sub ExportTableDefsToJSON(ByVal exportPath As String)","Private Function GetFieldTypeName(fieldType As Integer) As String","Private Function GetFieldProperty(fld As DAO.field, propName As String) As Variant","Private Function GetIndexFields(idx As DAO.Index) As String"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"'═══════════════════════════════════════════════════════════════════════════════\n' Modul:     mod_ExportTables\n' Zweck:     Export aller Tabellen-Definitionen zu JSON\n' Autor:     Access-Forensiker Agent\n' Datum:     2025-10-31\n' Version:   1.0\n'═══════════════════════════════════════════════════════════════════════════════\n\nOption Compare Database\nOption Explicit\n\n'═══════════════════════════════════════════════════════════════════════════════\n' HAUPT-EXPORT-FUNKTION\n'═══════════════════════════════════════════════════════════════════════════════\n\nPublic Sub ExportTableDefsToJSON(ByVal exportPath As String)\n    On Error GoTo ErrorHandler\n    \n    Dim db As DAO.Database\n    Dim tdf As DAO.TableDef\n    Dim fld As DAO.field\n    Dim idx As DAO.Index\n    Dim f As Integer\n    Dim filePath As String\n    Dim firstTable As Boolean\n    Dim firstField As Boolean\n    Dim firstIndex As Boolean\n    Dim tableCount As Integer\n    \n    Set db = CurrentDb()\n    filePath = exportPath & \"\\tables.json\"\n    f = FreeFile\n    \n    Open filePath For Output As #f\n    \n    ' JSON-Array starten\n    Print #f, \"[\"\n    \n    firstTable = True\n    tableCount = 0\n    \n    ' Alle Tabellen durchgehen\n    For Each tdf In db.TableDefs\n        ' System-Tabellen überspringen\n        If Left$(tdf.Name, 4) <> \"MSys\" And Left$(tdf.Name, 1) <> \"~\" Then\n            \n            ' Komma vor weiteren Einträgen\n            If Not firstTable Then\n                Print #f, \",\"\n            End If\n            firstTable = False\n            tableCount = tableCount + 1\n            \n            ' Tabellen-Objekt öffnen\n            Print #f, \"  {\"\n            Print #f, \"    \"\"name\"\": \"\"\" & mod_ExportConsys.EscapeJSON(tdf.Name) & \"\"\",\"\n            Print #f, \"    \"\"recordCount\"\": \" & tdf.RecordCount & \",\"\n            Print #f, \"    \"\"dateCreated\"\": \"\"\" & Format(tdf.DateCreated, \"yyyy-mm-dd hh:nn:ss\") & \"\"\",\"\n            Print #f, \"    \"\"lastUpdated\"\": \"\"\" & Format(tdf.LastUpdated, \"yyyy-mm-dd hh:nn:ss\") & \"\"\",\"\n            \n            ' Felder exportieren\n            Print #f, \"    \"\"fields\"\": [\"\n            firstField = True\n            For Each fld In tdf.fields\n                If Not firstField Then\n                    Print #f, \",\"\n                End If\n                firstField = False\n                \n                Print #f, \"      {\"\n                Print #f, \"        \"\"name\"\": \"\"\" & mod_ExportConsys.EscapeJSON(fld.Name) & \"\"\",\"\n                Print #f, \"        \"\"type\"\": \" & fld.Type & \",\"\n                Print #f, \"        \"\"typeName\"\": \"\"\" & GetFieldTypeName(fld.Type) & \"\"\",\"\n                Print #f, \"        \"\"size\"\": \" & fld.Size & \",\"\n                Print #f, \"        \"\"required\"\": \" & LCase(fld.Required) & \",\"\n                Print #f, \"        \"\"allowZeroLength\"\": \" & LCase(GetFieldProperty(fld, \"AllowZeroLength\"))\n                \n                ' Default Value wenn vorhanden\n                If Len(Nz(fld.defaultValue, \"\")) > 0 Then\n                    Print #f, \",\"\n                    Print #f, \"        \"\"defaultValue\"\": \"\"\" & mod_ExportConsys.EscapeJSON(fld.defaultValue) & \"\"\"\"\n                End If\n                \n                ' Validation Rule wenn vorhanden\n                If Len(Nz(fld.ValidationRule, \"\")) > 0 Then\n                    Print #f, \",\"\n                    Print #f, \"        \"\"validationRule\"\": \"\"\" & mod_ExportConsys.EscapeJSON(fld.ValidationRule) & \"\"\",\"\n                    Print #f, \"        \"\"validationText\"\": \"\"\" & mod_ExportConsys.EscapeJSON(fld.ValidationText) & \"\"\"\"\n                End If\n                \n                Print #f, \"      }\"\n            Next fld\n            Print #f, \"    ],\"\n            \n            ' Indizes exportieren\n            Print #f, \"    \"\"indexes\"\": [\"\n            firstIndex = True\n            For Each idx In tdf.indexes\n                If Not firstIndex Then\n                    Print #f, \",\"\n                End If\n                firstIndex = False\n                \n                Print #f, \"      {\"\n                Print #f, \"        \"\"name\"\": \"\"\" & mod_ExportConsys.EscapeJSON(idx.Name) & \"\"\",\"\n                Print #f, \"        \"\"primary\"\": \" & LCase(idx.Primary) & \",\"\n                Print #f, \"        \"\"unique\"\": \" & LCase(idx.Unique) & \",\"\n                Print #f, \"        \"\"required\"\": \" & LCase(idx.Required) & \",\"\n                Print #f, \"        \"\"fields\"\": \"\"\" & GetIndexFields(idx) & \"\"\"\"\n                Print #f, \"      }\"\n            Next idx\n            Print #f, \"    ]\"\n            \n            Print #f, \"  }\"\n        End If\n    Next tdf\n    \n    ' JSON-Array schließen\n    Print #f, \"]\"\n    \n    Close #f\n    \n    Debug.Print \"      → \" & tableCount & \" Tabellen exportiert\"\n    \n    Exit Sub\n\nErrorHandler:\n    Close #f\n    Debug.Print \"      ✗ Fehler: \" & err.description\n    err.Raise err.Number, \"ExportTableDefsToJSON\", err.description\nEnd Sub\n\n'═══════════════════════════════════════════════════════════════════════════════\n' HILFSFUNKTIONEN\n'═══════════════════════════════════════════════════════════════════════════════\n\n' Gibt den Feld-Typ-Namen zurück\nPrivate Function GetFieldTypeName(fieldType As Integer) As String\n    Select Case fieldType\n        Case dbBoolean: GetFieldTypeName = \"Boolean\"\n        Case dbByte: GetFieldTypeName = \"Byte\"\n        Case dbInteger: GetFieldTypeName = \"Integer\"\n        Case dbLong: GetFieldTypeName = \"Long\"\n        Case dbCurrency: GetFieldTypeName = \"Currency\"\n        Case dbSingle: GetFieldTypeName = \"Single\"\n        Case dbDouble: GetFieldTypeName = \"Double\"\n        Case dbDate: GetFieldTypeName = \"Date/Time\"\n        Case dbText: GetFieldTypeName = \"Text\"\n        Case dbLongBinary: GetFieldTypeName = \"OLE Object\"\n        Case dbMemo: GetFieldTypeName = \"Memo\"\n        Case dbGUID: GetFieldTypeName = \"GUID\"\n        Case dbBigInt: GetFieldTypeName = \"BigInt\"\n        Case dbVarBinary: GetFieldTypeName = \"VarBinary\"\n        Case dbChar: GetFieldTypeName = \"Char\"\n        Case dbNumeric: GetFieldTypeName = \"Numeric\"\n        Case dbDecimal: GetFieldTypeName = \"Decimal\"\n        Case dbFloat: GetFieldTypeName = \"Float\"\n        Case dbTime: GetFieldTypeName = \"Time\"\n        Case dbTimeStamp: GetFieldTypeName = \"TimeStamp\"\n        Case Else: GetFieldTypeName = \"Unknown (\" & fieldType & \")\"\n    End Select\nEnd Function\n\n' Gibt Field-Property zurück\nPrivate Function GetFieldProperty(fld As DAO.field, propName As String) As Variant\n    On Error Resume Next\n    GetFieldProperty = fld.Properties(propName)\n    If err.Number <> 0 Then\n        GetFieldProperty = False\n    End If\n    On Error GoTo 0\nEnd Function\n\n' Gibt Index-Felder als kommaseparierte Liste zurück\nPrivate Function GetIndexFields(idx As DAO.Index) As String\n    Dim fld As DAO.field\n    Dim fieldList As String\n    \n    fieldList = \"\"\n    For Each fld In idx.fields\n        If Len(fieldList) > 0 Then\n            fieldList = fieldList & \", \"\n        End If\n        fieldList = fieldList & fld.Name\n    Next fld\n    \n    GetIndexFields = fieldList\nEnd Function"}
