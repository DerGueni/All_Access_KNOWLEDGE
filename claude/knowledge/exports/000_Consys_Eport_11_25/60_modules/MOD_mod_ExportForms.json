{"id":"MOD_mod_ExportForms","name":"mod_ExportForms","kind":"standard","procedures":["Public Sub ExportFormsToJSON(ByVal exportPath As String)","Private Function ExportSingleFormSafe(fileNum As Integer, formName As String) As Boolean","Private Function SafeGetProperty(obj As Object, propName As String, defaultValue As Variant) As Variant","Private Sub ExportControl(fileNum As Integer, ctl As control)","Private Sub ExportFormEvent(fileNum As Integer, frm As Form, eventName As String, ByRef isFirst As Boolean)","Private Sub ExportControlEvent(fileNum As Integer, ctl As control, eventName As String, ByRef isFirst As Boolean)","Public Function GetControlTypeName(ctl As control) As String","Private Function GetControlProperty(ctl As control, propName As String) As Variant"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' Modul:     mod_ExportForms\n' Zweck:     Export aller Formular-Definitionen zu JSON\n' Autor:     Access-Forensiker Agent\n' Datum:     2025-10-31\n' Version:   1.1 - Mit verbesserter Fehlerbehandlung\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nOption Compare Database\nOption Explicit\n\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' HAUPT-EXPORT-FUNKTION\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nPublic Sub ExportFormsToJSON(ByVal exportPath As String)\n    On Error GoTo ErrorHandler\n    \n    Dim f As Integer\n    Dim filePath As String\n    Dim i As Integer\n    Dim firstForm As Boolean\n    Dim formCount As Integer\n    Dim skippedCount As Integer\n    Dim af As Access.AccessObject\n    \n    filePath = exportPath & \"\\forms.json\"\n    f = FreeFile\n    \n    Open filePath For Output As #f\n    \n    ' JSON-Array starten\n    Print #f, \"[\"\n    \n    firstForm = True\n    formCount = 0\n    skippedCount = 0\n    \n    ' Alle Formulare durchgehen\n    For i = 0 To CurrentProject.AllForms.Count - 1\n        Set af = CurrentProject.AllForms(i)\n        \n        ' Formular im Design-Modus Ã¶ffnen\n        On Error Resume Next\n        DoCmd.OpenForm af.Name, acDesign, , , , acHidden\n        \n        If err.Number = 0 Then\n            On Error GoTo ErrorHandler\n            \n            ' Komma vor weiteren EintrÃ¤gen\n            If Not firstForm Then\n                Print #f, \",\"\n            End If\n            firstForm = False\n            formCount = formCount + 1\n            \n            ' Formular-Objekt exportieren (mit Fehlerbehandlung)\n            If Not ExportSingleFormSafe(f, af.Name) Then\n                ' Bei Fehler: Placeholder einfÃ¼gen\n                Debug.Print \"      âš  Formular '\" & af.Name & \"' teilweise exportiert (mit Fehlern)\"\n                skippedCount = skippedCount + 1\n            End If\n            \n            ' Formular schlieÃŸen ohne Speichern\n            DoCmd.Close acForm, af.Name, acSaveNo\n        Else\n            ' Fehler beim Ã–ffnen - Placeholder einfÃ¼gen\n            Debug.Print \"      âš  Formular '\" & af.Name & \"' konnte nicht geÃ¶ffnet werden: \" & err.description\n            \n            If Not firstForm Then\n                Print #f, \",\"\n            End If\n            firstForm = False\n            \n            Print #f, \"  {\"\n            Print #f, \"    \"\"name\"\": \"\"\" & mod_ExportConsys.EscapeJSON(af.Name) & \"\"\",\"\n            Print #f, \"    \"\"error\"\": \"\"Could not open form - \" & mod_ExportConsys.EscapeJSON(err.description) & \"\"\",\"\n            Print #f, \"    \"\"recordSource\"\": \"\"ERROR\"\",\"\n            Print #f, \"    \"\"controls\"\": []\"\n            Print #f, \"  }\"\n            \n            skippedCount = skippedCount + 1\n            On Error GoTo ErrorHandler\n        End If\n    Next i\n    \n    ' JSON-Array schlieÃŸen\n    Print #f, \"]\"\n    \n    Close #f\n    \n    Debug.Print \"      â†’ \" & formCount & \" Formulare exportiert\"\n    If skippedCount > 0 Then\n        Debug.Print \"      âš  \" & skippedCount & \" Formulare mit Fehlern/Warnungen\"\n    End If\n    \n    Exit Sub\n\nErrorHandler:\n    On Error Resume Next\n    Close #f\n    DoCmd.Close acForm, , acSaveNo\n    On Error GoTo 0\n    Debug.Print \"      âœ— Fehler: \" & err.description\n    err.Raise err.Number, \"ExportFormsToJSON\", err.description\nEnd Sub\n\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' EINZELNES FORMULAR EXPORTIEREN (MIT FEHLERBEHANDLUNG)\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nPrivate Function ExportSingleFormSafe(fileNum As Integer, formName As String) As Boolean\n    On Error GoTo FormError\n    \n    Dim frm As Form\n    Dim ctl As control\n    Dim firstCtrl As Boolean\n    Dim firstEvent As Boolean\n    Dim hadError As Boolean\n    \n    hadError = False\n    Set frm = Forms(formName)\n    \n    ' Formular-Basis-Infos\n    Print #fileNum, \"  {\"\n    Print #fileNum, \"    \"\"name\"\": \"\"\" & mod_ExportConsys.EscapeJSON(formName) & \"\"\",\"\n    Print #fileNum, \"    \"\"caption\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(SafeGetProperty(frm, \"Caption\", \"\"), \"\")) & \"\"\",\"\n    \n    ' RecordSource mit Fehlerbehandlung\n    Dim recordSource As String\n    On Error Resume Next\n    recordSource = frm.recordSource\n    If err.Number <> 0 Then\n        recordSource = \"ERROR: \" & err.description\n        hadError = True\n        err.clear\n    End If\n    On Error GoTo FormError\n    \n    Print #fileNum, \"    \"\"recordSource\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(recordSource, \"\")) & \"\"\",\"\n    Print #fileNum, \"    \"\"defaultView\"\": \" & SafeGetProperty(frm, \"DefaultView\", 0) & \",\"\n    Print #fileNum, \"    \"\"viewsAllowed\"\": \" & SafeGetProperty(frm, \"ViewsAllowed\", 0) & \",\"\n    Print #fileNum, \"    \"\"allowAdditions\"\": \" & LCase(SafeGetProperty(frm, \"AllowAdditions\", False)) & \",\"\n    Print #fileNum, \"    \"\"allowDeletions\"\": \" & LCase(SafeGetProperty(frm, \"AllowDeletions\", False)) & \",\"\n    Print #fileNum, \"    \"\"allowEdits\"\": \" & LCase(SafeGetProperty(frm, \"AllowEdits\", False)) & \",\"\n    Print #fileNum, \"    \"\"dataEntry\"\": \" & LCase(SafeGetProperty(frm, \"DataEntry\", False)) & \",\"\n    Print #fileNum, \"    \"\"recordSelectors\"\": \" & LCase(SafeGetProperty(frm, \"RecordSelectors\", True)) & \",\"\n    Print #fileNum, \"    \"\"navigationButtons\"\": \" & LCase(SafeGetProperty(frm, \"NavigationButtons\", True)) & \",\"\n    Print #fileNum, \"    \"\"popUp\"\": \" & LCase(SafeGetProperty(frm, \"PopUp\", False)) & \",\"\n    Print #fileNum, \"    \"\"modal\"\": \" & LCase(SafeGetProperty(frm, \"Modal\", False)) & \",\"\n    \n    ' Filter und OrderBy\n    Print #fileNum, \"    \"\"filter\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(SafeGetProperty(frm, \"Filter\", \"\"), \"\")) & \"\"\",\"\n    Print #fileNum, \"    \"\"orderBy\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(SafeGetProperty(frm, \"OrderBy\", \"\"), \"\")) & \"\"\",\"\n    Print #fileNum, \"    \"\"filterOnLoad\"\": \" & LCase(SafeGetProperty(frm, \"FilterOnLoad\", False)) & \",\"\n    Print #fileNum, \"    \"\"orderByOnLoad\"\": \" & LCase(SafeGetProperty(frm, \"OrderByOnLoad\", False)) & \",\"\n    \n    ' Events exportieren\n    Print #fileNum, \"    \"\"events\"\": {\"\n    firstEvent = True\n    ExportFormEvent fileNum, frm, \"OnLoad\", firstEvent\n    ExportFormEvent fileNum, frm, \"OnOpen\", firstEvent\n    ExportFormEvent fileNum, frm, \"OnClose\", firstEvent\n    ExportFormEvent fileNum, frm, \"OnCurrent\", firstEvent\n    ExportFormEvent fileNum, frm, \"BeforeUpdate\", firstEvent\n    ExportFormEvent fileNum, frm, \"AfterUpdate\", firstEvent\n    ExportFormEvent fileNum, frm, \"OnActivate\", firstEvent\n    ExportFormEvent fileNum, frm, \"OnDeactivate\", firstEvent\n    Print #fileNum, \"    },\"\n    \n    ' Controls exportieren\n    Print #fileNum, \"    \"\"controls\"\": [\"\n    firstCtrl = True\n    \n    On Error Resume Next\n    For Each ctl In frm.controls\n        If err.Number = 0 Then\n            If Not firstCtrl Then\n                Print #fileNum, \",\"\n            End If\n            firstCtrl = False\n            \n            ExportControl fileNum, ctl\n        Else\n            ' Fehler bei diesem Control - weitermachen\n            err.clear\n        End If\n    Next ctl\n    On Error GoTo FormError\n    \n    Print #fileNum, \"    ]\"\n    Print #fileNum, \"  }\"\n    \n    ExportSingleFormSafe = Not hadError\n    Exit Function\n\nFormError:\n    ' Bei kritischem Fehler: Minimal-Export\n    Print #fileNum, \"  {\"\n    Print #fileNum, \"    \"\"name\"\": \"\"\" & mod_ExportConsys.EscapeJSON(formName) & \"\"\",\"\n    Print #fileNum, \"    \"\"error\"\": \"\"Export failed - \" & mod_ExportConsys.EscapeJSON(err.description) & \"\"\",\"\n    Print #fileNum, \"    \"\"recordSource\"\": \"\"ERROR\"\",\"\n    Print #fileNum, \"    \"\"controls\"\": []\"\n    Print #fileNum, \"  }\"\n    ExportSingleFormSafe = False\nEnd Function\n\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' SICHERE PROPERTY-ABFRAGE\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nPrivate Function SafeGetProperty(obj As Object, propName As String, defaultValue As Variant) As Variant\n    On Error Resume Next\n    SafeGetProperty = obj.Properties(propName)\n    If err.Number <> 0 Then\n        SafeGetProperty = defaultValue\n    End If\n    On Error GoTo 0\nEnd Function\n\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' CONTROL EXPORTIEREN\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nPrivate Sub ExportControl(fileNum As Integer, ctl As control)\n    Dim firstEvent As Boolean\n    \n    On Error Resume Next\n    \n    Print #fileNum, \"      {\"\n    Print #fileNum, \"        \"\"name\"\": \"\"\" & mod_ExportConsys.EscapeJSON(ctl.Name) & \"\"\",\"\n    Print #fileNum, \"        \"\"controlType\"\": \" & ctl.ControlType & \",\"\n    Print #fileNum, \"        \"\"controlTypeName\"\": \"\"\" & GetControlTypeName(ctl.ControlType) & \"\"\",\"\n    Print #fileNum, \"        \"\"controlSource\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(GetControlProperty(ctl, \"ControlSource\"), \"\")) & \"\"\",\"\n    \n    ' Spezielle Properties je nach Control-Typ\n    Select Case ctl.ControlType\n        Case acTextBox, acComboBox, acListBox\n            Print #fileNum, \"        \"\"rowSource\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(GetControlProperty(ctl, \"RowSource\"), \"\")) & \"\"\",\"\n            Print #fileNum, \"        \"\"rowSourceType\"\": \"\"\" & GetControlProperty(ctl, \"RowSourceType\") & \"\"\",\"\n        Case acCommandButton\n            Print #fileNum, \"        \"\"caption\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(GetControlProperty(ctl, \"Caption\"), \"\")) & \"\"\",\"\n        Case acLabel\n            Print #fileNum, \"        \"\"caption\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(GetControlProperty(ctl, \"Caption\"), \"\")) & \"\"\",\"\n        Case acSubform\n            Print #fileNum, \"        \"\"sourceObject\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(GetControlProperty(ctl, \"SourceObject\"), \"\")) & \"\"\",\"\n            Print #fileNum, \"        \"\"linkChildFields\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(GetControlProperty(ctl, \"LinkChildFields\"), \"\")) & \"\"\",\"\n            Print #fileNum, \"        \"\"linkMasterFields\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(GetControlProperty(ctl, \"LinkMasterFields\"), \"\")) & \"\"\",\"\n    End Select\n    \n    ' Visible und Enabled\n    Print #fileNum, \"        \"\"visible\"\": \" & LCase(GetControlProperty(ctl, \"Visible\")) & \",\"\n    Print #fileNum, \"        \"\"enabled\"\": \" & LCase(GetControlProperty(ctl, \"Enabled\")) & \",\"\n    Print #fileNum, \"        \"\"locked\"\": \" & LCase(GetControlProperty(ctl, \"Locked\")) & \",\"\n    \n    ' Events exportieren\n    Print #fileNum, \"        \"\"events\"\": {\"\n    firstEvent = True\n    ExportControlEvent fileNum, ctl, \"OnClick\", firstEvent\n    ExportControlEvent fileNum, ctl, \"OnDblClick\", firstEvent\n    ExportControlEvent fileNum, ctl, \"BeforeUpdate\", firstEvent\n    ExportControlEvent fileNum, ctl, \"AfterUpdate\", firstEvent\n    ExportControlEvent fileNum, ctl, \"OnEnter\", firstEvent\n    ExportControlEvent fileNum, ctl, \"OnExit\", firstEvent\n    ExportControlEvent fileNum, ctl, \"OnGotFocus\", firstEvent\n    ExportControlEvent fileNum, ctl, \"OnLostFocus\", firstEvent\n    ExportControlEvent fileNum, ctl, \"OnChange\", firstEvent\n    Print #fileNum, \"        }\"\n    \n    Print #fileNum, \"      }\"\n    \n    On Error GoTo 0\nEnd Sub\n\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' EVENT EXPORTIEREN\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nPrivate Sub ExportFormEvent(fileNum As Integer, frm As Form, eventName As String, ByRef isFirst As Boolean)\n    Dim eventValue As String\n    On Error Resume Next\n    eventValue = frm.Properties(eventName)\n    If err.Number = 0 And Len(Nz(eventValue, \"\")) > 0 Then\n        If Not isFirst Then Print #fileNum, \",\"\n        isFirst = False\n        Print #fileNum, \"      \"\"\" & eventName & \"\"\": \"\"\" & mod_ExportConsys.EscapeJSON(eventValue) & \"\"\"\"\n    End If\n    On Error GoTo 0\nEnd Sub\n\nPrivate Sub ExportControlEvent(fileNum As Integer, ctl As control, eventName As String, ByRef isFirst As Boolean)\n    Dim eventValue As String\n    On Error Resume Next\n    eventValue = ctl.Properties(eventName)\n    If err.Number = 0 And Len(Nz(eventValue, \"\")) > 0 Then\n        If Not isFirst Then Print #fileNum, \",\"\n        isFirst = False\n        Print #fileNum, \"          \"\"\" & eventName & \"\"\": \"\"\" & mod_ExportConsys.EscapeJSON(eventValue) & \"\"\"\"\n    End If\n    On Error GoTo 0\nEnd Sub\n\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' HILFSFUNKTIONEN\n'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nPublic Function GetControlTypeName(ctl As control) As String\n    Select Case ctl.ControlType\n        Case Access.acOptionGroup:      GetControlTypeName = \"OptionGroup\"\n        Case Access.acBoundObjectFrame: GetControlTypeName = \"BoundObjectFrame\"\n        Case Access.acCheckBox:         GetControlTypeName = \"CheckBox\"\n        Case Access.acComboBox:         GetControlTypeName = \"ComboBox\"\n        Case Access.acCommandButton:    GetControlTypeName = \"CommandButton\"\n        Case Access.acTextBox:          GetControlTypeName = \"TextBox\"\n        Case Access.acListBox:          GetControlTypeName = \"ListBox\"\n        Case Access.acLabel:            GetControlTypeName = \"Label\"\n        Case Access.acImage:            GetControlTypeName = \"Image\"\n        Case Access.acLine:             GetControlTypeName = \"Line\"\n        Case Access.acRectangle:        GetControlTypeName = \"Rectangle\"\n        Case Access.acSubform:          GetControlTypeName = \"Subform\"\n        Case Access.acObjectFrame:      GetControlTypeName = \"ObjectFrame\"\n        Case Access.acPageBreak:        GetControlTypeName = \"PageBreak\"\n        Case Access.acCustomControl:    GetControlTypeName = \"CustomControl\"\n        Case Access.acToggleButton:     GetControlTypeName = \"ToggleButton\"\n        Case Access.acTabCtl:           GetControlTypeName = \"TabControl\"   ' <— nicht acTab!\n        Case Access.acPage:             GetControlTypeName = \"Page\"\n        Case Else\n            GetControlTypeName = \"Unknown (\" & ctl.ControlType & \")\"\n    End Select\nEnd Function\n\nPrivate Function GetControlProperty(ctl As control, propName As String) As Variant\n    On Error Resume Next\n    GetControlProperty = ctl.Properties(propName)\n    If err.Number <> 0 Then\n        GetControlProperty = Null\n    End If\n    On Error GoTo 0\nEnd Function"}
