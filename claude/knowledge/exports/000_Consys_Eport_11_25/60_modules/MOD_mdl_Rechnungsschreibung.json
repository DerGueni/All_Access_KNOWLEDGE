{"id":"MOD_mdl_Rechnungsschreibung","name":"mdl_Rechnungsschreibung","kind":"standard","procedures":["Function fPDF_Datei(s As String)","Function fPDF_Pos_Datei(s As String)","Function fMahnDat(iStufe As Long) As Long","Public Function Zahlbed_Zahlbar_Bis(ZahlBed_ID As Long) As Date","Public Function Zahlbed_Zahlbar_BetragNetto(ZahlBed_ID As Long, betrag As Currency) As Currency","Public Function Zahlbed_Text(ZahlBed_ID As Long, betrag As Currency) As String","Function Update_Rch_Nr(iID As Long) As Long"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n\nFunction fPDF_Datei(s As String)\nDim i As Long\n\nIf Len(Trim(Nz(s))) = 0 Then Exit Function\ni = InStrRev(s, \".\")\nIf i > 0 Then\n    fPDF_Datei = Left(s, i) & \"pdf\"\nEnd If\nIf Not File_exist(fPDF_Datei) Then fPDF_Datei = \"\"\nEnd Function\n\nFunction fPDF_Pos_Datei(s As String)\nDim i As Long\n\nIf Len(Trim(Nz(s))) = 0 Then Exit Function\ni = InStrRev(s, \".\")\nIf i > 0 Then\n    fPDF_Pos_Datei = Left(s, i - 1) & \"_Pos.pdf\"\nEnd If\nIf Not File_exist(fPDF_Pos_Datei) Then fPDF_Pos_Datei = \"\"\nEnd Function\n\nFunction fMahnDat(iStufe As Long) As Long\nDim i As Long\ni = TLookup(\"Mahn\" & iStufe & \"Tage\", \"_tblEigeneFIrma\", \"FirmenID = 1\")\nfMahnDat = i\nEnd Function\n\nPublic Function Zahlbed_Zahlbar_Bis(ZahlBed_ID As Long) As Date\nDim i As Long\ni = Nz(TLookup(\"AnzTage\", \"_tblEigeneFirma_Zahlungsbedingungen\", \"ID = \" & ZahlBed_ID), 0)\nZahlbed_Zahlbar_Bis = Date + i\nEnd Function\n\nPublic Function Zahlbed_Zahlbar_BetragNetto(ZahlBed_ID As Long, betrag As Currency) As Currency\nDim sd As Single\nsd = Nz(TLookup(\"Skonto\", \"_tblEigeneFirma_Zahlungsbedingungen\", \"ID = \" & ZahlBed_ID), 0)\nZahlbed_Zahlbar_BetragNetto = fctround(betrag - (betrag * sd))\nEnd Function\n\n''Public Function Get_NeueNr(Optional iArt As Long = 1) As String\n'''CONSEC 5 stellig mit führender Null\n''Select Case iArt\n''    Case 1 ' Rechnung\n''    Case 2 ' Angebot\n''    Case 3 ' Brief\n''    Case 4 ' MA\n''\n''End Function\n\n\nPublic Function Zahlbed_Text(ZahlBed_ID As Long, betrag As Currency) As String\n\nDim zwtext As String\nDim i As Long\nDim zwcur As Currency\n\nDim ArrFill_DAO_OK1 As Boolean, recsetSQL1 As String, iZLMax1 As Long, iColMax1 As Long, DAOARRAY1, iZl As Long, iCol As Long\nrecsetSQL1 = \"SELECT ID, Zahlungsbedingung, AnzTage, Zahlbar_bis_Text, Teil2_Text, Skonto, Teil3_Text FROM _tblEigeneFirma_Zahlungsbedingungen WHERE ID = \" & ZahlBed_ID\nArrFill_DAO_OK1 = ArrFill_DAO_Acc(recsetSQL1, iZLMax1, iColMax1, DAOARRAY1)\n'Info:   'AccessArray(iSpalte,iZeile) <0, 0>\n\n'_tblEigeneFirma_Zahlungsbedingungen\n'Field Name\n'==========\n'0 - ID\n'1 - Zahlungsbedingung\n'2 - AnzTage\n'3 - Zahlbar_bis_Text\n'4 - Teil2_Text\n'5 - Skonto\n'6 - Teil3_Text\n'==========\n\n\nIf ArrFill_DAO_OK1 Then\n\n    zwtext = DAOARRAY1(3, 0)\n    i = DAOARRAY1(2, 0)\n    If i > 0 Then\n        zwtext = zwtext & \" \" & Format(Date + i, \"short date\", 2, 2) & \" \" & DAOARRAY1(4, 0)\n    End If\n    If Len(Trim(Nz(betrag))) > 0 Then\n        If betrag > 0 And DAOARRAY1(5, 0) > 0 Then\n            zwcur = fctround(betrag - (betrag * DAOARRAY1(5, 0)))\n            zwtext = zwtext & \" \" & Format(zwcur, \"Currency\")\n            zwtext = zwtext & \" \" & DAOARRAY1(6, 0)\n        End If\n    End If\n    Zahlbed_Text = zwtext\n    \n    Set DAOARRAY1 = Nothing\nEnd If\n\nEnd Function\n\nFunction Update_Rch_Nr(iID As Long) As Long\nDim i As Long\nDim strSQL As String\n\ni = Nz(TLookup(\"NummernKreis\", \"_tblEigeneFirma_Word_Nummernkreise\", \"ID = \" & iID), 0) + 1\n\nstrSQL = \"\"\nstrSQL = strSQL & \"UPDATE _tblEigeneFirma_Word_Nummernkreise SET [_tblEigeneFirma_Word_Nummernkreise].NummernKreis = \" & i\nstrSQL = strSQL & \" WHERE ((([_tblEigeneFirma_Word_Nummernkreise].ID)= \" & iID & \"));\"\nCurrentDb.Execute (strSQL)\nDoEvents\nUpdate_Rch_Nr = i\n\nEnd Function"}
