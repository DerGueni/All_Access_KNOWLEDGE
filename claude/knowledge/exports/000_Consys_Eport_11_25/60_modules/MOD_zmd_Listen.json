{"id":"MOD_zmd_Listen","name":"zmd_Listen","kind":"standard","procedures":["Function Stundenliste_erstellen(VA_ID As Long, Optional MA_ID As Long)"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n\n\nFunction Stundenliste_erstellen(VA_ID As Long, Optional MA_ID As Long)\n\nDim xlApp As Object, xlWB As Object, xlWS As Object, i As Integer, sql As String, rs As Recordset, rows As Integer, Count As Integer, Datum_Datei As String, _\nVADatum As Date, MA_Start As Date, MA_Ende As Date, StdGes As Double, StdTag As Double, stdNACHT As Double, stdSONNTAG As Double, StdFeiertag As Double\n\n    \n    Set xlApp = CreateObject(\"Excel.Application\")\n    xlApp.Visible = True\n    xlApp.WindowState = -4137 'xlMaximized\n    Set xlWB = xlApp.Workbooks.Add\n    Set xlWS = xlWB.Sheets(1)\n\n   \n    \n    With xlWS\n        .Range(\"A2\") = TLookup(\"Auftrag\", AUFTRAGSTAMM, \"ID = \" & VA_ID)\n        .Range(\"D2\") = TLookup(\"Ort\", AUFTRAGSTAMM, \"ID = \" & VA_ID)\n        .Range(\"F2\") = TLookup(\"Objekt\", AUFTRAGSTAMM, \"ID = \" & VA_ID)\n        If Not IsInitial(MA_ID) Then .Range(\"A2\") = .Range(\"A2\") & \" \" & TLookup(\"Nachname\", MASTAMM, \"ID = \" & MA_ID) & \" \" & TLookup(\"Vorname\", MASTAMM, \"ID = \" & MA_ID)\n        .Range(\"A2\").Font.FontStyle = \"Fett\"\n        .Range(\"A4\") = \"Datum\"\n        .Range(\"B4\") = \"Name\"\n        .Range(\"C4\") = \"Vorname\"\n        .Range(\"D4\") = \"von\"\n        .Range(\"E4\") = \"bis\"\n        .Range(\"F4\") = \"Gesamt\"\n        .Range(\"G4\") = \"Tag\"\n        .Range(\"H4\") = \"Nacht\"\n        .Range(\"I4\") = \"Sonntag\"\n        .Range(\"J4\") = \"Feiertag\"\n        .Range(\"K4\") = \"Bezeichnung\"\n        .Range(\"A4:K4\").Font.FontStyle = \"Fett\"\n        \n        sql = \"SELECT * FROM \" & ZUORDNUNG & \" WHERE VA_ID = \" & VA_ID\n        \n        If Not IsInitial(MA_ID) Then sql = sql & \" AND MA_ID = \" & MA_ID\n        \n        Set rs = CurrentDb.OpenRecordset(sql, 8)\n        i = 5\n        Do\n             VADatum = rs.fields(\"VADatum\")\n             MA_Start = Format(rs.fields(\"MA_Start\"), \"HH:MM\")\n             MA_Ende = rs.fields(\"MA_Ende\")\n             StdGes = Round(stunden(MA_Start, MA_Ende), 2)\n             stdNACHT = Round(Stunden_Zuschlag(VADatum, MA_Start, MA_Ende, \"NACHT\"), 2)\n             stdSONNTAG = Round(Stunden_Zuschlag(VADatum, MA_Start, MA_Ende, \"SONNTAG\") + Stunden_Zuschlag(VADatum, MA_Start, MA_Ende, \"SONNTAGNACHT\"), 2)\n             StdFeiertag = Round(Stunden_Zuschlag(VADatum, MA_Start, MA_Ende, \"FEIERTAG\") + Stunden_Zuschlag(VADatum, MA_Start, MA_Ende, \"FEIERTAGNACHT\"), 2)\n             StdTag = Round(StdGes - stdNACHT - stdSONNTAG - StdFeiertag, 2)\n            .Range(\"A\" & i) = VADatum\n            .Range(\"B\" & i) = TLookup(\"Nachname\", MASTAMM, \"ID = \" & rs.fields(\"MA_ID\"))\n            .Range(\"C\" & i) = TLookup(\"Vorname\", MASTAMM, \"ID = \" & rs.fields(\"MA_ID\"))\n            .Range(\"D\" & i) = rs.fields(\"MA_Start\")\n            .Range(\"D\" & i).NumberFormat = \"hh:mm;@\"\n            .Range(\"E\" & i) = rs.fields(\"MA_Ende\")\n            .Range(\"E\" & i).NumberFormat = \"hh:mm;@\"\n            .Range(\"F\" & i) = StdGes\n            .Range(\"G\" & i) = StdTag\n            .Range(\"H\" & i) = stdNACHT\n            .Range(\"I\" & i) = stdSONNTAG\n            .Range(\"J\" & i) = StdFeiertag\n            .Range(\"K\" & i) = rs.fields(\"Bemerkungen\")\n            .Range(\"F:J\").HorizontalAlignment = xlRight\n            .Range(\"D:E\").HorizontalAlignment = xlCenter\n            .Range(\"B:C\").EntireColumn.AutoFit\n            .Range(\"K:K\").EntireColumn.AutoFit\n\n            rs.MoveNext\n            i = i + 1\n            \n        Loop Until rs.EOF\n        \n        rows = i - 4\n        Count = .UsedRange.rows.Count\n        '.rows(4).AutoFilter\n        \n    End With\n    \n    With xlWS.Sort\n        .SortFields.clear\n        .SortFields.Add key:=xlWS.Range(\"A4:A\" & Count + 1), SortOn:=0, Order:=1, DataOption:=0 ', SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal\n        .SortFields.Add key:=xlWS.Range(\"D4:D\" & Count + 1), SortOn:=0, Order:=1, DataOption:=0\n        .SortFields.Add key:=xlWS.Range(\"B4:B\" & Count + 1), SortOn:=0, Order:=1, DataOption:=0\n        .SetRange xlWS.Range(\"A4:K\" & Count + 1)\n        .Header = 1\n        .MatchCase = False\n        .Orientation = 1\n        .SortMethod = 1\n        .Apply\n        \n    End With\n    \n    With xlWS\n        .Range(\"A5:A\" & .UsedRange.rows.Count + 1).NumberFormat = \"DDD. DD.MM.YY\"\n        .Range(\"F\" & Count + 3).FormulaR1C1 = \"=SUM(R[-\" & rows & \"]C:R[-2]C)\"\n        .Range(\"G\" & Count + 3).FormulaR1C1 = \"=SUM(R[-\" & rows & \"]C:R[-2]C)\"\n        .Range(\"H\" & Count + 3).FormulaR1C1 = \"=SUM(R[-\" & rows & \"]C:R[-2]C)\"\n        .Range(\"I\" & Count + 3).FormulaR1C1 = \"=SUM(R[-\" & rows & \"]C:R[-2]C)\"\n        .Range(\"J\" & Count + 3).FormulaR1C1 = \"=SUM(R[-\" & rows & \"]C:R[-2]C)\"\n        .PageSetup.Orientation = 2 'xlLandscape\n        .PageSetup.PaperSize = 9 'xlPaperA4\n        .PageSetup.Zoom = False\n        .PageSetup.FitToPagesWide = 1\n        .PageSetup.FitToPagesTall = 1\n        .PageSetup.PrintArea = .UsedRange.address\n        \n    End With\n        \n\n    \n    Datum_Datei = Format(xlWS.Range(\"A5\"), \"MM-DD-YY\")\n    xlWB.SaveAs PfadPlanungAktuell & Datum_Datei & \" \" & xlWS.Range(\"A2\") & \" Namensliste\" & \".xlsx\"\n    \nEnd Function\n\n'Function Stundenliste_erstellen(VA_ID As Long)\n'\n'Dim xlApp As Object, xlWB As Object, xlWS As Object, i As Integer, SQL As String, rs As Recordset, rows As Integer, count As Integer, Datum_Datei As String, _\n'VADatum As Date, MA_Start As Date, MA_Ende As Date, StdGes As Double, StdTag As Double, stdNACHT As Double, stdSONNTAG As Double, StdFeiertag As Double\n'\n'\n'    Set xlApp = CreateObject(\"Excel.Application\")\n'    xlApp.Visible = True\n'    Set xlWB = xlApp.Workbooks.Add\n'    Set xlWS = xlWB.sheets(1)\n'\n'    With xlWS\n'        .Range(\"A2\") = TLookup(\"Auftrag\", \"tbl_VA_Auftragstamm\", \"ID = \" & VA_ID)\n'        .Range(\"A2\").Font.FontStyle = \"Fett\"\n'        .Range(\"A4\") = \"Datum\"\n'        .Range(\"B4\") = \"Name\"\n'        .Range(\"C4\") = \"Vorname\"\n'        .Range(\"D4\") = \"von\"\n'        .Range(\"E4\") = \"bis\"\n'        .Range(\"F4\") = \"Gesamt\"\n'        .Range(\"G4\") = \"Tag\"\n'        .Range(\"H4\") = \"Nacht\"\n'        .Range(\"I4\") = \"Sonntag\"\n'        .Range(\"J4\") = \"Feiertag\"\n'        .Range(\"K4\") = \"Bezeichnung\"\n'        .Range(\"A4:K4\").Font.FontStyle = \"Fett\"\n'\n'\n'        SQL = \"SELECT * FROM \" & ZUORDNUNG & \" WHERE VA_ID = \" & VA_ID\n'        Set rs = CurrentDb.OpenRecordset(SQL, 8)\n'        i = 5\n'        Do\n'             VADatum = rs.Fields(\"VADatum\")\n'             MA_Start = Format(rs.Fields(\"MA_Start\"), \"HH:MM\")\n'             MA_Ende = rs.Fields(\"MA_Ende\")\n'             StdGes = Round(Stunden(MA_Start, MA_Ende), 2)\n'             stdNACHT = Round(Stunden_Zuschlag(VADatum, MA_Start, MA_Ende, \"NACHT\"), 2)\n'             stdSONNTAG = Round(Stunden_Zuschlag(VADatum, MA_Start, MA_Ende, \"SONNTAG\") + Stunden_Zuschlag(VADatum, MA_Start, MA_Ende, \"SONNTAGNACHT\"), 2)\n'             StdFeiertag = Round(Stunden_Zuschlag(VADatum, MA_Start, MA_Ende, \"FEIERTAG\") + Stunden_Zuschlag(VADatum, MA_Start, MA_Ende, \"FEIERTAGNACHT\"), 2)\n'             StdTag = Round(StdGes - stdNACHT - stdSONNTAG - StdFeiertag, 2)\n'\n'            .Range(\"A\" & i) = Format(VADatum, \"DDD. DD.MM.YY\")\n'            .Range(\"B\" & i) = TLookup(\"Nachname\", MASTAMM, \"ID = \" & rs.Fields(\"MA_ID\"))\n'            .Range(\"C\" & i) = TLookup(\"Vorname\", MASTAMM, \"ID = \" & rs.Fields(\"MA_ID\"))\n'            .Range(\"D\" & i) = rs.Fields(\"MA_Start\")\n'            .Range(\"D\" & i).NumberFormat = \"h:mm;@\"\n'            .Range(\"E\" & i) = rs.Fields(\"MA_Ende\")\n'            .Range(\"E\" & i).NumberFormat = \"h:mm;@\"\n'            .Range(\"F\" & i) = StdGes\n'            .Range(\"G\" & i) = StdTag\n'            .Range(\"H\" & i) = stdNACHT\n'            .Range(\"I\" & i) = stdSONNTAG\n'            .Range(\"J\" & i) = StdFeiertag\n'            .Range(\"K\" & i) = rs.Fields(\"Bemerkungen\")\n'\n'            rs.MoveNext\n'            i = i + 1\n'        Loop Until rs.EOF\n'\n'        rows = i - 4\n'        count = xlWS.usedrange.rows.count\n'        'xlWS.rows(4).AutoFilter\n'        With xlWS.Sort\n'            .SortFields.clear\n'            .SortFields.Add Key:=xlWS.Range(\"A4:A\" & count + 1), SortOn:=0, Order:=1, DataOption:=0 ', SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal\n'            .SortFields.Add Key:=xlWS.Range(\"D4:D\" & count + 1), SortOn:=0, Order:=1, DataOption:=0\n'            .SortFields.Add Key:=xlWS.Range(\"B4:B\" & count + 1), SortOn:=0, Order:=1, DataOption:=0\n'            .SetRange xlWS.Range(\"A4:K\" & count + 1)\n'            .Header = 1\n'            .MatchCase = False\n'            .Orientation = 1\n'            .SortMethod = 1\n'            .Apply\n'        End With\n'        With xlWS\n'            .Range(\"F\" & count + 3).FormulaR1C1 = \"=SUM(R[-\" & rows & \"]C:R[-2]C)\"\n'            .Range(\"G\" & count + 3).FormulaR1C1 = \"=SUM(R[-\" & rows & \"]C:R[-2]C)\"\n'            .Range(\"H\" & count + 3).FormulaR1C1 = \"=SUM(R[-\" & rows & \"]C:R[-2]C)\"\n'            .Range(\"I\" & count + 3).FormulaR1C1 = \"=SUM(R[-\" & rows & \"]C:R[-2]C)\"\n'            .Range(\"J\" & count + 3).FormulaR1C1 = \"=SUM(R[-\" & rows & \"]C:R[-2]C)\"\n'        End With\n'\n'    End With\n'\n'    Datum_Datei = Format(xlWS.Range(\"A5\"), \"MM-DD-YY\")\n'    xlWB.SaveAs PfadPlanungAktuell & Datum_Datei & \" \" & xlWS.Range(\"A2\") & \" Namensliste\"\n'\n'End Function"}
