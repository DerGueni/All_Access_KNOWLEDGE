{"id":"MOD_zmd_Ersatzfunktionen","name":"zmd_Ersatzfunktionen","kind":"standard","procedures":["Public Function TLookup(ByVal expression As String, ByVal domain As String, _","Public Function TLookupMulti(sExpr As String, sDomain As String, Optional vCriteria As Variant, Optional sOrderClause As String) As Variant","Public Function TMax(ByVal expression As String, ByVal domain As String, _","Public Function TCount(ByVal expression As String, ByVal domain As String, _","Public Function TSum(ByVal expression As String, ByVal domain As String, _","Function TUpdate(ByVal expression As String, ByVal domain As String, Optional ByVal Criteria, Optional ByVal extDB) As Variant","Function TInsert(ByVal expression As String, ByVal domain As String, ByVal Criteria, Optional ByVal extDB) As Variant","Function autowert_reset(tbl As String, spalte As String)","Function autowert_reset_extDB(db As String, tbl As String, spalte As String, spaltenart As String)","Function Restet_ZK_Stunden_autowert()"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":["DROP TABLE ","SELECT * INTO ","DELETE * FROM ","ALTER TABLE ","INSERT INTO ","DROP TABLE "],"DLookup":["DLookup()","DLookup()"],"DCount":["DCount()"],"DMax":["DMax()"],"DMin":[]},"source":"Option Compare Database\n\n'Ersatz für DLookup()\nPublic Function TLookup(ByVal expression As String, ByVal domain As String, _\n                Optional ByVal Criteria, Optional ByVal extDB) As Variant\n \nOn Error GoTo TLookup_Err\n \nDim strSQL As String\n\n    strSQL = \"SELECT [\" & expression & \"] FROM [\" & domain & \"]\"\n    If Not IsMissing(extDB) Then strSQL = strSQL & \" IN '\" & extDB & \"'\"\n    If Not IsMissing(Criteria) Then strSQL = strSQL & \" WHERE \" & Criteria\n    TLookup = DBEngine(0)(0).OpenRecordset(strSQL, dbOpenSnapshot)(0)\n    Exit Function\n \nTLookup_Err:\n  Select Case err.Number\n    Case 3021  'kein Datensatz gefunden\n      TLookup = Null\n    Case 3061  'einer der Feldnamen (Ausdruck oder Kriterium) stimmt nicht\n      TLookup = \"#Ausdruck/Kriterium\"\n    Case 3078  'Name der Tabelle oder Abfrage stimmt nicht\n      TLookup = \"#Domäne\"\n    Case 3464  'Datentyp im Kriterium ist falsch\n      TLookup = \"#Kriterium\"\n    Case Else  'Sonstige Fehler\n      TLookup = \"#Fehler\"\n  End Select\n \nEnd Function\n\n\n'Ersatz für DLookup() mit mehreren Ausgaben\nPublic Function TLookupMulti(sExpr As String, sDomain As String, Optional vCriteria As Variant, Optional sOrderClause As String) As Variant\n\nDim rs      As DAO.Recordset\nDim sSQL    As String\nDim tmp     As Variant\nDim result  As Variant\n\nOn Error GoTo Mark_Error\n        \n    ReDim result(0)\n    \n    If sExpr <> \"\" And sDomain <> \"\" Then\n        ' SQL-String zusammensetzen\n        sSQL = \"SELECT \" & sExpr & \" FROM \" & sDomain\n        If Not IsMissing(vCriteria) Then\n            sSQL = sSQL & \" WHERE \" & vCriteria\n        End If\n        If sOrderClause <> \"\" Then\n            sSQL = sSQL & \" ORDER BY \" & sOrderClause\n        End If\n        sSQL = sSQL & \";\"\n        ' Abfrage ausführen\n        Set rs = CurrentDb.OpenRecordset(sSQL, dbOpenSnapshot)\n        ' Ergebnis übergeben\n        If Not rs.EOF Then\n            rs.MoveLast\n            rs.MoveFirst\n            tmp = rs.GetRows(rs.RecordCount)\n            For i = LBound(tmp, 2) To UBound(tmp, 2)\n                ReDim Preserve result(i)\n                result(i) = tmp(0, i)\n            Next i\n        End If\n        rs.Close\n    End If\n    \nMark_Exit:\n    TLookupMulti = result\n    Set rs = Nothing\n    Exit Function\nMark_Error:\n    Resume Mark_Exit\nEnd Function\n\n\n\n'Ersatz für DMax()\nPublic Function TMax(ByVal expression As String, ByVal domain As String, _\n                       Optional ByVal Criteria, Optional ByVal extDB) As Variant\n \nOn Error GoTo TMax_Err\n \nDim strSQL As String\n\n    strSQL = \"SELECT Max(\" & expression & \") FROM \" & domain\n    If Not IsMissing(extDB) Then strSQL = strSQL & \" IN '\" & extDB & \"'\"\n    If Not IsMissing(Criteria) Then strSQL = strSQL & \" WHERE \" & Criteria\n    TMax = DBEngine(0)(0).OpenRecordset(strSQL, 8)(0)\n    Exit Function\n \nTMax_Err:\n  Select Case err.Number\n    Case 3061  'einer der Feldnamen (Ausdruck oder Kriterium) stimmt nicht\n      TMax = \"#Ausdruck/Kriterium\"\n    Case 3078  'Name der Tabelle oder Abfrage stimmt nicht\n      TMax = \"#Domäne\"\n    Case 3464  'Datentyp im Kriterium ist falsch\n      TMax = \"#Kriterium\"\n    Case Else  'Sonstige Fehler\n      TMax = \"#Fehler\"\n  End Select\n \nEnd Function\n\n\n'Ersatz für DCount()\nPublic Function TCount(ByVal expression As String, ByVal domain As String, _\n                       Optional ByVal Criteria, Optional ByVal extDB) As Variant\n \nOn Error GoTo TCount_Err\n \nDim strSQL As String\n\n    strSQL = \"SELECT COUNT(\" & expression & \") FROM \" & domain\n    If Not IsMissing(extDB) Then strSQL = strSQL & \" IN '\" & extDB & \"'\"\n    If Not IsMissing(Criteria) Then strSQL = strSQL & \" WHERE \" & Criteria\n    TCount = DBEngine(0)(0).OpenRecordset(strSQL, 8)(0)\n    Exit Function\n \nTCount_Err:\n  Select Case err.Number\n    Case 3061  'einer der Feldnamen (Ausdruck oder Kriterium) stimmt nicht\n      TCount = \"#Ausdruck/Kriterium\"\n    Case 3078  'Name der Tabelle oder Abfrage stimmt nicht\n      TCount = \"#Domäne\"\n    Case 3464  'Datentyp im Kriterium ist falsch\n      TCount = \"#Kriterium\"\n    Case Else  'Sonstige Fehler\n      TCount = \"#Fehler\"\n  End Select\n \nEnd Function\n\n\n'Ersatz für DSum()\nPublic Function TSum(ByVal expression As String, ByVal domain As String, _\n                Optional ByVal Criteria, Optional ByVal extDB) As Variant\n \nOn Error GoTo TSum_Err\n \nDim strSQL As String\n\n    strSQL = \"SELECT SUM(\" & expression & \") FROM \" & domain\n    If Not IsMissing(extDB) Then strSQL = strSQL & \" IN '\" & extDB & \"'\"\n    If Not IsMissing(Criteria) Then strSQL = strSQL & \" WHERE \" & Criteria\n    TSum = DBEngine(0)(0).OpenRecordset(strSQL, 8)(0)\n    Exit Function\n \nTSum_Err:\n  Select Case err.Number\n    Case 3061  'einer der Feldnamen (Ausdruck oder Kriterium) stimmt nicht\n      TSum = \"#Ausdruck/Kriterium\"\n    Case 3075  'Summierender Ausdruck ist falsch (z.B. \"*\" ist n. mgl.)\n      TSum = \"#Ausdruck\"\n    Case 3078  'Name der Tabelle oder Abfrage stimmt nicht\n      TSum = \"#Domäne\"\n    Case 3464  'Datentyp im Kriterium ist falsch\n      TSum = \"#Kriterium\"\n    Case Else  'Sonstige Fehler\n      TSum = \"#Fehler\"\n  End Select\n \nEnd Function\n\n\n'Tabelle updaten\nFunction TUpdate(ByVal expression As String, ByVal domain As String, Optional ByVal Criteria, Optional ByVal extDB) As Variant\n\nOn Error GoTo TUpdate_Err\n \nDim strSQL As String\n\n    If Not IsMissing(extDB) Then\n        strSQL = \"UPDATE [\" & domain & \"] IN '\" & extDB & \"' SET \" & expression\n    Else\n        strSQL = \"UPDATE [\" & domain & \"] SET \" & expression\n    End If\n    If Not IsMissing(Criteria) Then strSQL = strSQL & \" WHERE \" & Criteria\n    CurrentDb.Execute strSQL\n    TUpdate = \"OK\"\n    Exit Function\n \nTUpdate_Err:\n  Select Case err.Number\n    Case 3061  'einer der Feldnamen (Ausdruck oder Kriterium) stimmt nicht\n      TUpdate = \"#Ausdruck/Kriterium\"\n    Case 3075  'Summierender Ausdruck ist falsch (z.B. \"*\" ist n. mgl.)\n      TUpdate = \"#Ausdruck\"\n    Case 3078  'Name der Tabelle oder Abfrage stimmt nicht\n      TUpdate = \"#Domäne\"\n    Case 3464  'Datentyp im Kriterium ist falsch\n      TUpdate = \"#Kriterium\"\n    Case Else  'Sonstige Fehler\n      TUpdate = \"#Fehler\"\n  End Select\n  \nEnd Function\n\n'Tabelle insert\nFunction TInsert(ByVal expression As String, ByVal domain As String, ByVal Criteria, Optional ByVal extDB) As Variant\n\nOn Error GoTo Tinsert_Err\n \nDim strSQL As String\n\n    If Not IsMissing(extDB) Then\n        strSQL = \"UPDATE [\" & domain & \"] IN '\" & extDB & \"' VALUES \" & expression\n    Else\n        strSQL = \"UPDATE [\" & domain & \"] VALUES \" & expression\n    End If\n    If Not IsMissing(Criteria) Then strSQL = strSQL & \" WHERE \" & Criteria\n    CurrentDb.Execute strSQL\n    TInsert = \"OK\"\n    Exit Function\n \nTinsert_Err:\n  Select Case err.Number\n    Case 3061  'einer der Feldnamen (Ausdruck oder Kriterium) stimmt nicht\n      TInsert = \"#Ausdruck/Kriterium\"\n    Case 3075  'Summierender Ausdruck ist falsch (z.B. \"*\" ist n. mgl.)\n      TInsert = \"#Ausdruck\"\n    Case 3078  'Name der Tabelle oder Abfrage stimmt nicht\n      TInsert = \"#Domäne\"\n    Case 3464  'Datentyp im Kriterium ist falsch\n      TInsert = \"#Kriterium\"\n    Case Else  'Sonstige Fehler\n      TInsert = \"#Fehler\"\n  End Select\n  \nEnd Function\n\n\n'Autowert zurücksetzen\nFunction autowert_reset(tbl As String, spalte As String)\n\nDim tbltmp As String\n\n    tbltmp = \"temp_buffer\"\n    \n    If TableExists(tbltmp) Then CurrentDb.Execute \"DROP TABLE \" & tbltmp\n    \n    CurrentDb.Execute \"SELECT * INTO \" & tbltmp & \" FROM \" & tbl\n    CurrentDb.Execute \"DELETE * FROM \" & tbl\n    CurrentDb.Execute \"ALTER TABLE \" & tbl & \" ALTER COLUMN \" & spalte & \" COUNTER(1, 1)\"\n    CurrentDb.Execute \"INSERT INTO \" & tbl & \" SELECT * FROM \" & tbltmp\n    CurrentDb.Execute \"DROP TABLE \" & tbltmp\n    \nEnd Function\n\n\n'Autowert reset\nFunction autowert_reset_extDB(db As String, tbl As String, spalte As String, spaltenart As String)\n\n    Dim ConnDB As Object\n    Set ConnDB = CreateObject(\"ADODB.Connection\")\n    \n    tbltmp = \"temp_buffer\"\n        \n    ConnDB.Open \"Provider=Microsoft.ACE.OLEDB.12.0; Data Source=\" & db\n    ConnDB.Execute \"SELECT * INTO \" & tbltmp & \" FROM \" & tbl\n    ConnDB.Execute \"DELETE * FROM \" & tbl\n    ConnDB.Execute \"ALTER TABLE \" & tbl & \" ALTER COLUMN \" & spalte & \" COUNTER(1, 1)\"\n    ConnDB.Execute \"ALTER TABLE \" & tbltmp & \" DROP COLUMN \" & spalte\n    ConnDB.Execute \"ALTER TABLE \" & tbltmp & \" ADD COLUMN \" & spalte & \" \" & spaltenart\n    ConnDB.Execute \"INSERT INTO \" & tbl & \" SELECT * FROM \" & tbltmp\n    ConnDB.Execute \"DROP TABLE \" & tbltmp\n    ConnDB.Close\n    Set ConnDB = Nothing\n\nEnd Function\n\n'Autowert zurücksetzen\nFunction Restet_ZK_Stunden_autowert()\n\n    Call autowert_reset_extDB(PfadProd & Backend, \"ztbl_ZK_Stunden\", \"ID\", \"COUNTER;\")\n    \nEnd Function\n\n"}
