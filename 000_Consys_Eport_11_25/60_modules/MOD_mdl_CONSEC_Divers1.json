{"id":"MOD_mdl_CONSEC_Divers1","name":"mdl_CONSEC_Divers1","kind":"standard","procedures":["Function f_VAdat_Pl(iVADatum_ID As Long) As Date","Public Function fSumme_Std_Consys(MA_ID As Integer, Jahr As Integer, Monat As Integer) As Double","Public Function fSumme_Std_abger(PersNr As Integer, Jahr As Integer, Monat As Integer) As Double","Public Function fSumme_Std_ges(PersNr As Integer, Jahr As Integer, Monat As Integer) As Double","Public Function fZKausgezahlt(PersNr As Integer, Jahr As Integer, Monat As Integer) As Double","Function fStundenberech(iVA_ID As Long)","Function zfStundenberech(iVA_ID As Long)","Function fExcel_qry_export(qry_XL As String)","Function fNeu_Pos()","Function fUE_DblClick(iVA_ID As Long, iVADatum_ID As Long)","Function fEzPreis(i As Long) As Single","Function fTag_Schicht_Update_Tag(iVADatum_ID As Long, iVA_ID As Long)","Function fTag_Schicht_Update(iVADatum_ID As Long, iVAStart_ID As Long)","Function zfCreateQuery_Verplant(ByVal vglstart As Date, ByVal vglende As Date)","Function fCreateQuery_Verplant(ByVal VA_ID As Long, ByVal vglstart As Date, ByVal vglende As Date)","Function fZeitAusg(st As String, en As String, Ist As Long, Soll As Long) As String","Function fVA_AnzTage_Update()","Function Zuord_Fill(iVADatum_ID As Long, iVA_ID As Long)","Function fCreate_PosNr_Lfd()","Function fObjektOrt(ByVal Auftrag As String, ByVal Ort As String, ByVal Objekt As String) As String","Function fObjektOrt3(ByVal Auftrag As String, ByVal Ort As String, ByVal Objekt As String) As String","Function ftel_erf(s1 As String, s2 As String) As String","Function fAnstellungsart(ID As Long) As String","Function VA_Start_Erw()","Function fAnzAuftragTag(dt As Date) As Long","Function date_Umsetz(dt As Date, relstd As Single) As Date","Function Loginname() As String","Function fAuftr_RG(iTyp As Long, iRch_ID As Long)","Function MA_ID_Test(MA_ID As Long) As Long","Function VA_AnzTage_Maintainance()","Function VA_AnzTage_Upd(iVA_ID As Long, iVADatum_ID As Long)","Function sumo_Test() As Single","Function MA_Monat_SumNetStd(iMA_ID As Long, mondat As Date) As Single","Function zMA_Monat_SumNetStd(iMA_ID As Long, mondat As Date) As Single","Function Startzeit_G(dtDat1, h_start1) As Date","Function Endezeit_G(dtDat1, h_start1, Optional h_ende1) As Date","Function timeberech_G(dtDat1, h_start1, h_ende1, Optional PreisArt_ID As Long = 1) As Variant","Function StdSumAll_Neuberech(Optional iVA_ID As Long = 0)","Function fFontchange_frm(frmName As String)","Function fGetStDat(dtDatum As Date, dtStart As Date) As Date","Function fGetEndDat(dtDatum As Date, dtStart As Date, dtEnde As Date) As Date","Function aend_Dat_Auftr()","Function ZtDatLoesch(xin As Variant) As Date","Function VorMon_Ueberlaufstd_Les(MA_ID As Long, aktJahr As Long, Aktmon As Long) As Single","Function AktMon_Ueberlaufstd_Upd(MA_ID As Long, aktJahr As Long, Aktmon As Long, StdAnz As Single) As Single","Function DivInfo_MA(MA_ID As Long, sMaxStd As Single, stdlohn As Currency, RV_Betrag As Currency, RL34a_pro_Std As Currency, Proz_Lohnsteuer As Single, MA_Netto_std2 As Single)","Function RL34a_pro_Std(MA_ID As Long) As Currency","Function MA_Proz_Lohnsteuer(MA_ID As Long) As Single","Function MA_RV_Betrag(MA_ID As Long) As Currency","Function MA_stdlohn(MA_ID As Long) As Currency","Function MA_AktMax_Mon_std(MA_ID As Long, IstGes As Single) As Single","Function MA_Ueberl_Mon_std(MA_ID As Long, IstGes As Single) As Single","Function Netto_Std_Berech(Brutto_Std As Single) As Single","Function Ueberlaufstd_Berech_Neu(aktJahr As Long, AktMonat As Long, Optional MA_ID As Long = 0)","Function Tabellen_Loeschen()","Function fKD_Adr_create(kun_ID As Long) As String","Function fKopf_Bildname(MA_ID As Long) As String","Function fSignatur(MA_ID As Long) As String","Function fUnterschrift_Bild()","Public Sub DatenbankEinlesen(strDatenbank As String)","Public Sub TabellenEinlesen(db As DAO.Database, dbQuelle As DAO.Database, lngDatenbankID As Long)","Public Sub FelderEinlesen(db As DAO.Database, tdf As DAO.TableDef, lngTabelleID As Long)","Public Sub FeldeigenschaftenEinlesen(db As DAO.Database, tdf As DAO.TableDef, fld As DAO.field, lngFeldID As Long)","Function fDateiNameAusPfad(pfad As String) As String","Function fVADatum(VADatum As Date, PosNr As Integer) As String"],"calls":{"DoCmd.OpenForm":["_frmHlp_Excel_Einbinden","frm_VA_Auftragstamm","frmTop_VA_Tag_sub","MyReport"],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":["Dcount(\"*\", \"SELECT * FROM tbl_MA_VA_Zuordnung WHERE VADatum_ID = \" & iVADatum_ID & \" AND VA_ID = \" & iVA_ID)","Dcount(\"*\", strSQL, \"Rch_ID = \" & iRch_ID)"],"DMax":[],"DMin":["DMin(\"VADatum\", \"tbl_VA_AnzTage\")"]},"source":"Option Compare Database\nOption Explicit\n\n\nFunction f_VAdat_Pl(iVADatum_ID As Long) As Date\nf_VAdat_Pl = TLookup(\"VADatum\", \"tbl_VA_AnzTage\", \"ID = \" & iVADatum_ID)\nEnd Function\n\n\n'Summe Stunden Consys für Abgleich in zfrm_MA_Stunden_Lexware\nPublic Function fSumme_Std_Consys(MA_ID As Integer, Jahr As Integer, Monat As Integer) As Double\nOn Error Resume Next\n  fSumme_Std_Consys = Forms(\"zfrm_MA_Stunden_Lexware\").fSumme_stunden_consys(MA_ID, Jahr, Monat)\nEnd Function\n\n'Summe Stunden ZK abgerechnet für Abgleich in zfrm_MA_Stunden_Lexware\nPublic Function fSumme_Std_abger(PersNr As Integer, Jahr As Integer, Monat As Integer) As Double\nOn Error Resume Next\n  fSumme_Std_abger = Forms(\"zfrm_MA_Stunden_Lexware\").fSumme_Stunden_abger(PersNr, Jahr, Monat)\nEnd Function\n\n'Summe Stunden ZK Zeitkonto für Abgleich in zfrm_MA_Stunden_Lexware\nPublic Function fSumme_Std_ges(PersNr As Integer, Jahr As Integer, Monat As Integer) As Double\nOn Error Resume Next\n  fSumme_Std_ges = Forms(\"zfrm_MA_Stunden_Lexware\").fSumme_Stunden_ges(PersNr, Jahr, Monat)\nEnd Function\n\n'Summe Stunden ZK Lexware für Abgleich in zfrm_MA_Stunden_Lexware\nPublic Function fZKausgezahlt(PersNr As Integer, Jahr As Integer, Monat As Integer) As Double\nOn Error Resume Next\n  fZKausgezahlt = Forms(\"zfrm_MA_Stunden_Lexware\").fZKausgezahlt(PersNr, Jahr, Monat)\nEnd Function\n\nFunction fStundenberech(iVA_ID As Long)\nOn Error Resume Next\n\nCurrentDb.Execute (\"UPDATE tbl_MA_VA_Zuordnung SET tbl_MA_VA_Zuordnung.MVA_Start = Startzeit_G([VADatum],[MA_Start]) WHERE (((tbl_MA_VA_Zuordnung.VA_ID)=\" & iVA_ID & \"));\")\nDoEvents\nCurrentDb.Execute (\"UPDATE tbl_MA_VA_Zuordnung SET tbl_MA_VA_Zuordnung.MVA_Ende = Endezeit_G([VADatum],[MA_Start],[MA_Ende]) WHERE (((tbl_MA_VA_Zuordnung.VA_ID)=\" & iVA_ID & \"));\")\nDoEvents\nCurrentDb.Execute (\"UPDATE tbl_MA_VA_Zuordnung SET tbl_MA_VA_Zuordnung.MA_Brutto_Std = timeberech_G([VADatum],[MA_Start],[MA_Ende]) WHERE (((tbl_MA_VA_Zuordnung.VA_ID)=\" & iVA_ID & \"));\")\nDoEvents\nCurrentDb.Execute (\"UPDATE tbl_MA_VA_Zuordnung SET tbl_MA_VA_Zuordnung.MA_Netto_Std = Netto_Std_Berech([MA_Brutto_Std]) WHERE (((tbl_MA_VA_Zuordnung.VA_ID)=\" & iVA_ID & \"));\")\nDoEvents\nCurrentDb.Execute (\"UPDATE tbl_MA_VA_Zuordnung SET tbl_MA_VA_Zuordnung.RL34a = RL34a_pro_Std([MA_ID]) WHERE (((tbl_MA_VA_Zuordnung.VA_ID)=\" & iVA_ID & \"));\")\n\nfStundenberech = -1\n\nEnd Function\n\n\n'Stundenberechnung Bruttostunden Nettostunden\nFunction zfStundenberech(iVA_ID As Long)\n\nOn Error GoTo err\n\n    CurrentDb.Execute (\"UPDATE tbl_MA_VA_Zuordnung SET tbl_MA_VA_Zuordnung.MVA_Start = Startzeit_G([VADatum],[MA_Start]) WHERE (((tbl_MA_VA_Zuordnung.VA_ID)=\" & iVA_ID & \"));\")\n    DoEvents\n    CurrentDb.Execute (\"UPDATE tbl_MA_VA_Zuordnung SET tbl_MA_VA_Zuordnung.MVA_Ende = Endezeit_G([VADatum],[MA_Start],[MA_Ende]) WHERE (((tbl_MA_VA_Zuordnung.VA_ID)=\" & iVA_ID & \"));\")\n    \n    zfStundenberech = 1\n\nEnde:\n    Exit Function\nerr:\n    Debug.Print err.Number & \" \" & err.description\n    Resume Next\n    \nEnd Function\n\n\n\nFunction fExcel_qry_export(qry_XL As String)\n\nDim frm As Form\n\nDoCmd.OpenForm \"_frmHlp_Excel_Einbinden\"\nSet frm = Forms(\"_frmHlp_Excel_Einbinden\")\nfrm.WahlLinkImport = 1  ' Export = 1  ' Link = 2, Import = 0\nfrm.WahlLI\nDoEvents\nfrm.Tabellenname = qry_XL\nDoEvents\nfrm.IstMitHeader = True\n\nEnd Function\n\nFunction fNeu_Pos()\n\nDim iKID As Long\nDim strSQL As String\n\nDim PosNr As Long\nDim iAnz As Long\nDim iOB_Kopf As Long\nDim iOB_Pos As Long\nDim i As Long\n\nDim db As DAO.Database\nDim rst As DAO.Recordset\n\nDim ArrFill_DAO_OK1 As Boolean, recsetSQL1 As String, iZLMax1 As Long, iColMax1 As Long, DAOARRAY1, iZl As Long, iCol As Long\nrecsetSQL1 = \"qry_VA_Akt_Objekt_Pos_Ohne\"\n\niKID = Get_Priv_Property(\"prp_VA_Akt_Objekt_ID\")\n\nCurrentDb.Execute (\"qry_VA_Akt_MA_Pos_del\")\nDoEvents\n\nPosNr = 1\n\nSet db = CurrentDb\nSet rst = db.OpenRecordset(\"SELECT Top 1 * FROM tbl_VA_Akt_Objekt_Pos_MA;\")\n\nWith rst\n\nArrFill_DAO_OK1 = ArrFill_DAO_Acc(recsetSQL1, iZLMax1, iColMax1, DAOARRAY1)\n'Info:   'AccessArray(iSpalte,iZeile) <0, 0>\nIf ArrFill_DAO_OK1 Then\n    For iZl = 0 To iZLMax1\n        iAnz = DAOARRAY1(2, iZl)\n        iOB_Kopf = DAOARRAY1(0, iZl)\n        iOB_Pos = DAOARRAY1(1, iZl)\n        For i = 1 To iAnz\n            .AddNew\n                .fields(\"VA_Akt_Objekt_Kopf_ID\").Value = iOB_Kopf\n                .fields(\"VA_Akt_Objekt_Pos_ID\").Value = iOB_Pos\n                .fields(\"PosNr\").Value = PosNr\n                .fields(\"MA_ID\").Value = 0\n                .fields(\"Bemerkung\").Value = \"\"\n            .update\n            \n            PosNr = PosNr + 1\n        Next i\n\n    Next iZl\n    Set DAOARRAY1 = Nothing\nEnd If\n\n.Close\nEnd With\nSet rst = Nothing\n\nEnd Function\nFunction fUE_DblClick(iVA_ID As Long, iVADatum_ID As Long)\n\nDim strSQL2 As String\nDim dtsich As Date\nDim stdat As Date\n\nDoEvents\nDBEngine.Idle dbRefreshCache\nDBEngine.Idle dbFreeLocks\nDoEvents\n\nstrSQL2 = \"\"\nstrSQL2 = strSQL2 & \"SELECT tbl_MA_VA_Zuordnung.ID, tbl_MA_VA_Zuordnung.VA_ID, Nz(tbl_MA_VA_Zuordnung.MA_ID,0) AS Ausdr1, tbl_MA_VA_Zuordnung.PosNr,\"\nstrSQL2 = strSQL2 & \" [Nachname] & ', ' & [Vorname] AS Mitarbeiter, Left(Nz([VA_Start]),5) AS Start\"\nstrSQL2 = strSQL2 & \" FROM tbl_VA_Start RIGHT JOIN (tbl_MA_VA_Zuordnung LEFT JOIN tbl_MA_Mitarbeiterstamm\"\nstrSQL2 = strSQL2 & \" ON tbl_MA_VA_Zuordnung.MA_ID = tbl_MA_Mitarbeiterstamm.ID) ON tbl_VA_Start.ID = tbl_MA_VA_Zuordnung.VAStart_ID\"\nstrSQL2 = strSQL2 & \" WHERE (tbl_MA_VA_Zuordnung.VA_ID= \" & iVA_ID & \") AND ((tbl_MA_VA_Zuordnung.VADatum_ID) = \" & iVADatum_ID & \") Order By PosNr;\"\n\n'DoCmd.OpenForm \"frm_VA_Auftragstamm\", , , \"ID = \" & iVA_ID\nDoCmd.OpenForm \"frmTop_VA_Tag_sub\"\nForms!frmTop_VA_Tag_sub!dtDatum = stdat\nForms!frmTop_VA_Tag_sub!VA_ID = iVA_ID\nForms!frmTop_VA_Tag_sub!lst_Ist.rowSource = strSQL2\nForms!frmTop_VA_Tag_sub!lst_Ist.Requery\nForms!frmTop_VA_Tag_sub.Requery\n\n\nEnd Function\n\n\nFunction fEzPreis(i As Long) As Single\nSelect Case i\n    Case 4\n        fEzPreis = Get_Priv_Property(\"EZ_Preisart_4\")\n    Case 3\n        fEzPreis = Get_Priv_Property(\"EZ_Preisart_3\")\n    Case Else\n        fEzPreis = Get_Priv_Property(\"EZ_Preisart_1\")\nEnd Select\nEnd Function\n\nFunction fTag_Schicht_Update_Tag(iVADatum_ID As Long, iVA_ID As Long)\nDim ArrFill_DAO_OK1 As Boolean, recsetSQL1 As String, iZLMax1 As Long, iColMax1 As Long, DAOARRAY1, iZl As Long, iCol As Long\nrecsetSQL1 = \"SELECT tbl_VA_Start.ID FROM tbl_VA_Start where tbl_VA_Start.VA_ID = \" & iVA_ID & \" AND tbl_VA_Start.VADatum_ID = \" & iVADatum_ID & \" ORDER BY VA_Start, VA_Ende;\"\nArrFill_DAO_OK1 = ArrFill_DAO_Acc(recsetSQL1, iZLMax1, iColMax1, DAOARRAY1)\n'Info:   'AccessArray(iSpalte,iZeile) <0, 0>\nIf ArrFill_DAO_OK1 Then\n    For iZl = 0 To iZLMax1\n        fTag_Schicht_Update iVADatum_ID, CLng(DAOARRAY1(0, iZl))\n    Next iZl\n    Set DAOARRAY1 = Nothing\nEnd If\n\nEnd Function\n\n\nFunction fTag_Schicht_Update(iVADatum_ID As Long, iVAStart_ID As Long)\nDim i As Long, j As Long, bt As Long, k As Long\n\nDim iVA_ID As Long\nDim cdat As Date\n\n\ni = Nz(TCount(\"*\", \"tbl_MA_VA_Zuordnung\", \"MA_ID > 0 AND VADatum_ID = \" & iVADatum_ID), 0)\nj = Nz(TSum(\"MA_Anzahl\", \"tbl_VA_Start\", \"VADatum_ID = \" & iVADatum_ID), 0)\nbt = Not (i >= j And j > 0)\nCurrentDb.Execute (\"UPDATE tbl_VA_AnzTage SET tbl_VA_AnzTage.TVA_Ist = \" & i & \", tbl_VA_AnzTage.TVA_Soll = \" & j & \", TVA_Offen = \" & CLng(bt) & \" WHERE (((tbl_VA_AnzTage.ID)= \" & iVADatum_ID & \"));\")\n\ni = Nz(TCount(\"*\", \"tbl_MA_VA_Zuordnung\", \"MA_ID > 0 AND VAStart_ID = \" & iVAStart_ID), 0)\nCurrentDb.Execute (\"UPDATE tbl_VA_Start SET tbl_VA_Start.MA_Anzahl_Ist = \" & i & \" WHERE (((tbl_VA_Start.ID)= \" & iVAStart_ID & \"));\")\n\niVA_ID = Nz(TLookup(\"VA_ID\", \"tbl_VA_AnzTage\", \"ID = \" & iVADatum_ID), 0)\nk = Nz(TLookup(\"Veranst_Status_ID\", \"tbl_VA_Auftragstamm\", \"ID = \" & iVA_ID), 0)\nIf k < 3 Then\n    i = Nz(TCount(\"*\", \"tbl_MA_VA_Zuordnung\", \"MA_ID > 0 AND VA_ID = \" & iVA_ID), 0)\n    j = Nz(TSum(\"TVA_Soll\", \"tbl_VA_AnzTage\", \"VA_ID = \" & iVA_ID), 0)\n    If i >= j And j > 0 Then\n        CurrentDb.Execute (\"UPDATE tbl_VA_Auftragstamm SET tbl_VA_Auftragstamm.Veranst_Status_ID = 2 WHERE (((tbl_VA_Auftragstamm.ID)= \" & iVA_ID & \"));\")\n        'CurrentDb.Execute (\"UPDATE tbl_VA_Auftragstamm SET tbl_VA_Auftragstamm.Veranst_Status_ID = 2 WHERE (((tbl_VA_Auftragstamm.id)= \" & iVA_ID & \") and (tbl_va_auftragstamm.dat_va_bis) > cdate);\")\n    Else\n        CurrentDb.Execute (\"UPDATE tbl_VA_Auftragstamm SET tbl_VA_Auftragstamm.Veranst_Status_ID = 1 WHERE (((tbl_VA_Auftragstamm.ID)= \" & iVA_ID & \"));\")\n    End If\nEnd If\n\nEnd Function\n\n\n'läuft schneller als ursprüngliche Funktion...\nFunction zfCreateQuery_Verplant(ByVal vglstart As Date, ByVal vglende As Date)\n\nDim strSQL As String\n\n'Start und Ende der Verfügbarkreitsprüfung startet / endet zwei Minuten nach / vor dem eigentlichen Start / Ende um Überschneidungen sicher zu vermeiden\n'vglstart = DateAdd(\"n\", 2, vglstart) 'Start\n'vglende = DateAdd(\"n\", -2, vglende)  'Ende\nvglstart = DateAdd(\"n\", -2, vglstart) 'Start\nvglende = DateAdd(\"n\", 2, vglende)  'Ende\n\nstrSQL = \"\"\n'strsql = strsql & \"Select [MA_ID], [VADatum], [MVA_Start], [MVA_Ende], [Art] FROM zqry_VV_Union WHERE (\"\n'strsql = strsql & \" ([MVA_Start] between \" & DateTimeForSQL(vglstart) & \" and \" & DateTimeForSQL(vglende) & \")  OR\"\n'strsql = strsql & \" ([MVA_Ende] between \" & DateTimeForSQL(vglstart) & \" and \" & DateTimeForSQL(vglende) & \")  OR\"\n'strsql = strsql & \" (([MVA_Start]< \" & DateTimeForSQL(vglstart) & \") AND ([MVA_Ende]> \" & DateTimeForSQL(vglende) & \")))\"\nstrSQL = strSQL & \"Select [ID], [Beginn], [Ende], [Grund] FROM zqry_MA_Verfuegbarkeit WHERE istVerfuegbar = 0\"\n\nIf Not CreateQuery(strSQL, \"zqry_VV_tmp_belegt\") Then\n    MsgBox \"zqry_VV_tmp_belegt nicht erzeugt\"\nEnd If\n\nEnd Function\n\n\nFunction fCreateQuery_Verplant(ByVal VA_ID As Long, ByVal vglstart As Date, ByVal vglende As Date)\n\nDim strSQL As String\n\n'Start und Ende der Verfügbarkreitsprüfung startet / endet zwei Minuten nach / vor dem eigentlichen Start / Ende um Überschneidungen sicher zu vermeiden\nvglstart = DateAdd(\"n\", 2, vglstart) 'Start\nvglende = DateAdd(\"n\", -2, vglende)  'Ende\n\nCall upd_Vergleichszeiten(VA_ID, vglstart, vglende)\n\nstrSQL = \"\"\nstrSQL = strSQL & \"Select [MA_ID], [MAName], [VADatum], [MVA_Start], [MVA_Ende], [Art], ObjektOrt FROM qry_VV_Union WHERE (\"\nstrSQL = strSQL & \" ([MVA_Start] between \" & DateTimeForSQL(vglstart) & \" and \" & DateTimeForSQL(vglende) & \")  OR\"\nstrSQL = strSQL & \" ([MVA_Ende] between \" & DateTimeForSQL(vglstart) & \" and \" & DateTimeForSQL(vglende) & \")  OR\"\nstrSQL = strSQL & \" (([MVA_Start]< \" & DateTimeForSQL(vglstart) & \") AND ([MVA_Ende]> \" & DateTimeForSQL(vglende) & \")))\"\n\nIf Not CreateQuery(strSQL, \"qry_VV_tmp_belegt\") Then\n    MsgBox \"qry_VV_tmp_belegt nicht erzeugt\"\nEnd If\n\nEnd Function\n\n\n'Function fCreateQuery_Verplant_1(ByVal vglstart As Date, ByVal vglende As Date)\n'\n'Dim strSQL As String\n'\n''Start und Ende der Verfügbarkreitsprüfung startet / endet zwei Minuten nach / vor dem eigentlichen Start / Ende um Überschneidungen sicher zu vermeiden\n'vglstart = DateAdd(\"n\", 2, vglstart) 'Start\n'vglende = DateAdd(\"n\", -2, vglende)  'Ende\n'\n'strSQL = \"\"\n'strSQL = strSQL & \"Select [MA_ID], [MAName], [VADatum], [MVA_Start], [MVA_Ende], [Art], ObjektOrt FROM qry_VV_Union WHERE (\"\n'strSQL = strSQL & \" ([MVA_Start] between \" & DateTimeForSQL(vglstart) & \" and \" & DateTimeForSQL(vglende) & \")  OR\"\n'strSQL = strSQL & \" ([MVA_Ende] between \" & DateTimeForSQL(vglstart) & \" and \" & DateTimeForSQL(vglende) & \")  OR\"\n'strSQL = strSQL & \" (([MVA_Start]< \" & DateTimeForSQL(vglstart) & \") AND ([MVA_Ende]> \" & DateTimeForSQL(vglende) & \")))\"\n'\n'If Not CreateQuery(strSQL, \"qry_VV_tmp_belegt\") Then\n'    MsgBox \"qry_VV_tmp_belegt nicht erzeugt\"\n'End If\n'\n'End Function\n\n\nFunction fZeitAusg(st As String, en As String, Ist As Long, Soll As Long) As String\n\nDim s As String\nDim s1 As String\n\ns = \"\"\nIf Len(Trim(Nz(st))) = 0 Then\n    s1 = \"von\"\nElse\n    s1 = st\nEnd If\ns = s & s1 & \" - \"\n\nIf Len(Trim(Nz(en))) = 0 Then\n    s1 = \"xxx\"\nElse\n    s1 = en\nEnd If\ns = s & s1\n\ns = s & \" Uhr | \" & Ist & \" / \" & Soll\n\nfZeitAusg = s\n\nEnd Function\n\nFunction fVA_AnzTage_Update()\n\n'############################################################\n'Update alle Soll / Ist Zeiten\n\nCall CurrentDb.Execute(\"Delete * FROM tbl_MA_VA_Zuordnung WHERE ID IN (SELECT Zuo_ID From qry_Falsche_Nr)\")\nCall CurrentDb.Execute(\"DELETE tbl_VA_AnzTage.ID, tbl_VA_Start.* FROM tbl_VA_Start LEFT JOIN tbl_VA_AnzTage ON tbl_VA_Start.VADatum_ID = tbl_VA_AnzTage.ID WHERE (((tbl_VA_AnzTage.ID) Is Null));\")\n\n'Schritt 1 - Neue Soll-Zeiten hinzufügen\nCurrentDb.Execute (\"qry_VA_AnzTage_Soll_Add\")\n\n'temp table löschen\nCurrentDb.Execute (\"delete * FROM tbltmp_VA_Soll_Ist\")\n\n'temp table füllen\nCurrentDb.Execute (\"qry_VA_tmp_Soll_Ist_Add\")\n\n'Überschreiben alter VA_AnzTage Werte\nCurrentDb.Execute (\"qry_VA_Soll_Ist_Update_1\")\n\n'Ist: Alle VA_AnzTage 0 Setzen\nCurrentDb.Execute (\"qry_VA_Soll_Ist_Update_2\")\n\n'Alles TRUE setzen\nCurrentDb.Execute (\"qry_VA_Soll_Ist_Update_3\")\n\n'Alles False setzen, wenn TVA_Soll = 0 Oder TVA_Soll > TVA_Ist\nCurrentDb.Execute (\"qry_VA_Soll_Ist_Update_4\")\n\n'Aufräumen\n'temp table löschen\nCurrentDb.Execute (\"delete * FROM tbltmp_VA_Soll_Ist\")\n\n'###########################\n\n'temp table löschen\nCurrentDb.Execute (\"delete * FROM tbltmp_VAStart_Ist\")\n\n'temp table Füllen\nCurrentDb.Execute (\"qry_VA_Start_tmp_Add\")\n\n' Ist-Zeiten VA_Start auf 0 setzen\nCurrentDb.Execute (\"qry_VA_Start_Ist_Update_1\")\n\n'Update Ist-Zeiten VA_Start\nCurrentDb.Execute (\"qry_VA_Start_Ist_Update_2\")\n\n'Veranstaltungsstatus auf 1 setzen, wenn offen\nCurrentDb.Execute (\"UPDATE tbl_VA_Auftragstamm INNER JOIN tbl_VA_AnzTage ON tbl_VA_Auftragstamm.ID = tbl_VA_AnzTage.VA_ID SET tbl_VA_Auftragstamm.Veranst_Status_ID = 1 WHERE (((tbl_VA_Auftragstamm.Veranst_Status_ID)<4) AND ((tbl_VA_AnzTage.TVA_Offen)=True));\")\n\n'Veranstaltungsstatus auf 1 setzen, wenn offen\nCurrentDb.Execute (\"UPDATE tbl_VA_Auftragstamm INNER JOIN tbl_VA_AnzTage ON tbl_VA_Auftragstamm.ID = tbl_VA_AnzTage.VA_ID SET tbl_VA_Auftragstamm.Veranst_Status_ID = 1 WHERE (((tbl_VA_Auftragstamm.Veranst_Status_ID)<4) AND ((tbl_VA_AnzTage.TVA_Offen)=True));\")\n\n'Aufräumen\n'temp table löschen\nCurrentDb.Execute (\"delete * FROM tbltmp_VAStart_Ist\")\n\n'############################################################\n\nEnd Function\n\nFunction Zuord_Fill(iVADatum_ID As Long, iVA_ID As Long)\n\nDim ArrFill_DAO_OK1 As Boolean, recsetSQL1 As String, iZLMax1 As Long, iColMax1 As Long, DAOARRAY1, iZl As Long, iCol As Long\nDim ArrFill_DAO_OK2 As Boolean, recsetSQL2 As String, iZLMax2 As Long, iColMax2 As Long, DAOARRAY2, iZl2 As Long, iCol2 As Long\nDim iAnz As Long\nDim i As Long, j As Long, k As Long\nDim iLfdNr As Long\nDim sAnz As Single\nDim iVgl As Long\nDim iGes As Long\nDim iGesVgl As Long\n\nDim db As DAO.Database\nDim rst As DAO.Recordset\n\nDim dtVgl As Date\nDim dtvgl_ID As Long\nDim dtdat As Date\nDim dtdat_ID As Long\nDim dtdatzeitvon As Date\nDim dtdatzeitbis As Date\n\nDim Dat_VA_Von As Date\n\nDim StdBrutto As Single\nDim Std_Pa As Single\nDim PauseAnz As Single\n\nDim iPosNr As Long\n\nDim strSQL As String\nDim iVAStart_ID As Long\nDim iMA_ID As Long\n\nDim iSollVgl As Long\nDim iSoll As Long\n\nDim dtSt1\nDim dtEn1\n\nDim dtSt2\nDim dtEn2\n\nSet db = CurrentDb\n\n'Table tbl_MA_VA_Zuordnung mit den fehlenden Positionsnummern füllen.\n'Table tbl_MA_VA_Zuordnung - Überzählige IDs löschen\n'Update aller Datensätze mit Sortierung der MAs und Neuer Vergabe der Positionsnummern\n\nDoEvents\nDBEngine.Idle dbRefreshCache\nDBEngine.Idle dbFreeLocks\nDoEvents\n\n\n'Löschen ganze Schichten ...\nCall CurrentDb.Execute(\"Delete * FROM tbl_MA_VA_Zuordnung WHERE VA_ID IN (SELECT Zuo_ID From qry_Falsche_Nr)\")\nDoEvents\n\nrecsetSQL1 = \"SELECT tbl_VA_Start.* FROM tbl_VA_Start where tbl_VA_Start.VA_ID = \" & iVA_ID & \" AND tbl_VA_Start.VADatum_ID = \" & iVADatum_ID & \" ORDER BY VA_Start, VA_Ende;\"\nArrFill_DAO_OK1 = ArrFill_DAO_Acc(recsetSQL1, iZLMax1, iColMax1, DAOARRAY1)\n'Info:   'AccessArray(iSpalte,iZeile) <0, 0>\nIf ArrFill_DAO_OK1 Then\n    For iZl = 0 To iZLMax1\n        iVAStart_ID = CLng(DAOARRAY1(0, iZl))\n        'Anzahl lt Schichtplan\n        iAnz = CLng(DAOARRAY1(3, iZl))\n        'Vorhandene Anzahl lt. Einsatzplan\n        iVgl = Nz(TCount(\"*\", \"tbl_MA_VA_Zuordnung\", \"VAStart_ID = \" & iVAStart_ID), 0)\n       \n       'Wenn Überzählige im Einsatzplan ...\n        If iVgl > iAnz Then  ' Überzählige löschen\n            j = iVgl - iAnz\n            Set rst = db.OpenRecordset(\"SELECT * FROM tbl_MA_VA_Zuordnung WHERE VAStart_ID = \" & iVAStart_ID & \" Order by PosNr Desc;\")\n            With rst\n                For i = 1 To j\n                    .Delete\n                    .MoveNext\n                Next i\n                .Close\n                DoEvents\n            End With\n            Set rst = Nothing\n            DoEvents\n            \n        'Wenn Unterzählige im Einsatzplan ...\n        ElseIf iVgl < iAnz Then  ' Fehlende hinzufügen\n            j = iAnz - iVgl\n            iLfdNr = Nz(TMax(\"PosNr\", \"tbl_MA_VA_Zuordnung\", \"VAdatum_ID = \" & iVADatum_ID), 0) + 1\n            \n            dtdat = CDate(DAOARRAY1(7, iZl))\n            j = iAnz - iVgl\n            Debug.Print j\n            For i = 1 To j\n                \n                strSQL = \"\"\n                strSQL = strSQL & \"INSERT INTO tbl_MA_VA_Zuordnung ( VA_ID, VADatum_ID, VAStart_ID, PosNr, MA_ID, MA_Start, MA_Ende, Erst_am, Erst_von, VADatum, MVA_Start, MVA_Ende, PreisArt_ID)\"\n                strSQL = strSQL & \" SELECT tbl_VA_Start.VA_ID, tbl_VA_Start.VADatum_ID, tbl_VA_Start.ID, \"\n                strSQL = strSQL & iLfdNr & \" AS APosNr, 0 AS AMA_ID, tbl_VA_Start.VA_Start, tbl_VA_Start.VA_Ende, \"\n                strSQL = strSQL & \" Now() AS Ausdr5, atcnames(1) AS Ausdr6, \"\n                strSQL = strSQL & \" tbl_VA_Start.VADatum, tbl_VA_Start.MVA_Start, tbl_VA_Start.MVA_Ende, 1 AS APrArt \"\n                strSQL = strSQL & \" FROM tbl_VA_Start WHERE (((tbl_VA_Start.ID)= \" & iVAStart_ID & \"));\"\n                CurrentDb.Execute (strSQL)\n                                  \n                iLfdNr = iLfdNr + 1\n            \n            Next i\n            DoEvents\n        End If\n    Next iZl\n\n    DoEvents\n    DBEngine.Idle dbRefreshCache\n    DBEngine.Idle dbFreeLocks\n    DoEvents\n\n'Über und unterzählige Datensätze bereinigt\n' Jetzt alle Datensätze Updaten\n            \n'Namen sortieren pro Schicht\n    For iZl = 0 To iZLMax1\n        iVAStart_ID = CLng(DAOARRAY1(0, iZl))\n        iAnz = CLng(DAOARRAY1(3, iZl))\n        dtSt2 = DAOARRAY1(4, iZl)\n        dtEn2 = DAOARRAY1(5, iZl)\n        \n        recsetSQL1 = \"\"\n        recsetSQL1 = recsetSQL1 & \"SELECT tbl_MA_VA_Zuordnung.MA_ID, tbl_MA_VA_Zuordnung.MA_Start, tbl_MA_VA_Zuordnung.MA_Ende FROM tbl_MA_VA_Zuordnung LEFT JOIN tbl_MA_Mitarbeiterstamm ON tbl_MA_VA_Zuordnung.MA_ID = tbl_MA_Mitarbeiterstamm.ID\"\n        recsetSQL1 = recsetSQL1 & \" WHERE (((tbl_MA_VA_Zuordnung.VA_ID) = \" & iVA_ID & \") And ((tbl_MA_VA_Zuordnung.VADatum_ID) = \" & iVADatum_ID & \" ) AND MA_ID > 0 And ((tbl_MA_VA_Zuordnung.VAStart_ID) = \" & iVAStart_ID & \"))\"\n        recsetSQL1 = recsetSQL1 & \" ORDER BY tbl_MA_Mitarbeiterstamm.Nachname, tbl_MA_Mitarbeiterstamm.Vorname, tbl_MA_VA_Zuordnung.MA_Start, tbl_MA_VA_Zuordnung.MA_ENde;\"\n        \n        ArrFill_DAO_OK1 = ArrFill_DAO_Acc(recsetSQL1, iZLMax1, iColMax1, DAOARRAY1)\n        'Info:   'AccessArray(iSpalte,iZeile) <0, 0>\n        If Not ArrFill_DAO_OK1 Then\n    '        MsgBox \"Sortierung nicht möglich, Abbruch\"\n            Exit For\n        End If\n    \n        iSollVgl = Nz(TCount(\"*\", \"tbl_MA_VA_Zuordnung\", \"VA_ID = \" & iVA_ID & \" AND VADatum_ID = \" & iVADatum_ID & \" AND VAStart_ID = \" & iVAStart_ID), 0)\n        If iSollVgl = 0 Or iAnz <> iSollVgl Then\n           ' MsgBox \"Sortierung nicht möglich, Abbruch\"\n            Debug.Print \"Keine Sortierung\"\n            Exit For\n        End If\n        Set rst = db.OpenRecordset(\"SELECT * FROM tbl_MA_VA_Zuordnung WHERE VA_ID = \" & iVA_ID & \" AND VADatum_ID = \" & iVADatum_ID & \" AND VAStart_ID = \" & iVAStart_ID & \" ORDER BY [PosNr];\")\n        iZl = 0\n        With rst\n            Do Until .EOF\n                If iZl <= iZLMax1 Then\n                    iMA_ID = DAOARRAY1(0, iZl)\n                    dtSt1 = DAOARRAY1(1, iZl)\n                    dtEn1 = DAOARRAY1(2, iZl)\n                Else\n                    iMA_ID = 0\n                    dtSt1 = dtSt2\n                    dtEn1 = dtEn2\n                End If\n                .Edit\n                    .fields(\"MA_ID\") = iMA_ID\n                    .fields(\"MA_Start\") = dtSt1\n                    .fields(\"MA_Ende\") = dtEn1\n                .update\n                .MoveNext\n                iZl = iZl + 1\n            Loop\n            .Close\n        End With\n        Set rst = Nothing\n    Next iZl\nEnd If\n\n\n\nDoEvents\nDBEngine.Idle dbRefreshCache\nDBEngine.Idle dbFreeLocks\nDoEvents\n\n\n'Fortlaufende PosNr erzeugen über alle Schichten hinweg\nk = rstDcount(\"*\", \"SELECT * FROM tbl_MA_VA_Zuordnung WHERE VADatum_ID = \" & iVADatum_ID & \" AND VA_ID = \" & iVA_ID)\nIf k > 0 Then\n    i = k\n    Set rst = db.OpenRecordset(\"SELECT * FROM tbl_MA_VA_Zuordnung WHERE VADatum_ID = \" & iVADatum_ID & \" AND VA_ID = \" & iVA_ID & \" Order by MA_Start, PosNr;\")\n    With rst\n    'Dummy Lfd Nr vergeben um die Key-Eindeutigkeit nicht zu verletzen\n        Do Until .EOF\n            .Edit\n               .fields(\"PosNr\").Value = i * 10000\n            .update\n            i = i - 1\n            .MoveNext\n        Loop\n        .MoveFirst\n        \n    'Lfd Nr umsortieren\n        i = 1\n        Do Until .EOF\n            .Edit\n               .fields(\"PosNr\").Value = i\n            .update\n            i = i + 1\n            .MoveNext\n        Loop\n        .Close\n        DoEvents\n        Set rst = Nothing\n    End With\nEnd If\n\n\nDoEvents\nDBEngine.Idle dbRefreshCache\nDBEngine.Idle dbFreeLocks\nDoEvents\n\n\nSet DAOARRAY1 = Nothing\nSet DAOARRAY2 = Nothing\nEnd Function\n\n\nFunction fCreate_PosNr_Lfd()\nDim db As DAO.Database\nDim rst As DAO.Recordset\nDim i As Long\nDim iVgl As Long\nSet db = CurrentDb\nSet rst = db.OpenRecordset(\"SELECT * FROM tbltmp_PosNr_create ORDER BY VADatum, VA_ID, VA_Start_ID, LfdNr_Start;\")\nWith rst\n    iVgl = .fields(\"MaxPos\")\n    i = 1\n    Do While Not .EOF\n        If iVgl <> .fields(\"MaxPos\") Then\n            i = 1\n            iVgl = .fields(\"MaxPos\")\n        End If\n        .Edit\n            .fields(\"PosNr\") = i\n        .update\n        i = i + 1\n        .MoveNext\n    Loop\n    .Close\nEnd With\nSet rst = Nothing\n\nEnd Function\n\n\nFunction fObjektOrt(ByVal Auftrag As String, ByVal Ort As String, ByVal Objekt As String) As String\n\nDim i1 As Long, i2 As Long, i3 As Long, s As String\ni1 = Len(Trim(Nz(Auftrag)))\ni2 = Len(Trim(Nz(Ort)))\ni3 = Len(Trim(Nz(Objekt)))\n\nIf i1 > 0 And i2 > 0 And i3 > 0 Then\n    s = Trim(Objekt & \" \" & Ort)\nElse\n    s = Trim(Nz(Auftrag)) & \" \" & Trim(Nz(Objekt))\n    s = Trim(s) & \" \" & Trim(Nz(Ort))\n    s = Trim(s)\nEnd If\nfObjektOrt = s\n\nEnd Function\n\n\n'Objekt + Ort für Dienstplanübersicht\nFunction fObjektOrt3(ByVal Auftrag As String, ByVal Ort As String, ByVal Objekt As String) As String\n\nDim i1 As Long, i2 As Long, i3 As Long, s As String\n\n    i1 = Len(Trim(Nz(Auftrag)))\n    i2 = Len(Trim(Nz(Ort)))\n    i3 = Len(Trim(Nz(Objekt)))\n    \n    \n    If i1 > 0 And i2 > 0 And i3 > 0 Then\n        s = Trim(Auftrag & \" \" & Objekt & \" \" & Ort)\n    Else\n        s = Trim(Nz(Auftrag)) & \" \" & Trim(Nz(Objekt))\n        s = Trim(s) & \" \" & Trim(Nz(Ort))\n        s = Trim(s)\n    End If\n    \n    'Nur Auftrag und Ort anzeigen\n    s = Trim(Nz(Auftrag)) & \", \" & Trim(Nz(Ort))\n    \n    \n    fObjektOrt3 = s\n\nEnd Function\n\n\n\nFunction ftel_erf(s1 As String, s2 As String) As String\nDim s As String\nIf Len(Trim(Nz(s1))) > 0 And Len(Trim(Nz(s2))) > 0 Then\n    s = s1 & \" | \" & s2\nElse\n    s = Trim(Nz(s1) & Nz(s2))\nEnd If\nftel_erf = s\nEnd Function\n\nFunction fAnstellungsart(ID As Long) As String\nfAnstellungsart = Nz(TLookup(\"Anstellungsart\", \"tbl_hlp_MA_Anstellungsart\", \"ID = \" & ID))\nEnd Function\n\n\nFunction VA_Start_Erw()\n'Dim db As DAO.Database\n'Dim rst As DAO.Recordset\n'Dim i As Long\n'Dim A As String\n'Dim ivgl As Long\n'\n'Set db = CurrentDb()\n'Set rst = db.OpenRecordset(\"SELECT * FROM tbl_VA_Start ORDER BY VA_ID, VADatum_ID, VA_Start, VA_Ende;\")\n'A = \"A\"\n'With rst\n'    ivgl = .Fields(\"VA_ID\")\n'    Do While Not .EOF\n'        If ivgl <> .Fields(\"VA_ID\") Then\n'            A = \"A\"\n'            ivgl = .Fields(\"VA_ID\")\n'        End If\n'        .Edit\n'            .Fields(\"VAStart_ID_Bchst\") = A\n'        .Update\n'        A = Chr$(Asc(A) + 1)\n'        .MoveNext\n'    Loop\n'    .Close\n'End With\n'Set rst = Nothing\n'\n'DoEvents\n'CurrentDb.Execute (\"UPDATE tbl_VA_Start INNER JOIN tbl_MA_VA_Zuordnung ON tbl_VA_Start.ID = tbl_MA_VA_Zuordnung.VAStart_ID SET tbl_MA_VA_Zuordnung.VAStart_ID_Bchst = [tbl_VA_Start].[VAStart_ID_Bchst];\")\n'DoEvents\n\nEnd Function\n\nFunction fAnzAuftragTag(dt As Date) As Long\n\nIf dt <= CDate(TMax(\"VADatum\", \"tbl_VA_AnzTage\")) And dt >= CDate(DMin(\"VADatum\", \"tbl_VA_AnzTage\")) Then\n    fAnzAuftragTag = Nz(TCount(\"*\", \"tbl_VA_AnzTage\", \"VADatum = \" & SQLDatum(dt)), 0)\nElse\n    fAnzAuftragTag = -1\nEnd If\nEnd Function\n\n\nFunction date_Umsetz(dt As Date, relstd As Single) As Date\n\nDim dtx As Date\ndtx = dt + (relstd / 24)\n\ndate_Umsetz = dtx\n\nEnd Function\n\n\nFunction Loginname() As String\nLoginname = Nz(TLookup(\"Int_Nachname\", \"_tblEigeneFirma_Mitarbeiter\", \"int_Login = '\" & atCNames(1) & \"'\")) & \", \" & Nz(TLookup(\"Int_Vorname\", \"_tblEigeneFirma_Mitarbeiter\", \"int_Login = '\" & atCNames(1) & \"'\"))\nEnd Function\n\nFunction fAuftr_RG(iTyp As Long, iRch_ID As Long)\nDim i As Long, iVA_ID As Long\nDim strSQL As String\nstrSQL = \"SELECT tbl_Rch_Pos_Auftrag.VA_ID, tbl_Rch_Pos_Auftrag.Rch_ID FROM tbl_Rch_Pos_Auftrag GROUP BY tbl_Rch_Pos_Auftrag.VA_ID, tbl_Rch_Pos_Auftrag.Rch_ID\"\n\ni = rstDcount(\"*\", strSQL, \"Rch_ID = \" & iRch_ID)\nIf i > 1 Or i < 1 Then\n    If iTyp = 1 Then\n        fAuftr_RG = \"Diverse\"\n    Else\n        fAuftr_RG = \"\"\n    End If\nElse\n    iVA_ID = Nz(TLookup(\"VA_ID\", \"tbl_Rch_Pos_Auftrag\", \"Rch_ID = \" & iRch_ID))\n    Select Case iTyp\n        Case 1\n            fAuftr_RG = TLookup(\"Auftrag\", \"tbl_VA_Auftragstamm\", \"ID = \" & iVA_ID)\n        Case 2\n            fAuftr_RG = TLookup(\"Ort\", \"tbl_VA_Auftragstamm\", \"ID = \" & iVA_ID)\n        Case 3\n            fAuftr_RG = TLookup(\"Objekt\", \"tbl_VA_Auftragstamm\", \"ID = \" & iVA_ID)\n        Case Else\n            fAuftr_RG = \"\"\n    End Select\nEnd If\n\nEnd Function\n\n\nFunction MA_ID_Test(MA_ID As Long) As Long\n\nDim i As Long\ni = Nz(TLookup(\"ID\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID), 0)\n\nIf i = 0 Then\n    MA_ID_Test = 1001  ' TBA\nElse\n    MA_ID_Test = i\nEnd If\n\nEnd Function\n\n'Function fMA_IstOK(ID As Long, MA_ID As Long, VADatum As Date, VAStart_ID As Long, Zeit_Herkunft_ID As Long, Optional VA_ID As Long, Optional bFehlerAnz As Boolean = True) As Long\n''fMA_IstOK(Me!ID, Me!MA_ID, Me!VADatum, Me!MA_Start, Me!MA_Ende, 3, Me.Parent!ID, bFehlerAnz)\n'' Zeit_Herkunft_ID = Woher kam der Aufruf: : 1 = Planung, 3 = Zuordnung\n'\n''Fehlercode = 1 - Im gleichen Auftrag bereits verplant\n'\n'Dim strSQL As String\n'\n'strSQL = \"VA_ID = \" & VA_ID & \" AND MA_ID = \" & MA_ID & \" AND VADatum_ID = \" & VADatum_ID & \" AND VAStart_ID = \" & VAStart_ID\n''MA gleicher Auftrag schon verplant oder zugeordnet ?\n'If Len(Trim(Nz(VA_ID))) > 0 Then\n'    If TCount(\"*\", \"tbl_MA_VA_Zuordnung\", strSQL) > 0 Or TCount(\"*\", \"tbl_MA_VA_Planung\", strSQL) > 0 Then\n'        fMA_IstOK = 1\n'        Exit Function\n'    End If\n'End If\n'\n'strSQL = \"VA_ID = \" & VA_ID & \" AND MA_ID = \" & MA_ID & \" AND VADatum_ID = \" & VADatum_ID\n'If Len(Trim(Nz(VA_ID))) > 0 Then\n'    If TCount(\"*\", \"tbl_MA_VA_Zuordnung\", strSQL) > 0 Or TCount(\"*\", \"tbl_MA_VA_Planung\", strSQL) > 0 Then\n'        fMA_IstOK = 2\n'        Exit Function\n'    End If\n'End If\n'strSQL = \"VA_ID = \" & VA_ID & \" AND MA_ID = \" & MA_ID & \" AND VADatum_ID = \" & VADatum_ID\n'If Len(Trim(Nz(VA_ID))) > 0 Then\n'    If TCount(\"*\", \"tbl_MA_VA_Zuordnung\", strSQL) > 0 Or TCount(\"*\", \"tbl_MA_VA_Planung\", strSQL) > 0 Then\n'        fMA_IstOK = 2\n'        Exit Function\n'    End If\n'End If\n'\n'End Function\n\nFunction VA_AnzTage_Maintainance()\n\nCurrentDb.Execute (\"qry_MA_Maintainance_Zuo_1\")\nCurrentDb.Execute (\"qry_MA_Maintainance_Zuo_PKW_2\")\nCurrentDb.Execute (\"qry_MA_Maintainance_Zuo_3\")\n\nCurrentDb.Execute (\"qry_MA_Maintainance_Upd_Tl0_Null\")\nCurrentDb.Execute (\"qry_MA_Maintainance_UPd_Tl1_Ist\")\nCurrentDb.Execute (\"qry_MA_Maintainance_UPd_Tl2_Soll\")\nCurrentDb.Execute (\"qry_MA_Maintainance_UPd_Tl3_PKWl\")\nCurrentDb.Execute (\"qry_MA_Maintainance_UPd_Tl4_Offen\")\n\nDoCmd.DeleteObject acTable, \"temp_tbl_MA_Maintainance_Zuo_Tl1\"\nDoCmd.DeleteObject acTable, \"temp_tbl_MA_Maintainance_PKW_Zuo_T2\"\nDoCmd.DeleteObject acTable, \"temp_tbl_MA_Maintainance_Zuo_Tl3\"\n\nEnd Function\n\n'Aktuelle Veranstaltungsdaten updaten\nFunction VA_AnzTage_Upd(iVA_ID As Long, iVADatum_ID As Long)\n\nDim iIst As Long\nDim iSoll As Long\nDim iAnzPKW As Long\nDim bIstNotOffen As Long\n\nDim strSQL As String\n\niIst = Nz(TCount(\"*\", \"tbl_MA_VA_Zuordnung\", \"MA_ID > 0 AND VA_ID = \" & iVA_ID & \" AND VADatum_ID = \" & iVADatum_ID), 0)\niAnzPKW = Nz(TCount(\"*\", \"tbl_MA_VA_Zuordnung\", \"PKW IS NOT NULL AND VA_ID = \" & iVA_ID & \" AND VADatum_ID = \" & iVADatum_ID), 0)\niSoll = Nz(TSum(\"MA_Anzahl\", \"tbl_VA_Start\", \"VA_ID = \" & iVA_ID & \" AND VADatum_ID = \" & iVADatum_ID), 0)\nbIstNotOffen = Not ((iIst <> 0) And (iSoll <> 0) And (iSoll - iIst <= 0))\n\nstrSQL = \"\"\nstrSQL = strSQL & \"UPDATE tbl_VA_AnzTage SET tbl_VA_AnzTage.TVA_Soll = \" & iSoll & \", \"\nstrSQL = strSQL & \" tbl_VA_AnzTage.TVA_Ist = \" & iIst & \", \"\nstrSQL = strSQL & \" tbl_VA_AnzTage.TVA_Offen = \" & bIstNotOffen & \", \"\nstrSQL = strSQL & \" tbl_VA_AnzTage.PKW_Anzahl = \" & iAnzPKW\nstrSQL = strSQL & \" WHERE (((tbl_VA_AnzTage.ID)= \" & iVADatum_ID & \"));\"\n\nCurrentDb.Execute (strSQL)\n\nEnd Function\n\n\nFunction sumo_Test() As Single\nDim dt As Date\ndt = DateSerial(2019, 9, 1)\nsumo_Test = zMA_Monat_SumNetStd(152, dt)\nEnd Function\n\nFunction MA_Monat_SumNetStd(iMA_ID As Long, mondat As Date) As Single\nDim SQLWHERE As String\nDim mosum As Single\nSQLWHERE = \"(tbl_MA_VA_Zuordnung.VADatum Between \" & SQLDatum(DateSerial(year(mondat), Month(mondat), 1)) & \" AND \" & SQLDatum(DateSerial(year(mondat), Month(mondat) + 1, 0)) & \") AND ((tbl_MA_VA_Zuordnung.MA_ID = \" & iMA_ID & \") AND (tbl_MA_VA_Zuordnung.Rch_Erstellt = TRUE))\"\nmosum = Nz(TSum(\"MA_Netto_Std\", \"tbl_MA_VA_Zuordnunng\", SQLWHERE), 0)\nMA_Monat_SumNetStd = fctround(mosum)\nEnd Function\n\n\n'Berechnung Nettostunden -> Gesamter Monat eingeteilt!\nFunction zMA_Monat_SumNetStd(iMA_ID As Long, mondat As Date) As Single\nDim SQLWHERE As String\nDim mosum As Single\n\n    SQLWHERE = \"(\" & ZUORDNUNG_FE & \".VADatum Between \" & SQLDatum(DateSerial(year(mondat), Month(mondat), 1)) & \" AND \" & _\n        SQLDatum(DateSerial(year(mondat), Month(mondat) + 1, 0)) & \") AND (\" & ZUORDNUNG_FE & \".MA_ID = \" & iMA_ID & \")\"\n\n    mosum = Nz(TSum(\"MA_Netto_Std2\", ZUORDNUNG_FE, SQLWHERE), 0)\n    zMA_Monat_SumNetStd = fctround(mosum)\n    \nEnd Function\n\n\nFunction Startzeit_G(dtDat1, h_start1) As Date\n\nDim dtdatzeitvon As Date\nDim dtdatzeitbis As Date\nDim sg As Single\n\nOn Error Resume Next\nDim h_start As Date\nDim h_ende As Date\n\nDim dtdat As Date\n\nIf IsNull(h_start1) Or IsNull(dtDat1) Then Exit Function\n\nIf Not IsDate(h_start1) Or Not IsDate(dtDat1) Then Exit Function\n\nh_start = h_start1\ndtdat = dtDat1\n\ndtdatzeitvon = Fix(dtdat) + TimeSerial(Hour(h_start), minute(h_start), 0)\nStartzeit_G = dtdatzeitvon\n\nEnd Function\n\n\nFunction Endezeit_G(dtDat1, h_start1, Optional h_ende1) As Date\n\nDim dtdatzeitvon As Date\nDim dtdatzeitbis As Date\nDim sg As Single\n\nDim stzwi As Single\n\n\nOn Error Resume Next\nDim h_start As Date\nDim h_ende As Date\n\nDim dtdat As Date\n\nstzwi = CSng(Get_Priv_Property(\"prp_VA_Start_AutoLaenge\")) / 24#\n\nIf IsNull(h_start1) Or IsNull(dtDat1) Then Exit Function\nIf Not IsDate(h_start1) Or Not IsDate(dtDat1) Then Exit Function\n\nh_start = h_start1\ndtdat = dtDat1\n\nIf IsDate(h_ende1) Then\n    h_ende = h_ende1\nElse\n    h_ende = TimeSerial(Hour(h_start), minute(h_start), 0) + stzwi\nEnd If\n\ndtdatzeitvon = Fix(dtdat) + TimeSerial(Hour(h_start), minute(h_start), 0)\ndtdatzeitbis = Fix(dtdat) + TimeSerial(Hour(h_ende), minute(h_ende), 0)\nIf dtdatzeitbis < dtdatzeitvon Then dtdatzeitbis = dtdatzeitbis + 1\nEndezeit_G = dtdatzeitbis\n\nEnd Function\n\n\nFunction timeberech_G(dtDat1, h_start1, h_ende1, Optional PreisArt_ID As Long = 1) As Variant\n\nDim dtdatzeitvon As Date\nDim dtdatzeitbis As Date\nDim sg As Single\n\nOn Error Resume Next\nDim h_start As Date\nDim h_ende As Date\n\nDim dtdat As Date\n\n\n'timeberech_G = 0\nsg = 0\ntimeberech_G = sg\n\nIf IsNull(h_start1) Or IsNull(h_ende1) Or IsNull(dtDat1) Then Exit Function\n\nIf Not IsDate(h_start1) Or Not IsDate(h_ende1) Or Not IsDate(dtDat1) Or PreisArt_ID > 3 Then Exit Function\n\nh_start = h_start1\nh_ende = h_ende1\ndtdat = dtDat1\n\ndtdatzeitvon = Fix(dtdat) + TimeSerial(Hour(h_start), minute(h_start), 0)\ndtdatzeitbis = Fix(dtdat) + TimeSerial(Hour(h_ende), minute(h_ende), 0)\nIf dtdatzeitbis < dtdatzeitvon Then dtdatzeitbis = dtdatzeitbis + 1\nsg = Nz(fctround(DateDiff(\"n\", dtdatzeitvon, dtdatzeitbis, 2, 2) / 60), 0)\ntimeberech_G = sg\nEnd Function\n\nFunction StdSumAll_Neuberech(Optional iVA_ID As Long = 0)\n\nDim strSQL As String\nDim strSQL2 As String\n\nIf table_exist(\"tbltmp_AnzStd\") Then\n    DoCmd.DeleteObject acTable, \"tbltmp_AnzStd\"\n    DoEvents\nEnd If\n\nstrSQL2 = \"\"\nIf iVA_ID > 0 Then\n    strSQL2 = \" AND VA_ID = \" & iVA_ID\nEnd If\n\nstrSQL = \"UPDATE tbl_VA_AnzTage SET tbl_VA_AnzTage.TVA_Soll = 0, tbl_VA_AnzTage.TVA_Ist = 0 WHERE 1 = 1\" & strSQL2 & \";\"\nCurrentDb.Execute (strSQL)\nDoEvents\n\nstrSQL = \"\"\nstrSQL = strSQL & \"SELECT tbl_VA_Start.VA_ID, tbl_VA_Start.VADatum_ID, Sum(tbl_VA_Start.MA_Anzahl) AS SummevonMA_Anzahl INTO tbltmp_AnzStd\"\nstrSQL = strSQL & \" FROM tbl_VA_Start \"\nstrSQL = strSQL & \" WHERE 1 = 1 \" & strSQL2\nstrSQL = strSQL & \" GROUP BY tbl_VA_Start.VA_ID, tbl_VA_Start.VADatum_ID;\"\nCurrentDb.Execute (strSQL)\nDoEvents\n\nstrSQL = \"\"\nstrSQL = strSQL & \"UPDATE tbltmp_AnzStd INNER JOIN tbl_VA_AnzTage ON (tbltmp_AnzStd.VADatum_ID = tbl_VA_AnzTage.ID) \"\nstrSQL = strSQL & \" AND (tbltmp_AnzStd.VA_ID = tbl_VA_AnzTage.VA_ID) SET tbl_VA_AnzTage.TVA_Soll = [SummevonMA_Anzahl];\"\nCurrentDb.Execute (strSQL)\nDoEvents\n\nDoCmd.DeleteObject acTable, \"tbltmp_AnzStd\"\n\nstrSQL = \"\"\nstrSQL = strSQL & \"SELECT tbl_MA_VA_Zuordnung.VA_ID, tbl_MA_VA_Zuordnung.VADatum_ID, Count(tbl_MA_VA_Zuordnung.MA_ID) AS AnzahlvonMA_ID INTO tbltmp_AnzStd\"\nstrSQL = strSQL & \" FROM tbl_MA_VA_Zuordnung \"\nstrSQL = strSQL & \" WHERE 1 = 1 \" & strSQL2\nstrSQL = strSQL & \" GROUP BY tbl_MA_VA_Zuordnung.VA_ID, tbl_MA_VA_Zuordnung.VADatum_ID\"\nCurrentDb.Execute (strSQL)\nDoEvents\n\nstrSQL = \"\"\nstrSQL = strSQL & \"UPDATE tbltmp_AnzStd INNER JOIN tbl_VA_AnzTage ON (tbltmp_AnzStd.VADatum_ID = tbl_VA_AnzTage.ID) \"\nstrSQL = strSQL & \" AND (tbltmp_AnzStd.VA_ID = tbl_VA_AnzTage.VA_ID) SET tbl_VA_AnzTage.TVA_Ist = [AnzahlvonMA_ID];\"\nCurrentDb.Execute (strSQL)\nDoEvents\n\nstrSQL = \"\"\nstrSQL = strSQL & \"UPDATE tbl_VA_AnzTage SET tbl_VA_AnzTage.TVA_Offen = True WHERE ((([TVA_Soll]-[TVA_Ist])>0) OR TVA_Soll = 0);\"\nCurrentDb.Execute (strSQL)\nDoEvents\n\n'strSQL = \"\"\n'strSQL = strSQL & \"UPDATE tbl_VA_AnzTage SET tbl_VA_AnzTage.TVA_Offen = True WHERE (((tbl_VA_AnzTage.TVA_Soll)=0) AND ((tbl_VA_AnzTage.TVA_Ist)=0));\"\n'CurrentDb.Execute (strSQL)\n'DoEvents\n\n'DoCmd.DeleteObject acTable, \"tbltmp_AnzStd\"\n\nEnd Function\n\n\n\nFunction fFontchange_frm(frmName As String)\n\nDim ctl\nDoCmd.OpenForm \"MyReport\", acViewDesign\nFor Each ctl In Forms.item(\"AmbulanceServices\")\n  If ctl.FontName = \"*\" Then\n    ctl.FontName = \"Arial\"\n    ctl.FontSize = 10\n  End If\nNext\nDoCmd.Save acForm, \"MyReport\"\n\nEnd Function\n\n'VA_StartDat: fGetStDat([VaDatum];[VA_Start])\nFunction fGetStDat(dtDatum As Date, dtStart As Date) As Date\nfGetStDat = Fix(dtDatum) + TimeSerial(Hour(dtStart), minute(dtStart), 0)\nEnd Function\n\n'VA_EndeDat: fGetEndDat([VaDatum];[VA_Start];[VA_Ende])\nFunction fGetEndDat(dtDatum As Date, dtStart As Date, dtEnde As Date) As Date\nDim stdat As Date\nDim Enddat As Date\nstdat = Fix(dtDatum) + TimeSerial(Hour(dtStart), minute(dtStart), 0)\nEnddat = Fix(dtDatum) + TimeSerial(Hour(dtEnde), minute(dtEnde), 0)\nIf Enddat < stdat Then Enddat = Enddat + 1\nfGetEndDat = Enddat\nEnd Function\n\nFunction aend_Dat_Auftr()\nDim db As DAO.Database\nDim rst As DAO.Recordset\n\nDim dtVgl As Date\n\nSet db = CurrentDb\nSet rst = db.OpenRecordset(\"SELECT * FROM tbl_XL_Auftrag_Einsatz;\")\n\n    With rst\n        dtVgl = .fields(\"dtdatum\")\n        Do While Not .EOF\n            .Edit\n            If IsNull(.fields(\"dtdatum\")) Then\n            .Edit\n                .fields(\"dtdatum\") = dtVgl\n            .update\n            Else\n                dtVgl = .fields(\"dtdatum\")\n            End If\n            .MoveNext\n        Loop\n        \n        .Close\n    End With\nSet rst = Nothing\n\nEnd Function\n\nFunction ZtDatLoesch(xin As Variant) As Date\nDim dtdbl As Double\nDim dtlng As Long\nIf Not IsNull(xin) Then\n    If Not IsDate(xin) Then\n        Exit Function\n    End If\nElse\n    Exit Function\nEnd If\n\ndtdbl = xin\ndtlng = Fix(xin)\nZtDatLoesch = dtdbl - dtlng\nEnd Function\n\nFunction VorMon_Ueberlaufstd_Les(MA_ID As Long, aktJahr As Long, Aktmon As Long) As Single\n'Lesen Überlaufstunden Vormonat\nDim iJahr As Long\nDim iMon As Long\n\nDim sWert As Single\n\niMon = Aktmon - 1\niJahr = aktJahr\n\nIf iMon <= 0 Then\n    iMon = 12\n    iJahr = iJahr - 1\nEnd If\n\nsWert = Nz(TLookup(\"M\" & iMon, \"tbl_MA_UeberlaufStunden\", \"AktJahr = \" & iJahr & \" AND MA_ID = \" & MA_ID), 0)\nVorMon_Ueberlaufstd_Les = sWert\n\nEnd Function\n\nFunction AktMon_Ueberlaufstd_Upd(MA_ID As Long, aktJahr As Long, Aktmon As Long, StdAnz As Single) As Single\n'Update Überlaufstunden Aktueller Monat\n\nIf Aktmon < 1 Or Aktmon > 12 Or aktJahr < 2010 Or aktJahr > year(Date) + 1 Or StdAnz = 0 Then Exit Function\n\nDim strSQL As String\n\nIf Nz(TLookup(\"ID\", \"tbl_MA_UeberlaufStunden\", \"MA_ID = \" & MA_ID & \" AND AktJahr = \" & aktJahr), 0) = 0 Then\n\n    strSQL = \"\"\n    strSQL = strSQL & \"INSERT INTO tbl_MA_UeberlaufStunden ( MA_ID, AktJahr )\"\n    strSQL = strSQL & \" SELECT \" & MA_ID & \"  AS Ausdr1, \" & aktJahr & \" AS Ausdr2\"\n    strSQL = strSQL & \" FROM _tblInternalSystemFE;\"\n    CurrentDb.Execute strSQL\n    DoEvents\n\nEnd If\n\nstrSQL = \"\"\nstrSQL = strSQL & \"UPDATE tbl_MA_UeberlaufStunden SET tbl_MA_UeberlaufStunden.M\" & Aktmon & \" = \" & str(StdAnz)\nstrSQL = strSQL & \" WHERE (((tbl_MA_UeberlaufStunden.MA_ID)= \" & MA_ID & \") AND ((tbl_MA_UeberlaufStunden.AktJahr)= \" & aktJahr & \" ));\"\nCurrentDb.Execute strSQL\nDoEvents\n\nEnd Function\n\n\nFunction DivInfo_MA(MA_ID As Long, sMaxStd As Single, stdlohn As Currency, RV_Betrag As Currency, RL34a_pro_Std As Currency, Proz_Lohnsteuer As Single, MA_Netto_std2 As Single)\n'---------------------------------------------------------------------------------------\n' Procedure : DivInfo_MA\n' Author    : Klaus\n' Date      : 09.04.2015\n' Purpose   : Liefert alle Werte, die man für die Jahreswerte MA benötigt\n'               MA_ID As Long, sMaxStd As Single, RV_Betrag As Currency, stdlohn As Currency, Proz_Lohnsteuer As Single, RL34a_pro_Std As Currency)\n'               MA_ID ist Input, der Rest ist Output:\n'\n'Wenn sMaxStd > 0 Dann die Summe (Nettostunden + Überlauf Vormat) auf max. Erlaubt und Folgemonat verteilen.\n' Bei RV_Betrag, RL34a_pro_Std, Proz_Lohnsteuer - Rückgabe 0 wenn Bedingung nicht erfüllt, sonst Wert\n'---------------------------------------------------------------------------------------\n'\n'#################################\n'Dim iiMA_ID As Long, osMaxStd As Single, oRV_Betrag As Currency, oRL34a_pro_Std As Currency, ostdlohn As Currency, oProz_Lohnsteuer As Single\n'\n'iiMA_ID = 1234\n'Call DivInfo_MA(iiMA_ID, sMaxStd, stdlohn, RV_Betrag, RL34a_pro_Std, Proz_Lohnsteuer)\n'\n'osMaxStd = sMaxStd\n'ostdlohn = stdlohn\n'oRV_Betrag = RV_Betrag             ' Wenn Ist_RV_Befrantrag = True, Betrag 0\n'oRL34a_pro_Std = RL34a_pro_Std         ' 34a RL Betrag pro Stunde\n'oProz_Lohnsteuer = Proz_Lohnsteuer ' nur wenn Minijobber, sonst 0\n\n'Doevents\n'###################################\n\nDim MJ As String\nDim IstRV As Boolean\nDim Hat_keine_34a As Boolean\nDim Proz_RL_34a As Single\nDim ima_netto_std2 As Single\nMJ = UCase(Left(Nz(TLookup(\"Anstellungsart\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID)), 1))\nIstRV = Nz(TLookup(\"Ist_RV_Befrantrag\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID), 0)\nHat_keine_34a = Nz(TLookup(\"Hat_keine_34a\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID), 0)\n\nsMaxStd = Nz(TLookup(\"StundenZahlMax\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID), 0)\nstdlohn = Nz(TLookup(\"Stundenlohn_brutto\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID), 0)\nima_netto_std2 = Nz(TLookup(\"Ma_Netto_std2\", \"tbl_ma_va_zuordnung\", \"Me.MA_ID = \" & MA_ID), 0)\n\nIf MJ = \"M\" Then\n    'Proz_Lohnsteuer = Get_Priv_Property(\"prp_Lohnst\")\n    Proz_Lohnsteuer = \"0,02\"\n\n    \n    \n    \nElse\n    Proz_Lohnsteuer = 0\nEnd If\n\nIf IstRV = True Then\n    RV_Betrag = Get_Priv_Property(\"prp_RV_Betrag\")\nElse\n    RV_Betrag = 0\nEnd If\n\nIf Hat_keine_34a = False Then\n    Proz_RL_34a = Get_Priv_Property(\"prp_RL_34a\")\n    RL34a_pro_Std = Proz_RL_34a * stdlohn * MA_Netto_std2\nElse\n    RL34a_pro_Std = 0\nEnd If\n\nEnd Function\n\n'    fctRound(RL34a_pro_Std([MA_ID_Neu]) * [MA_Netto_Std2])\n\nFunction RL34a_pro_Std(MA_ID As Long) As Currency\n\n'Berechnung RL 34a:\n'Wenn: Kein_34a angekreuzt ist, wird RL 34a erhoben.\n'Wenn Kein_34a NICHT angekreuzt ist, so wird keine 34a Rücklage erhoben.\n'Das Datum_34a überschreibt den Status von Kein_34a.\n'Wenn Datum_34a enthält, wird VOR diesem Datum die RL 34a erhoben, danach nicht.\n\nDim Hat_keine_34a As Boolean\nDim MA_stdlohn As Currency\nDim Proz_RL_34a As Single\nDim RL_dat\nDim MA_Netto_Std As Single\nMA_stdlohn = Nz(TLookup(\"Stundenlohn_brutto\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID), 0)\nIf MA_stdlohn = 0 Then\n    MA_stdlohn = Get_Priv_Property(\"prp_Lohn_Notfall\")\nEnd If\n\nHat_keine_34a = Nz(TLookup(\"Hat_keine_34a\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID), 0)\nProz_RL_34a = Get_Priv_Property(\"prp_RL_34a\")\nRL_dat = TLookup(\"Datum_34a\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID)\n\nIf Hat_keine_34a = False Then\n    RL34a_pro_Std = Proz_RL_34a * MA_stdlohn * MA_Netto_Std\nElse\n    RL34a_pro_Std = 0\nEnd If\nIf Len(Trim(Nz(RL_dat))) = 0 Then\n    If Date > RL_dat Then\n        RL34a_pro_Std = Proz_RL_34a * MA_stdlohn * MA_Netto_Std\n    Else\n        RL34a_pro_Std = 0\n    End If\nEnd If\n\nEnd Function\n\nFunction MA_Proz_Lohnsteuer(MA_ID As Long) As Single\nDim MJ As Long\n\nMJ = Nz(TLookup(\"Anstellungsart_ID\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID), 0)\nIf MJ = 5 Then\n    MA_Proz_Lohnsteuer = Get_Priv_Property(\"prp_Lohnst\")\nElse\n    MA_Proz_Lohnsteuer = 0\nEnd If\n\nEnd Function\n\nFunction MA_RV_Betrag(MA_ID As Long) As Currency\n\nDim IstRV As Boolean\nIstRV = Nz(TLookup(\"Ist_RV_Befrantrag\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID), 0)\nIf IstRV = False Then\n    MA_RV_Betrag = Get_Priv_Property(\"prp_RV_Betrag\")\nElse\n    MA_RV_Betrag = 0\nEnd If\n\nEnd Function\n\nFunction MA_stdlohn(MA_ID As Long) As Currency\n\nMA_stdlohn = Nz(TLookup(\"Stundenlohn_brutto\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID), 0)\nIf MA_stdlohn = 0 Then\n    MA_stdlohn = Get_Priv_Property(\"prp_Lohn_Notfall\")\nEnd If\n\nEnd Function\n\n\nFunction MA_AktMax_Mon_std(MA_ID As Long, IstGes As Single) As Single\nDim Max_Mon_std As Single\nMax_Mon_std = Nz(TLookup(\"StundenZahlMax\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID), 0)\nIf Max_Mon_std > 0 Then\n    If IstGes > Max_Mon_std Then\n        MA_AktMax_Mon_std = fctround(Max_Mon_std)\n    Else\n        MA_AktMax_Mon_std = fctround(IstGes)\n    End If\nElse\n    MA_AktMax_Mon_std = fctround(IstGes)\nEnd If\nEnd Function\n\nFunction MA_Ueberl_Mon_std(MA_ID As Long, IstGes As Single) As Single\nDim Max_Mon_std As Single\nMax_Mon_std = Nz(TLookup(\"StundenZahlMax\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID), 0)\nIf Max_Mon_std > 0 Then\n    If IstGes > Max_Mon_std Then\n        MA_Ueberl_Mon_std = fctround(IstGes - Max_Mon_std)\n    Else\n        MA_Ueberl_Mon_std = 0\n    End If\nElse\n    MA_Ueberl_Mon_std = 0\nEnd If\nEnd Function\n\n\n\nFunction Netto_Std_Berech(Brutto_Std As Single) As Single\nDim Pause_Abzug As Single\n    Pause_Abzug = Get_Priv_Property(\"prp_Pausenabzug\")\n    Netto_Std_Berech = fctround(Brutto_Std * Pause_Abzug)\n    \nEnd Function\n\n\n\nFunction Ueberlaufstd_Berech_Neu(aktJahr As Long, AktMonat As Long, Optional MA_ID As Long = 0)\n\nDim strSQL As String\nDim strSQL2 As String\n\nDim iAktMon As Long\nDim iAktJahr As Long\nDim iVorMon As Long\nDim iVorJahr As Long\n\nDim ARRSTR\nDim i As Long\n\n\n'Dim ArrFill_DAO_OK1 As Boolean, recsetSQL1 As String, iZLMax1 As Long, iColMax1 As Long, DAOARRAY1, iZl As Long, iCol As Long\n\n'Vormonats-Überlaufwerte Selektieren\n        iAktJahr = aktJahr\n        iAktMon = AktMonat\n        iVorJahr = iAktJahr\n        iVorMon = iAktMon - 1\n        If iVorMon = 0 Then\n            iVorMon = 12\n            iVorJahr = iVorJahr - 1\n        End If\n        \n        strSQL = \"\"\n        strSQL = strSQL & \"SELECT \" & iAktJahr & \" AS AktJahr, \" & iAktMon & \" AS AktMon FROM _tblInternalSystemFE;\"\n        CreateQuery strSQL, \"qry_JB_MA_AktMon\"\n\n        strSQL2 = \";\"\n        If MA_ID > 0 Then strSQL2 = \" WHERE tbl_MA_Mitarbeiterstamm.ID= \" & MA_ID & \";\"\n        strSQL = \"\"\n        strSQL = strSQL & \"SELECT tbl_MA_Mitarbeiterstamm.ID AS MA_ID, qry_JB_MA_AktMon.AktJahr, qry_JB_MA_AktMon.AktMon\"\n        strSQL = strSQL & \" FROM tbl_MA_Mitarbeiterstamm, qry_JB_MA_AktMon\"\n        strSQL = strSQL & strSQL2\n        CreateQuery strSQL, \"qry_JB_MA_AktMon_Alle\"\n\n        strSQL2 = \";\"\n        If MA_ID > 0 Then strSQL2 = \" WHERE tbl_MA_Mitarbeiterstamm.ID= \" & MA_ID & \";\"\n        strSQL = \"\"\n        strSQL = strSQL & \"INSERT INTO tbl_MA_UeberlaufStunden ( MA_ID, AktJahr )\"\n        strSQL = strSQL & \" SELECT tbl_MA_Mitarbeiterstamm.ID, \" & iAktJahr & \" AS Ausdr1 FROM tbl_MA_Mitarbeiterstamm\"\n        strSQL = strSQL & strSQL2\n        CurrentDb.Execute (strSQL)\n        DoEvents\n        \n        If iVorJahr <> iAktJahr Then\n        \n            strSQL2 = \";\"\n            If MA_ID > 0 Then strSQL2 = \" WHERE tbl_MA_Mitarbeiterstamm.ID= \" & MA_ID & \";\"\n            strSQL = \"\"\n            strSQL = strSQL & \"INSERT INTO tbl_MA_UeberlaufStunden ( MA_ID, AktJahr )\"\n            strSQL = strSQL & \" SELECT tbl_MA_Mitarbeiterstamm.ID, \" & iVorJahr & \" AS Ausdr1 FROM tbl_MA_Mitarbeiterstamm\"\n            strSQL = strSQL & strSQL2\n            CurrentDb.Execute (strSQL)\n            DoEvents\n\n        End If\n        \n'Jahresübersicht löschen\n        strSQL2 = \";\"\n        If MA_ID > 0 Then strSQL2 = \" AND MA_ID = \" & MA_ID & \";\"\n        strSQL = \"\"\n        strSQL = strSQL & \"DELETE * FROM tbl_MA_Jahresuebersicht\"\n        strSQL = strSQL & \" WHERE (((tbl_MA_Jahresuebersicht.AktJahr)= \" & iAktJahr & \") AND ((tbl_MA_Jahresuebersicht.AktMon)= \" & iAktMon & \"))\"\n        strSQL = strSQL & strSQL2\n        CurrentDb.Execute (strSQL)\n        DoEvents\n        \n 'Jahreswerte Grund neu Einfügen\n        strSQL2 = \";\"\n        If MA_ID > 0 Then strSQL2 = \" AND MA_ID = \" & MA_ID & \";\"\n        strSQL = \"\"\n        strSQL = strSQL & \"INSERT INTO tbl_MA_Jahresuebersicht ( MA_ID, AktJahr, AktMon, Brutto_Std2, Ist, Fahrtko, RL_34a, RZ_34a, Abschlag, NichtDa, Kaution, Sonstig,\"\n        strSQL = strSQL & \" SonstFuer, Lohn, LohnVon, IstGes )\"\n        strSQL = strSQL & \" SELECT qry_JB_MA_Sum.MA_ID, qry_JB_MA_Sum.AktJahr, qry_JB_MA_Sum.AktMonat, qry_JB_MA_Sum.MA_Brutto_Std2,\"\n        strSQL = strSQL & \" qry_JB_MA_Sum.MA_Netto_Std2, qry_JB_MA_Sum.Fahrtkost, qry_JB_MA_Sum.RL_34a, qry_JB_MA_Sum.RZ_34a,\"\n        strSQL = strSQL & \" qry_JB_MA_Sum.Abschlag, qry_JB_MA_Sum.NichtDa, qry_JB_MA_Sum.Kaution, qry_JB_MA_Sum.Sonst_Abzuege,\"\n        strSQL = strSQL & \" qry_JB_MA_Sum.Sonst_Abzuege_Grund , qry_JB_MA_Sum.Monatslohn, qry_JB_MA_Sum.Ueberw_von, qry_JB_MA_Sum.MA_Netto_Std2 FROM qry_JB_MA_Sum\"\n        strSQL = strSQL & \" WHERE (((qry_JB_MA_Sum.AktJahr)= \" & iAktJahr & \" ) AND ((qry_JB_MA_Sum.AktMonat)= \" & iAktMon & \"))\"\n        strSQL = strSQL & strSQL2\n        CurrentDb.Execute (strSQL)\n        DoEvents\n        \n'Überlauf Vormonat updaten\n        strSQL2 = \";\"\n        If MA_ID > 0 Then strSQL2 = \" AND tbl_MA_Jahresuebersicht.MA_ID= \" & MA_ID & \";\"\n        strSQL = \"\"\n        strSQL = strSQL & \"UPDATE tbl_MA_Jahresuebersicht SET tbl_MA_Jahresuebersicht.RestAusVormonat = VorMon_Ueberlaufstd_Les([MA_ID],\" & iAktJahr & \", \" & iAktMon & \")\"\n        strSQL = strSQL & \" WHERE (((tbl_MA_Jahresuebersicht.aktJahr) = \" & iAktJahr & \" ) And ((tbl_MA_Jahresuebersicht.Aktmon) = \" & iAktMon & \"))\"\n        strSQL = strSQL & strSQL2\n        CurrentDb.Execute (strSQL)\n        DoEvents\n\nstrSQL2 = \";\"\nIf MA_ID > 0 Then strSQL2 = \" AND MA_ID = \" & MA_ID & \";\"\n\n'Aktuellen Monat Updaten - IstGes = Ist + Überlauf Vormonat\n        strSQL = \"\"\n        strSQL = strSQL & \"UPDATE tbl_MA_Jahresuebersicht SET tbl_MA_Jahresuebersicht.IstGes = fctRound(Nz([RestAusVormonat],0) + Nz([Ist],0))\"\n        strSQL = strSQL & \" WHERE (((tbl_MA_Jahresuebersicht.AktJahr)= \" & iAktJahr & \") AND ((tbl_MA_Jahresuebersicht.AktMon)= \" & iAktMon & \"))\"\n        strSQL = strSQL & strSQL2\n        CurrentDb.Execute (strSQL)\n        DoEvents\n    \n\n'Aktuellen Monat Überlauf ermitteln - IstGes trennen in HabVerr (MaxStd) und UeberlaufAktMonat (ÜberlaufStunden)\n        strSQL = \"\"\n        strSQL = strSQL & \"UPDATE tbl_MA_Jahresuebersicht SET tbl_MA_Jahresuebersicht.UeberlaufAktMonat = Nz(MA_Ueberl_Mon_std([MA_ID],[IstGes]),0),\"\n        strSQL = strSQL & \" tbl_MA_Jahresuebersicht.HabVerr = Nz(fctRound(MA_AktMax_Mon_std([MA_ID], [IstGes])),0)\"\n        strSQL = strSQL & \" WHERE (((tbl_MA_Jahresuebersicht.AktJahr)= \" & iAktJahr & \") AND ((tbl_MA_Jahresuebersicht.AktMon)= \" & iAktMon & \"))\"\n        strSQL = strSQL & strSQL2\n        CurrentDb.Execute (strSQL)\n        DoEvents\n\n'Aktuellen Monat Überlaufstunden in tbl_MA_UeberlaufStunden übertragen\n        strSQL2 = \";\"\n        If MA_ID > 0 Then strSQL2 = \" AND tbl_MA_Jahresuebersicht.MA_ID = \" & MA_ID & \";\"\n        strSQL = \"\"\n        strSQL = strSQL & \"UPDATE tbl_MA_UeberlaufStunden INNER JOIN tbl_MA_Jahresuebersicht ON (tbl_MA_UeberlaufStunden.AktJahr = tbl_MA_Jahresuebersicht.AktJahr)\"\n        strSQL = strSQL & \" AND (tbl_MA_UeberlaufStunden.MA_ID = tbl_MA_Jahresuebersicht.MA_ID)\"\n        strSQL = strSQL & \" SET tbl_MA_UeberlaufStunden.M\" & iAktMon & \" = 1 * Nz([UeberlaufAktMonat],0)\"\n        strSQL = strSQL & \" WHERE (((tbl_MA_Jahresuebersicht.AktJahr)= \" & iAktJahr & \") AND ((tbl_MA_Jahresuebersicht.AktMon)= \" & iAktMon & \"))\"\n        strSQL = strSQL & strSQL2\n        CurrentDb.Execute (strSQL)\n        DoEvents\n\n'Aktuellen Monat InfBrutto\nstrSQL2 = \";\"\nIf MA_ID > 0 Then strSQL2 = \" AND MA_ID = \" & MA_ID & \";\"\n        strSQL = \"\"\n        strSQL = strSQL & \"UPDATE tbl_MA_Jahresuebersicht SET tbl_MA_Jahresuebersicht.InfBrutto = fctRound(Nz([HabVerr],0) * Nz(MA_StdLohn([MA_ID]),0))\"\n        strSQL = strSQL & \" WHERE (((tbl_MA_Jahresuebersicht.AktJahr)= \" & iAktJahr & \") AND ((tbl_MA_Jahresuebersicht.AktMon)= \" & iAktMon & \"))\"\n        strSQL = strSQL & strSQL2\n        CurrentDb.Execute (strSQL)\n        DoEvents\n\n'Aktuellen Monat RV Update\n'        If Date >= DateSerial(iAktJahr, iAktMon - 1, 1) Then\n            strSQL = \"\"\n            strSQL = strSQL & \"UPDATE tbl_MA_Jahresuebersicht SET\"\n            strSQL = strSQL & \" tbl_MA_Jahresuebersicht.RV = Nz(MA_RV_Betrag([MA_ID]),0)\"\n            strSQL = strSQL & \" WHERE (((tbl_MA_Jahresuebersicht.AktJahr)= \" & iAktJahr & \") AND ((tbl_MA_Jahresuebersicht.AktMon)= \" & iAktMon & \"))\"\n            strSQL = strSQL & strSQL2\n            CurrentDb.Execute (strSQL)\n            DoEvents\n'        End If\n\n'Aktuellen Monat Lohnsteuer Update\n        strSQL = \"\"\n        strSQL = strSQL & \"UPDATE tbl_MA_Jahresuebersicht SET tbl_MA_Jahresuebersicht.Lst = fctRound(MA_Proz_Lohnsteuer([MA_ID])*Nz([InfBrutto],0) *-1)\"\n        strSQL = strSQL & \" WHERE (((tbl_MA_Jahresuebersicht.AktJahr)= \" & iAktJahr & \") AND ((tbl_MA_Jahresuebersicht.AktMon)= \" & iAktMon & \"))\"\n        strSQL = strSQL & strSQL2\n        CurrentDb.Execute (strSQL)\n        DoEvents\n\n'Aktuellen Monat InfNetto Update\n        strSQL = \"\"\n        strSQL = strSQL & \"UPDATE tbl_MA_Jahresuebersicht SET tbl_MA_Jahresuebersicht.InfNetto = fctRound(Nz([InfBrutto],0) + Nz([Lst],0))\"\n        strSQL = strSQL & \" WHERE (((tbl_MA_Jahresuebersicht.AktJahr)= \" & iAktJahr & \") AND ((tbl_MA_Jahresuebersicht.AktMon)= \" & iAktMon & \"))\"\n        strSQL = strSQL & strSQL2\n        CurrentDb.Execute (strSQL)\n        DoEvents\n        \n'Aktuellen Monat InfGesamt Update\n        strSQL = \"\"\n        strSQL = strSQL & \"UPDATE tbl_MA_Jahresuebersicht SET\"\n        strSQL = strSQL & \" tbl_MA_Jahresuebersicht.InfGesamt = fctRound(Nz([InfNetto],0) + Nz([RL34a],0) + Nz([Abschlag],0) + Nz([NichtDa],0) + Nz([Kaution],0) + Nz([Sonstig],0) + Nz([RV],0) + Nz([FahrtKo],0))\"\n        strSQL = strSQL & \" WHERE (((tbl_MA_Jahresuebersicht.AktJahr)= \" & iAktJahr & \") AND ((tbl_MA_Jahresuebersicht.AktMon)= \" & iAktMon & \"))\"\n        strSQL = strSQL & strSQL2\n        CurrentDb.Execute (strSQL)\n        DoEvents\n                \n'Aktuellen Monat InfGesamt Update\n        strSQL = \"\"\n        strSQL = strSQL & \"UPDATE tbl_MA_Jahresuebersicht SET\"\n        strSQL = strSQL & \" tbl_MA_Jahresuebersicht.RestGut = fctRound(Nz([InfGesamt],0) + Nz([Lohn],0))\"\n        strSQL = strSQL & \" WHERE (((tbl_MA_Jahresuebersicht.AktJahr)= \" & iAktJahr & \") AND ((tbl_MA_Jahresuebersicht.AktMon)= \" & iAktMon & \"))\"\n        strSQL = strSQL & strSQL2\n        CurrentDb.Execute (strSQL)\n        DoEvents\n                \n\n'HabVerr enthält manchmal zuviele Nachkommastellen, (warum auch immer keine Ahnung) Deshalb werden diese \"weg\"-gerundet.\nCurrentDb.Execute (\"UPDATE tbl_MA_Jahresuebersicht SET tbl_MA_Jahresuebersicht.HabVerr = fctround(tbl_MA_Jahresuebersicht.HabVerr);\")\n\n'Wenn 0 dann NULL  - 0-Werte in den folgenden Feldern löschen ...\nARRSTR = Array(\"Brutto_Std2\", \"Ist\", \"RestAusVormonat\", \"InfBrutto\", \"lst\", \"IstGes\", \"UeberlaufAktMonat\", \"HabVerr\", \"InfNetto\", \"InfGesamt\", \"RestGut\", \"RV\")\nFor i = 0 To UBound(ARRSTR)\n    CurrentDb.Execute (\"UPDATE tbl_MA_Jahresuebersicht SET tbl_MA_Jahresuebersicht.\" & ARRSTR(i) & \" = Null WHERE (((tbl_MA_Jahresuebersicht.\" & ARRSTR(i) & \")=0));\")\nNext i\n\nDoEvents\nDBEngine.Idle dbRefreshCache\nDBEngine.Idle dbFreeLocks\nDoEvents\n\nEnd Function\n\nFunction Tabellen_Loeschen()\n\nDim ArrFill_DAO_OK1 As Boolean, recsetSQL1 As String, iZLMax1 As Long, iColMax1 As Long, DAOARRAY1, iZl As Long, iCol As Long\nDim StrName As String\n\nrecsetSQL1 = \"SELECT tblName FROM Acc_Acc_tblVerknuepfungstabellen WHERE jn = True;\"\nArrFill_DAO_OK1 = ArrFill_DAO_Acc(recsetSQL1, iZLMax1, iColMax1, DAOARRAY1)\n'Info:   'AccessArray(iSpalte,iZeile) <0, 0>\nOn Error Resume Next\nIf ArrFill_DAO_OK1 Then\n    For iZl = 0 To iZLMax1\n\n        StrName = DAOARRAY1(0, iZl)\n        DoCmd.DeleteObject acTable, StrName\n\n    Next iZl\n    Set DAOARRAY1 = Nothing\nEnd If\n\nEnd Function\n\nFunction fKD_Adr_create(kun_ID As Long) As String\n\nDim ArrFill_DAO_OK1 As Boolean, recsetSQL1 As String, iZLMax1 As Long, iColMax1 As Long, DAOARRAY1, iZl As Long, iCol As Long\nDim StrName As String\n\n'tbl_KD_Kundenstamm\n'Field Name\n'==========\n'0 - kun_Id\n'1 - kun_AdressArt\n'2 - kun_Firma\n'3 - kun_Bezeichnung\n'4 - kun_Matchcode\n'5 - kun_Strasse\n'6 - kun_PLZ\n'7 - kun_Ort\n'8 - kun_LKZ\n'9 - kun_BriefKopf\n'10 - kun_ans_manuell\n'11 - kun_Anschreiben\n'12 - kun_land_vorwahl\n'13 - kun_telefon\n'14 - kun_telefax\n'15 - kun_mobil\n'16 - kun_email\n'17 - kun_URL\n'18 - kun_kreditinstitut\n'19 - kun_blz\n'20 - kun_kontonummer\n'21 - kun_iban\n'22 - kun_bic\n'23 - kun_ustidnr\n'24 - kun_memo\n'25 - kun_geloescht\n'26 - Erst_von\n'27 - Erst_am\n'28 - Aend_von\n'29 - Aend_am\n'30 - kun_IDF_PersonID\n'==========\n\nrecsetSQL1 = \"SELECT * From tbl_KD_Kundenstamm WHERE kun_ID = \" & kun_ID\nArrFill_DAO_OK1 = ArrFill_DAO_Acc(recsetSQL1, iZLMax1, iColMax1, DAOARRAY1)\n'Info:   'AccessArray(iSpalte,iZeile) <0, 0>\nOn Error Resume Next\nIf ArrFill_DAO_OK1 Then\n    For iZl = 0 To iZLMax1\n        \n        StrName = \"\"\n        StrName = StrName & DAOARRAY1(2, iZl)\n        StrName = StrName & vbCrLf & DAOARRAY1(3, iZl)\n        StrName = StrName & vbCrLf & DAOARRAY1(5, iZl)\n        StrName = StrName & vbCrLf\n        StrName = StrName & vbCrLf & DAOARRAY1(6, iZl) & \" \" & DAOARRAY1(7, iZl)\n        fKD_Adr_create = StrName\n        \n    Next iZl\n    Set DAOARRAY1 = Nothing\nEnd If\n\nEnd Function\n\n'Bild für Ausweis\nFunction fKopf_Bildname(MA_ID As Long) As String\n\nDim Bildname As String\nDim MA_Bildpfad As String\nDim Me_tblBilddatei As String\n'Pfad ID 7 = Consec MA\n\nMe_tblBilddatei = Nz(TLookup(\"tblBilddatei\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID))\nMA_Bildpfad = Nz(Get_Priv_Property(\"prp_CONSYS_GrundPfad\") & Nz(TLookup(\"Pfad\", \"_tblEigeneFirma_Pfade\", \"ID = 7\")))\n\nOn Error Resume Next\nIf Not File_exist(MA_Bildpfad & Me_tblBilddatei) Then\n    Bildname = \"KeinBild.jpg\"\nElse\n    Bildname = Me_tblBilddatei\nEnd If\n\nfKopf_Bildname = MA_Bildpfad & Bildname\n\nEnd Function\n\n'Signatur für Ausweis\nFunction fSignatur(MA_ID As Long) As String\n\nDim Signaturname As String\nDim MA_Signaturpfad As String\nDim Me_tblSignaturdatei As String\n\nMe_tblSignaturdatei = Nz(TLookup(\"tblSignaturdatei\", \"tbl_MA_Mitarbeiterstamm\", \"ID = \" & MA_ID))\nMA_Signaturpfad = Nz(Get_Priv_Property(\"prp_CONSYS_GrundPfad\") & Nz(TLookup(\"Pfad\", \"_tblEigeneFirma_Pfade\", \"ID = 14\")))\n\nOn Error Resume Next\nIf Not File_exist(MA_Signaturpfad & Me_tblSignaturdatei) Then\n    Signaturname = \"KeinSignatur.jpg\"\nElse\n    Signaturname = Me_tblSignaturdatei\nEnd If\n\nfSignatur = MA_Signaturpfad & Signaturname\n\nEnd Function\n\nFunction fUnterschrift_Bild()\nDim MA_Bildpfad As String\n\n'Pfad ID 6 = Consec intern\nMA_Bildpfad = Nz(Get_Priv_Property(\"prp_CONSYS_GrundPfad\") & Nz(TLookup(\"Pfad\", \"_tblEigeneFirma_Pfade\", \"ID = 6\")))\n\nfUnterschrift_Bild = MA_Bildpfad\n\nEnd Function\n\nPublic Sub DatenbankEinlesen(strDatenbank As String)\nDim db As DAO.Database\nDim dbQuelle As DAO.Database\nDim lngDatenbankID As Long\nSet db = CurrentDb\nDoCmd.Hourglass True\nSet dbQuelle = OpenDatabase(strDatenbank, , True)\ndb.Execute \"DELETE FROM tblDatenbanken WHERE Datenbank = '\" & dbQuelle.Name & \"'\", dbFailOnError\ndb.Execute \"INSERT INTO tblDatenbanken(Datenbank) VALUES('\" & dbQuelle.Name & \"')\", dbFailOnError\nlngDatenbankID = db.OpenRecordset(\"SELECT @@IDENTITY\").fields(0)\nTabellenEinlesen db, dbQuelle, lngDatenbankID\nDoCmd.Hourglass False\nEnd Sub\n\nPublic Sub TabellenEinlesen(db As DAO.Database, dbQuelle As DAO.Database, lngDatenbankID As Long)\n\nDim tdf As DAO.TableDef\nDim intSystemtabelle As Integer\nDim intVersteckteTabelle As Integer\nDim lngTabelleID As Long\nDim bolEinlesen As Boolean\nFor Each tdf In dbQuelle.TableDefs\nbolEinlesen = True\nSysCmd acSysCmdSetStatus, \"Tabelle '\" & tdf.Name & \"'\"\nintSystemtabelle = Not ((tdf.attributes And dbSystemObject) = 0)\nintVersteckteTabelle = Not ((tdf.attributes And dbHiddenObject) = 0)\n'If Me!chkSystemtabellen = False Then\nIf intSystemtabelle = True Then\nbolEinlesen = False\nEnd If\n'End If\n'If Me!chkVersteckteTabellen = False Then\nIf intVersteckteTabelle = True Then\nbolEinlesen = False\nEnd If\n'End If\nIf bolEinlesen = True Then\ndb.Execute \"INSERT INTO tblTabellen(Tabelle, DatenbankID, Systemtabelle, VersteckteTabelle) VALUES('\" _\n& tdf.Name & \"', \" & lngDatenbankID & \", \" & intSystemtabelle & \", \" & intVersteckteTabelle & \")\"\nlngTabelleID = db.OpenRecordset(\"SELECT @@IDENTITY\").fields(0)\nFelderEinlesen db, tdf, lngTabelleID\n'TabelleneigenschaftenEinlesen db, tdf, lngTabelleID\nEnd If\nNext tdf\n'SysCmd acSysCmdClearStat\nEnd Sub\n\nPublic Sub FelderEinlesen(db As DAO.Database, tdf As DAO.TableDef, lngTabelleID As Long)\nDim fld As DAO.field\nDim lngFeldID As Long\nFor Each fld In tdf.fields\nSysCmd acSysCmdSetStatus, \"Tabelle '\" & tdf.Name & \"', Feld '\" & fld.Name & \"'\"\ndb.Execute \"INSERT INTO tblFelder(Feld, TabelleID) VALUES('\" & fld.Name & \"', \" & lngTabelleID & \")\", dbFailOnError\nlngFeldID = db.OpenRecordset(\"SELECT @@IDENTITY\").fields(0)\nFeldeigenschaftenEinlesen db, tdf, fld, lngFeldID\nNext fld\nEnd Sub\n\nPublic Sub FeldeigenschaftenEinlesen(db As DAO.Database, tdf As DAO.TableDef, fld As DAO.field, lngFeldID As Long)\nDim prp As DAO.Property\nDim strEigenschaft As String\nDim strWert As String\nFor Each prp In fld.Properties\nSysCmd acSysCmdSetStatus, \"Tabelle '\" & tdf.Name & \"', Feld '\" & fld.Name & \"', Eigenschaft '\" & prp.Name & \"'\"\nSelect Case prp.Name\nCase \"FieldSize\", \"ForeignName\", \"OriginalValue\", \"ValidateOnSet\", \"Value\", \"VisibleValue\"\nCase Else\nstrEigenschaft = prp.Name\nstrWert = prp.Value\ndb.Execute \"INSERT INTO tblFeldeigenschaften(Feldeigenschaft, Eigenschaftswert, FeldID) VALUES('\" _\n& strEigenschaft & \"', '\" & Replace(strWert, \"'\", \"''\") & \"', \" & lngFeldID & \")\", dbFailOnError\nEnd Select\nNext prp\nEnd Sub\n\n\n'Dateiname aus Pfad extrahieren\nFunction fDateiNameAusPfad(pfad As String) As String\nDim temp\n\n    temp = Split(pfad, \"\\\")\n    fDateiNameAusPfad = temp(UBound(temp))\nEnd Function\n\n\n'Datum für Bericht Einsatzliste aufbereiten\nFunction fVADatum(VADatum As Date, PosNr As Integer) As String\n    \n    If PosNr = 1 Then fVADatum = Format(VADatum, \"DDD. DD.MM.YY\")\n    \nEnd Function\n"}
