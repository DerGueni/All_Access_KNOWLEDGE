{"id":"MOD_mdlWaehrungsumrechnung","name":"mdlWaehrungsumrechnung","kind":"standard","procedures":["Public Function getUmrechnungskursAlle() As Boolean","Private Function ArrFill_DAO_Acc(ByVal recsetSQL As String, ByRef iZLMax As Long, ByRef iColMax As Long, ByRef DAOARRAY) As Boolean","Private Function ObjectExists(strObjectType As String, strObjectName As String) As Boolean","Public Function getUmrechnungskurs(Optional strCurr As String = \"CHF\", Optional VonEuro As Boolean = False) As Currency","Function Wae_Hist()"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n\nPublic Function getUmrechnungskursAlle() As Boolean\n\n' Autor: Günter Gerold (Newsgroup)\n\n' Legalitätscheck - Erlaubte Abfrage ...\n' http://www.ecb.europa.eu/home/html/disclaimer.de.html\n\n' Download History Daten\n' http://www.ecb.europa.eu/stats/exchange/eurofxref/html/index.en.html\n\n    Dim iJahr As Long\n    Dim iMon As Long\n    Dim iday As Long\n    Dim dtDatum As Date\n    Dim strAdresse As String\n    Dim objWeb As Object\n    Dim strXML As String\n    Dim strMarke As String\n    Dim strLand As String\n    Dim intMarkeAnfang As Integer\n    Dim intLaenge As Integer\n    Dim OrgWert As Currency\n    Dim i As Long\n    Dim UmrechnungskursVon As Double\n    Dim UmrechnungskursNach As Double\n    Dim strDatum() As String\n    Dim db As DAO.Database\n    Dim rst As DAO.Recordset\n\n    Dim dDatVgl As Date\n\nDim recsetSQL As String, iZLMax As Long, iColMax As Long, DAOARRAY, isOK As Boolean, iZl As Long\nDim strfld As String\nDim sfld As Single\n\n    'Initialisieren\nOn Error GoTo getUmrechnungskursSF_Error\n    getUmrechnungskursAlle = -1\n\n    If Not ObjectExists(\"Table\", \"_tblUmrechnungskurs\") Then\n    CurrentDb.Execute (\"CREATE TABLE _tblUmrechnungskurs \" & _\n          \"(UmrLand TEXT(12), CreateDate DATETIME, UmrWert  SINGLE, \" & _\n          \"CONSTRAINT PrimKey PRIMARY KEY (UmrLand));\")\n    End If\n    DoEvents\n\n    dDatVgl = Nz(TMax(\"CreateDate\", \"_tblUmrechnungskurs\"), 32000)\n    \n    If dDatVgl = Date Then\n        Exit Function\n    End If\n\n    strAdresse = _\n\"http://www.ecb.europa.eu/stats/eurofxref/eurofxref-daily.xml\"\n    'Web-Zugriff\n    Set objWeb = CreateObject(\"Microsoft.XMLHTTP\")\n    objWeb.Open \"GET\", strAdresse, False\n    objWeb.Send\n    strXML = objWeb.responseText\n\n    CurrentDb.Execute (\"DELETE * FROM _tblUmrechnungskurs;\")\n    Set db = CurrentDb\n    Set rst = db.OpenRecordset(\"SELECT * FROM _tblUmrechnungskurs;\")\n\n' <Cube time=\"2008-02-28\">\n    strMarke = \"Cube time='\"\n    strDatum = Split(Mid(strXML, _\n      InStr(strXML, strMarke) + 11, 10), \"-\")\n    dtDatum = DateSerial(strDatum(0), strDatum(1), strDatum(2))\n\n    i = 1\n    Do\n        strMarke = \"Cube currency='\"\n        intMarkeAnfang = InStr(i, strXML, strMarke)\n        If intMarkeAnfang = 0 Then Exit Do\n        strLand = Mid(strXML, intMarkeAnfang + Len(strMarke), 3)\n        intLaenge = InStr(intMarkeAnfang, strXML, \"'/>\") _\n          - intMarkeAnfang - Len(strMarke) - 11\n        OrgWert = CCur(Replace(Mid(strXML, _\n          intMarkeAnfang + Len(strMarke) + 11, intLaenge), \".\", \",\"))\n        i = intMarkeAnfang + 1\n        With rst\n            .AddNew\n                rst.fields(\"UmrLand\").Value = strLand\n                rst.fields(\"CreateDate\").Value = dtDatum\n                rst.fields(\"UmrWert\").Value = OrgWert\n            .update\n        End With\n    Loop\n\n    rst.Close\n    Set rst = Nothing\n        \n    If ObjectExists(\"Table\", \"_tblUmrechnungskurs_Hist\") Then\n        ''Info:   'AccessArray(iSpalte,iZeile) <0, 0>       'ExcelArray(iZeile, iSpalte) <1, 1>\n        'Function ArrFill_DAO(ByVal recsetSQL As String, ByRef iZLMax As Long, ByRef iColMax As Long, ByRef DAOARRAY) As Boolean\n        CurrentDb.Execute (\"DELETE * FROM _tblUmrechnungskurs_Hist WHERE Date = Date();\")\n        isOK = ArrFill_DAO_Acc(\"_tblUmrechnungskurs\", iZLMax, iColMax, DAOARRAY)\n        If isOK Then\n            Set rst = db.OpenRecordset(\"SELECT TOP 1 * FROM _tblUmrechnungskurs_Hist;\")\n            With rst\n                .AddNew\n                .fields(1) = Date\n                For iZl = 0 To iZLMax\n                    strfld = DAOARRAY(0, iZl)\n                    sfld = DAOARRAY(2, iZl)\n                    .fields(strfld).Value = sfld\n                Next iZl\n                .update\n                .Close\n            End With\n            Set DAOARRAY = Nothing\n        End If\n        DoEvents\n        Set rst = Nothing\n    End If\n    \n    Set db = Nothing\n    getUmrechnungskursAlle = True\nAUSGANG:\n      On Error Resume Next\n      Exit Function\n\ngetUmrechnungskursSF_Error:\n getUmrechnungskursAlle = False\n Select Case err.Number\n     Case 0\n          Resume AUSGANG\n     Case Else\n          MsgBox \"fehler\"\n '         Call fncErrorHandler(\"mdlGerold\", \"getUmrechnungskursSF\")\n          Resume AUSGANG\nEnd Select\n\nDoEvents\nDBEngine.Idle dbRefreshCache\nDBEngine.Idle dbFreeLocks\nDoEvents\n\nEnd Function\n\nPrivate Function ArrFill_DAO_Acc(ByVal recsetSQL As String, ByRef iZLMax As Long, ByRef iColMax As Long, ByRef DAOARRAY) As Boolean\n\nDim db As DAO.Database\nDim rst As DAO.Recordset\nDim i As Long\n\n'Dim ArrFill_DAO_OK1 As Boolean, recsetSQL1 As String, iZLMax1 As Long, iColMax1 As Long, DAOARRAY1, iZl as long, iCol as long\n'recsetSQL1 = \"\"\n'ArrFill_DAO_OK1 = ArrFill_DAO_Acc(recsetSQL1,iZLMax1,iColMax1,DAOARRAY1)\n''Info:   'AccessArray(iSpalte,iZeile) <0, 0>\n'If ArrFill_DAO_OK1 Then\n'    For iZl = 0 To iZLMax1\n'\n'\n'\n'    Next iZl\n'    Set DAOARRAY1 = Nothing\n'End If\n\n\nArrFill_DAO_Acc = False\n\n    Set db = CurrentDb\n    Set rst = db.OpenRecordset(recsetSQL)\n    If rst.RecordCount <> 0 Then\n        rst.MoveLast\n        i = rst.RecordCount\n        rst.MoveFirst\n        DAOARRAY = rst.GetRows(i)\n\n    'Achtung Zeile und Spalte 0-basiert\n    'RowArray(iFldNr,iRecNr)\n    'RowArray(iSpalte,iZeile)\n        iZLMax = UBound(DAOARRAY, 2)\n        iColMax = UBound(DAOARRAY, 1)\n        ArrFill_DAO_Acc = True\n    End If\n    rst.Close\n    Set rst = Nothing\n\nEnd Function\n\nPrivate Function ObjectExists(strObjectType As String, strObjectName As String) As Boolean\n' Pass the Object type: Table, Query, Form, Report, Macro, or Module\n' Pass the Object Name\n     Dim db As DAO.Database\n     Dim tbl As DAO.TableDef\n     Dim QRY As DAO.QueryDef\n     Dim i As Integer\n     \n     Set db = CurrentDb()\n     ObjectExists = False\n     \n     If strObjectType = \"Table\" Then\n          For Each tbl In db.TableDefs\n               If tbl.Name = strObjectName Then\n                    ObjectExists = True\n                    Set db = Nothing\n                    Exit Function\n               End If\n          Next tbl\n     ElseIf strObjectType = \"Query\" Then\n          For Each QRY In db.QueryDefs\n               If QRY.Name = strObjectName Then\n                    ObjectExists = True\n                    Set db = Nothing\n                    Exit Function\n               End If\n          Next QRY\n     ElseIf strObjectType = \"Form\" Or strObjectType = \"Report\" Or strObjectType = \"Module\" Then\n          For i = 0 To db.Containers(strObjectType & \"s\").Documents.Count - 1\n               If db.Containers(strObjectType & \"s\").Documents(i).Name = strObjectName Then\n                    ObjectExists = True\n                    Set db = Nothing\n                    Exit Function\n               End If\n          Next i\n     ElseIf strObjectType = \"Macro\" Then\n          For i = 0 To db.Containers(\"Scripts\").Documents.Count - 1\n               If db.Containers(\"Scripts\").Documents(i).Name = strObjectName Then\n                    ObjectExists = True\n                    Set db = Nothing\n                    Exit Function\n               End If\n          Next i\n     Else\n          MsgBox \"Invalid Object Type passed, must be Table, Query, Form, Report, Macro, or Module\"\n     End If\n\nSet db = Nothing\n     \nEnd Function\n\n\n\n\n\nPublic Function getUmrechnungskurs(Optional strCurr As String = \"CHF\", Optional VonEuro As Boolean = False) As Currency\n    \n' Autor: Günter Gerold (Newsgroup)  ' Änderungen: Klaus Oberdalhoff\n\n    Dim strAdresse As String\n    Dim objWeb As Object\n    Dim strXML As String\n    Dim strMarke As String\n    Dim intMarkeAnfang As Integer\n    Dim intLaenge As Integer\n    Dim OrgWert As Currency\n\n' Legalitätscheck - Erlaubte Abfrage ...\n' http://www.ecb.europa.eu/home/html/disclaimer.de.html\n\n'  <Cube currency=\"USD\" rate=\"1.5044\" />    USD US dollar  1.5044\n'  <Cube currency=\"JPY\" rate=\"159.95\" />    JPY Japanese yen  159.95\n'  <Cube currency=\"BGN\" rate=\"1.9558\" />    BGN Bulgarian lev  1.9558\n'  <Cube currency=\"CZK\" rate=\"25.048\" />    CZK Czech koruna  25.048\n'  <Cube currency=\"DKK\" rate=\"7.4546\" />    DKK Danish krone  7.4546\n'  <Cube currency=\"EEK\" rate=\"15.6466\" />   EEK Estonian kroon  15.6466\n'  <Cube currency=\"GBP\" rate=\"0.75760\" />   GBP Pound sterling  0.75760\n'  <Cube currency=\"HUF\" rate=\"257.98\" />    HUF Hungarian forint  257.98\n'  <Cube currency=\"LTL\" rate=\"3.4528\" />    LTL Lithuanian litas  3.4528\n'  <Cube currency=\"LVL\" rate=\"0.6965\" />    LVL Latvian lats  0.6965\n'  <Cube currency=\"PLN\" rate=\"3.5385\" />    PLN Polish zloty  3.5385\n'  <Cube currency=\"RON\" rate=\"3.6498\" />    RON New Romanian leu 1 3.6498\n'  <Cube currency=\"SEK\" rate=\"9.3356\" />    SEK Swedish krona  9.3356\n'  <Cube currency=\"SKK\" rate=\"32.817\" />    SKK Slovak koruna  32.817\n'  <Cube currency=\"CHF\" rate=\"1.6074\" />    CHF Swiss franc  1.6074\n'  <Cube currency=\"ISK\" rate=\"98.65\" />     ISK Icelandic krona  98.65\n'  <Cube currency=\"NOK\" rate=\"7.8540\" />    NOK Norwegian krone  7.8540\n'  <Cube currency=\"HRK\" rate=\"7.2770\" />    HRK Croatian kuna  7.2770\n'  <Cube currency=\"RUB\" rate=\"36.3680\" />   RUB Russian rouble  36.3680\n'  <Cube currency=\"TRY\" rate=\"1.7793\" />    TRY New Turkish lira 2  1.7793\n'  <Cube currency=\"AUD\" rate=\"1.6021\" />    AUD Australian dollar  1.6021\n'  <Cube currency=\"BRL\" rate=\"2.5185\" />    BRL Brasilian real  2.5185\n'  <Cube currency=\"CAD\" rate=\"1.4742\" />    CAD Canadian dollar  1.4742\n'  <Cube currency=\"CNY\" rate=\"10.7444\" />   CNY Chinese yuan renminbi  10.7444\n'  <Cube currency=\"HKD\" rate=\"11.7148\" />   HKD Hong Kong dollar  11.7148\n'  <Cube currency=\"IDR\" rate=\"13619.33\" />  IDR Indonesian rupiah  13619.33\n'  <Cube currency=\"KRW\" rate=\"1415.72\" />   KRW South Korean won  1415.72\n'  <Cube currency=\"MXN\" rate=\"16.1525\" />   MXN Mexican peso  16.1525\n'  <Cube currency=\"MYR\" rate=\"4.8186\" />    MYR Malaysian ringgit  4.8186\n'  <Cube currency=\"NZD\" rate=\"1.8365\" />    NZD New Zealand dollar  1.8365\n'  <Cube currency=\"PHP\" rate=\"60.507\" />    PHP Philippine peso  60.507\n'  <Cube currency=\"SGD\" rate=\"2.1013\" />    SGD Singapore dollar  2.1013\n'  <Cube currency=\"THB\" rate=\"44.900\" />    THB Thai baht  44.900\n'  <Cube currency=\"ZAR\" rate=\"11.2168\" />   ZAR South African rand\n\n    'Initialisieren\nOn Error GoTo getUmrechnungskursSF_Error\n\n    strAdresse = \"http://www.ecb.europa.eu/stats/eurofxref/eurofxref-daily.xml\"\n    strMarke = \"Cube currency='\" & strCurr & \"' rate='\"\n    'Web-Zugriff\n    Set objWeb = CreateObject(\"Microsoft.XMLHTTP\")\n    objWeb.Open \"GET\", strAdresse, False\n    objWeb.Send\n    strXML = objWeb.responseText\n    intMarkeAnfang = InStr(1, strXML, strMarke)\n    intLaenge = InStr(intMarkeAnfang, strXML, \"'/>\") - intMarkeAnfang - Len(strMarke)\n    OrgWert = CCur(Replace(Mid(strXML, intMarkeAnfang + Len(strMarke), intLaenge), \".\", \",\"))\n    If VonEuro = False Then\n        getUmrechnungskurs = Format(1 / OrgWert, \"0.0000\")\n    Else\n        getUmrechnungskurs = OrgWert\n    End If\n\nAUSGANG:\n      On Error Resume Next\n      Exit Function\n\ngetUmrechnungskursSF_Error:\n Select Case err.Number\n     Case 0\n          Resume AUSGANG\n     Case Else\n          MsgBox \"fehler\"\n '         Call fncErrorHandler(\"mdlGerold\", \"getUmrechnungskursSF\")\n          Resume AUSGANG\nEnd Select\n\nEnd Function\n\n\nFunction Wae_Hist()\n\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN ZAR Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN USD Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN TRY Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN THB Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN SGD Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN SEK Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN RUB Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN RON Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN PLN Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN PHP Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN NZD Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN NOK Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN MYR Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN MXN Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN LVL Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN LTL Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN KRW Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN JPY Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN INR Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN ILS Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN IDR Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN HUF Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN HRK Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN HKD Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN GBP Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN DKK Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN CZK Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN CNY Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN CHF Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN CAD Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN BRL Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN BGN Single;\")\nCurrentDb.Execute (\"ALTER TABLE _tblUmrechnungskurs_Hist ALTER COLUMN AUD Single;\")\n\nEnd Function\n\n'USD\n'JPY\n'BGN\n'CYP\n'CZK\n'DKK\n'EEK\n'GBP\n'HUF\n'LTL\n'LVL\n'MTL\n'PLN\n'ROL\n'RON\n'SEK\n'CHF\n'SIT\n'SKK\n'HRK\n'ISK\n'NOK\n'RUB\n'AUD\n'TRL\n'TRY\n'BRL\n'CAD\n'CNY\n'HKD\n'IDR\n'INR\n'KRW\n'MXN\n'MYR\n'NZD\n'PHP\n'SGD\n'ILS\n'THB\n'ZAR\n"}
