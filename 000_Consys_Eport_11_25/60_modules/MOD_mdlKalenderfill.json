{"id":"MOD_mdlKalenderfill","name":"mdlKalenderfill","kind":"standard","procedures":["Function Form_Load_Year_Monat(frm As Form, XBund As String, iJahr As Long, IstFerien As Boolean)","Function Ferien_Set(Werkid As String)","Function Einfachkl()","Public Function Kal_Doppelklick(ibtn As Long)","SubformName = Subform1.Name","Private Function ArrFill_DAO(ByVal recsetSQL As String, ByRef iZLMax As Long, ByRef iColMax As Long, ByRef DAOARRAY) As Boolean"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n\nDim ifc As Long\nDim ibc As Long\nDim iJahr As Long\nDim strCaption As String\nDim Feiername As String\nGlobal Global_mitSumme As Boolean\n\n'Call Form_Load_Year_Monat(MainForm, Me!cboBundesland, Me!iJahr, Me!JN_IstFerien)\n\nFunction Form_Load_Year_Monat(frm As Form, XBund As String, iJahr As Long, IstFerien As Boolean)\nDim iMon As Long, i As Long, j As Long, idaymax As Long, k As Long\nDim SQLStr As String\nDim strFldName As String\nDim Monatarr\n\nDim ArrFill_DAO_OK1 As Boolean, recsetSQL1 As String, iZLMax1 As Long, iColMax1 As Long, DAOARRAY1, DAOARRAY_Name1, iZl As Long, iCol As Long\nDim ArrFill_DAO_OK2 As Boolean, recsetSQL2 As String, iZLMax2 As Long, iColMax2 As Long, DAOARRAY2, DAOARRAY_Name2, iZl2 As Long, iCol2 As Long\nDim ArrFill_DAO_OK3 As Boolean, recsetSQL3 As String, iZLMax3 As Long, iColMax3 As Long, DAOARRAY3, DAOARRAY_Name3, iZl3 As Long, iCol3 As Long\n\nMonatarr = Array(, \"Januar\", \"Februar\", \"März\", \"April\", \"Mai\", \"Juni\", \"Juli\", \"August\", \"September\", \"Oktober\", \"November\", \"Dezember\")\n\nDebug.Print frm.Name\n\nrecsetSQL1 = \"qryHlp_Farben_used\"\nArrFill_DAO_OK1 = ArrFill_DAO(recsetSQL1, iZLMax1, iColMax1, DAOARRAY1)\n''Info:   'AccessArray(iSpalte,iZeile) <0, 0>       'ExcelArray(iZeile, iSpalte) <1, 1>\n\n' zeile 4 = Werktage   3 = Feiertage    2 = Sonntage     1 = Samstage  0 = Ferientage\n' Spalte = 2 = Background   3 = Foreground (Textfarbe)\n\nFor iMon = 1 To 12\n\n    For i = 1 To 6\n        strFldName = \"w1w\" & i\n        frm(\"frm_Kal_\" & iMon).Form!(strFldName).caption = \"\"\n        frm(\"frm_Kal_\" & iMon).Form!(strFldName).Visible = False\n                \n        For j = 1 To 7\n            strFldName = \"btn1Tg\" & i & j\n            frm(\"frm_Kal_\" & iMon).Form!(strFldName).caption = \"\"\n            frm(\"frm_Kal_\" & iMon).Form!(strFldName).Visible = False\n        Next j\n    Next i\n\n    \n    SQLStr = \"\"\n    SQLStr = SQLStr & \"SELECT qryHlp_Kal2_Alle.dtDatum, qryHlp_Kal2_Alle.JahrNr, qryHlp_Kal2_Alle.MonatNr, qryHlp_Kal2_Alle.TagNr,\"\n    SQLStr = SQLStr & \" qryHlp_Kal2_Alle.Wochentag, qryHlp_Kal2_Alle.KW, qryHlp_Kal2_Alle.BtnWk, qryHlp_Kal2_Alle.BtnTg,\"\n    SQLStr = SQLStr & \" qryHlp_Kal2_Alle.B\" & XBund & \", qryHlp_Kal2_Alle.F\" & XBund\n    SQLStr = SQLStr & \" FROM qryHlp_Kal2_Alle\"\n    SQLStr = SQLStr & \" WHERE (((qryHlp_Kal2_Alle.JahrNr)=\" & iJahr & \") AND ((qryHlp_Kal2_Alle.MonatNr)=\" & iMon & \")) Order By qryHlp_Kal2_Alle.dtDatum;\"\n\n    idaymax = DateSerial(iJahr, iMon + 1, 0)\n\n    frm(\"frm_Kal_\" & iMon).Form!iJahr = iJahr\n    frm(\"frm_Kal_\" & iMon).Form!iMon = iMon\n    frm(\"frm_Kal_\" & iMon).Form!sub_Ueberschrift.caption = \"'\" & Monatarr(iMon) & \"'\"\n    \n    \n    ArrFill_DAO_OK2 = ArrFill_DAO(SQLStr, iZLMax2, iColMax2, DAOARRAY2)\n    If ArrFill_DAO_OK2 Then\n        For iZl2 = 0 To iZLMax2\n        \n            'Wochennr\n            strFldName = DAOARRAY2(6, iZl2)\n            frm(\"frm_Kal_\" & iMon).Form!(strFldName).caption = DAOARRAY2(5, iZl2)\n            frm(\"frm_Kal_\" & iMon).Form!(strFldName).Visible = True\n            \n            'Tag setzen\n            strFldName = DAOARRAY2(7, iZl2)\n            frm(\"frm_Kal_\" & iMon).Form!(strFldName).caption = DAOARRAY2(3, iZl2)\n            frm(\"frm_Kal_\" & iMon).Form!(strFldName).Visible = True\n            \n            ' DAOARRAY1 = Farben\n            ' zeile 4 = Werktage   3 = Feiertage    2 = Sonntage     1 = Samstage  0 = Ferientage\n            ' Spalte = 2 = Background   3 = Foreground (Textfarbe)\n                \n            'Werktag\n            frm(\"frm_Kal_\" & iMon).Form!(strFldName).backColor = DAOARRAY1(2, 4)\n            frm(\"frm_Kal_\" & iMon).Form!(strFldName).foreColor = DAOARRAY1(3, 4)\n            \n            'Ferien\n            If IstFerien = True And DAOARRAY2(9, iZl2) = True Then\n                frm(\"frm_Kal_\" & iMon).Form!(strFldName).backColor = DAOARRAY1(2, 0)\n                frm(\"frm_Kal_\" & iMon).Form!(strFldName).foreColor = DAOARRAY1(3, 0)\n            End If\n            \n            'Samstag\n            If DAOARRAY2(4, iZl2) = 6 Then\n                frm(\"frm_Kal_\" & iMon).Form!(strFldName).backColor = DAOARRAY1(2, 1)\n                frm(\"frm_Kal_\" & iMon).Form!(strFldName).foreColor = DAOARRAY1(3, 1)\n            End If\n            'Sonntag\n            If DAOARRAY2(4, iZl2) = 7 Then\n                frm(\"frm_Kal_\" & iMon).Form!(strFldName).backColor = DAOARRAY1(2, 2)\n                frm(\"frm_Kal_\" & iMon).Form!(strFldName).foreColor = DAOARRAY1(3, 2)\n            End If\n            \n            'Feiertag\n            If DAOARRAY2(8, iZl2) = True Then\n                frm(\"frm_Kal_\" & iMon).Form!(strFldName).backColor = DAOARRAY1(2, 3)\n                frm(\"frm_Kal_\" & iMon).Form!(strFldName).foreColor = DAOARRAY1(3, 3)\n            End If\n\n        Next iZl2\n    End If\n\n'    recsetSQL3 = \"SELECT qryHlp_Kal2_Alle.dtDatum, qryHlp_Kal2_Alle.JahrNr, qryHlp_Kal2_Alle.MonatNr, qryHlp_Kal2_Alle.TagNr,\"\n'    recsetSQL3 = recsetSQL3 & \" qryHlp_Kal2_Alle.Wochentag , qryHlp_Kal2_Alle.KW, qryHlp_Kal2_Alle.BtnWk, qryHlp_Kal2_Alle.BtnTg, [_tblFarben].FarbNrHint, [_tblFarben].FarbNrText\"\n'    recsetSQL3 = recsetSQL3 & \" FROM qryHlp_Kal2_Alle INNER JOIN ((tblTerminEinzelTag INNER JOIN tblTerminTyp\"\n'    recsetSQL3 = recsetSQL3 & \" ON tblTerminEinzelTag.TerminTypID = tblTerminTyp.ID) INNER JOIN _tblFarben ON tblTerminTyp.FarbNr = [_tblFarben].FarbID)\"\n'    recsetSQL3 = recsetSQL3 & \" ON qryHlp_Kal2_Alle.dtDatum = tblTerminEinzelTag.TerminDatum\"\n'    recsetSQL3 = recsetSQL3 & \" WHERE (((tblTerminEinzelTag.TerminMonat)= \" & iMon & \") \"\n'    recsetSQL3 = recsetSQL3 & \" AND ((tblTerminEinzelTag.TerminJahr)= \" & iJahr & \" )\"\n'    If istNurEigene = True Then\n'        recsetSQL3 = recsetSQL3 & \" AND ((tblTerminEinzelTag.TerminPerson)=atcnames(1))\"\n'    End If\n'    recsetSQL3 = recsetSQL3 & \" AND ((tblTerminEinzelTag.TerminTypID)= \" & TerminTypID & \"));\"\n'\n'    ArrFill_DAO_OK3 = ArrFill_DAO(recsetSQL3, iZLMax3, iColMax3, DAOARRAY3)\n'\n'    If ArrFill_DAO_OK3 Then\n'        For iZl3 = 0 To iZLMax3\n'\n'            strFldName = DAOARRAY3(7, iZl3)\n'            frm(\"frm_Kal_\" & iMon).Form!(strFldName).BackColor = DAOARRAY3(8, iZl3)\n'            frm(\"frm_Kal_\" & iMon).Form!(strFldName).ForeColor = DAOARRAY3(9, iZl3)\n'\n'        Next iZl3\n'    End If\n\nNext iMon\n\nEnd Function\n\n\nFunction Ferien_Set(Werkid As String)\n\n    Dim BundID As String\n    Dim ArrFill_DAO_OK1 As Boolean, recsetSQL1 As String, iZLMax1 As Long, iColMax1 As Long, DAOARRAY1, DAOARRAY_Name1, iZl As Long, iCol As Long\n    Dim SQLStr As String\n    Dim iJ As Long, i As Long\n    Dim idtvon As Long\n    Dim idtbis As Long\n\nSQLStr = \"\"\nSQLStr = SQLStr & \"UPDATE _tblAlleTage SET [_tblAlleTage].FBW = 0, [_tblAlleTage].FBY = 0, [_tblAlleTage].FBE = 0, [_tblAlleTage].FBB = 0, [_tblAlleTage].FHB = 0,\"\nSQLStr = SQLStr & \" [_tblAlleTage].FHH = 0, [_tblAlleTage].FHE = 0, [_tblAlleTage].FMV = 0, [_tblAlleTage].FNI = 0, [_tblAlleTage].FNW = 0,\"\nSQLStr = SQLStr & \" [_tblAlleTage].FRP = 0, [_tblAlleTage].FSL = 0, [_tblAlleTage].FSN = 0, [_tblAlleTage].FST = 0, [_tblAlleTage].FSH = 0, [_tblAlleTage].FTH = 0\"\nSQLStr = SQLStr & \" WHERE ([_tblAlleTage].Werkname ='\" & Werkid & \"');\"\nCurrentDb.Execute (SQLStr)\n\n    'recsetSQL1 = \"SELECT * FROM qry_Ferien_Meta_Kurz WHERE JahrNr = \" & I & \";\"\n    'ArrFill_DAO_OK1 = ArrFill_DAO(recsetSQL1, iZLMax1, iColMax1, DAOARRAY1, DAOARRAY_Name1)\n    ''Info:   'AccessArray(iSpalte,iZeile) <0, 0>       'ExcelArray(iZeile, iSpalte) <1, 1>\n\n    recsetSQL1 = \"SELECT * FROM qry_Ferien_Meta_Kurz;\"\n    ArrFill_DAO_OK1 = ArrFill_DAO(recsetSQL1, iZLMax1, iColMax1, DAOARRAY1)\n    \n    If ArrFill_DAO_OK1 Then\n        For iZl = 0 To iZLMax1\n            BundID = \"F\" & DAOARRAY1(0, iZl)\n            i = year(DAOARRAY1(1, iZl))\n            iJ = year(DAOARRAY1(2, iZl))\n            idtvon = Format(DAOARRAY1(1, iZl), \"y\", 2, 2)\n            idtbis = Format(DAOARRAY1(2, iZl), \"y\", 2, 2)\n            \n            SQLStr = \"\"\n            SQLStr = SQLStr & \"UPDATE _tblAlleTage SET [_tblAlleTage].\" & BundID & \" = True\"\n            SQLStr = SQLStr & \" WHERE ([dtdatum] >= (dateserial(\" & i & \",1,\" & idtvon & \")) AND ([dtdatum] <= dateserial(\" & iJ & \",1,\" & idtbis & \")) AND ([_tblAlleTage].Werkname = '\" & Werkid & \"'));\"\n            \n            CurrentDb.Execute (SQLStr)\n        Next iZl\n    End If\n\n\nEnd Function\n\n\nFunction Einfachkl()\n'MsgBox Application.Screen.ActiveForm.ActiveControl.Form.ActiveControl.Name\nMsgBox Application.Screen.ActiveForm.ActiveControl.Name\nEnd Function\n\n\nPublic Function Kal_Doppelklick(ibtn As Long)\nDim ctlname As String\nDim SubformName As String\nDim MainForm As Form\nDim subForm As Form\nDim Subform1 As control\nDim X As control\nDim Mainformname As String\nDim iJahr As Long\nDim iMonat As Long\nDim iWoche As Long\nDim iWochentag As Long\nDim j As Long\nDim k As Long\nDim st As String\nDim st1 As String\n\n'w1w 1 woche   110 - 160\n's1w 1 Summe   210 - 260\n'btn1Tg wt     11 - 67     w = Woche t = Wochentag\n\nk = 0\nst = ibtn\nst1 = ibtn\nj = Len(st)\nIf j = 3 Then\n    k = Left(st, 1)\n    st1 = Mid(st, 2, 1)\nEnd If\n\nSelect Case k\n    Case 2\n        's1w 1 -    Summe   210 - 260\n        ctlname = \"s1w\" & st1\n    \n    Case 1\n        'w1w 1 -    woche   110 - 160\n        ctlname = \"w1w\" & st1\n    \n    Case 0\n        'btn1Tg wt     11 - 67     w = Woche t = Wochentag\n        ctlname = \"btn1Tg\" & st1\n    Case Else\n    \nEnd Select\n\n'Set x = Application.Screen.ActiveForm.ActiveControl\n'ctlname = x.Name\nSet MainForm = Application.Screen.ActiveForm\nMainformname = MainForm.Name\n\nSet Subform1 = Application.Screen.ActiveForm.ActiveControl\nSubformName = Subform1.Name\n'Application.Screen.ActiveForm.ActiveControl.Form.ActiveControl.SetFocus\n'Set x = Application.Screen.ActiveForm.ActiveControl.Form.ActiveControl\n'ctlname = x.Name\n\nSet X = Application.Screen.ActiveForm.ActiveControl.Form(ctlname)\n\nDim zwwert As String\nDim zwwert2 As String\nDim zw2 As Long\nDim zw3 As Double\n\nzw2 = 0\nzwwert = X.caption\nj = InStr(zwwert, vbNewLine)\nIf j > 0 Then\n    zw2 = Left(zwwert, j - 1)\n    zwwert2 = Mid(zwwert, j + 1)\n    If Len(Trim(Nz(zwwert2))) > 0 Then\n        zw3 = zwwert2\n    End If\nElse\n    If Len(Trim(Nz(zwwert))) > 0 Then\n        zw2 = CLng(Nz(zwwert, 0))\n    Else\n        zw2 = 0\n    End If\nEnd If\n\n''\n' Dim myControl As Control\n' Dim myTarget As Control\n'\n' Set myControl = Screen.ActiveForm.ActiveControl\n'\n'If myControl.ControlType = acSubform Then\n''If TypeName(myControl) = \"SubForm\" Then\n'    Set myTarget = myControl.Form.ActiveControl\n'Else\n'    Set myTarget = myControl\n'End If\n'\n'ctlname = myTarget.Name\n'\n'Debug.Print \"-------\"\n'Debug.Print Mainformname\n'Debug.Print SubformName\n'Debug.Print Application.Screen.ActiveForm.ActiveControl.Form.Name\n'Debug.Print ctlname\n'Debug.Print zw2\n'Debug.Print zw3\n'Debug.Print \"-------\"\n'\n'\n'Stop\nDim xx As String\n\nIf Left(ctlname, 3) = \"btn\" Then\n    xx = \" Tag \" & zw2 & \" Wert \" & zw3\nElse\n    xx = \"\"\nEnd If\n\nMsgBox \"Doppelklick ct: \" & ctlname & \" - Jahr \" & MainForm(SubformName).Form!iJahr & \" - Monat \" & MainForm(SubformName).Form!iMon & xx\n\nEnd Function\n\nPrivate Function ArrFill_DAO(ByVal recsetSQL As String, ByRef iZLMax As Long, ByRef iColMax As Long, ByRef DAOARRAY) As Boolean\n\nDim db As DAO.Database\nDim rst As DAO.Recordset\nDim i As Long\n\n'Dim ArrFill_DAO_OK1 As Boolean, recsetSQL1 As String, iZLMax1 As Long, iColMax1 As Long, DAOARRAY1, iZl as long, iCol as long\n'recsetSQL1 = \"\"\n'ArrFill_DAO_OK1 = ArrFill_DAO_Acc(recsetSQL1,iZLMax1,iColMax1,DAOARRAY1)\n''Info:   'AccessArray(iSpalte,iZeile) <0, 0>\n\nArrFill_DAO = False\n\n    Set db = CurrentDb\n    Set rst = db.OpenRecordset(recsetSQL)\n    If rst.RecordCount <> 0 Then\n        rst.MoveLast\n        i = rst.RecordCount\n        rst.MoveFirst\n        DAOARRAY = rst.GetRows(i)\n\n    'Achtung Zeile und Spalte 0-basiert\n    'RowArray(iFldNr,iRecNr)\n    'RowArray(iSpalte,iZeile)\n        iZLMax = UBound(DAOARRAY, 2)\n        iColMax = UBound(DAOARRAY, 1)\n        ArrFill_DAO = True\n    End If\n    rst.Close\n    Set rst = Nothing\n\nEnd Function"}
