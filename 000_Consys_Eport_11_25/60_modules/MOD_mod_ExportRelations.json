{"id":"MOD_mod_ExportRelations","name":"mod_ExportRelations","kind":"standard","procedures":["Public Sub ExportRelationsToJSON(ByVal exportPath As String)","Private Function GetRelationshipType(attributes As Long) As String"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"'═══════════════════════════════════════════════════════════════════════════════\n' Modul:     mod_ExportRelations\n' Zweck:     Export aller Tabellen-Beziehungen zu JSON\n' Autor:     Access-Forensiker Agent\n' Datum:     2025-10-31\n' Version:   1.0\n'═══════════════════════════════════════════════════════════════════════════════\n\nOption Compare Database\nOption Explicit\n\n'═══════════════════════════════════════════════════════════════════════════════\n' HAUPT-EXPORT-FUNKTION\n'═══════════════════════════════════════════════════════════════════════════════\n\nPublic Sub ExportRelationsToJSON(ByVal exportPath As String)\n    On Error GoTo ErrorHandler\n    \n    Dim db As DAO.Database\n    Dim rel As DAO.Relation\n    Dim fld As DAO.field\n    Dim f As Integer\n    Dim filePath As String\n    Dim firstRelation As Boolean\n    Dim firstField As Boolean\n    Dim relationCount As Integer\n    \n    Set db = CurrentDb()\n    filePath = exportPath & \"\\relations.json\"\n    f = FreeFile\n    \n    Open filePath For Output As #f\n    \n    ' JSON-Array starten\n    Print #f, \"[\"\n    \n    firstRelation = True\n    relationCount = 0\n    \n    ' Alle Beziehungen durchgehen\n    For Each rel In db.Relations\n        ' System-Beziehungen überspringen\n        If Left$(rel.Name, 4) <> \"MSys\" Then\n            \n            ' Komma vor weiteren Einträgen\n            If Not firstRelation Then\n                Print #f, \",\"\n            End If\n            firstRelation = False\n            relationCount = relationCount + 1\n            \n            ' Beziehungs-Objekt öffnen\n            Print #f, \"  {\"\n            Print #f, \"    \"\"name\"\": \"\"\" & mod_ExportConsys.EscapeJSON(rel.Name) & \"\"\",\"\n            Print #f, \"    \"\"table\"\": \"\"\" & mod_ExportConsys.EscapeJSON(rel.Table) & \"\"\",\"\n            Print #f, \"    \"\"foreignTable\"\": \"\"\" & mod_ExportConsys.EscapeJSON(rel.ForeignTable) & \"\"\",\"\n            Print #f, \"    \"\"attributes\"\": \" & rel.attributes & \",\"\n            Print #f, \"    \"\"relationshipType\"\": \"\"\" & GetRelationshipType(rel.attributes) & \"\"\",\"\n            \n            ' Relationship-Attribute auswerten\n            Print #f, \"    \"\"properties\"\": {\"\n            Print #f, \"      \"\"enforceReferentialIntegrity\"\": \" & LCase((rel.attributes And dbRelationUpdateCascade) = dbRelationUpdateCascade Or (rel.attributes And dbRelationDeleteCascade) = dbRelationDeleteCascade) & \",\"\n            Print #f, \"      \"\"cascadeUpdates\"\": \" & LCase((rel.attributes And dbRelationUpdateCascade) = dbRelationUpdateCascade) & \",\"\n            Print #f, \"      \"\"cascadeDeletes\"\": \" & LCase((rel.attributes And dbRelationDeleteCascade) = dbRelationDeleteCascade) & \",\"\n            Print #f, \"      \"\"unique\"\": \" & LCase((rel.attributes And dbRelationUnique) = dbRelationUnique) & \",\"\n            Print #f, \"      \"\"inheritedByReplicaSet\"\": \" & LCase((rel.attributes And dbRelationInherited) = dbRelationInherited)\n            Print #f, \"    },\"\n            \n            ' Felder exportieren (Primär- und Fremdschlüssel)\n            Print #f, \"    \"\"fields\"\": [\"\n            firstField = True\n            For Each fld In rel.fields\n                If Not firstField Then\n                    Print #f, \",\"\n                End If\n                firstField = False\n                \n                Print #f, \"      {\"\n                Print #f, \"        \"\"name\"\": \"\"\" & mod_ExportConsys.EscapeJSON(fld.Name) & \"\"\",\"\n                Print #f, \"        \"\"foreignName\"\": \"\"\" & mod_ExportConsys.EscapeJSON(fld.ForeignName) & \"\"\"\"\n                Print #f, \"      }\"\n            Next fld\n            Print #f, \"    ]\"\n            \n            Print #f, \"  }\"\n        End If\n    Next rel\n    \n    ' JSON-Array schließen\n    Print #f, \"]\"\n    \n    Close #f\n    \n    Debug.Print \"      → \" & relationCount & \" Beziehungen exportiert\"\n    \n    Exit Sub\n\nErrorHandler:\n    Close #f\n    Debug.Print \"      ✗ Fehler: \" & err.description\n    err.Raise err.Number, \"ExportRelationsToJSON\", err.description\nEnd Sub\n\n'═══════════════════════════════════════════════════════════════════════════════\n' HILFSFUNKTIONEN\n'═══════════════════════════════════════════════════════════════════════════════\n\n' Bestimmt den Beziehungstyp\nPrivate Function GetRelationshipType(attributes As Long) As String\n    ' Standardmäßig One-to-Many\n    Dim relType As String\n    relType = \"One-to-Many\"\n    \n    ' Wenn Unique-Attribut gesetzt ist, dann One-to-One\n    If (attributes And dbRelationUnique) = dbRelationUnique Then\n        relType = \"One-to-One\"\n    End If\n    \n    GetRelationshipType = relType\nEnd Function"}
