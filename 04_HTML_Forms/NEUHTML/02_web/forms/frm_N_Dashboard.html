<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live-Dashboard - CONSYS</title>
    <link rel="stylesheet" href="../css/app-layout.css">
    <link rel="stylesheet" href="../theme/consys_theme.css">
    <style>
        :root {
            --db-primary: #2c3e50;
            --db-accent: #3498db;
            --db-success: #27ae60;
            --db-warning: #f39c12;
            --db-danger: #e74c3c;
        }

        body {
            background: #1a1a2e;
        }

        .dashboard-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        .db-sidebar {
            width: 220px;
            min-width: 220px;
            background: linear-gradient(180deg, #2c3e50 0%, #1a252f 100%);
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255,255,255,0.1);
        }

        .db-sidebar-header {
            padding: 20px 16px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .db-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            color: white;
        }

        .db-logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--db-accent) 0%, #2980b9 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .db-logo-text {
            font-size: 18px;
            font-weight: 700;
        }

        .db-nav {
            flex: 1;
            padding: 16px 0;
            overflow-y: auto;
        }

        .db-nav-section {
            padding: 8px 16px;
            color: #7f8c8d;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .db-nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: #bdc3c7;
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
            font-size: 13px;
        }

        .db-nav-item:hover {
            background: rgba(255,255,255,0.05);
            color: white;
        }

        .db-nav-item.active {
            background: linear-gradient(90deg, var(--db-accent) 0%, #2980b9 100%);
            color: white;
        }

        .db-nav-item-icon {
            width: 20px;
            text-align: center;
        }

        .db-nav-badge {
            margin-left: auto;
            background: var(--db-danger);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
        }

        /* Main Content */
        .db-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #16213e;
        }

        /* Header */
        .db-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: rgba(0,0,0,0.2);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .db-header-left h1 {
            color: white;
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .db-header-left p {
            color: #7f8c8d;
            font-size: 12px;
        }

        .db-header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .db-search {
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 8px 14px;
            gap: 10px;
        }

        .db-search input {
            background: transparent;
            border: none;
            color: white;
            font-size: 13px;
            width: 200px;
            outline: none;
        }

        .db-search input::placeholder {
            color: #7f8c8d;
        }

        .db-search-icon {
            color: #7f8c8d;
        }

        .db-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .db-btn-primary {
            background: var(--db-accent);
            color: white;
        }

        .db-btn-primary:hover {
            background: #2980b9;
        }

        .db-user {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .db-user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--db-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        /* Content */
        .db-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        /* Stats Cards */
        .db-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .stat-card:hover {
            background: rgba(255,255,255,0.08);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .stat-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .stat-card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .stat-card-icon.blue { background: rgba(52,152,219,0.2); color: #3498db; }
        .stat-card-icon.green { background: rgba(39,174,96,0.2); color: #27ae60; }
        .stat-card-icon.orange { background: rgba(243,156,18,0.2); color: #f39c12; }
        .stat-card-icon.red { background: rgba(231,76,60,0.2); color: #e74c3c; }
        .stat-card-icon.purple { background: rgba(155,89,182,0.2); color: #9b59b6; }

        .stat-card-change {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 12px;
        }

        .stat-card-change.up {
            background: rgba(39,174,96,0.2);
            color: #27ae60;
        }

        .stat-card-change.down {
            background: rgba(231,76,60,0.2);
            color: #e74c3c;
        }

        .stat-card-value {
            font-size: 32px;
            font-weight: 700;
            color: white;
            margin-bottom: 4px;
        }

        .stat-card-label {
            color: #7f8c8d;
            font-size: 12px;
        }

        /* Charts Row */
        .db-charts {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .db-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        .db-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .db-card-header h3 {
            color: white;
            font-size: 14px;
            font-weight: 600;
        }

        .db-card-actions {
            display: flex;
            gap: 8px;
        }

        .db-card-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: #7f8c8d;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .db-card-btn:hover, .db-card-btn.active {
            background: var(--db-accent);
            color: white;
        }

        .db-card-body {
            padding: 20px;
        }

        /* Simple Chart Visualization */
        .chart-container {
            height: 200px;
            display: flex;
            align-items: flex-end;
            gap: 8px;
            padding: 10px 0;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(180deg, var(--db-accent) 0%, #2980b9 100%);
            border-radius: 4px 4px 0 0;
            transition: all 0.3s;
            position: relative;
            cursor: pointer;
        }

        .chart-bar:hover {
            background: linear-gradient(180deg, #5dade2 0%, #3498db 100%);
        }

        .chart-bar::after {
            content: attr(data-value);
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            color: #7f8c8d;
            font-size: 10px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .chart-bar:hover::after {
            opacity: 1;
        }

        .chart-labels {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .chart-label {
            flex: 1;
            text-align: center;
            color: #7f8c8d;
            font-size: 10px;
        }

        /* Donut Chart */
        .donut-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 24px;
            padding: 20px;
        }

        .donut-chart {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: conic-gradient(
                var(--db-success) 0deg 144deg,
                var(--db-warning) 144deg 216deg,
                var(--db-danger) 216deg 252deg,
                #7f8c8d 252deg 360deg
            );
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .donut-chart::after {
            content: '';
            width: 90px;
            height: 90px;
            background: #16213e;
            border-radius: 50%;
            position: absolute;
        }

        .donut-center {
            position: absolute;
            z-index: 1;
            text-align: center;
        }

        .donut-center-value {
            font-size: 24px;
            font-weight: 700;
            color: white;
        }

        .donut-center-label {
            font-size: 10px;
            color: #7f8c8d;
        }

        .donut-legend {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .donut-legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ecf0f1;
            font-size: 12px;
        }

        .donut-legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* Tables */
        .db-tables {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .db-table {
            width: 100%;
            border-collapse: collapse;
        }

        .db-table th {
            text-align: left;
            padding: 12px 16px;
            color: #7f8c8d;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .db-table td {
            padding: 14px 16px;
            color: #ecf0f1;
            font-size: 13px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .db-table tbody tr {
            transition: background 0.2s;
        }

        .db-table tbody tr:hover {
            background: rgba(255,255,255,0.03);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .status-badge.success { background: rgba(39,174,96,0.2); color: #27ae60; }
        .status-badge.warning { background: rgba(243,156,18,0.2); color: #f39c12; }
        .status-badge.danger { background: rgba(231,76,60,0.2); color: #e74c3c; }
        .status-badge.info { background: rgba(52,152,219,0.2); color: #3498db; }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        /* Live Indicator */
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #27ae60;
            font-size: 11px;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #27ae60;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .db-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            .db-charts {
                grid-template-columns: 1fr;
            }
            .db-tables {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 1000px) {
            .db-sidebar {
                width: 60px;
                min-width: 60px;
            }
            .db-logo-text,
            .db-nav-item span:not(.db-nav-item-icon),
            .db-nav-section,
            .db-nav-badge {
                display: none;
            }
            .db-nav-item {
                justify-content: center;
                padding: 14px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="db-sidebar">
            <div class="db-sidebar-header">
                <div class="db-logo">
                    <div class="db-logo-icon">&#128202;</div>
                    <span class="db-logo-text">CONSYS</span>
                </div>
            </div>
            <nav class="db-nav">
                <div class="db-nav-section">Hauptmenue</div>
                <a href="frm_N_Dashboard.html" class="db-nav-item active">
                    <span class="db-nav-item-icon">&#127968;</span>
                    <span>Dashboard</span>
                </a>
                <a href="frm_N_Dienstplanuebersicht.html" class="db-nav-item">
                    <span class="db-nav-item-icon">&#128197;</span>
                    <span>Dienstplan</span>
                </a>
                <a href="frm_VA_Planungsuebersicht.html" class="db-nav-item">
                    <span class="db-nav-item-icon">&#128200;</span>
                    <span>Planung</span>
                    <span class="db-nav-badge">3</span>
                </a>
                <a href="frm_va_Auftragstamm.html" class="db-nav-item">
                    <span class="db-nav-item-icon">&#128203;</span>
                    <span>Auftraege</span>
                </a>

                <div class="db-nav-section">Stammdaten</div>
                <a href="frm_MA_Mitarbeiterstamm.html" class="db-nav-item">
                    <span class="db-nav-item-icon">&#128100;</span>
                    <span>Mitarbeiter</span>
                </a>
                <a href="frm_KD_Kundenstamm.html" class="db-nav-item">
                    <span class="db-nav-item-icon">&#127970;</span>
                    <span>Kunden</span>
                </a>
                <a href="frm_OB_Objekt.html" class="db-nav-item">
                    <span class="db-nav-item-icon">&#127919;</span>
                    <span>Objekte</span>
                </a>

                <div class="db-nav-section">Personal</div>
                <a href="frm_MA_Abwesenheit.html" class="db-nav-item">
                    <span class="db-nav-item-icon">&#128197;</span>
                    <span>Abwesenheit</span>
                </a>
                <a href="frm_MA_Zeitkonten.html" class="db-nav-item">
                    <span class="db-nav-item-icon">&#9201;</span>
                    <span>Zeitkonten</span>
                </a>
                <a href="frm_N_Lohnabrechnungen.html" class="db-nav-item">
                    <span class="db-nav-item-icon">&#128176;</span>
                    <span>Lohn</span>
                </a>

                <div class="db-nav-section">Extras</div>
                <a href="frm_N_Optimierung.html" class="db-nav-item">
                    <span class="db-nav-item-icon">&#9881;</span>
                    <span>Optimierungen</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="db-main">
            <!-- Header -->
            <header class="db-header">
                <div class="db-header-left">
                    <h1>Live-Dashboard</h1>
                    <p>Willkommen zurueck! Hier ist Ihre aktuelle Uebersicht.</p>
                </div>
                <div class="db-header-right">
                    <div class="live-indicator">
                        <span class="live-dot"></span>
                        Live-Daten
                    </div>
                    <div class="db-search">
                        <span class="db-search-icon">&#128269;</span>
                        <input type="text" placeholder="Suche... (Strg+K)">
                    </div>
                    <button class="db-btn db-btn-primary">+ Neuer Auftrag</button>
                    <div class="db-user">
                        <div class="db-user-avatar">GS</div>
                    </div>
                </div>
            </header>

            <!-- Content -->
            <div class="db-content">
                <!-- Stats Cards -->
                <div class="db-stats">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon blue">&#128197;</div>
                            <span class="stat-card-change up">&#9650; 12%</span>
                        </div>
                        <div class="stat-card-value">24</div>
                        <div class="stat-card-label">Einsaetze heute</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon green">&#128100;</div>
                            <span class="stat-card-change up">&#9650; 3</span>
                        </div>
                        <div class="stat-card-value">156</div>
                        <div class="stat-card-label">Aktive Mitarbeiter</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon orange">&#9888;</div>
                            <span class="stat-card-change down">&#9660; 5</span>
                        </div>
                        <div class="stat-card-value">8</div>
                        <div class="stat-card-label">Offene Anfragen</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-card-icon red">&#128276;</div>
                        </div>
                        <div class="stat-card-value">3</div>
                        <div class="stat-card-label">Unterbesetzte Schichten</div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="db-charts">
                    <div class="db-card">
                        <div class="db-card-header">
                            <h3>Einsaetze diese Woche</h3>
                            <div class="db-card-actions">
                                <button class="db-card-btn active">Woche</button>
                                <button class="db-card-btn">Monat</button>
                            </div>
                        </div>
                        <div class="db-card-body">
                            <div class="chart-container">
                                <div class="chart-bar" style="height: 60%;" data-value="18"></div>
                                <div class="chart-bar" style="height: 80%;" data-value="24"></div>
                                <div class="chart-bar" style="height: 70%;" data-value="21"></div>
                                <div class="chart-bar" style="height: 90%;" data-value="27"></div>
                                <div class="chart-bar" style="height: 85%;" data-value="25"></div>
                                <div class="chart-bar" style="height: 45%;" data-value="14"></div>
                                <div class="chart-bar" style="height: 35%;" data-value="10"></div>
                            </div>
                            <div class="chart-labels">
                                <span class="chart-label">Mo</span>
                                <span class="chart-label">Di</span>
                                <span class="chart-label">Mi</span>
                                <span class="chart-label">Do</span>
                                <span class="chart-label">Fr</span>
                                <span class="chart-label">Sa</span>
                                <span class="chart-label">So</span>
                            </div>
                        </div>
                    </div>
                    <div class="db-card">
                        <div class="db-card-header">
                            <h3>MA-Status</h3>
                        </div>
                        <div class="db-card-body">
                            <div class="donut-container">
                                <div class="donut-chart">
                                    <div class="donut-center">
                                        <div class="donut-center-value">156</div>
                                        <div class="donut-center-label">Gesamt</div>
                                    </div>
                                </div>
                                <div class="donut-legend">
                                    <div class="donut-legend-item">
                                        <span class="donut-legend-color" style="background: var(--db-success);"></span>
                                        <span>Im Einsatz (62)</span>
                                    </div>
                                    <div class="donut-legend-item">
                                        <span class="donut-legend-color" style="background: var(--db-warning);"></span>
                                        <span>Verfuegbar (48)</span>
                                    </div>
                                    <div class="donut-legend-item">
                                        <span class="donut-legend-color" style="background: var(--db-danger);"></span>
                                        <span>Abwesend (18)</span>
                                    </div>
                                    <div class="donut-legend-item">
                                        <span class="donut-legend-color" style="background: #7f8c8d;"></span>
                                        <span>Inaktiv (28)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tables -->
                <div class="db-tables">
                    <div class="db-card">
                        <div class="db-card-header">
                            <h3>Heutige Einsaetze</h3>
                            <button class="db-card-btn">Alle anzeigen &#8594;</button>
                        </div>
                        <div class="db-card-body" style="padding: 0;">
                            <table class="db-table">
                                <thead>
                                    <tr>
                                        <th>Auftrag</th>
                                        <th>Ort</th>
                                        <th>Zeit</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>NERVY Nuernberg</td>
                                        <td>Nuernberg</td>
                                        <td>12:00 - 23:30</td>
                                        <td><span class="status-badge success"><span class="status-dot"></span>Besetzt</span></td>
                                    </tr>
                                    <tr>
                                        <td>HC Erlangen</td>
                                        <td>Erlangen</td>
                                        <td>15:30 - 20:30</td>
                                        <td><span class="status-badge warning"><span class="status-dot"></span>2 MA fehlen</span></td>
                                    </tr>
                                    <tr>
                                        <td>1. FC Nuernberg</td>
                                        <td>Nuernberg</td>
                                        <td>11:15 - 16:00</td>
                                        <td><span class="status-badge success"><span class="status-dot"></span>Besetzt</span></td>
                                    </tr>
                                    <tr>
                                        <td>Studentenverbindung</td>
                                        <td>Nuernberg</td>
                                        <td>22:30 - 05:30</td>
                                        <td><span class="status-badge danger"><span class="status-dot"></span>3 MA fehlen</span></td>
                                    </tr>
                                    <tr>
                                        <td>Doro Nuernberg</td>
                                        <td>Nuernberg</td>
                                        <td>17:30 - 23:30</td>
                                        <td><span class="status-badge info"><span class="status-dot"></span>Geplant</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="db-card">
                        <div class="db-card-header">
                            <h3>Offene Anfragen</h3>
                            <button class="db-card-btn">Alle anzeigen &#8594;</button>
                        </div>
                        <div class="db-card-body" style="padding: 0;">
                            <table class="db-table">
                                <thead>
                                    <tr>
                                        <th>Mitarbeiter</th>
                                        <th>Auftrag</th>
                                        <th>Seit</th>
                                        <th>Aktion</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Glatz Michaela</td>
                                        <td>HC Erlangen</td>
                                        <td>2 Std.</td>
                                        <td><span class="status-badge warning"><span class="status-dot"></span>Ausstehend</span></td>
                                    </tr>
                                    <tr>
                                        <td>Mueller Klaus</td>
                                        <td>NERVY</td>
                                        <td>4 Std.</td>
                                        <td><span class="status-badge warning"><span class="status-dot"></span>Ausstehend</span></td>
                                    </tr>
                                    <tr>
                                        <td>Schmidt Anna</td>
                                        <td>1. FC Nbg</td>
                                        <td>1 Tag</td>
                                        <td><span class="status-badge danger"><span class="status-dot"></span>Dringend</span></td>
                                    </tr>
                                    <tr>
                                        <td>Weber Thomas</td>
                                        <td>Stud.verb.</td>
                                        <td>5 Std.</td>
                                        <td><span class="status-badge warning"><span class="status-dot"></span>Ausstehend</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { Bridge } from '../js/webview2-bridge.js';

        document.addEventListener('DOMContentLoaded', init);

        async function init() {
            await loadDashboardStats();
            setupEventListeners();
        }

        function setupEventListeners() {
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'k') {
                    e.preventDefault();
                    document.querySelector('.db-search input').focus();
                }
            });

            // Auto-refresh
            setInterval(loadDashboardStats, 60000);

            // Search functionality
            document.querySelector('.db-search input').addEventListener('input', function(e) {
                const term = e.target.value.toLowerCase();
                console.log('Searching:', term);
            });
        }

        async function loadDashboardStats() {
            try {
                // Einsaetze heute
                const einsaetzeResult = await Bridge.execute('executeSQL', {
                    sql: `SELECT COUNT(*) AS Anzahl FROM tbl_VA_Start WHERE VADatum = Date()`,
                    fetch: true
                });
                const einsaetze = (einsaetzeResult.rows && einsaetzeResult.rows[0]) ? einsaetzeResult.rows[0].Anzahl : 0;

                // Aktive Mitarbeiter
                const maResult = await Bridge.execute('executeSQL', {
                    sql: `SELECT COUNT(*) AS Anzahl FROM tbl_MA_Mitarbeiterstamm WHERE IstAktiv = -1`,
                    fetch: true
                });
                const aktiveMa = (maResult.rows && maResult.rows[0]) ? maResult.rows[0].Anzahl : 0;

                // Offene Anfragen
                const anfragenResult = await Bridge.execute('executeSQL', {
                    sql: `SELECT COUNT(*) AS Anzahl FROM tbl_MA_VA_Planung WHERE Status = 'Anfrage'`,
                    fetch: true
                });
                const anfragen = (anfragenResult.rows && anfragenResult.rows[0]) ? anfragenResult.rows[0].Anzahl : 0;

                // Unterbesetzte Schichten heute
                const unterbesetztResult = await Bridge.execute('executeSQL', {
                    sql: `SELECT COUNT(*) AS Anzahl FROM tbl_VA_Start WHERE VADatum = Date() AND MA_Anzahl_Ist < MA_Anzahl`,
                    fetch: true
                });
                const unterbesetzt = (unterbesetztResult.rows && unterbesetztResult.rows[0]) ? unterbesetztResult.rows[0].Anzahl : 0;

                // Stats-Cards aktualisieren
                const statCards = document.querySelectorAll('.stat-card');
                if (statCards[0]) statCards[0].querySelector('.stat-card-value').textContent = einsaetze;
                if (statCards[1]) statCards[1].querySelector('.stat-card-value').textContent = aktiveMa;
                if (statCards[2]) statCards[2].querySelector('.stat-card-value').textContent = anfragen;
                if (statCards[3]) statCards[3].querySelector('.stat-card-value').textContent = unterbesetzt;

                console.log('[Dashboard] Stats aktualisiert');
            } catch (e) {
                console.error('[Dashboard] Fehler:', e);
            }
        }
    </script>
</body>
</html>
