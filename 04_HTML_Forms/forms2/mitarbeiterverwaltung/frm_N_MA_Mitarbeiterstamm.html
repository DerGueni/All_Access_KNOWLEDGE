<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mitarbeiterstammblatt</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 12px; background: #d4d0c8; overflow: hidden; }
        
        .app-container { display: flex; height: 100vh; width: 100%; }
        
        /* SIDEBAR */
        .sidebar { width: 130px; min-width: 100px; background: linear-gradient(180deg, #8B0000 0%, #660000 100%); display: flex; flex-direction: column; flex-shrink: 0; }
        .sidebar-logo { padding: 6px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.2); }
        .sidebar-logo-icon { width: 36px; height: 36px; margin: 0 auto; background: linear-gradient(135deg, #1a3a6a 0%, #2a4a8a 100%); border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; border: 2px solid #0a2a5a; }
        .sidebar-title { color: white; font-size: 11px; font-weight: bold; text-align: center; padding: 6px 4px; background: rgba(0,0,0,0.2); }
        .sidebar-menu { flex: 1; padding: 4px; overflow-y: auto; }
        .menu-btn { display: block; width: 100%; padding: 5px 4px; margin: 2px 0; background: linear-gradient(180deg, #5577aa 0%, #4466aa 100%); color: white; border: 1px solid #3355aa; border-radius: 3px; cursor: pointer; font-size: 9px; text-align: center; }
        .menu-btn:hover { background: linear-gradient(180deg, #6688bb 0%, #5577aa 100%); }
        .menu-btn.active { background: linear-gradient(180deg, #3355aa 0%, #224499 100%); }
        .menu-btn.highlight { background: #00cc66; color: black; border-color: #009944; }
        
        .main-area { flex: 1; display: flex; flex-direction: column; min-width: 0; }
        
        /* HEADER */
        .header-row1 { background: linear-gradient(180deg, #5577aa 0%, #4466aa 100%); padding: 4px 8px; display: flex; align-items: center; gap: 6px; border-bottom: 1px solid #3355aa; }
        .header-logo { width: 36px; height: 36px; background: linear-gradient(135deg, #1a3a6a 0%, #2a4a8a 100%); border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; border: 2px solid #0a2a5a; flex-shrink: 0; }
        .header-title { color: white; font-size: 15px; font-weight: bold; margin-right: 8px; }
        .nav-btns { display: flex; gap: 1px; flex-shrink: 0; }
        .nav-btn { width: 24px; height: 24px; background: #f0f0f0; border: 1px solid #888; cursor: pointer; font-size: 11px; display: flex; align-items: center; justify-content: center; }
        .nav-btn:hover { background: #e0e0e0; }
        .header-btn { padding: 4px 10px; font-size: 11px; border: 1px solid #666; background: linear-gradient(180deg, #f4f4f4 0%, #ddd 100%); cursor: pointer; border-radius: 2px; white-space: nowrap; }
        .header-btn:hover { background: linear-gradient(180deg, #fff 0%, #eee 100%); }
        .header-btn.blue { background: linear-gradient(180deg, #5588dd 0%, #4477cc 100%); color: white; border-color: #3366bb; }
        .header-btn.green { background: linear-gradient(180deg, #44bb44 0%, #339933 100%); color: white; border-color: #228822; }
        .header-btn.red { background: linear-gradient(180deg, #dd4444 0%, #cc3333 100%); color: white; border-color: #bb2222; }
        .header-sep { width: 1px; height: 24px; background: rgba(255,255,255,0.3); margin: 0 4px; }
        
        .name-display { display: flex; gap: 20px; align-items: center; flex: 1; justify-content: center; }
        .name-display .nachname { font-size: 20px; color: white; font-weight: bold; }
        .name-display .vorname { font-size: 20px; color: white; }
        .ma-id-box { background: #2a4a8a; color: white; padding: 4px 10px; border-radius: 3px; font-size: 11px; }
        .ma-id-box span { font-weight: bold; }
        
        .content { display: flex; flex: 1; min-height: 0; }
        .form-area { flex: 1; display: flex; flex-direction: column; padding: 6px; min-width: 0; background: #d4d0c8; }
        
        /* TABS */
        .tab-box { flex: 1; display: flex; flex-direction: column; background: white; border: 1px solid #888; min-height: 0; }
        .tab-header { display: flex; background: #c8c4bc; border-bottom: 1px solid #888; }
        .tab-btn { padding: 6px 16px; font-size: 11px; border: none; border-right: 1px solid #888; background: #c0bbb4; cursor: pointer; }
        .tab-btn:hover { background: #d8d4cc; }
        .tab-btn.active { background: white; font-weight: bold; }
        .tab-body { flex: 1; display: none; overflow: auto; background: white; padding: 10px; }
        .tab-body.active { display: block; }
        
        /* FORMULARFELDER */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-col { display: flex; flex-direction: column; gap: 4px; }
        .field-row { display: flex; align-items: center; gap: 6px; margin-bottom: 4px; }
        .lbl { font-size: 11px; min-width: 130px; text-align: right; color: #000; }
        .inp { padding: 3px 5px; border: 1px solid #888; font-size: 11px; background: white; flex: 1; max-width: 250px; }
        .inp:focus { border-color: #4477bb; outline: none; }
        .inp[readonly] { background: #f0f0f0; }
        .sel { padding: 3px 4px; border: 1px solid #888; font-size: 11px; background: white; flex: 1; max-width: 250px; }
        .chk-row { display: flex; align-items: center; gap: 6px; margin-left: 136px; }
        .inp-short { max-width: 80px; }
        .inp-plz { max-width: 60px; }
        .inp-nr { max-width: 50px; }
        
        .section-title { font-weight: bold; font-size: 12px; margin: 12px 0 6px 0; padding-bottom: 3px; border-bottom: 1px solid #888; color: #333; }
        
        /* RECHTE SIDEBAR */
        .right-panel { width: 380px; min-width: 320px; background: #d4d0c8; border-left: 1px solid #888; display: flex; flex-direction: column; padding: 5px; flex-shrink: 0; }
        
        .foto-box { width: 140px; height: 180px; border: 1px solid #888; background: white; margin: 0 auto 10px auto; display: flex; align-items: center; justify-content: center; color: #888; font-size: 10px; }
        .foto-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        .info-box { background: white; border: 1px solid #888; padding: 6px; margin-bottom: 8px; font-size: 10px; }
        .info-row { display: flex; justify-content: space-between; margin: 2px 0; }
        .info-label { color: #333; }
        .info-value { font-weight: bold; }
        
        .filter-bar { display: flex; align-items: center; gap: 4px; margin-bottom: 5px; flex-wrap: wrap; }
        .filter-bar .lbl { min-width: auto; }
        .filter-inp { width: 120px; padding: 2px 4px; border: 1px solid #888; font-size: 10px; }
        .filter-sel { padding: 2px 4px; border: 1px solid #888; font-size: 10px; }
        
        .ma-grid { flex: 1; border: 1px solid #888; background: white; overflow: auto; }
        .ma-tbl { width: 100%; border-collapse: collapse; font-size: 9px; table-layout: fixed; }
        .ma-tbl th { background: #5577aa; color: white; border: 1px solid #4466aa; padding: 4px; position: sticky; top: 0; text-align: left; }
        .ma-tbl td { border: 1px solid #ddd; padding: 3px 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .ma-tbl tr:hover { background: #e0f0ff; cursor: pointer; }
        .ma-tbl tr.sel { background: #3366cc; color: white; }
        .ma-tbl .c-nn { width: 90px; }
        .ma-tbl .c-vn { width: 80px; }
        .ma-tbl .c-ort { width: 70px; }
        
        .footer { background: #c8c4bc; padding: 3px 8px; display: flex; justify-content: space-between; font-size: 9px; color: #333; border-top: 1px solid #888; }
        
        /* RESPONSIVE */
        @media screen and (max-width: 1400px) {
            .sidebar { width: 110px; }
            .right-panel { width: 320px; min-width: 280px; }
            .form-grid { gap: 12px; }
            .lbl { min-width: 110px; font-size: 10px; }
        }
        @media screen and (min-width: 1700px) {
            .right-panel { width: 420px; }
            .foto-box { width: 160px; height: 200px; }
        }
    </style>
    <script src="../../data/mitarbeiter_data.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-logo"><div class="sidebar-logo-icon">◈</div></div>
            <div class="sidebar-title">HAUPTMENÜ</div>
            <div class="sidebar-menu">
                <button class="menu-btn" onclick="openMenu('Dienstplanuebersicht')">Dienstplanübersicht</button>
                <button class="menu-btn" onclick="openMenu('Planungsuebersicht')">Planungsübersicht</button>
                <button class="menu-btn" onclick="openMenu('Auftragsverwaltung')">Auftragsverwaltung</button>
                <button class="menu-btn active">Mitarbeiterverwaltung</button>
                <button class="menu-btn" onclick="openMenu('OffeneMailAnfragen')">Offene Mail Anfragen</button>
                <button class="menu-btn" onclick="openMenu('ExcelZeitkonten')">Excel Zeitkonten</button>
                <button class="menu-btn" onclick="openMenu('Zeitkonten')">Zeitkonten</button>
                <button class="menu-btn" onclick="openMenu('Abwesenheitsplanung')">Abwesenheitsplanung</button>
                <button class="menu-btn" onclick="openMenu('Dienstausweis')">Dienstausweis erstellen</button>
                <button class="menu-btn" onclick="openMenu('Stundenabgleich')">Stundenabgleich</button>
                <button class="menu-btn" onclick="openMenu('Kundenverwaltung')">Kundenverwaltung</button>
                <button class="menu-btn" onclick="openMenu('Verrechnungssaetze')">Verrechnungssätze</button>
                <button class="menu-btn" onclick="openMenu('SubRechnungen')">Sub Rechnungen</button>
                <button class="menu-btn" onclick="openMenu('EMail')">E-Mail</button>
                <button class="menu-btn" onclick="openMenu('Menu2')">Menü 2</button>
                <button class="menu-btn highlight">HTML Ansicht</button>
            </div>
        </div>
        
        <!-- HAUPTBEREICH -->
        <div class="main-area">
            <div class="header-row1">
                <div class="header-logo">◈</div>
                <span class="header-title">Mitarbeiterstammblatt</span>
                <div class="nav-btns">
                    <button class="nav-btn" onclick="navFirst()">⏮</button>
                    <button class="nav-btn" onclick="navPrev()">◀</button>
                    <button class="nav-btn" onclick="navNext()">▶</button>
                    <button class="nav-btn" onclick="navLast()">⏭</button>
                </div>
                <button class="header-btn blue" onclick="showAdressen()">MA Adressen</button>
                <div class="header-sep"></div>
                <div class="name-display">
                    <span class="nachname" id="dispNachname">Mustermann</span>
                    <span class="vorname" id="dispVorname">Max</span>
                </div>
                <div class="ma-id-box">MA - ID: <span id="dispMaId">1</span></div>
                <div class="header-sep"></div>
                <button class="header-btn red" onclick="deleteMA()">Mitarbeiter löschen</button>
                <button class="header-btn" onclick="showZeitkonto()">Zeitkonto</button>
                <button class="header-btn green" onclick="newMA()">Neuer Mitarbeiter</button>
                <button class="header-btn blue" onclick="sendEinsaetze()">Einsätze übertragen</button>
            </div>
            
            <!-- CONTENT -->
            <div class="content">
                <div class="form-area">
                    <div class="tab-box">
                        <div class="tab-header">
                            <button class="tab-btn active" onclick="showTab('stammdaten',this)">Stammdaten</button>
                            <button class="tab-btn" onclick="showTab('einsatz',this)">Einsatzübersicht</button>
                            <button class="tab-btn" onclick="showTab('dienstplan',this)">Dienstplan</button>
                            <button class="tab-btn" onclick="showTab('nichtverfuegbar',this)">Nicht Verfügbar</button>
                            <button class="tab-btn" onclick="showTab('kleidung',this)">Bestand Dienstkleidung</button>
                        </div>
                        
                        <div class="tab-body active" id="tab-stammdaten">
                            <div class="chk-row">
                                <span class="lbl" style="min-width:auto">PersNr</span>
                                <input type="text" id="txtPersNr" class="inp inp-short" readonly>
                                <span class="lbl" style="min-width:auto">LexNr:</span>
                                <input type="text" id="txtLexNr" class="inp inp-short" readonly>
                                <label><input type="checkbox" id="chkAktiv"> Aktiv</label>
                                <label><input type="checkbox" id="chkSubunternehmer"> Subunternehmer</label>
                                <label><input type="checkbox" id="chkLexAktiv"> Lex_Aktiv</label>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-col">
                                    <div class="section-title">Persönliche Daten</div>
                                    <div class="field-row"><span class="lbl">Nachname</span><input type="text" id="txtNachname" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Vorname</span><input type="text" id="txtVorname" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Strasse</span><input type="text" id="txtStrasse" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Nr</span><input type="text" id="txtNr" class="inp inp-nr"></div>
                                    <div class="field-row"><span class="lbl">PLZ</span><input type="text" id="txtPLZ" class="inp inp-plz"><input type="text" id="txtOrt" class="inp" placeholder="Ort"></div>
                                    <div class="field-row"><span class="lbl">Land</span><input type="text" id="txtLand" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Bundesland</span><input type="text" id="txtBundesland" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Tel. Mobil</span><input type="text" id="txtTelMobil" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Tel. Festnetz</span><input type="text" id="txtTelFest" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Email</span><input type="text" id="txtEmail" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Geschlecht</span><select id="selGeschlecht" class="sel"><option value="">--</option><option value="männlich">männlich</option><option value="weiblich">weiblich</option><option value="divers">divers</option></select></div>
                                    <div class="field-row"><span class="lbl">Staatsangehörigkeit</span><input type="text" id="txtStaatsang" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Geb. Datum</span><input type="text" id="txtGebDat" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Geb. Ort</span><input type="text" id="txtGebOrt" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Geb. Name</span><input type="text" id="txtGebName" class="inp"></div>
                                </div>
                                
                                <div class="form-col">
                                    <div class="section-title">Bank & Steuerdaten</div>
                                    <div class="field-row"><span class="lbl">Kontoinhaber</span><input type="text" id="txtKontoinhaber" class="inp"></div>
                                    <div class="field-row"><span class="lbl">BIC</span><input type="text" id="txtBIC" class="inp"></div>
                                    <div class="field-row"><span class="lbl">IBAN</span><input type="text" id="txtIBAN" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Lohngruppe</span><select id="selLohngruppe" class="sel"><option value="">--</option></select></div>
                                    <div class="field-row"><span class="lbl">Bezüge gezahlt als</span><input type="text" id="txtBezuege" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Steuer-ID</span><input type="text" id="txtSteuerNr" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Tätigkeit Bezeichnung</span><select id="selTaetigkeit" class="sel"><option value="">--</option><option value="Sicherheitspersonal">Sicherheitspersonal</option><option value="Ordner">Ordner</option></select></div>
                                    <div class="field-row"><span class="lbl">Krankenkasse</span><input type="text" id="txtKrankenkasse" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Steuerklasse</span><input type="text" id="txtSteuerklasse" class="inp"></div>
                                    <div class="field-row"><span class="lbl">Urlaubsanspruch pro Jahr</span><input type="text" id="txtUrlaub" class="inp inp-short"></div>
                                    <div class="field-row"><span class="lbl">Stundenzahl Monat max.</span><input type="text" id="txtMaxStunden" class="inp inp-short"></div>
                                    
                                    <div class="section-title">Status</div>
                                    <div class="chk-row" style="margin-left:0"><label><input type="checkbox" id="chkRVBefreit"> RV Befreiung beantragt</label></div>
                                    <div class="chk-row" style="margin-left:0"><label><input type="checkbox" id="chkBruttoStd"> Brutto-Std</label></div>
                                    <div class="chk-row" style="margin-left:0"><label><input type="checkbox" id="chkEmailAbrechnung"> Abrechnung per eMail</label></div>
                                    <div class="field-row"><span class="lbl">Lichtbild</span><input type="text" id="txtLichtbild" class="inp" readonly><button class="header-btn" style="margin-left:4px">...</button></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-body" id="tab-einsatz"><div style="padding:20px;">Einsatzübersicht - wird geladen...</div></div>
                        <div class="tab-body" id="tab-dienstplan"><div style="padding:20px;">Dienstplan - wird geladen...</div></div>
                        <div class="tab-body" id="tab-nichtverfuegbar"><div style="padding:20px;">Nicht verfügbare Zeiten - wird geladen...</div></div>
                        <div class="tab-body" id="tab-kleidung"><div style="padding:20px;">Bestand Dienstkleidung - wird geladen...</div></div>
                    </div>
                </div>
                
                <!-- RECHTE SIDEBAR -->
                <div class="right-panel">
                    <div class="foto-box" id="fotoBox">Kein Foto vorhanden</div>
                    
                    <div class="info-box">
                        <div class="info-row"><span class="info-label">Arbeitsstd. pro Arbeitstag</span><span class="info-value" id="infoArbStd">7,67</span></div>
                        <div class="info-row"><span class="info-label">Arbeitstage pro Woche</span><span class="info-value" id="infoArbTage">5,16</span></div>
                    </div>
                    
                    <div style="display:flex;align-items:center;gap:6px;margin-bottom:5px;">
                        <label><input type="checkbox" id="chkNurAktive" checked> Nur Aktive anzeigen</label>
                    </div>
                    
                    <div class="filter-bar">
                        <span class="lbl">Suche:</span>
                        <input type="text" class="filter-inp" id="txtSuche" placeholder="Suchen..." onkeyup="filterMitarbeiter()">
                    </div>
                    <div class="filter-bar">
                        <span class="lbl">Filter:</span>
                        <select class="filter-sel" id="selFilter" onchange="filterMitarbeiter()">
                            <option value="">Alle Aktiven</option>
                            <option value="minijob">Minijobber</option>
                            <option value="fest">Festangestellte</option>
                            <option value="sub">Subunternehmer</option>
                        </select>
                    </div>
                    
                    <div class="ma-grid">
                        <table class="ma-tbl">
                            <thead>
                                <tr>
                                    <th class="c-nn">Nachname</th>
                                    <th class="c-vn">Vorname</th>
                                    <th class="c-ort">Ort</th>
                                </tr>
                            </thead>
                            <tbody id="maBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <span>Erstellt am: <span id="lblErstellt">Mo 01.01.2020</span> von <span id="lblErstVon">System</span></span>
                <span>Geaendert am: <span id="lblGeaendert">Fr 13.12.2025</span> von <span id="lblAendVon">guenther.siegert</span></span>
            </div>
        </div>
    </div>

<script>
// === GLOBALE VARIABLEN ===
let alleMitarbeiter = [], gefiltert = [], currentIdx = -1, currentMA = null;

// === INIT ===
document.addEventListener('DOMContentLoaded', function() {
    loadAllData();
});

function loadAllData() {
    if (typeof MITARBEITER_DATA !== 'undefined') {
        alleMitarbeiter = MITARBEITER_DATA.mitarbeiter || [];
        filterMitarbeiter();
        if (gefiltert.length > 0) selectMA(0);
    }
}

// === FILTER ===
function filterMitarbeiter() {
    const nurAktive = document.getElementById('chkNurAktive').checked;
    const suche = document.getElementById('txtSuche').value.toLowerCase();
    const filter = document.getElementById('selFilter').value;
    
    gefiltert = alleMitarbeiter.filter(m => {
        if (nurAktive && !m.istAktiv) return false;
        if (filter === 'sub' && !m.istSub) return false;
        if (suche) {
            const name = (m.nachname + ' ' + m.vorname + ' ' + m.ort).toLowerCase();
            if (!name.includes(suche)) return false;
        }
        return true;
    });
    
    renderMAListe();
}

function renderMAListe() {
    const tbody = document.getElementById('maBody');
    tbody.innerHTML = '';
    gefiltert.forEach((m, idx) => {
        const tr = document.createElement('tr');
        if (idx === currentIdx) tr.classList.add('sel');
        tr.onclick = () => selectMA(idx);
        tr.innerHTML = '<td class="c-nn">' + escapeHtml(m.nachname) + '</td><td class="c-vn">' + escapeHtml(m.vorname) + '</td><td class="c-ort">' + escapeHtml(m.ort) + '</td>';
        tbody.appendChild(tr);
    });
}

// === AUSWAHL ===
function selectMA(idx) {
    if (idx < 0 || idx >= gefiltert.length) return;
    currentIdx = idx;
    currentMA = gefiltert[idx];
    
    // Header aktualisieren
    document.getElementById('dispNachname').textContent = currentMA.nachname;
    document.getElementById('dispVorname').textContent = currentMA.vorname;
    document.getElementById('dispMaId').textContent = currentMA.id;
    
    // Formular befüllen
    document.getElementById('txtPersNr').value = currentMA.id;
    document.getElementById('txtLexNr').value = currentMA.lexId || '';
    document.getElementById('chkAktiv').checked = currentMA.istAktiv;
    document.getElementById('chkSubunternehmer').checked = currentMA.istSub;
    document.getElementById('chkLexAktiv').checked = currentMA.lexAktiv;
    
    document.getElementById('txtNachname').value = currentMA.nachname;
    document.getElementById('txtVorname').value = currentMA.vorname;
    document.getElementById('txtStrasse').value = currentMA.strasse;
    document.getElementById('txtNr').value = currentMA.nr;
    document.getElementById('txtPLZ').value = currentMA.plz;
    document.getElementById('txtOrt').value = currentMA.ort;
    document.getElementById('txtLand').value = currentMA.land;
    document.getElementById('txtBundesland').value = currentMA.bundesland;
    document.getElementById('txtTelMobil').value = currentMA.telMobil;
    document.getElementById('txtTelFest').value = currentMA.telFest;
    document.getElementById('txtEmail').value = currentMA.email;
    document.getElementById('selGeschlecht').value = currentMA.geschlecht;
    document.getElementById('txtStaatsang').value = currentMA.staatsang;
    document.getElementById('txtGebDat').value = currentMA.gebDat;
    document.getElementById('txtGebOrt').value = currentMA.gebOrt;
    document.getElementById('txtGebName').value = currentMA.gebName;
    
    document.getElementById('txtKontoinhaber').value = currentMA.kontoinhaber;
    document.getElementById('txtBIC').value = currentMA.bic;
    document.getElementById('txtIBAN').value = currentMA.iban;
    document.getElementById('txtBezuege').value = currentMA.bezuegeAls;
    document.getElementById('txtSteuerNr').value = currentMA.steuerNr;
    document.getElementById('txtKrankenkasse').value = currentMA.krankenkasse;
    document.getElementById('txtSteuerklasse').value = currentMA.steuerklasse;
    document.getElementById('txtUrlaub').value = currentMA.urlaubsanspr;
    document.getElementById('txtMaxStunden').value = currentMA.maxStunden;
    
    document.getElementById('chkRVBefreit').checked = currentMA.rvBefreit;
    document.getElementById('chkBruttoStd').checked = currentMA.bruttoStd;
    document.getElementById('chkEmailAbrechnung').checked = currentMA.emailAbrechnung;
    document.getElementById('txtLichtbild').value = currentMA.lichtbild;
    
    document.getElementById('infoArbStd').textContent = currentMA.arbStdTag ? currentMA.arbStdTag.toFixed(2).replace('.', ',') : '-';
    document.getElementById('infoArbTage').textContent = currentMA.arbTageWoche ? currentMA.arbTageWoche.toFixed(2).replace('.', ',') : '-';
    
    // Liste aktualisieren
    document.querySelectorAll('#maBody tr').forEach((tr, i) => tr.classList.toggle('sel', i === idx));
}

// === NAVIGATION ===
function navFirst() { if (gefiltert.length) selectMA(0); }
function navPrev() { if (currentIdx > 0) selectMA(currentIdx - 1); }
function navNext() { if (currentIdx < gefiltert.length - 1) selectMA(currentIdx + 1); }
function navLast() { if (gefiltert.length) selectMA(gefiltert.length - 1); }

// === TABS ===
function showTab(name, btn) {
    document.querySelectorAll('.tab-body').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-' + name).classList.add('active');
    btn.classList.add('active');
}

// === AKTIONEN ===
function showAdressen() { console.log('MA Adressen'); }
function deleteMA() { if (currentMA) confirm('Mitarbeiter "' + currentMA.nachname + ', ' + currentMA.vorname + '" wirklich löschen?'); }
function showZeitkonto() { console.log('Zeitkonto'); }
function newMA() { console.log('Neuer Mitarbeiter'); }
function sendEinsaetze() { console.log('Einsätze übertragen'); }
function openMenu(name) { console.log('Menü: ' + name); }

// === HILFSFUNKTIONEN ===
function escapeHtml(str) { if (!str) return ''; return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); }

// === WEBVIEW2 BRIDGE ===
window.Bridge = {
    loadData: function(json) {
        const data = typeof json === 'string' ? JSON.parse(json) : json;
        if (data.mitarbeiter) {
            alleMitarbeiter = data.mitarbeiter;
            filterMitarbeiter();
        }
    },
    selectMA: function(id) {
        const idx = gefiltert.findIndex(m => m.id == id);
        if (idx >= 0) selectMA(idx);
    }
};
</script>
</body>
</html>
