<!DOCTYPE html>
<html lang="de" data-yd-content-ready="true" style="position: relative;"><head style="position: relative;">
    <meta charset="UTF-8" style="position: relative;">
    <script style="position: relative;">
    // Auto-Load in Shell (Sidebar-Integration)
    (function() {
        const urlParams = new URLSearchParams(window.location.search);
        const isInShell = urlParams.has('shell') || window.SHELL_PARAMS;
        const isInIframe = window.self !== window.top;
        if (!isInShell && !isInIframe) {
            const formName = window.location.pathname.split('/').pop();
            const recordId = urlParams.get('id') || urlParams.get('ma_id') || urlParams.get('kd_id') || urlParams.get('va_id');
            let shellUrl = 'shell.html?form=' + formName;
            if (recordId) shellUrl += '&id=' + recordId;
            for (const [key, value] of urlParams.entries()) {
                if (!['shell', 'id', 'ma_id', 'kd_id', 'va_id', '_t'].includes(key)) {
                    shellUrl += '&' + encodeURIComponent(key) + '=' + encodeURIComponent(value);
                }
            }
            console.log('[Auto-Redirect] Lade mit Sidebar:', shellUrl);
            window.location.replace(shellUrl);
        }
    })();
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" style="position: relative;">
    <title style="position: relative;">Kundenstammblatt</title>
    <link rel="stylesheet" href="css/unified-header.css" style="position: relative;">
    <style style="position: relative;">
        :root {
            --base-font-size: 11px;
            --small-font-size: 10px;
            --header-font-size: 12px;
            --title-font-size: 16px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: var(--base-font-size);
        }

        body {
            background-color: #8080c0;
            overflow: hidden;
            height: 100vh;
        }

        .window-frame {
            background-color: #8080c0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Title Bar - ausgeblendet gemaess Anforderung */
        .title-bar {
            display: none;
        }

        .title-bar-left {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .title-bar-buttons {
            display: flex;
            gap: 2px;
        }

        .title-btn {
            width: 21px;
            height: 21px;
            background: #ece9d8;
            border: 1px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            font-size: 11px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .title-btn.close {
            background: #c75050;
            color: white;
        }

        /* Main Container */
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            min-width: 0;
            min-height: 0; /* KRITISCH: Flex-Kette für sticky header */
        }

        /* Left Menu */
        .left-menu {
            width: 185px;
            background-color: #6060a0;
            padding: 5px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .menu-header {
            background-color: #000080;
            color: white;
            padding: 6px;
            text-align: center;
            font-weight: bold;
            font-size: 11px;
            margin-bottom: 8px;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            flex: 1;
            justify-content: space-between;
        }

        .menu-btn {
            background: linear-gradient(to bottom, #d0d0e0, #a0a0c0);
            padding: 8px 10px;
            text-align: center;
            cursor: pointer;
            font-size: 11px;
            color: #000;
            font-weight: 500;
            position: relative;
            border: none;
            margin: 1px 0;
            overflow: visible;
        }

        /* Obere helle Kante - 4px nach rechts versetzt */
        .menu-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: calc(100% - 4px);
            height: 2px;
            background: #ffffff;
            z-index: 1;
        }

        /* Untere dunkle Kante - 4px nach links versetzt */
        .menu-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: calc(100% - 4px);
            height: 2px;
            background: #404070;
            z-index: 1;
        }

        .menu-btn:hover {
            background: linear-gradient(to bottom, #e0e0f0, #b0b0d0);
        }

        .menu-btn:active {
            background: linear-gradient(to bottom, #b0b0d0, #9090b0);
        }

        .menu-btn:active::before {
            background: #404070;
            left: 4px;
            width: calc(100% - 4px);
        }

        .menu-btn:active::after {
            background: #ffffff;
            right: 4px;
            width: calc(100% - 4px);
        }

        .menu-btn.active {
            background: linear-gradient(to bottom, #a0a0d0, #8080b0);
        }

        .menu-btn.active::before {
            background: #505080;
            left: 4px;
            width: calc(100% - 4px);
        }

        .menu-btn.active::after {
            background: #c0c0d8;
            right: 4px;
            width: calc(100% - 4px);
        }

        /* Content Area */
        .content-area {
            flex: 1;
            background-color: #d3d3d3;
            padding: 3px;
            display: flex;
            flex-direction: column;
            gap: 2px;
            overflow: hidden;
            min-height: 0; /* KRITISCH: Flex-Kette für sticky header */
        }

        /* Header Row */
        .header-row {
            background-color: #d3d3d3;
            border: 1px solid #606090;
            padding: 4px 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            flex-shrink: 0;
            flex-wrap: wrap;
        }

        /* logo-box und title-text - Überschrieben durch unified-header.css */

        .btn {
            background: linear-gradient(to bottom, #d0d0e0, #a0a0c0);
            border: none;
            padding: 4px 12px;
            font-size: 11px;
            cursor: pointer;
            white-space: nowrap;
        }

        .btn:hover {
            background: linear-gradient(to bottom, #e0e0f0, #b0b0d0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-green, .btn.btn-green {
            background: linear-gradient(to bottom, #90c090, #60a060);
            color: white; /* Fix: dunkler Hintergrund braucht weisse Schrift */
        }

        .btn-blue, .btn.btn-blue {
            background: linear-gradient(to bottom, #b8b8d8, #6060a0);
            color: white; /* Fix: dunkler Hintergrund braucht weisse Schrift */
        }

        .btn-red, .btn.btn-red {
            background: linear-gradient(to bottom, #c09090, #a06060);
            color: white; /* Fix: dunkler Hintergrund braucht weisse Schrift */
        }

        /* gpt-box und header-row-wrapper - Überschrieben durch unified-header.css */

        .header-kd-nr {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-left: auto;
        }

        .header-kd-nr input {
            width: 60px;
            height: 18px;
            border: 1px solid #808080;
            text-align: center;
            font-size: 11px;
            background: #e0e0e0;
        }

        /* Customer Info Row */
        .customer-info {
            background-color: #b8b8d8;
            border: 1px solid #606090;
            padding: 6px 12px;
            flex-shrink: 0;
        }

        .customer-name {
            font-size: 14px;
            font-weight: bold;
            color: #000080;
        }

        .customer-address {
            font-size: 11px;
            color: #333;
        }

        /* Work Area */
        .work-area {
            display: flex;
            flex: 1;
            gap: 3px;
            overflow: hidden;
            min-height: 0; /* KRITISCH: Flex-Kette für sticky header */
        }

        /* Left Work Panel */
        .left-work-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
            overflow: hidden;
            min-height: 0; /* KRITISCH: Flex-Kette für sticky header */
        }

        /* Tab Container */
        .tab-container {
            background-color: #b8b8d8;
            border: 1px solid #606090;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0; /* KRITISCH: Flex-Kette für sticky header */
        }

        .tab-header {
            display: flex;
            background: #8080b0;
            border-bottom: 1px solid #606090;
            flex-shrink: 0;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 4px 12px;
            background: #a0a0c0;
            border: 1px solid #808080;
            border-bottom: none;
            cursor: pointer;
            font-size: 11px;
            margin-right: -1px;
            white-space: nowrap;
        }

        .tab-btn.active {
            background: #b8b8d8;
            border-bottom: 1px solid #b8b8d8;
            position: relative;
            top: 1px;
        }

        .tab-content {
            padding: 8px;
            flex: 1;
            overflow: auto;
            background: #b8b8d8;
            min-height: 0; /* KRITISCH: Flex-Kette für sticky header */
        }

        .tab-page {
            display: none;
        }

        .tab-page.active {
            display: block;
        }

        /* Form Layout */
        .form-columns {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .form-column {
            flex: 1;
            min-width: 280px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .form-row {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .form-label {
            min-width: 100px;
            text-align: right;
            font-size: 11px;
        }

        .form-input, .form-select {
            border: 1px solid #808080;
            padding: 1px 3px;
            font-size: 11px;
            background: white;
            height: 18px;
            width: 150px;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #000080;
            box-shadow: 0 0 2px #000080;
        }

        .form-input.readonly {
            background: #e0e0e0;
        }

        .form-input.small { width: 60px; }
        .form-input.medium { width: 150px; }
        .form-input.wide { width: 200px; }  /* Fix: war 150px wie medium */

        .form-textarea {
            border: 1px solid #808080;
            padding: 3px;
            font-size: 11px;
            background: white;
            resize: vertical;
        }

        .checkbox-row {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-left: 105px;
        }

        .checkbox-row input[type="checkbox"] {
            width: 13px;
            height: 13px;
        }

        .checkbox-row label {
            font-size: 11px;
            cursor: pointer;
        }

        .checkbox-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            padding: 5px;
            background: #a0a0c0;
            border: 1px solid #808080;
            margin-bottom: 8px;
        }

        .checkbox-group .checkbox-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Map Container - Kundenstamm */
        .kd-map-container {
            width: 300px;
            height: 280px;
            border: 1px solid #808080;
            background: #f0f0f0;
            cursor: pointer;
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
        }
        .kd-map-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            pointer-events: none; /* Klick geht auf Container */
        }
        .kd-map-container:hover {
            border-color: #0066cc;
        }
        .kd-map-container:hover::after {
            content: 'Klicken um Google Maps zu oeffnen';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,102,204,0.9);
            color: white;
            font-size: 10px;
            padding: 4px;
            text-align: center;
        }
        .kd-map-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 11px;
            text-align: center;
        }
        .map-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
        }
        .map-label {
            font-size: 11px;
            font-weight: bold;
            color: #333;
        }

        /* Right Panel: Customer List */
        .right-panel {
            width: 320px;
            background: #b8b8d8;
            border: 1px solid #606090;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow: hidden;
            min-height: 0; /* KRITISCH: Flex-Kette für sticky header */
        }

        .right-header {
            padding: 5px;
            border-bottom: 1px solid #808080;
            flex-shrink: 0;
        }

        .search-box {
            display: flex;
            gap: 4px;
            align-items: center;
            margin-bottom: 4px;
        }

        .search-box label {
            font-size: 11px;
        }

        .search-box input {
            flex: 1;
            height: 18px;
            border: 1px solid #808080;
            padding: 1px 4px;
            font-size: 11px;
        }

        .filter-box {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .filter-box label {
            font-size: 11px;
        }

        .filter-box input[type="checkbox"] {
            width: 13px;
            height: 13px;
        }

        .list-wrapper {
            flex: 1;
            overflow: auto;
            min-height: 0; /* KRITISCH: Flex-Kette für sticky header */
        }

        .data-grid {
            width: 100%;
            border-collapse: separate; /* KRITISCH: separate statt collapse für sticky */
            border-spacing: 0; /* KRITISCH: Abstand 0 um collapse-Look zu erhalten */
            font-size: 11px;
        }

        .data-grid thead {
            position: sticky;
            top: 0;
            z-index: 11; /* Höher als th für korrektes Stacking */
        }

        .data-grid th {
            background: linear-gradient(to bottom, #e0e0e0, #c0c0c0);
            border: 1px solid #808080;
            padding: 3px 5px;
            text-align: left;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: nowrap;
        }

        .data-grid td {
            border: 1px solid #c0c0c0;
            padding: 2px 4px;
            background: white;
        }

        .data-grid tr:hover td {
            background: #e0e0ff;
        }

        .data-grid tr.selected td {
            background: #000080;
            color: white;
        }

        /* Status Bar */
        .status-bar {
            background: #c0c0c0;
            border-top: 1px solid #808080;
            padding: 2px 5px;
            display: flex;
            gap: 10px;
            font-size: 11px;
            flex-shrink: 0;
        }

        .status-section {
            border: 1px inset #808080;
            padding: 1px 8px;
            background: #e0e0e0;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(128, 128, 192, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #fff;
            border-top-color: #000080;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast */
        .toast-container {
            position: fixed;
            top: 30px;
            right: 10px;
            z-index: 1002;
        }

        .toast {
            background: #333;
            color: white;
            padding: 10px 20px;
            margin-bottom: 5px;
            border-radius: 4px;
            animation: slideIn 0.3s ease;
        }

        .toast.success { background: #2e7d32; }
        .toast.error { background: #c62828; }
        .toast.warning { background: #f57f17; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 16px;
            height: 16px;
        }

        ::-webkit-scrollbar-track {
            background: #c0c0c0;
        }

        ::-webkit-scrollbar-thumb {
            background: #a0a0a0;
            border: 1px solid;
            border-color: #e0e0e0 #606060 #606060 #e0e0e0;
        }

        /* Vollbild-Button oben rechts */
        .fullscreen-btn {
            position: fixed;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background: linear-gradient(to bottom, #d0d0e0, #a0a0c0);
            border: none;
            cursor: pointer;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #000080;
        }

        .fullscreen-btn:hover {
            background: linear-gradient(to bottom, #e0e0f0, #b0b0d0);
        }

        .fullscreen-btn:active {
            background: linear-gradient(to bottom, #b0b0d0, #9090b0);
        }

        /* Pflichtfeld-Markierung */
        .required { color: #cc0000; font-weight: bold; }
        input:required:invalid { border-color: #cc0000; }
        input:required:valid { border-color: #008000; }
        input.invalid { border-color: #cc0000 !important; background-color: #fff8f8 !important; }

    </style>
    <link rel="stylesheet" href="consys-common.css" style="position: relative;">
    <link rel="stylesheet" href="css/fonts_override.css" style="position: relative;">
    <script src="js/performance-init.js" style="position: relative;"></script><script src="chrome-extension://oglffgiaiekgeicdgkdlnlkhliajdlja/injectScript.js" style="position: relative;"></script><script src="chrome-extension://oglffgiaiekgeicdgkdlnlkhliajdlja/injectScript.js" style="position: relative;"></script>
<link rel="stylesheet" href="css/visbug_overrides.css" style="position: relative;">
<style style="position: relative;">
            /* Shell-Modus: Sidebar versteckt */
            body.shell-mode .left-menu {
                display: none !important;
            }
            body.shell-mode .main-container {
                margin-left: 0 !important;
            
            min-width: 0;}
            body.shell-mode .content-area {
                width: 100% !important;
            }
        </style><style id="perf-init-styles" style="position: relative;">
        @keyframes skeleton-shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: 200px 0; }
        }

        .skeleton-loading {
            pointer-events: none;
        }

        .skeleton-row {
            display: flex;
            gap: 8px;
            padding: 6px 4px;
            border-bottom: 1px solid #e0e0e0;
        }

        .skeleton-cell {
            height: 14px;
            background: linear-gradient(90deg, #e8e8e8 25%, #f0f0f0 50%, #e8e8e8 75%);
            background-size: 400px 100%;
            animation: skeleton-shimmer 1.2s ease-in-out infinite;
            border-radius: 3px;
        }

        .skeleton-cell.w-20 { width: 20%; }
        .skeleton-cell.w-30 { width: 30%; }
        .skeleton-cell.w-40 { width: 40%; }
        .skeleton-cell.w-50 { width: 50%; }
        .skeleton-cell.w-60 { width: 60%; }

        .form-loading::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.7);
            z-index: 100;
        }

        .form-loading::after {
            content: 'Laden...';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 10px 20px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 101;
            font-size: 12px;
            color: #666;
        }

        [data-lazy-src]:not(.lazy-loaded) {
            background: #f5f5f5;
            min-height: 50px;
        }

        .fade-in {
            animation: fadeIn 0.2s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style><style style="position: relative;">@keyframes loading {
    0% {
        transform: rotate(0);
    }

    to {
        transform: rotate(360deg);
    }
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar {
    height: 6px;
    width: 6px;
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar-track {
    background: transparent;
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar-thumb {
    background: #dfdfdf;
    border-radius: 4px;
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar-thumb:hover {
    background: #d4d4d4;
}
</style><style style="position: relative;">.translated-content .ytCoreImageHost {
    visibility: visible;
}
</style><style style="position: relative;">body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:rgba(0,0,0,.4)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:hsl(0,0%,33%);font-family:inherit;font-size:1rem}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1))}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2))}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):focus-visible{box-shadow:0 0 0 3px rgba(112,102,224,.5)}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):focus-visible{box-shadow:0 0 0 3px rgba(220,55,65,.5)}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):focus-visible{box-shadow:0 0 0 3px rgba(110,120,129,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-default-outline:focus-visible{box-shadow:0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:rgba(0,0,0,0);color:#ccc;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:none;background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:1em 1.6em .3em;overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid hsl(0,0%,85%);border-radius:.1875em;background:rgba(0,0,0,0);box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:1px solid #b4dbed;outline:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:#fff}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:rgba(0,0,0,0);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:#fff;color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:hsl(0,0%,94%);color:#666;font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}div:where(.swal2-icon).swal2-warning{border-color:rgb(249.95234375,205.965625,167.74765625);color:#f8bb86}div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}div:where(.swal2-icon).swal2-info{border-color:rgb(156.7033492823,224.2822966507,246.2966507177);color:#3fc3ee}div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}div:where(.swal2-icon).swal2-question{border-color:rgb(200.8064516129,217.9677419355,225.1935483871);color:#87adbd}div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:swal2-show .3s}.swal2-hide{animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}.swal2-toast.swal2-show{animation:swal2-toast-show .5s}.swal2-toast.swal2-hide{animation:swal2-toast-hide .1s forwards}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}</style><style style="position: relative;">
            /* Shell-Modus: Sidebar versteckt */
            body.shell-mode .left-menu {
                display: none !important;
            }
            body.shell-mode .main-container {
                margin-left: 0 !important;
            }
            body.shell-mode .content-area {
                width: 100% !important;
            }
        </style><style style="position: relative;">@keyframes loading {
    0% {
        transform: rotate(0);
    }

    to {
        transform: rotate(360deg);
    }
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar {
    height: 6px;
    width: 6px;
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar-track {
    background: transparent;
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar-thumb {
    background: #dfdfdf;
    border-radius: 4px;
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar-thumb:hover {
    background: #d4d4d4;
}
</style><style style="position: relative;">.translated-content .ytCoreImageHost {
    visibility: visible;
}
</style><style style="position: relative;">body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:rgba(0,0,0,.4)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:hsl(0,0%,33%);font-family:inherit;font-size:1rem}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1))}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2))}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):focus-visible{box-shadow:0 0 0 3px rgba(112,102,224,.5)}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):focus-visible{box-shadow:0 0 0 3px rgba(220,55,65,.5)}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):focus-visible{box-shadow:0 0 0 3px rgba(110,120,129,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-default-outline:focus-visible{box-shadow:0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:rgba(0,0,0,0);color:#ccc;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:none;background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:1em 1.6em .3em;overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid hsl(0,0%,85%);border-radius:.1875em;background:rgba(0,0,0,0);box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:1px solid #b4dbed;outline:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:#fff}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:rgba(0,0,0,0);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:#fff;color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:hsl(0,0%,94%);color:#666;font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}div:where(.swal2-icon).swal2-warning{border-color:rgb(249.95234375,205.965625,167.74765625);color:#f8bb86}div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}div:where(.swal2-icon).swal2-info{border-color:rgb(156.7033492823,224.2822966507,246.2966507177);color:#3fc3ee}div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}div:where(.swal2-icon).swal2-question{border-color:rgb(200.8064516129,217.9677419355,225.1935483871);color:#87adbd}div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:swal2-show .3s}.swal2-hide{animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}.swal2-toast.swal2-show{animation:swal2-toast-show .5s}.swal2-toast.swal2-hide{animation:swal2-toast-hide .1s forwards}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}</style></head>
<body data-form="frm_KD_Kundenstamm" class="shell-mode" inmaintabuse="1" style="position: relative;">
    <button class="fullscreen-btn tiny-btn" id="fullscreenBtn" onclick="toggleFullscreen()" title="Vollbild" data-testid="kd-btn-vollbild">⛶</button>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner" style="position: relative;"></div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="window-frame" style="position: relative;">
        <!-- Title Bar -->
        <div class="title-bar" style="position: relative;">
            <div class="title-bar-left" style="position: relative;">
                <span style="position: relative;">🏢</span>
                <span style="position: relative;">Kundenstammblatt</span>
            </div>
            <div class="title-bar-buttons" style="position: relative;">
                <button class="title-btn tiny-btn" onclick="Bridge.sendEvent('minimize')" data-testid="kd-btn-minimieren" style="position: relative;">_</button>
                <button class="title-btn" data-testid="kd-btn-maximieren" style="position: relative;">□</button>
                <button class="title-btn close" onclick="closeForm()" data-testid="kd-btn-schliessen" style="position: relative;">✕</button>
            </div>
        </div>

        <!-- Main Container -->
        <div class="main-container" style="margin-left: 0px; position: relative;">
            <!-- Left Menu -->

            <!-- Content Area -->
            <div class="content-area" style="position: relative;">
                <!-- Header Row - Unified Design -->
                <div class="header-row-wrapper" style="position: relative;">
                    <div class="header-row combined-buttons" style="position: relative;">
                        <!-- Logo-Box links -->
                        <div class="logo-box" style="position: relative;">K</div>

                        <!-- Formulartitel -->
                        <span class="title-text" style="position: relative;">Kundenstammblatt</span>

                        <!-- Aktualisieren-Button direkt nach Titel -->
                        <button class="btn unified-btn" id="btnAktualisieren" onclick="refreshData()" data-testid="kd-btn-aktualisieren" style="margin-left: 15px; position: relative;">Aktualisieren</button>

                        <!-- Formular-spezifische Buttons in Grid -->
                        <div class="buttons-grid" style="position: relative;">
                            <!-- Zeile 1: 6 Buttons -->
                            <button class="btn unified-btn btn-blue" id="btnVerrechnungssaetze" onclick="openVerrechnungssaetze()" data-testid="kd-btn-verrechnungssaetze" style="position: relative;">Verrechnungssätze</button>
                            <button class="btn unified-btn btn-blue" id="btnUmsatzauswertung" onclick="openUmsatzauswertung()" data-testid="kd-btn-umsatzauswertung" style="position: relative;">Umsatzauswertung</button>
                            <button class="btn unified-btn btn-blue" id="btnAuswertung" onclick="openKundenpreiseGueni()" data-testid="kd-btn-auswertung" title="Kundenpreise Auswertung" style="position: relative;">Kundenpreise</button>
                            <button class="btn unified-btn" id="btnOutlook" onclick="openOutlook()" title="E-Mail senden" data-testid="kd-btn-outlook" style="position: relative;">✉ Outlook</button>
                            <button class="btn unified-btn" id="btnWord" onclick="openWord()" title="Brief erstellen" data-testid="kd-btn-word" style="position: relative; display: none;">📄 Word</button>
                            <button class="btn unified-btn btn-green" id="btnNeuKunde" onclick="neuerKunde()" data-testid="kd-btn-neu" style="position: relative;">Neuer Kunde</button>
                            <button class="btn unified-btn btn-red" id="btnLoeschen" onclick="kundeLoeschen()" data-testid="kd-btn-loeschen" style="position: relative;">Kunde löschen</button>

                            <!-- Zeile 2: Navigation + KD-Nr Suche -->
                            <button class="btn unified-btn" onclick="gotoFirstRecord()" title="Erster Datensatz" data-testid="kd-btn-erste" style="position: relative;">|&lt;</button>
                            <button class="btn unified-btn" onclick="gotoPrevRecord()" title="Vorheriger Datensatz" data-testid="kd-btn-vorige" style="position: relative;">&lt;</button>
                            <button class="btn unified-btn" onclick="gotoNextRecord()" title="Nächster Datensatz" data-testid="kd-btn-naechste" style="position: relative;">&gt;</button>
                            <button class="btn unified-btn" onclick="gotoLastRecord()" title="Letzter Datensatz" data-testid="kd-btn-letzte" style="position: relative;">&gt;|</button>
                            <div class="header-kd-nr" style="display: flex; align-items: center; gap: 4px; position: relative;">
                                <span style="position: relative;">KD-Nr:</span>
                                <input type="text" id="cboKDNrSuche" class="input-xs" placeholder="Suche..." onkeydown="if(event.key==='Enter') sucheKundeNr()" data-testid="kd-input-nrsuche" style="width: 60px; height: 22px; position: relative;">
                                <button class="btn unified-btn" onclick="sucheKundeNr()" title="Kunde nach Nr. suchen" data-testid="kd-btn-nrsuche" style="padding: 2px 6px; position: relative;">🔍</button>
                            </div>
                            <button class="btn unified-btn" id="btnSpeichern" onclick="speichern()" data-testid="kd-btn-speichern" style="position: relative;">Speichern</button>
                        </div>

                        <!-- Aktuelle KD-Nr Display rechts -->
                        <div style="margin-left: 15px; display: flex; align-items: center; gap: 4px; position: relative;">
                            <span style="position: relative;">Akt. Nr.:</span>
                            <input type="text" id="kdNr" readonly="" style="width: 60px; height: 20px; background: rgb(224, 224, 224); font-size: var(--base-font-size); position: relative;" data-testid="kd-input-id">
                        </div>
                    </div>

                    <!-- GPT/TEST Box rechts -->
                    <div class="gpt-box" style="position: relative;">
                        GPT | TEST<br style="position: relative;">
                        <span id="lblDatum" style="position: relative;">18.1.2026</span>
                    </div>
                </div>

                <!-- Customer Info -->
                <div class="customer-info" style="position: relative; width: 1539px; height: 44px;">
                    <span class="customer-name" id="displayFirma" style="position: relative; left: 620px; font-size: 13px; font-weight: bold;">1 Agency</span>
                    <span class="customer-address" id="displayAddress" style="position: relative;"></span>
                </div>

                <!-- Work Area -->
                <div class="work-area" style="position: relative;">
                    <!-- Left Work Panel -->
                    <div class="left-work-panel" style="position: relative;">
                        <div class="tab-container" style="width: 1276px; position: relative;">
                            <div class="tab-header" style="flex-wrap: wrap; position: relative;">
                                <!-- Sichtbare Tabs (wie in Access) -->
                                <button class="tab-btn active" data-tab="stammdaten" data-testid="kd-tab-stammdaten" style="background-color: rgb(225, 225, 229);">Stammdaten</button>
                                <button class="tab-btn" data-tab="objekte" data-testid="kd-tab-objekte" style="position: relative; background-color: rgb(225, 225, 229);">Objekte</button>
                                <button class="tab-btn" data-tab="konditionen" data-testid="kd-tab-konditionen" style="position: relative; background-color: rgb(225, 225, 229);">Konditionen</button>
                                <button class="tab-btn" data-tab="zusatzdateien" data-testid="kd-tab-zusatzdateien" style="position: relative; background-color: rgb(225, 225, 229);">Zusatzdateien</button>
                                <button class="tab-btn" data-tab="bemerkungen" data-testid="kd-tab-bemerkungen" style="position: relative; background-color: rgb(225, 225, 229);">Bemerkungen</button>
                                <button class="tab-btn" data-tab="preise" data-testid="kd-tab-preise" style="position: relative; background-color: rgb(225, 225, 229);">Preise</button>
                                <!-- Weitere Tabs -->
                                <button class="tab-btn" data-tab="auftraguebersicht" data-testid="kd-tab-auftragsuebersicht" style="position: relative; background-color: rgb(225, 225, 229);">Auftragsübersicht</button>
                                <button class="tab-btn" data-tab="ansprechpartner" data-testid="kd-tab-ansprechpartner" style="position: relative; background-color: rgb(225, 225, 229);">Ansprechpartner</button>
                                <button class="tab-btn" data-tab="angebote" data-testid="kd-tab-angebote" style="position: relative; background-color: rgb(225, 225, 229);">Angebote</button>
                                <button class="tab-btn" data-tab="statistik" data-testid="kd-tab-statistik" style="position: relative; background-color: rgb(225, 225, 229);">Statistik</button>
                            </div>
                            <div class="tab-content" style="width: 1209px; position: relative;">
                                <!-- Tab 1: Stammdaten -->
                                <div class="tab-page active" id="tab-stammdaten" style="width: 1128px; position: relative;">
                                    <div class="checkbox-group" style="position: relative;">
                                        <div class="checkbox-item" style="position: relative;">
                                            <input type="checkbox" id="kun_IstAktiv" data-field="kun_IstAktiv" checked="" data-testid="kd-checkbox-istaktiv" style="position: relative;">
                                            <label for="kun_IstAktiv" style="position: relative;">Ist aktiv</label>
                                        </div>
                                        <div class="checkbox-item" style="position: relative;">
                                            <input type="checkbox" id="kun_IstSammelRechnung" data-field="kun_IstSammelRechnung" style="position: relative;">
                                            <label for="kun_IstSammelRechnung" style="position: relative;">Sammelrechnung</label>
                                        </div>
                                        <div class="checkbox-item" style="position: relative;">
                                            <input type="checkbox" id="kun_ans_manuell" data-field="kun_ans_manuell" style="position: relative;">
                                            <label for="kun_ans_manuell" style="position: relative;">Anschrift manuell</label>
                                        </div>
                                    </div>

                                    <div class="form-columns" style="left: -25px; width: 1133px; position: relative;">
                                        <!-- Column 1: Adressdaten -->
                                        <div class="form-column" style="left: 0px; top: 0px; position: relative;">
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">Firma: <span class="required" style="position: relative;">*</span></span>
                                                <input type="text" class="form-input wide" id="kun_Firma" data-field="kun_Firma" required="" data-testid="kd-input-firma" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">Bezeichnung:</span>
                                                <input type="text" class="form-input wide" id="kun_bezeichnung" data-field="kun_bezeichnung" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">Kunden-Kurzel:</span>
                                                <input type="text" class="form-input wide" id="kun_Matchcode" data-field="kun_Matchcode" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">Strase:</span>
                                                <input type="text" class="form-input wide" id="kun_Strasse" data-field="kun_Strasse" data-testid="kd-input-strasse" autocomplete="off" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">PLZ:</span>
                                                <input type="text" class="form-input medium" id="kun_PLZ" data-field="kun_PLZ" pattern="[0-9]{5}" title="5-stellige PLZ eingeben" data-testid="kd-input-plz" style="width: 200px; position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">Ort:</span>
                                                <input type="text" class="form-input wide" id="kun_Ort" data-field="kun_Ort" data-testid="kd-input-ort" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">Land:</span>
                                                <select class="form-select input-sm" id="kun_LKZ" data-field="kun_LKZ" style="height: 18px; width: 95px; position: relative;">
                                                    <option value="DE" style="position: relative;">DE</option>
                                                    <option value="AT" style="position: relative;">AT</option>
                                                    <option value="CH" style="position: relative;">CH</option>
                                                </select>
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">Telefon:</span>
                                                <input type="tel" class="form-input wide" id="kun_telefon" data-field="kun_telefon" pattern="[0-9+\-\s/()]+" title="Telefonnummer eingeben" data-testid="kd-input-telefon" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">Mobil:</span>
                                                <input type="tel" class="form-input wide" id="kun_mobil" data-field="kun_mobil" pattern="[0-9+\-\s/()]+" title="Telefonnummer eingeben" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">Telefax:</span>
                                                <input type="tel" class="form-input wide" id="kun_telefax" data-field="kun_telefax" pattern="[0-9+\-\s/()]+" title="Telefaxnummer eingeben" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">E-Mail:</span>
                                                <input type="email" class="form-input wide" id="kun_email" data-field="kun_email" pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" title="Gueltige E-Mail-Adresse eingeben" data-testid="kd-input-email" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">Homepage:</span>
                                                <input type="text" class="form-input wide" id="kun_URL" data-field="kun_URL" style="position: relative;">
                                            </div>
                                            <!-- kun_IDF_PersonID: Haupt-Ansprechpartner Dropdown -->
                                            <div class="form-row" style="margin-top: 10px; border-top: 1px solid rgb(128, 128, 128); padding-top: 8px; top: 0px; position: relative;">
                                                <span class="form-label" style="position: relative;">Haupt-AP:</span>
                                                <select class="form-select input-lg" id="kun_IDF_PersonID" data-field="kun_IDF_PersonID" onchange="onHauptAnsprechpartnerChange()" style="position: relative; width: 195px;">
                                                    <option value="" style="position: relative;">-- Ansprechpartner waehlen --</option>
                                                </select>
                                            </div>
                                            <!-- Ansprechpartner-Kontaktdaten (werden bei Auswahl aktualisiert) -->
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">AP Telefon:</span>
                                                <input type="tel" class="form-input wide" id="adr_telefon" readonly="" style="background: rgb(240, 240, 240); position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">AP Mobil:</span>
                                                <input type="tel" class="form-input wide" id="adr_mobil" readonly="" style="background: rgb(240, 240, 240); position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">AP E-Mail:</span>
                                                <input type="email" class="form-input wide" id="adr_email_haupt" readonly="" style="background: rgb(240, 240, 240); position: relative;">
                                            </div>
                                        </div>

                                        <!-- Column 2: Bankdaten -->
                                        <div class="form-column" style="left: -40px; position: relative;">
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">Kreditinstitut:</span>
                                                <input type="text" class="form-input wide" id="kun_kreditinstitut" data-field="kun_kreditinstitut" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">BLZ:</span>
                                                <input type="text" class="form-input medium" id="kun_blz" data-field="kun_blz" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">Kontonummer:</span>
                                                <input type="text" class="form-input wide" id="kun_kontonummer" data-field="kun_kontonummer" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">IBAN:</span>
                                                <input type="text" class="form-input wide" id="kun_iban" data-field="kun_iban" pattern="[A-Z]{2}[0-9]{2}[A-Z0-9]{4}[0-9]{7}([A-Z0-9]?){0,16}" title="IBAN Format: DE12345678901234567890" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">BIC:</span>
                                                <input type="text" class="form-input wide" id="kun_bic" data-field="kun_bic" pattern="[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?" title="BIC Format: ABCDEFGH oder ABCDEFGHIJK" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">UStIDNr.:</span>
                                                <input type="text" class="form-input wide" id="kun_ustidnr" data-field="kun_ustidnr" style="position: relative;">
                                            </div>
                                            <div class="form-row" style="position: relative;">
                                                <span class="form-label" style="position: relative;">Zahlungsbed.:</span>
                                                <select class="form-select input-md" id="kun_Zahlbed" data-field="kun_Zahlbed" style="position: relative;">
                                                    <option value="6" style="position: relative;">Netto 6 Tage</option>
                                                    <option value="7" style="position: relative;">Netto 7 Tage</option>
                                                    <option value="14" style="position: relative;">Netto 14 Tage</option>
                                                    <option value="30" style="position: relative;">Netto 30 Tage</option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- Column 3: Kartenansicht -->
                                        <div class="map-column" style="position: relative; width: 420px;">
                                            <span class="map-label" style="position: relative;">Standort</span>
                                            <div class="kd-map-container" id="kdMapContainer" onclick="openKdMapsFullscreen()" title="Klicken um Google Maps zu oeffnen" style="width: 465px;">
                                                <div class="kd-map-placeholder" id="kdMapPlaceholder" style="display: flex; width: 308px; position: relative; left: -10px;">
                                                    <span style="position: relative;">Adresse eingeben<br style="position: relative;">fuer Kartenansicht</span>
                                                </div>
                                                <iframe id="kdMapFrame" src="" style="display: none; position: relative;"></iframe>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab 2: Objekte (sub_KD_Objekte) -->
                                <div class="tab-page" id="tab-objekte" style="position: relative;">
                                    <div style="display: flex; gap: 8px; margin-bottom: 8px; position: relative;">
                                        <button class="btn btn-green" onclick="neuesObjekt()" style="position: relative;">+ Neues Objekt</button>
                                        <button class="btn" onclick="loadObjekte()" style="position: relative;">Aktualisieren</button>
                                        <button class="btn" onclick="openObjekt()" style="position: relative;">Objekt öffnen</button>
                                    </div>
                                    <div class="list-wrapper" style="height: 320px; position: relative;">
                                        <div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><table class="data-grid" id="objekteTable" data-testid="kd-table-objekte" style="position: relative;">
                                            <thead>
                                                <tr style="position: relative;">
                                                    <th style="width: 50px;">ID</th>
                                                    <th>Objektname</th>
                                                    <th>Ort</th>
                                                    <th style="width: 60px;">Aktiv</th>
                                                    <th style="width: 80px;">Aufträge</th>
                                                </tr>
                                            </thead>
                                            <tbody id="objekteBody" class="skeleton-loading" style="position: relative;"><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div></tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Tab 3: Konditionen -->
                                <div class="tab-page" id="tab-konditionen" style="position: relative;">
                                    <div class="form-column" style="max-width: 400px; position: relative;">
                                        <div class="form-row" style="position: relative;">
                                            <span class="form-label" style="position: relative;">Rabatt %:</span>
                                            <input type="number" class="form-input small" id="kun_rabatt" data-field="kun_rabatt" step="0.01" style="position: relative;">
                                        </div>
                                        <div class="form-row" style="position: relative;">
                                            <span class="form-label" style="position: relative;">Skonto %:</span>
                                            <input type="number" class="form-input small" id="kun_skonto" data-field="kun_skonto" step="0.01" style="position: relative;">
                                        </div>
                                        <div class="form-row" style="position: relative;">
                                            <span class="form-label" style="position: relative;">Skonto Tage:</span>
                                            <input type="number" class="form-input small" id="kun_skonto_tage" data-field="kun_skonto_tage" style="position: relative;">
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab 3: Auftraguebersicht -->
                                <div class="tab-page" id="tab-auftraguebersicht" style="position: relative;">
                                    <!-- Umsatz-Statistik (aus Access Form_Current / pg_Rch_Kopf) -->
                                    <div style="display: flex; gap: 15px; margin-bottom: 10px; padding: 5px; background: rgb(160, 160, 192); border: 1px solid rgb(128, 128, 128); position: relative;">
                                        <div style="position: relative;"><span style="font-size: 9px; position: relative;">Gesamt:</span><br style="position: relative;"><span id="KD_Ges" style="font-weight: bold; position: relative;">0,00 EUR</span></div>
                                        <div style="position: relative;"><span style="font-size: 9px; position: relative;">Vorjahr:</span><br style="position: relative;"><span id="KD_VJ" style="font-weight: bold; position: relative;">0,00 EUR</span></div>
                                        <div style="position: relative;"><span style="font-size: 9px; position: relative;">Lfd. Jahr:</span><br style="position: relative;"><span id="KD_LJ" style="font-weight: bold; position: relative;">0,00 EUR</span></div>
                                        <div style="position: relative;"><span style="font-size: 9px; position: relative;">Akt. Monat:</span><br style="position: relative;"><span id="KD_LM" style="font-weight: bold; position: relative;">0,00 EUR</span></div>
                                        <!-- Button fuer detaillierte Statistik -->
                                        <button class="btn btn-blue" onclick="switchTab('statistik')" style="margin-left: auto; position: relative;">Detaillierte Statistik</button>
                                    </div>
                                    <div class="form-row" style="margin-bottom: 10px; position: relative;">
                                        <span class="form-label" style="position: relative;">Von:</span>
                                        <input type="date" class="form-input medium" id="datAufträgeVon" style="position: relative;">
                                        <span class="form-label" style="min-width: 30px; position: relative;">bis:</span>
                                        <input type="date" class="form-input medium" id="datAufträgeBis" style="position: relative;">
                                        <button class="btn" onclick="loadAufträge()" style="position: relative;">Filtern</button>
                                        <button class="btn" onclick="activateDatumsfilter()" style="position: relative;">Datum</button>
                                        <!-- PDF-Buttons aus Access (btnAufRchPDF, btnAufRchPosPDF, btnAufEinsPDF) -->
                                        <button class="btn btn-blue" onclick="openRechnungPDF()" style="position: relative;">Rechnung</button>
                                        <button class="btn btn-blue" onclick="openBerechnungslistePDF()" style="position: relative;">Berechnungsliste</button>
                                        <button class="btn btn-blue" onclick="openEinsatzlistePDF()" style="position: relative;">Einsatzliste</button>
                                        <button class="btn btn-green" onclick="openNeuerAuftrag()" style="position: relative;">+ Neuer Auftrag</button>
                                    </div>
                                    <div class="list-wrapper" style="height: 200px; position: relative;">
                                        <div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><table class="data-grid" id="auftraegeTable" data-testid="kd-table-auftraege" style="position: relative;">
                                            <thead>
                                                <tr style="position: relative;">
                                                    <th>Nr</th>
                                                    <th>Bezeichnung</th>
                                                    <th>Datum</th>
                                                    <th>Objekt</th>
                                                    <th>Status</th>
                                                    <th>Betrag</th>
                                                </tr>
                                            </thead>
                                            <tbody id="auftraegeBody" class="skeleton-loading" style="position: relative;"><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div></tbody>
                                        </table>
                                    </div>
                                    <!-- PosGesamtsumme: Summenzeile unter Auftrags-Tabelle -->
                                    <div style="display: flex; justify-content: flex-end; padding: 5px; background: rgb(176, 176, 208); border: 1px solid rgb(128, 128, 128); margin-top: -1px; position: relative;">
                                        <span style="font-weight: bold; position: relative;">Gesamtsumme:</span>
                                        <span id="PosGesamtsumme" style="font-weight: bold; margin-left: 10px; min-width: 100px; text-align: right; position: relative;">0,00 EUR</span>
                                    </div>

                                    <!-- sub_KD_Rch_Auftragspos: Rechnungspositionen des ausgewaehlten Auftrags -->
                                    <div style="margin-top: 10px; border: 1px solid rgb(128, 128, 128); background: rgb(240, 240, 240); padding: 5px; position: relative;">
                                        <div style="font-weight: bold; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; position: relative;">
                                            <span style="position: relative;">Positionen des ausgewaehlten Auftrags: <span id="selectedAuftragNr" style="position: relative;">-</span></span>
                                            <button class="btn" onclick="loadAuftragsPositionen()" style="font-size: 9px; position: relative;">Aktualisieren</button>
                                        </div>
                                        <div class="list-wrapper" style="height: 120px; overflow-y: auto; position: relative;">
                                            <table class="data-grid" id="auftragspositionenTable" style="position: relative;">
                                                <thead>
                                                    <tr style="position: relative;">
                                                        <th style="width: 40px;">Pos</th>
                                                        <th>Bezeichnung</th>
                                                        <th style="width: 60px;">Menge</th>
                                                        <th style="width: 80px;">Einzelpreis</th>
                                                        <th style="width: 80px;">Gesamt</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="auftragspositionenBody" style="position: relative;">
                                                    <tr style="position: relative;"><td colspan="5" style="text-align: center; color: rgb(102, 102, 102); padding: 10px; position: relative;">Auftrag auswaehlen um Positionen zu sehen</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div style="display: flex; justify-content: flex-end; padding: 3px; background: rgb(192, 192, 208); margin-top: 2px; position: relative;">
                                            <span style="font-weight: bold; position: relative;">Positionen-Summe:</span>
                                            <span id="PositionenSumme" style="font-weight: bold; margin-left: 10px; min-width: 80px; text-align: right; position: relative;">0,00 EUR</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab 4: Ansprechpartner -->
                                <div class="tab-page" id="tab-ansprechpartner" style="position: relative;">
                                    <div style="padding: 8px; position: relative;">
                                        <div style="display: flex; gap: 8px; margin-bottom: 8px; flex-wrap: wrap; align-items: center; position: relative;">
                                            <button class="btn btn-green" onclick="neuerAnsprechpartner()" style="position: relative;">+ Neu</button>
                                            <button class="btn btn-red" onclick="loescheAnsprechpartner()" style="position: relative;">Löschen</button>
                                            <button class="btn" onclick="loadAnsprechpartner()" style="position: relative;">Aktualisieren</button>
                                            <!-- btnPersonUebernehmen: Bestehende Person zuordnen (wie in VBA) -->
                                            <span style="border-left: 1px solid rgb(128, 128, 128); padding-left: 8px; display: flex; gap: 4px; align-items: center; position: relative;">
                                                <label style="font-size: 11px; position: relative;">Person:</label>
                                                <select id="cboPerson" style="width: 180px; height: 22px; font-size: 11px; position: relative;">
                                                    <option value="" style="position: relative;">-- Person wählen --</option>
                                                </select>
                                                <button class="btn btn-blue" id="btnPersonUebernehmen" onclick="personUebernehmen()" title="Ausgewählte Person diesem Kunden zuordnen" style="position: relative;">Übernehmen</button>
                                            </span>
                                        </div>
                                        <div style="height: 200px; overflow-y: auto; border: 1px solid rgb(128, 128, 128); margin-bottom: 10px; position: relative;">
                                            <div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><table class="data-grid" id="ansprechpartnerTable" data-testid="kd-table-ansprechpartner" style="position: relative;">
                                                <thead>
                                                    <tr style="position: relative;">
                                                        <th style="width: 150px;">Nachname</th>
                                                        <th style="width: 100px;">Vorname</th>
                                                        <th style="width: 100px;">Position</th>
                                                        <th style="width: 120px;">Telefon</th>
                                                        <th style="width: 120px;">Handy</th>
                                                        <th style="width: 180px;">E-Mail</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="ansprechpartnerTbody" class="skeleton-loading" style="position: relative;"><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div></tbody>
                                            </table>
                                        </div>
                                        <!-- Detail-Formular für ausgewaehlten Ansprechpartner -->
                                        <div style="border: 1px solid rgb(128, 128, 128); padding: 10px; background: rgb(240, 240, 240); position: relative;">
                                            <div style="font-weight: bold; margin-bottom: 8px; position: relative;">Ansprechpartner Details:</div>
                                            <div style="display: flex; gap: 20px; flex-wrap: wrap; position: relative;">
                                                <div class="form-column" style="min-width: 250px; position: relative;">
                                                    <div class="form-row" style="position: relative;">
                                                        <span class="form-label" style="min-width: 80px; position: relative;">Nachname:</span>
                                                        <input type="text" class="form-input input-md" id="adr_Nachname" data-ap-field="adr_Nachname" style="position: relative;">
                                                    </div>
                                                    <div class="form-row" style="position: relative;">
                                                        <span class="form-label" style="min-width: 80px; position: relative;">Vorname:</span>
                                                        <input type="text" class="form-input input-md" id="adr_Vorname" data-ap-field="adr_Vorname" style="position: relative;">
                                                    </div>
                                                    <div class="form-row" style="position: relative;">
                                                        <span class="form-label" style="min-width: 80px; position: relative;">Anrede:</span>
                                                        <select class="form-select input-md" id="adr_AnredeID" data-ap-field="adr_AnredeID" style="position: relative;">
                                                            <option value="" style="position: relative;">-- Bitte waehlen --</option>
                                                            <option value="1" style="position: relative;">Herr</option>
                                                            <option value="2" style="position: relative;">Frau</option>
                                                            <option value="3" style="position: relative;">Firma</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-row" style="position: relative;">
                                                        <span class="form-label" style="min-width: 80px; position: relative;">Akad. Grad:</span>
                                                        <input type="text" class="form-input input-md" id="adr_akad_Grad" data-ap-field="adr_akad_Grad" style="position: relative;">
                                                    </div>
                                                </div>
                                                <div class="form-column" style="min-width: 250px; position: relative;">
                                                    <div class="form-row" style="position: relative;">
                                                        <span class="form-label" style="min-width: 80px; position: relative;">Telefon:</span>
                                                        <input type="tel" class="form-input input-md" id="adr_Tel" data-ap-field="adr_Tel" pattern="[0-9+\-\s/()]+" title="Telefonnummer eingeben" style="position: relative;">
                                                    </div>
                                                    <div class="form-row" style="position: relative;">
                                                        <span class="form-label" style="min-width: 80px; position: relative;">Handy:</span>
                                                        <input type="tel" class="form-input input-md" id="adr_Handy" data-ap-field="adr_Handy" pattern="[0-9+\-\s/()]+" title="Telefonnummer eingeben" style="position: relative;">
                                                    </div>
                                                    <div class="form-row" style="position: relative;">
                                                        <span class="form-label" style="min-width: 80px; position: relative;">E-Mail:</span>
                                                        <input type="email" class="form-input input-lg" id="adr_eMail" data-ap-field="adr_eMail" pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" title="Gueltige E-Mail-Adresse eingeben" style="position: relative;">
                                                    </div>
                                                    <div class="form-row" style="position: relative;">
                                                        <span class="form-label" style="min-width: 80px; position: relative;">Fax:</span>
                                                        <input type="tel" class="form-input input-md" id="adr_Fax" data-ap-field="adr_Fax" pattern="[0-9+\-\s/()]+" title="Faxnummer eingeben" style="position: relative;">
                                                    </div>
                                                </div>
                                                <div class="form-column" style="min-width: 250px; position: relative;">
                                                    <div class="form-row" style="position: relative;">
                                                        <span class="form-label" style="min-width: 80px; position: relative;">Geburtstag:</span>
                                                        <input type="date" class="form-input" id="adr_Geburtstag" data-ap-field="adr_Geburtstag" style="width: 130px; position: relative;">
                                                    </div>
                                                    <div class="form-row" style="position: relative;">
                                                        <span class="form-label" style="min-width: 80px; position: relative;">Bemerkung:</span>
                                                        <textarea class="form-input" id="adr_Bemerkung" data-ap-field="adr_Bemerkung" style="width: 200px; height: 60px; position: relative;"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                            <div style="margin-top: 10px; position: relative;">
                                                <button class="btn btn-green" onclick="speichereAnsprechpartner()" style="position: relative;">Speichern</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab 5: Zusatzdateien -->
                                <div class="tab-page" id="tab-zusatzdateien" style="position: relative;">
                                    <div style="margin-bottom: 10px; position: relative;">
                                        <button class="btn btn-blue" onclick="dateiHinzufuegen()" style="position: relative;">Datei hinzufugen</button>
                                    </div>
                                    <div class="list-wrapper" style="height: 300px; position: relative;">
                                        <div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><table class="data-grid" id="dateienTable" style="position: relative;">
                                            <thead>
                                                <tr style="position: relative;">
                                                    <th>Dateiname</th>
                                                    <th>Datum</th>
                                                    <th>Grose</th>
                                                    <th>Typ</th>
                                                    <th>Beschreibung</th>
                                                </tr>
                                            </thead>
                                            <tbody id="dateienBody" class="skeleton-loading" style="position: relative;"><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div></tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Tab 6: Bemerkungen -->
                                <div class="tab-page" id="tab-bemerkungen" style="position: relative;">
                                    <div class="form-column" style="position: relative;">
                                        <div style="margin-bottom: 10px; position: relative;">
                                            <span style="font-weight: bold; position: relative;">Anschreiben:</span>
                                            <textarea class="form-textarea" id="kun_Anschreiben" data-field="kun_Anschreiben" rows="3" style="width: 100%; margin-top: 4px; position: relative;"></textarea>
                                        </div>
                                        <div style="margin-bottom: 10px; position: relative;">
                                            <span style="font-weight: bold; position: relative;">Briefkopf:</span>
                                            <textarea class="form-textarea" id="kun_BriefKopf" data-field="kun_BriefKopf" rows="4" style="width: 100%; margin-top: 4px; position: relative;"></textarea>
                                        </div>
                                        <div style="position: relative;">
                                            <span style="font-weight: bold; position: relative;">Memo:</span>
                                            <textarea class="form-textarea" id="kun_memo" data-field="kun_memo" rows="8" style="width: 100%; margin-top: 4px; position: relative;"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab 7: Angebote (pg_Ang / sub_Rch_Kopf_Ang) -->
                                <div class="tab-page" id="tab-angebote" style="position: relative;">
                                    <div style="display: flex; gap: 8px; margin-bottom: 8px; position: relative;">
                                        <button class="btn btn-green" onclick="neuesAngebot()" style="position: relative;">+ Neues Angebot</button>
                                        <button class="btn" onclick="loadAngebote()" style="position: relative;">Aktualisieren</button>
                                        <button class="btn btn-blue" onclick="openAngebotPDF()" style="position: relative;">Angebot PDF</button>
                                    </div>
                                    <div class="list-wrapper" style="height: 320px; position: relative;">
                                        <table class="data-grid" id="angeboteTable" data-testid="kd-table-angebote" style="position: relative;">
                                            <thead>
                                                <tr style="position: relative;">
                                                    <th style="width: 80px;">Datum</th>
                                                    <th style="width: 100px;">Angebot-Nr</th>
                                                    <th>Bezeichnung</th>
                                                    <th style="width: 100px;">Betrag</th>
                                                    <th style="width: 80px;">Status</th>
                                                    <th style="width: 80px;">Gueltig bis</th>
                                                </tr>
                                            </thead>
                                            <tbody id="angeboteBody" style="position: relative;">
                                                <tr style="position: relative;"><td colspan="6" style="text-align: center; color: rgb(102, 102, 102); padding: 20px; position: relative;">Angebote werden geladen...</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- Angebots-Summe -->
                                    <div style="display: flex; justify-content: flex-end; padding: 5px; background: rgb(176, 176, 208); border: 1px solid rgb(128, 128, 128); margin-top: -1px; position: relative;">
                                        <span style="position: relative;">Anzahl Angebote: <span id="angeboteAnzahl" style="font-weight: bold; position: relative;">0</span></span>
                                        <span style="margin-left: 20px; position: relative;">Gesamtwert:</span>
                                        <span id="angeboteGesamtwert" style="font-weight: bold; margin-left: 10px; min-width: 100px; text-align: right; position: relative;">0,00 EUR</span>
                                    </div>
                                </div>

                                <!-- Tab 8: Statistik (pg_Rch_Kopf - Detaillierte Umsatzstatistik) -->
                                <div class="tab-page" id="tab-statistik" style="position: relative;">
                                    <div style="font-weight: bold; margin-bottom: 10px; font-size: 12px; position: relative;">Detaillierte Umsatzstatistik - Jahresvergleich</div>
                                    <div style="display: flex; gap: 20px; flex-wrap: wrap; position: relative;">
                                        <!-- Jahresuebersicht Grid -->
                                        <table class="data-grid" style="width: auto; min-width: 600px; position: relative;">
                                            <thead>
                                                <tr style="position: relative;">
                                                    <th style="width: 150px;">Kategorie</th>
                                                    <th style="width: 120px; text-align: right;" id="statJahr1Header">2024</th>
                                                    <th style="width: 120px; text-align: right;" id="statJahr2Header">2023</th>
                                                    <th style="width: 120px; text-align: right;" id="statJahr3Header">2022</th>
                                                </tr>
                                            </thead>
                                            <tbody style="position: relative;">
                                                <tr style="position: relative;">
                                                    <td style="font-weight: bold; position: relative;">Umsatz Netto</td>
                                                    <td style="text-align: right; position: relative;" id="UmsNGes1">0,00 EUR</td>
                                                    <td style="text-align: right; position: relative;" id="UmsNGes2">0,00 EUR</td>
                                                    <td style="text-align: right; position: relative;" id="UmsNGes3">0,00 EUR</td>
                                                </tr>
                                                <tr style="position: relative;">
                                                    <td style="font-weight: bold; position: relative;">Umsatz Brutto</td>
                                                    <td style="text-align: right; position: relative;" id="UmsGes1">0,00 EUR</td>
                                                    <td style="text-align: right; position: relative;" id="UmsGes2">0,00 EUR</td>
                                                    <td style="text-align: right; position: relative;" id="UmsGes3">0,00 EUR</td>
                                                </tr>
                                                <tr style="position: relative;">
                                                    <td style="font-weight: bold; position: relative;">Stunden gesamt</td>
                                                    <td style="text-align: right; position: relative;" id="StdGes1">0</td>
                                                    <td style="text-align: right; position: relative;" id="StdGes2">0</td>
                                                    <td style="text-align: right; position: relative;" id="StdGes3">0</td>
                                                </tr>
                                                <tr style="position: relative;">
                                                    <td style="font-weight: bold; position: relative;">Auftraege</td>
                                                    <td style="text-align: right; position: relative;" id="AufAnz1">0</td>
                                                    <td style="text-align: right; position: relative;" id="AufAnz2">0</td>
                                                    <td style="text-align: right; position: relative;" id="AufAnz3">0</td>
                                                </tr>
                                                <tr style="background: rgb(224, 224, 240); position: relative;">
                                                    <td style="font-weight: bold; position: relative;">Personal/Tage</td>
                                                    <td style="text-align: right; position: relative;" id="PersGes1">0</td>
                                                    <td style="text-align: right; position: relative;" id="PersGes2">0</td>
                                                    <td style="text-align: right; position: relative;" id="PersGes3">0</td>
                                                </tr>
                                            </tbody>
                                        </table>

                                        <!-- KW-basierte Stunden (letzte Wochen) -->
                                        <div style="border: 1px solid rgb(128, 128, 128); padding: 8px; background: rgb(240, 240, 240); position: relative;">
                                            <div style="font-weight: bold; margin-bottom: 5px; position: relative;">Stunden letzte Wochen</div>
                                            <table class="data-grid" style="width: auto; position: relative;">
                                                <thead>
                                                    <tr style="position: relative;">
                                                        <th>KW</th>
                                                        <th style="text-align: right;">Std</th>
                                                    </tr>
                                                </thead>
                                                <tbody style="position: relative;">
                                                    <tr style="position: relative;"><td style="position: relative;">KW 51</td><td style="text-align: right; position: relative;" id="Std51">0</td></tr>
                                                    <tr style="position: relative;"><td style="position: relative;">KW 52</td><td style="text-align: right; position: relative;" id="Std52">0</td></tr>
                                                    <tr style="position: relative;"><td style="position: relative;">KW 53</td><td style="text-align: right; position: relative;" id="Std53">0</td></tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <!-- Personal/Tage letzte Wochen -->
                                        <div style="border: 1px solid rgb(128, 128, 128); padding: 8px; background: rgb(240, 240, 240); position: relative;">
                                            <div style="font-weight: bold; margin-bottom: 5px; position: relative;">Personal/Tage letzte Wochen</div>
                                            <table class="data-grid" style="width: auto; position: relative;">
                                                <thead>
                                                    <tr style="position: relative;">
                                                        <th>KW</th>
                                                        <th style="text-align: right;">Pers</th>
                                                    </tr>
                                                </thead>
                                                <tbody style="position: relative;">
                                                    <tr style="position: relative;"><td style="position: relative;">KW 51</td><td style="text-align: right; position: relative;" id="Pers51">0</td></tr>
                                                    <tr style="position: relative;"><td style="position: relative;">KW 52</td><td style="text-align: right; position: relative;" id="Pers52">0</td></tr>
                                                    <tr style="position: relative;"><td style="position: relative;">KW 53</td><td style="text-align: right; position: relative;" id="Pers53">0</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Buttons -->
                                    <div style="margin-top: 15px; display: flex; gap: 8px; position: relative;">
                                        <button class="btn" onclick="loadStatistik()" style="position: relative;">Aktualisieren</button>
                                        <button class="btn btn-blue" onclick="exportStatistikExcel()" style="position: relative;">Export Excel</button>
                                    </div>
                                </div>

                                <!-- Tab 9: Preise (pgPreise / sub_KD_Standardpreise) -->
                                <div class="tab-page" id="tab-preise" style="position: relative;">
                                    <div style="display: flex; gap: 8px; margin-bottom: 8px; position: relative;">
                                        <button class="btn btn-green" onclick="standardpreiseAnlegen()" style="position: relative;">Standardpreise anlegen</button>
                                        <button class="btn" onclick="loadKundenpreise()" style="position: relative;">Aktualisieren</button>
                                        <button class="btn btn-green" onclick="neuerPreis()" style="position: relative;">+ Neuer Preis</button>
                                        <button class="btn btn-red" onclick="preisLoeschen()" style="position: relative;">Preis loeschen</button>
                                    </div>
                                    <div class="list-wrapper" style="height: 320px; position: relative;">
                                        <div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><table class="data-grid" id="kundenpreiseTable" style="position: relative;">
                                            <thead>
                                                <tr style="position: relative;">
                                                    <th style="width: 50px;">Pos</th>
                                                    <th style="width: 200px;">Bezeichnung</th>
                                                    <th style="width: 100px;">Preis/Std</th>
                                                    <th style="width: 100px;">Preis/Tag</th>
                                                    <th style="width: 100px;">Nachtzuschlag</th>
                                                    <th>Bemerkung</th>
                                                    <th style="width: 120px;">Geaendert am</th>
                                                </tr>
                                            </thead>
                                            <tbody id="kundenpreiseBody" class="skeleton-loading" style="position: relative;"><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-50" style="position: relative;"></div><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-60" style="position: relative;"></div><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div></div><div class="skeleton-row" style="position: relative;"><div class="skeleton-cell w-30" style="position: relative;"></div><div class="skeleton-cell w-40" style="position: relative;"></div><div class="skeleton-cell w-20" style="position: relative;"></div><div class="skeleton-cell w-50" style="position: relative;"></div></div></tbody>
                                        </table>
                                    </div>
                                    <!-- Detail-Formular fuer Preis-Bearbeitung -->
                                    <div style="border: 1px solid rgb(128, 128, 128); padding: 10px; background: rgb(240, 240, 240); margin-top: 10px; position: relative;">
                                        <div style="font-weight: bold; margin-bottom: 8px; position: relative;">Preis bearbeiten:</div>
                                        <div style="display: flex; gap: 20px; flex-wrap: wrap; position: relative;">
                                            <div class="form-column" style="min-width: 250px; position: relative;">
                                                <div class="form-row" style="position: relative;">
                                                    <span class="form-label" style="min-width: 80px; position: relative;">Preisart:</span>
                                                    <select class="form-select" id="preis_Preisart_ID" data-preis-field="Preisart_ID" style="width: 200px; position: relative;">
                                                        <option value="" style="position: relative;">-- Bitte waehlen --</option>
                                                    </select>
                                                </div>
                                                <div class="form-row" style="position: relative;">
                                                    <span class="form-label" style="min-width: 80px; position: relative;">Bemerkung:</span>
                                                    <input type="text" class="form-input" id="preis_Bemerkung" data-preis-field="Bemerkung" style="width: 200px; position: relative;">
                                                </div>
                                            </div>
                                            <div class="form-column" style="min-width: 200px; position: relative;">
                                                <div class="form-row" style="position: relative;">
                                                    <span class="form-label" style="min-width: 80px; position: relative;">Preis/Std:</span>
                                                    <input type="number" class="form-input" id="preis_StdPreis" data-preis-field="StdPreis" style="width: 100px; position: relative;" step="0.01">
                                                    <span style="font-size: 11px; margin-left: 4px; position: relative;">EUR</span>
                                                </div>
                                                <div class="form-row" style="position: relative;">
                                                    <span class="form-label" style="min-width: 80px; position: relative;">Preis/Tag:</span>
                                                    <input type="number" class="form-input" id="preis_TagPreis" data-preis-field="TagPreis" style="width: 100px; position: relative;" step="0.01">
                                                    <span style="font-size: 11px; margin-left: 4px; position: relative;">EUR</span>
                                                </div>
                                                <div class="form-row" style="position: relative;">
                                                    <span class="form-label" style="min-width: 80px; position: relative;">Nachtzuschlag:</span>
                                                    <input type="number" class="form-input" id="preis_Nachtzuschlag" data-preis-field="Nachtzuschlag" style="width: 100px; position: relative;" step="0.01">
                                                    <span style="font-size: 11px; margin-left: 4px; position: relative;">%</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div style="margin-top: 10px; position: relative;">
                                            <button class="btn btn-green" onclick="speicherePreis()" style="position: relative;">Preis speichern</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Customer List -->
                    <div class="right-panel" style="width: 435px; left: -5px; height: 682px; top: 0px; position: relative;">
                        <div class="right-header" style="position: relative;">
                            <div class="filter-box" style="margin-bottom: 4px; position: relative;">
                                <input type="checkbox" id="chkNurAktive" checked="" onchange="loadKunden()" style="position: relative;">
                                <label for="chkNurAktive" style="position: relative;">Nur Aktive</label>
                                <button class="btn" onclick="resetAuswahlfilter()" style="margin-left: 8px; font-size: 9px; position: relative;">Filter Reset</button>
                            </div>
                            <div class="search-box" style="position: relative;">
                                <label style="position: relative;">Suche:</label>
                                <input type="text" id="searchInput" placeholder="Firma eingeben..." style="position: relative;">
                            </div>
                            <!-- Filter-Comboboxen aus Access (cboSuchPLZ, cboSuchOrt) -->
                            <div style="display: flex; gap: 4px; margin-top: 4px; flex-wrap: wrap; width: 423px; position: relative;">
                                <select id="cboSuchPLZ" onchange="filterByPLZ(this.value)" style="width: 70px; height: 18px; font-size: 11px; position: relative;">
                                    <option value="_ALLE" style="position: relative;">PLZ</option>
                                    <option value="90" style="position: relative;">90xxx</option>
                                    <option value="91" style="position: relative;">91xxx</option>
                                    <option value="80" style="position: relative;">80xxx</option>
                                    <option value="81" style="position: relative;">81xxx</option>
                                </select>
                                <select id="cboSuchOrt" onchange="filterByOrt(this.value)" style="width: 100px; height: 18px; font-size: 11px; position: relative;">
                                    <option value="_ALLE" style="position: relative;">Ort</option>
                                    <option value="Nuernberg" style="position: relative;">Nuernberg</option>
                                    <option value="Fuerth" style="position: relative;">Fuerth</option>
                                    <option value="Erlangen" style="position: relative;">Erlangen</option>
                                    <option value="Muenchen" style="position: relative;">Muenchen</option>
                                </select>
                                <select id="cboSuchSuchF" onchange="filterBySortfeld(this.value)" style="width: 100px; height: 18px; font-size: 11px; position: relative;" title="Filter nach Sortfeld/Kategorie">
                                    <option value="_ALLE" style="position: relative;">Sortfeld</option>
                                </select>
                            </div>
                        </div>
                        <div class="list-wrapper" id="listWrapper" style="position: relative;">
                            <table class="data-grid" id="kundenTable" style="position: relative;">
                                <thead>
                                    <tr style="position: relative;">
                                        <th>Nr</th>
                                        <th>Firma</th>
                                        <th style="width: 83px;">Kontaktname</th>
                                        <th>Vorname</th>
                                        <th>Ort</th>
                                        <th>Telefon</th>
                                    </tr>
                                </thead>
                                <tbody id="kundenBody" style="position: relative;"><tr data-index="0" class="selected" style="position: relative;">
                    <td style="position: relative;">27</td>
                    <td style="position: relative;">1 Agency</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="1" style="position: relative;">
                    <td style="position: relative;">11155</td>
                    <td style="position: relative;">A&amp;R</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="2" style="position: relative;">
                    <td style="position: relative;">20790</td>
                    <td style="position: relative;">Ackermann Thomas</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="3" style="position: relative;">
                    <td style="position: relative;">10170</td>
                    <td style="position: relative;">aktives Neumarkt e. V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="4" style="position: relative;">
                    <td style="position: relative;">20818</td>
                    <td style="position: relative;">Antonio Russo</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="5" style="position: relative;">
                    <td style="position: relative;">10688</td>
                    <td style="position: relative;">ARGO Konzerte GmbH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="6" style="position: relative;">
                    <td style="position: relative;">20727</td>
                    <td style="position: relative;">Arnold GmbH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="7" style="position: relative;">
                    <td style="position: relative;">10692</td>
                    <td style="position: relative;">Auinger Peter</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="8" style="position: relative;">
                    <td style="position: relative;">20731</td>
                    <td style="position: relative;">B &amp; M Security</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="9" style="position: relative;">
                    <td style="position: relative;">10720</td>
                    <td style="position: relative;">B.O.S. FRANKEN SECURITY GmbH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="10" style="position: relative;">
                    <td style="position: relative;">20771</td>
                    <td style="position: relative;">B.O.S. Fussball FCN</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="11" style="position: relative;">
                    <td style="position: relative;">20770</td>
                    <td style="position: relative;">B.O.S. Kaufland</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="12" style="position: relative;">
                    <td style="position: relative;">20718</td>
                    <td style="position: relative;">Bavarian Gastro</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="13" style="position: relative;">
                    <td style="position: relative;">20787</td>
                    <td style="position: relative;">BBS - Bertold-Brecht-Schule</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="14" style="position: relative;">
                    <td style="position: relative;">10695</td>
                    <td style="position: relative;">Beilngries Tourismus GmbH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="15" style="position: relative;">
                    <td style="position: relative;">20822</td>
                    <td style="position: relative;">Berg GmbH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="16" style="position: relative;">
                    <td style="position: relative;">20816</td>
                    <td style="position: relative;">BKV</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="17" style="position: relative;">
                    <td style="position: relative;">20702</td>
                    <td style="position: relative;">Blank Christian</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="18" style="position: relative;">
                    <td style="position: relative;">28</td>
                    <td style="position: relative;">Blank Promotion Service</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="19" style="position: relative;">
                    <td style="position: relative;">20119</td>
                    <td style="position: relative;">BOS Sub</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="20" style="position: relative;">
                    <td style="position: relative;">10214</td>
                    <td style="position: relative;">Brauerei Gutmann</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="21" style="position: relative;">
                    <td style="position: relative;">10215</td>
                    <td style="position: relative;">Brauhaus Höchstadt</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="22" style="position: relative;">
                    <td style="position: relative;">20830</td>
                    <td style="position: relative;">BSC Woffenbach 1950 e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="23" style="position: relative;">
                    <td style="position: relative;">10770</td>
                    <td style="position: relative;">Burschenverein Köstlbach-Heng</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="24" style="position: relative;">
                    <td style="position: relative;">10220</td>
                    <td style="position: relative;">CA-Veranstaltungen</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="25" style="position: relative;">
                    <td style="position: relative;">20747</td>
                    <td style="position: relative;">Cocktailbar Don Caribico</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="26" style="position: relative;">
                    <td style="position: relative;">10233</td>
                    <td style="position: relative;">Concertbüro Franken GmbH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="27" style="position: relative;">
                    <td style="position: relative;">20821</td>
                    <td style="position: relative;">DATEV eG</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="28" style="position: relative;">
                    <td style="position: relative;">10241</td>
                    <td style="position: relative;">Der Cult</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="29" style="position: relative;">
                    <td style="position: relative;">20777</td>
                    <td style="position: relative;">DJK Fiegenstall e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="30" style="position: relative;">
                    <td style="position: relative;">20797</td>
                    <td style="position: relative;">DJK SV Pilsach</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="31" style="position: relative;">
                    <td style="position: relative;">20744</td>
                    <td style="position: relative;">Dominik Cobic</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="32" style="position: relative;">
                    <td style="position: relative;">20798</td>
                    <td style="position: relative;">Dorfmusik Seligenporten</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="33" style="position: relative;">
                    <td style="position: relative;">20793</td>
                    <td style="position: relative;">Edgar Security</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="34" style="position: relative;">
                    <td style="position: relative;">10736</td>
                    <td style="position: relative;">EH Sicherheit</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="35" style="position: relative;">
                    <td style="position: relative;">20740</td>
                    <td style="position: relative;">Engelhardt &amp; Co Parkraummanagement</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="36" style="position: relative;">
                    <td style="position: relative;">10788</td>
                    <td style="position: relative;">ESS</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="37" style="position: relative;">
                    <td style="position: relative;">20730</td>
                    <td style="position: relative;">ESS 1 Messe</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="38" style="position: relative;">
                    <td style="position: relative;">20760</td>
                    <td style="position: relative;">ESS 2 Standwachen</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="39" style="position: relative;">
                    <td style="position: relative;">20761</td>
                    <td style="position: relative;">ESS 3 Handball</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="40" style="position: relative;">
                    <td style="position: relative;">10254</td>
                    <td style="position: relative;">E-Werk</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="41" style="position: relative;">
                    <td style="position: relative;">20758</td>
                    <td style="position: relative;">Faschingsgesellschaft Hechtonia Berching e.V</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="42" style="position: relative;">
                    <td style="position: relative;">20757</td>
                    <td style="position: relative;">Faschingsverein Meckenhausen e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="43" style="position: relative;">
                    <td style="position: relative;">20774</td>
                    <td style="position: relative;">FC Ezelsdorf 1923 e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="44" style="position: relative;">
                    <td style="position: relative;">20808</td>
                    <td style="position: relative;">FC Möning 1949 e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="45" style="position: relative;">
                    <td style="position: relative;">20814</td>
                    <td style="position: relative;">Fiege Health Care</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="46" style="position: relative;">
                    <td style="position: relative;">20765</td>
                    <td style="position: relative;">Fledererverein Meiersberg e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="47" style="position: relative;">
                    <td style="position: relative;">10789</td>
                    <td style="position: relative;">Förderverein Naturbad Postbauer-Heng e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="48" style="position: relative;">
                    <td style="position: relative;">20783</td>
                    <td style="position: relative;">Franz Schattenhofer GmbH &amp; Co.KG</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="49" style="position: relative;">
                    <td style="position: relative;">20803</td>
                    <td style="position: relative;">FSV Berngau</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="50" style="position: relative;">
                    <td style="position: relative;">20728</td>
                    <td style="position: relative;">Gemeinde Schwarzenbruck</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="51" style="position: relative;">
                    <td style="position: relative;">10647</td>
                    <td style="position: relative;">Gundel Joachim</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="52" style="position: relative;">
                    <td style="position: relative;">10702</td>
                    <td style="position: relative;">Gutmann am Dutzendteich</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="53" style="position: relative;">
                    <td style="position: relative;">20791</td>
                    <td style="position: relative;">Gymnasium Beilngries</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="54" style="position: relative;">
                    <td style="position: relative;">20773</td>
                    <td style="position: relative;">Gymnasium Stein</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="55" style="position: relative;">
                    <td style="position: relative;">20729</td>
                    <td style="position: relative;">Hahn Sicherheit &amp; Schulung</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="56" style="position: relative;">
                    <td style="position: relative;">10337</td>
                    <td style="position: relative;">HIRSCH GdbR</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="57" style="position: relative;">
                    <td style="position: relative;">20827</td>
                    <td style="position: relative;">Jugendkulturmanagement con-action/ Kopf und Kragen</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="58" style="position: relative;">
                    <td style="position: relative;">20759</td>
                    <td style="position: relative;">K.D.St.V. Ostmark im CV zu Nürnberg</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="59" style="position: relative;">
                    <td style="position: relative;">20786</td>
                    <td style="position: relative;">Kärwaboum Lindelburg e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="60" style="position: relative;">
                    <td style="position: relative;">20811</td>
                    <td style="position: relative;">Kärwaboum Unterferrieden e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="61" style="position: relative;">
                    <td style="position: relative;">20748</td>
                    <td style="position: relative;">Kärwaboumverein Seitendorf</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="62" style="position: relative;">
                    <td style="position: relative;">20792</td>
                    <td style="position: relative;">Kärwaburschen Atzenhof</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="63" style="position: relative;">
                    <td style="position: relative;">20804</td>
                    <td style="position: relative;">Kärwaverein Deberndorf e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="64" style="position: relative;">
                    <td style="position: relative;">20788</td>
                    <td style="position: relative;">Kärwaverein Schwarzenbruck</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="65" style="position: relative;">
                    <td style="position: relative;">20749</td>
                    <td style="position: relative;">Kirwaboum Schwarzach e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="66" style="position: relative;">
                    <td style="position: relative;">20722</td>
                    <td style="position: relative;">KKT GmbH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="67" style="position: relative;">
                    <td style="position: relative;">20815</td>
                    <td style="position: relative;">KKV &amp; GV Seukendorf</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="68" style="position: relative;">
                    <td style="position: relative;">20796</td>
                    <td style="position: relative;">Klaragasse &amp; Freunde e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="69" style="position: relative;">
                    <td style="position: relative;">20776</td>
                    <td style="position: relative;">Konzertbüro Oberpfalz UG</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="70" style="position: relative;">
                    <td style="position: relative;">621</td>
                    <td style="position: relative;">KS Security</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="71" style="position: relative;">
                    <td style="position: relative;">20826</td>
                    <td style="position: relative;">Markt Wendelstein</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="72" style="position: relative;">
                    <td style="position: relative;">20741</td>
                    <td style="position: relative;">Martin Kaiser &amp; David Lodhi Gbr</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="73" style="position: relative;">
                    <td style="position: relative;">10423</td>
                    <td style="position: relative;">MC Rückwärts-Gang</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="74" style="position: relative;">
                    <td style="position: relative;">20825</td>
                    <td style="position: relative;">Metropol</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="75" style="position: relative;">
                    <td style="position: relative;">10448</td>
                    <td style="position: relative;">MUNICH SECURITY SERVICES GMBH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="76" style="position: relative;">
                    <td style="position: relative;">10451</td>
                    <td style="position: relative;">Musikinitiative Nürnberger Land e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="77" style="position: relative;">
                    <td style="position: relative;">20726</td>
                    <td style="position: relative;">Nasty Entertainment GmbH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="78" style="position: relative;">
                    <td style="position: relative;">20707</td>
                    <td style="position: relative;">Neues Museum Nürnberg, Staatliches Museum für Kunst und Design</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="79" style="position: relative;">
                    <td style="position: relative;">10458</td>
                    <td style="position: relative;">Neumarkter Lammsbräu Gebr.Ehrnsperger e.K.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="80" style="position: relative;">
                    <td style="position: relative;">10759</td>
                    <td style="position: relative;">NWS Sicherheitsservice GmbH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="81" style="position: relative;">
                    <td style="position: relative;">20764</td>
                    <td style="position: relative;">NWS Sonderdienst DHL Parkplatz</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="82" style="position: relative;">
                    <td style="position: relative;">20755</td>
                    <td style="position: relative;">Palazzo Produktionen</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="83" style="position: relative;">
                    <td style="position: relative;">20724</td>
                    <td style="position: relative;">Palermo Security</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="84" style="position: relative;">
                    <td style="position: relative;">20745</td>
                    <td style="position: relative;">Parkcafé Neumarkt</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="85" style="position: relative;">
                    <td style="position: relative;">20789</td>
                    <td style="position: relative;">Pfertner GmbH Immobilienverwaltung</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="86" style="position: relative;">
                    <td style="position: relative;">20752</td>
                    <td style="position: relative;">Power Concerts</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="87" style="position: relative;">
                    <td style="position: relative;">20735</td>
                    <td style="position: relative;">POWER GmbH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="88" style="position: relative;">
                    <td style="position: relative;">20812</td>
                    <td style="position: relative;">PVS - Peter Vischer Schulen</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="89" style="position: relative;">
                    <td style="position: relative;">10495</td>
                    <td style="position: relative;">Pyraser Landbrauerei</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="90" style="position: relative;">
                    <td style="position: relative;">10772</td>
                    <td style="position: relative;">Raahner Club</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="91" style="position: relative;">
                    <td style="position: relative;">20829</td>
                    <td style="position: relative;">Raiffeisenbank</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="92" style="position: relative;">
                    <td style="position: relative;">20819</td>
                    <td style="position: relative;">Richter + Frenzel Nürnberg GmbH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="93" style="position: relative;">
                    <td style="position: relative;">20785</td>
                    <td style="position: relative;">RLH Agrar GmbH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="94" style="position: relative;">
                    <td style="position: relative;">20769</td>
                    <td style="position: relative;">Rockn Roll Catering</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="95" style="position: relative;">
                    <td style="position: relative;">20739</td>
                    <td style="position: relative;">SC Prölsdorf</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="96" style="position: relative;">
                    <td style="position: relative;">9295</td>
                    <td style="position: relative;">Sec Concept</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="97" style="position: relative;">
                    <td style="position: relative;">10527</td>
                    <td style="position: relative;">Semmel Concerts GmbH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="98" style="position: relative;">
                    <td style="position: relative;">20817</td>
                    <td style="position: relative;">ShowBro GmbH</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="99" style="position: relative;">
                    <td style="position: relative;">20800</td>
                    <td style="position: relative;">SkyDai Gastronomie GmbH &amp; Co. KG</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="100" style="position: relative;">
                    <td style="position: relative;">20737</td>
                    <td style="position: relative;">SPVGG Greuther Fürth GmbH &amp; Co. KGaA</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="101" style="position: relative;">
                    <td style="position: relative;">10656</td>
                    <td style="position: relative;">St. Wolfgang-Mittelschule</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="102" style="position: relative;">
                    <td style="position: relative;">10115</td>
                    <td style="position: relative;">Stadt Abenberg</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="103" style="position: relative;">
                    <td style="position: relative;">20807</td>
                    <td style="position: relative;">Stadt Altdorf</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="104" style="position: relative;">
                    <td style="position: relative;">20763</td>
                    <td style="position: relative;">Stadt Berching</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="105" style="position: relative;">
                    <td style="position: relative;">20813</td>
                    <td style="position: relative;">Stadt Freystadt</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="106" style="position: relative;">
                    <td style="position: relative;">20784</td>
                    <td style="position: relative;">Stadt Neumarkt i.d.Opf.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="107" style="position: relative;">
                    <td style="position: relative;">10768</td>
                    <td style="position: relative;">Stadt Nürnberg</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="108" style="position: relative;">
                    <td style="position: relative;">20753</td>
                    <td style="position: relative;">Stadt Roth</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="109" style="position: relative;">
                    <td style="position: relative;">20799</td>
                    <td style="position: relative;">Stargarage AG</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="110" style="position: relative;">
                    <td style="position: relative;">20828</td>
                    <td style="position: relative;">SV Raitersaich e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="111" style="position: relative;">
                    <td style="position: relative;">20810</td>
                    <td style="position: relative;">SV Seligenporten 1949 e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="112" style="position: relative;">
                    <td style="position: relative;">20706</td>
                    <td style="position: relative;">Tanzcentrum Neumarkt</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="113" style="position: relative;">
                    <td style="position: relative;">20823</td>
                    <td style="position: relative;">The GOOD FOX Company</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="114" style="position: relative;">
                    <td style="position: relative;">20772</td>
                    <td style="position: relative;">Timo Wachinger</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="115" style="position: relative;">
                    <td style="position: relative;">20820</td>
                    <td style="position: relative;">TSV 1846 Nbg e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="116" style="position: relative;">
                    <td style="position: relative;">20756</td>
                    <td style="position: relative;">TSV Meckenhausen e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="117" style="position: relative;">
                    <td style="position: relative;">20767</td>
                    <td style="position: relative;">TSV Pavelsbach</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="118" style="position: relative;">
                    <td style="position: relative;">20111</td>
                    <td style="position: relative;">United Security</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="119" style="position: relative;">
                    <td style="position: relative;">20824</td>
                    <td style="position: relative;">Wallenstein-Festpielverein Altdorf e.V.</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="120" style="position: relative;">
                    <td style="position: relative;">20795</td>
                    <td style="position: relative;">Wasserwacht</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="121" style="position: relative;">
                    <td style="position: relative;">10605</td>
                    <td style="position: relative;">Weitersdorfer KB</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="122" style="position: relative;">
                    <td style="position: relative;">10606</td>
                    <td style="position: relative;">Wettig Stephanie</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="123" style="position: relative;">
                    <td style="position: relative;">10607</td>
                    <td style="position: relative;">Wild 2000</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr><tr data-index="124" style="position: relative;">
                    <td style="position: relative;">10640</td>
                    <td style="position: relative;">World Network Agency</td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                    <td style="position: relative;"></td>
                </tr></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar" style="position: relative;">
            <span class="status-section" id="lblRecordInfo" style="position: relative;">Datensatz: 1 / 125</span>
            <span class="status-section" id="lblStatus" style="position: relative;">Bereit</span>
            <span class="status-section" style="position: relative;">Erstellt</span>
            <span class="status-section" id="erstelltAm" style="position: relative;">30.1.2023, 12:02:12</span>
            <span class="status-section" id="erstelltVon" style="position: relative;">-</span>
            <span class="status-section" style="position: relative;">Geandert</span>
            <span class="status-section" id="geaendertAm" style="position: relative;">14.1.2026, 15:15:29</span>
            <span class="status-section" id="geaendertVon" style="position: relative;">-</span>
        </div>
    </div>

    <!-- WebView2 Bridge -->
    <script src="js/webview2-bridge.js" style="position: relative;"></script>
    <!-- Global Button Handlers -->
    <script src="js/global-handlers.js" style="position: relative;"></script>

    <script style="position: relative;">
        'use strict';

        // State
        const state = {
            kundenList: [],
            currentIndex: 0,
            currentRecord: null,
            selectedObjekt: null,
            selectedDatei: null,
            isDirty: false,
            // Umsatz-Statistik (aus Access Form_Current)
            KD_Ges: 0,
            KD_VJ: 0,
            KD_LJ: 0,
            KD_LM: 0
        };

        // ============================================
        // INITIALISIERUNG
        // ============================================
        document.addEventListener('DOMContentLoaded', async function() {
            document.getElementById('lblDatum').textContent = formatDate(new Date());

            // Tab-Wechsel
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });

            // Menu-Navigation
            document.querySelectorAll('.menu-btn[data-form]').forEach(btn => {
                btn.addEventListener('click', function() {
                    navigateToForm(this.dataset.form);
                });
            });

            // Search
            document.getElementById('searchInput').addEventListener('input', renderKundenList);

            // Keyboard Navigation
            document.getElementById('listWrapper').addEventListener('keydown', (e) => {
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    showRecord(Math.min(state.currentIndex + 1, state.kundenList.length - 1));
                }
                if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    showRecord(Math.max(state.currentIndex - 1, 0));
                }
            });

            // Bridge-Events
            Bridge.on('onDataReceived', function(data) {
                // Kundenliste empfangen (von Bridge: type='kunden', records=... ODER kundenList=...)
                if (data.type === 'kunden' && data.records) {
                    state.kundenList = data.records;
                    renderKundenList();
                    document.getElementById('lblRecordInfo').textContent = `Datensatz: ${state.currentIndex + 1} / ${state.kundenList.length}`;
                    if (state.kundenList.length > 0) {
                        showRecord(0);
                    }
                    hideLoading();
                } else if (data.kundenList) {
                    // Alternative Event-Struktur
                    state.kundenList = data.kundenList;
                    renderKundenList();
                    document.getElementById('lblRecordInfo').textContent = `Datensatz: ${state.currentIndex + 1} / ${state.kundenList.length}`;
                    if (state.kundenList.length > 0) {
                        showRecord(0);
                    }
                    hideLoading();
                } else if (data.kunde) {
                    // Einzeldatensatz empfangen
                    loadKundeData(data.kunde);
                    hideLoading();
                }
                if (data.action === 'load' && data.kd_id) {
                    loadKundeById(data.kd_id);
                }
            });

            // Daten laden
            await loadKunden();

            // URL-Parameter prüfen
            const params = new URLSearchParams(window.location.search);
            const kdId = params.get('kd_id');
            if (kdId) {
                await loadKundeById(parseInt(kdId));
            }

            hideLoading();
        });

        // ============================================
        // DATA LOADING via WebView2 Bridge
        // ============================================
        async function loadKunden() {
            showLoading();
            try {
                const nurAktive = document.getElementById('chkNurAktive').checked;

                // Bridge.loadData ist Promise-basiert und feuert auch onDataReceived
                // Die Verarbeitung erfolgt im Event-Handler (oben)
                await Bridge.loadData('kunden', null, { aktiv: nurAktive });

                // Falls die Daten direkt zurueckkommen (REST-API Fallback verarbeitet im Event-Handler)
                // Hier nur warten, die eigentliche Verarbeitung geschieht im onDataReceived Handler
            } catch (e) {
                console.error('Kunden laden fehlgeschlagen:', e);
                hideLoading();
            }
        }

        async function loadKundeById(kdId) {
            const index = state.kundenList.findIndex(k => k.kun_Id === kdId);
            if (index >= 0) {
                await showRecord(index);
            } else {
                Bridge.loadData('kunde', kdId);
            }
        }

        // ============================================
        // RENDERING-FUNKTIONEN
        // ============================================
        function renderKundenList() {
            const tbody = document.getElementById('kundenBody');
            const search = document.getElementById('searchInput').value.toLowerCase();
            tbody.innerHTML = '';

            state.kundenList.forEach((kunde, index) => {
                const firma = kunde.kun_Firma || '';
                if (search && !firma.toLowerCase().includes(search)) return;

                const tr = document.createElement('tr');
                tr.dataset.index = index;
                if (index === state.currentIndex) {
                    tr.classList.add('selected');
                }
                tr.innerHTML = `
                    <td>${kunde.kun_Id || ''}</td>
                    <td>${escapeHtml(kunde.kun_Firma || '')}</td>
                    <td>${escapeHtml(kunde.adr_name || '')}</td>
                    <td>${escapeHtml(kunde.adr_vorname || '')}</td>
                    <td>${escapeHtml(kunde.kun_Ort || '')}</td>
                    <td>${escapeHtml(kunde.kun_telefon || '')}</td>
                `;
                tr.addEventListener('click', () => showRecord(index));
                tbody.appendChild(tr);
            });
        }

        async function showRecord(index) {
            if (index < 0 || index >= state.kundenList.length) return;
            state.currentIndex = index;
            const kdId = state.kundenList[index].kun_Id;

            // Load full record via Bridge
            Bridge.loadData('kunde', kdId);

            // Vorläufig Listendaten anzeigen
            state.currentRecord = state.kundenList[index];
            loadKundeData(state.currentRecord);
            markSelectedRow(index);

            document.getElementById('lblRecordInfo').textContent = `Datensatz: ${index + 1} / ${state.kundenList.length}`;
        }

        function loadKundeData(kunde) {
            document.getElementById('displayFirma').textContent = kunde.kun_Firma || '-';
            document.getElementById('displayAddress').textContent = kunde.kun_Ort ? ` - ${kunde.kun_PLZ} ${kunde.kun_Ort}` : '';
            document.getElementById('kdNr').value = kunde.kun_Id || '';

            // Alle Felder mit data-field befuellen
            document.querySelectorAll('[data-field]').forEach(el => {
                const field = el.dataset.field;
                let value = kunde[field];

                if (value === undefined || value === null) {
                    value = '';
                }

                if (el.type === 'checkbox') {
                    el.checked = !!value;
                } else {
                    el.value = value;
                }
            });

            // Audit-Felder
            if (kunde.Erst_am) {
                document.getElementById('erstelltAm').textContent = formatDateTime(kunde.Erst_am);
            }
            document.getElementById('erstelltVon').textContent = kunde.Erst_von || '-';
            if (kunde.Aend_am) {
                document.getElementById('geaendertAm').textContent = formatDateTime(kunde.Aend_am);
            }
            document.getElementById('geaendertVon').textContent = kunde.Aend_von || '-';

            Bridge.setFormValue('kd_id', kunde.kun_Id);

            // Kartenansicht aktualisieren
            loadKdMap(
                kunde.kun_Strasse || '',
                kunde.kun_PLZ || '',
                kunde.kun_Ort || '',
                kunde.kun_LKZ || 'DE'
            );
        }

        function markSelectedRow(index) {
            document.querySelectorAll('#kundenBody tr').forEach((tr) => {
                tr.classList.toggle('selected', parseInt(tr.dataset.index) === index);
            });
            document.querySelector(`#kundenBody tr[data-index="${index}"]`)?.scrollIntoView({ block: 'nearest' });
        }

        // ============================================
        // AKTIONS-FUNKTIONEN (REST-API + WebView2 Fallback)
        // ============================================
        async function neuerKunde() {
            showLoading();
            try {
                // REST-API: POST /api/kunden
                const response = await fetch('http://localhost:5000/api/kunden', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        kun_Firma: 'Neuer Kunde',
                        kun_IstAktiv: true
                    })
                });
                const result = await response.json();
                if (result.success) {
                    showToast('Neuer Kunde erstellt', 'success');
                    await loadKunden();
                    // Zum neuen Kunden navigieren
                    if (result.id) {
                        const newIndex = state.kunden.findIndex(k => k.kun_Id === result.id);
                        if (newIndex >= 0) gotoKunde(newIndex);
                    }
                } else {
                    throw new Error(result.error || 'Erstellen fehlgeschlagen');
                }
            } catch (error) {
                console.error('Fehler beim Erstellen:', error);
                showToast('Fehler: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        async function kundeLoeschen() {
            if (!state.currentRecord?.kun_Id) {
                showToast('Kein Kunde ausgewählt', 'warning');
                return;
            }
            if (!confirm('Kunde wirklich löschen?')) return;

            showLoading();
            try {
                // REST-API: DELETE /api/kunden/{id} (Soft-Delete)
                const response = await fetch(`http://localhost:5000/api/kunden/${state.currentRecord.kun_Id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                if (result.success) {
                    showToast('Kunde deaktiviert', 'success');
                    await loadKunden();
                } else {
                    throw new Error(result.error || 'Löschen fehlgeschlagen');
                }
            } catch (error) {
                console.error('Fehler beim Löschen:', error);
                showToast('Fehler: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        async function speichern() {
            if (!state.currentRecord?.kun_Id) {
                showToast('Kein Kunde ausgewählt', 'warning');
                return;
            }

            const data = {};
            document.querySelectorAll('[data-field]').forEach(el => {
                const field = el.dataset.field;
                if (el.type === 'checkbox') {
                    data[field] = el.checked;
                } else {
                    data[field] = el.value;
                }
            });

            showLoading();
            try {
                // REST-API: PUT /api/kunden/{id}
                const response = await fetch(`http://localhost:5000/api/kunden/${state.currentRecord.kun_Id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (result.success) {
                    showToast('Kunde gespeichert', 'success');
                    await loadKunden();
                } else {
                    throw new Error(result.error || 'Speichern fehlgeschlagen');
                }
            } catch (error) {
                console.error('Fehler beim Speichern:', error);
                showToast('Fehler: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        async function refreshData() {
            await loadKunden();
            showToast('Daten aktualisiert', 'success');
        }

        async function loadAufträge() {
            if (!state.currentRecord?.kun_Id) return;

            const von = document.getElementById('datAufträgeVon').value;
            const bis = document.getElementById('datAufträgeBis').value;

            Bridge.loadData('auftraege', null, {
                kunde_id: state.currentRecord.kun_Id,
                von: von,
                bis: bis
            });
        }

        Bridge.on('onAufträgeReceived', function(data) {
            const auftraege = data.auftraege || [];
            const tbody = document.getElementById('auftraegeBody');
            tbody.innerHTML = '';

            auftraege.forEach(a => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${a.ID || ''}</td>
                    <td>${escapeHtml(a.Auftrag || '')}</td>
                    <td>${formatDateShort(a.Dat_VA_Von)}</td>
                    <td>${escapeHtml(a.Objekt || '')}</td>
                    <td>${a.Veranst_Status_ID || ''}</td>
                    <td style="text-align: right;">${formatCurrency(a.Betrag)}</td>
                `;
                tr.addEventListener('click', () => {
                    Bridge.navigate('frm_va_Auftragstamm', a.ID);
                });
                tbody.appendChild(tr);
            });
        });

        function openVerrechnungssaetze() {
            if (state.currentRecord?.kun_Id) {
                Bridge.navigate('frm_KD_Verrechnungssaetze', state.currentRecord.kun_Id);
            }
        }

        function openUmsatzauswertung() {
            if (state.currentRecord?.kun_Id) {
                Bridge.navigate('frm_KD_Umsatzauswertung', state.currentRecord.kun_Id);
            }
        }

        // --- btnAuswertung_Click: Kundenpreise öffnen (VBA: DoCmd.OpenForm "frm_kundenpreise_gueni") ---
        function openKundenpreiseGueni() {
            if (!state.currentRecord?.kun_Id) {
                showToast('Bitte zuerst einen Kunden auswählen', 'warning');
                return;
            }
            console.log('[btnAuswertung] Öffne Kundenpreise für Kunde:', state.currentRecord.kun_Id);
            Bridge.navigate('frm_Kundenpreise_gueni', state.currentRecord.kun_Id);
        }

        // ============================================
        // OBJEKTE-TAB FUNKTIONEN (sub_KD_Objekte)
        // ============================================
        async function loadObjekte() {
            if (!state.currentRecord?.kun_Id) return;
            Bridge.loadData('objekte', null, { kunde_id: state.currentRecord.kun_Id });
        }

        Bridge.on('onObjekteReceived', function(data) {
            const objekte = data.objekte || [];
            const tbody = document.getElementById('objekteBody');
            tbody.innerHTML = '';

            objekte.forEach(obj => {
                const tr = document.createElement('tr');
                tr.dataset.id = obj.ob_id;
                tr.innerHTML = `
                    <td>${obj.ob_id || ''}</td>
                    <td>${escapeHtml(obj.ob_Objektname || '')}</td>
                    <td>${escapeHtml(obj.ob_Ort || '')}</td>
                    <td>${obj.ob_IstAktiv ? 'Ja' : 'Nein'}</td>
                    <td>${obj.anzahl_auftraege || 0}</td>
                `;
                tr.addEventListener('click', () => {
                    document.querySelectorAll('#objekteBody tr').forEach(r => r.classList.remove('selected'));
                    tr.classList.add('selected');
                    state.selectedObjekt = obj;
                });
                tr.addEventListener('dblclick', () => {
                    openObjekt();
                });
                tbody.appendChild(tr);
            });

            // Anzahl aktualisieren
            const countEl = document.getElementById('objekteCount');
            if (countEl) countEl.textContent = `(${objekte.length})`;
        });

        function neuesObjekt() {
            if (!state.currentRecord?.kun_Id) {
                showToast('Bitte zuerst Kunde auswählen', 'error');
                return;
            }
            // Neues Objekt mit vorausgefüllter Kunden-ID öffnen
            Bridge.navigate('frm_OB_Objekt', { kunde_id: state.currentRecord.kun_Id, mode: 'new' });
        }

        function openObjekt() {
            if (state.selectedObjekt?.ob_id) {
                Bridge.navigate('frm_OB_Objekt', state.selectedObjekt.ob_id);
            } else {
                showToast('Bitte zuerst Objekt auswählen', 'info');
            }
        }

        // ============================================
        // ANSPRECHPARTNER-TAB FUNKTIONEN
        // ============================================
        let selectedAnsprechpartnerId = null;
        let ansprechpartnerList = [];

        async function loadAnsprechpartner() {
            const kunId = state.currentRecord?.kun_Id;
            if (!kunId) return;

            try {
                const response = await fetch(`http://localhost:5000/api/kunden/${kunId}/ansprechpartner`);
                const result = await response.json();
                ansprechpartnerList = result.data || result || [];
                renderAnsprechpartner(ansprechpartnerList);
            } catch (error) {
                console.error('Fehler beim Laden der Ansprechpartner:', error);
                // Bridge-Fallback
                Bridge.loadData('ansprechpartner', kunId);
            }
        }

        // --- cboPerson laden: Globale Personenliste fuer "Person uebernehmen" ---
        let globalPersonList = [];
        async function loadCboPerson() {
            const select = document.getElementById('cboPerson');
            if (!select) return;

            try {
                // Lade alle Personen aus der globalen Adresstabelle
                const response = await fetch('http://localhost:5000/api/adressen?limit=500');
                const result = await response.json();
                globalPersonList = result.data || result || [];

                // Dropdown befuellen
                select.innerHTML = '<option value="">-- Person wählen --</option>';
                globalPersonList.forEach(person => {
                    const option = document.createElement('option');
                    option.value = person.adr_ID;
                    const name = [person.adr_Nachname, person.adr_Vorname].filter(Boolean).join(', ');
                    option.textContent = name || `Person ${person.adr_ID}`;
                    select.appendChild(option);
                });
                console.log('[Kundenstamm] cboPerson geladen:', globalPersonList.length, 'Personen');
            } catch (error) {
                console.error('Fehler beim Laden der Personenliste:', error);
                // Fallback: Zeige Hinweis
                select.innerHTML = '<option value="">-- Laden fehlgeschlagen --</option>';
            }
        }

        function renderAnsprechpartner(records) {
            const tbody = document.getElementById('ansprechpartnerTbody');
            tbody.innerHTML = '';
            if (!records || records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; padding:20px; color:#666;">Keine Ansprechpartner vorhanden</td></tr>';
                clearAnsprechpartnerForm();
                return;
            }
            records.forEach(ap => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${ap.adr_Nachname || ''}</td>
                    <td>${ap.adr_Vorname || ''}</td>
                    <td>${ap.adr_Name1 || ''}</td>
                    <td>${ap.adr_Tel || ''}</td>
                    <td>${ap.adr_Handy || ''}</td>
                    <td>${ap.adr_eMail || ''}</td>
                `;
                tr.onclick = () => selectAnsprechpartner(ap, tr);
                if (ap.adr_ID === selectedAnsprechpartnerId) tr.classList.add('selected');
                tbody.appendChild(tr);
            });
        }

        function selectAnsprechpartner(ap, tr) {
            selectedAnsprechpartnerId = ap.adr_ID;
            document.querySelectorAll('#ansprechpartnerTbody tr').forEach(r => r.classList.remove('selected'));
            tr.classList.add('selected');

            // Detail-Formular fuellen
            const fields = ['adr_Nachname', 'adr_Vorname', 'adr_AnredeID', 'adr_akad_Grad',
                           'adr_Tel', 'adr_Handy', 'adr_eMail', 'adr_Fax', 'adr_Geburtstag', 'adr_Bemerkung'];
            fields.forEach(field => {
                const el = document.getElementById(field);
                if (el) {
                    if (field === 'adr_Geburtstag' && ap[field]) {
                        el.value = ap[field].split('T')[0];
                    } else {
                        el.value = ap[field] || '';
                    }
                }
            });
        }

        function clearAnsprechpartnerForm() {
            selectedAnsprechpartnerId = null;
            const fields = ['adr_Nachname', 'adr_Vorname', 'adr_AnredeID', 'adr_akad_Grad',
                           'adr_Tel', 'adr_Handy', 'adr_eMail', 'adr_Fax', 'adr_Geburtstag', 'adr_Bemerkung'];
            fields.forEach(field => {
                const el = document.getElementById(field);
                if (el) el.value = '';
            });
        }

        function neuerAnsprechpartner() {
            clearAnsprechpartnerForm();
            document.querySelectorAll('#ansprechpartnerTbody tr').forEach(r => r.classList.remove('selected'));
            document.getElementById('adr_Nachname').focus();
        }

        async function speichereAnsprechpartner() {
            const kunId = state.currentRecord?.kun_Id;
            if (!kunId) {
                showToast('Erst Kunde auswählen', 'error');
                return;
            }

            const data = {
                kun_Id: kunId,
                adr_Nachname: document.getElementById('adr_Nachname')?.value || '',
                adr_Vorname: document.getElementById('adr_Vorname')?.value || '',
                adr_AnredeID: parseInt(document.getElementById('adr_AnredeID')?.value) || null,
                adr_akad_Grad: document.getElementById('adr_akad_Grad')?.value || '',
                adr_Tel: document.getElementById('adr_Tel')?.value || '',
                adr_Handy: document.getElementById('adr_Handy')?.value || '',
                adr_eMail: document.getElementById('adr_eMail')?.value || '',
                adr_Fax: document.getElementById('adr_Fax')?.value || '',
                adr_Geburtstag: document.getElementById('adr_Geburtstag')?.value || null,
                adr_Bemerkung: document.getElementById('adr_Bemerkung')?.value || ''
            };

            try {
                let url, method;
                if (selectedAnsprechpartnerId) {
                    url = `http://localhost:5000/api/kunden/${kunId}/ansprechpartner/${selectedAnsprechpartnerId}`;
                    method = 'PUT';
                } else {
                    url = `http://localhost:5000/api/kunden/${kunId}/ansprechpartner`;
                    method = 'POST';
                }

                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    showToast('Ansprechpartner gespeichert', 'success');
                    loadAnsprechpartner();
                } else {
                    throw new Error('Speichern fehlgeschlagen');
                }
            } catch (error) {
                console.error('Fehler:', error);
                // Bridge-Fallback
                Bridge.sendEvent('saveAnsprechpartner', { id: selectedAnsprechpartnerId, ...data });
                setTimeout(loadAnsprechpartner, 500);
            }
        }

        function loescheAnsprechpartner() {
            if (!selectedAnsprechpartnerId) {
                showToast('Bitte erst Ansprechpartner auswählen', 'info');
                return;
            }
            if (!confirm('Ansprechpartner wirklich löschen?')) return;

            const kunId = state.currentRecord?.kun_Id;
            fetch(`http://localhost:5000/api/kunden/${kunId}/ansprechpartner/${selectedAnsprechpartnerId}`, {
                method: 'DELETE'
            }).then(() => {
                showToast('Ansprechpartner gelöscht', 'success');
                clearAnsprechpartnerForm();
                loadAnsprechpartner();
            }).catch(() => {
                Bridge.sendEvent('deleteAnsprechpartner', { id: selectedAnsprechpartnerId });
                setTimeout(() => {
                    clearAnsprechpartnerForm();
                    loadAnsprechpartner();
                }, 500);
            });
        }

        // ============================================
        // ZUSATZDATEIEN-TAB FUNKTIONEN
        // ============================================
        async function dateiHinzufuegen() {
            if (!state.currentRecord?.kun_Id) {
                showToast('Erst Kunde auswählen', 'error');
                return;
            }

            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '*/*';
            input.style.display = 'none';

            input.onchange = async (e) => {
                const file = e.target.files?.[0];
                if (!file) return;

                try {
                    showLoading();
                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('kd_id', state.currentRecord.kun_Id);
                    formData.append('tabellen_nr', 40); // TabellenNr für Kunde

                    const response = await fetch('http://localhost:5000/api/attachments/upload', {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        showToast('Datei hinzugefuegt', 'success');
                        loadZusatzdateien();
                    } else {
                        throw new Error('Upload fehlgeschlagen');
                    }
                } catch (err) {
                    showToast('Fehler beim Hochladen', 'error');
                    console.error('[Kundenstamm] Upload-Fehler:', err);
                } finally {
                    hideLoading();
                    input.remove();
                }
            };

            document.body.appendChild(input);
            input.click();
        }

        async function loadZusatzdateien() {
            if (!state.currentRecord?.kun_Id) return;

            try {
                const result = await apiCall(`/attachments?kd_id=${state.currentRecord.kun_Id}&tabellen_nr=40`);
                const dateien = result.data || [];

                const tbody = document.getElementById('dateienBody'); // 18.01.2026: ID korrigiert
                if (!tbody) return;

                tbody.innerHTML = '';
                dateien.forEach(dat => {
                    const tr = document.createElement('tr');
                    tr.dataset.id = dat.ZusatzNr;
                    tr.innerHTML = `
                        <td>${dat.Dateiname || ''}</td>
                        <td>${formatDateShort(dat.DFiledate)}</td>
                        <td style="text-align:right">${formatFileSize(dat.DLaenge)}</td>
                    `;
                    tr.addEventListener('click', () => {
                        tbody.querySelectorAll('tr').forEach(r => r.classList.remove('selected'));
                        tr.classList.add('selected');
                        state.selectedDatei = dat;
                    });
                    tr.addEventListener('dblclick', () => {
                        window.open(`http://localhost:5000/api/attachments/${dat.ZusatzNr}/download`, '_blank');
                    });
                    tbody.appendChild(tr);
                });
            } catch (e) {
                console.error('[Kundenstamm] Zusatzdateien laden fehlgeschlagen:', e);
            }
        }

        async function dateiLöschen() {
            if (!state.selectedDatei) {
                showToast('Bitte Datei auswählen', 'error');
                return;
            }

            if (!confirm(`Datei "${state.selectedDatei.Dateiname}" wirklich löschen?`)) return;

            try {
                showLoading();
                const response = await fetch(`http://localhost:5000/api/attachments/${state.selectedDatei.ZusatzNr}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showToast('Datei gelöscht', 'success');
                    state.selectedDatei = null;
                    loadZusatzdateien();
                } else {
                    throw new Error('Löschen fehlgeschlagen');
                }
            } catch (err) {
                showToast('Fehler beim Löschen', 'error');
            } finally {
                hideLoading();
            }
        }

        function formatFileSize(bytes) {
            if (!bytes) return '';
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024*1024) return (bytes/1024).toFixed(1) + ' KB';
            return (bytes/1024/1024).toFixed(1) + ' MB';
        }

        // ============================================
        // NAVIGATION
        // ============================================
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabName);
            });
            document.querySelectorAll('.tab-page').forEach(page => {
                page.classList.toggle('active', page.id === 'tab-' + tabName);
            });

            // Daten laden wenn Tab gewechselt wird
            if (state.currentRecord) {
                if (tabName === 'auftraguebersicht') {
                    loadAufträge();
                } else if (tabName === 'objekte') {
                    loadObjekte();
                } else if (tabName === 'zusatzdateien') {
                    loadZusatzdateien();
                } else if (tabName === 'ansprechpartner') {
                    loadAnsprechpartner();
                    loadCboPerson(); // Globale Personenliste fuer "Uebernehmen"-Button
                } else if (tabName === 'preise') {
                    loadKundenpreise();
                    loadPreisarten();
                }
            }
        }

        function navigateToForm(formName, recordId) {
            // WebView2 Modus
            if (window.chrome && window.chrome.webview && typeof Bridge !== 'undefined') {
                Bridge.navigate(formName, recordId);
                return;
            }
            // Verwende shell-detector.js Funktion wenn verfuegbar
            if (typeof window._shellNavigateToForm === 'function') {
                window._shellNavigateToForm(formName, recordId);
            } else if (window.parent && window.parent !== window) {
                window.parent.postMessage({ type: 'NAVIGATE', formName: formName, id: recordId }, '*');
            } else {
                var url = formName + '.html';
                if (recordId) url += '?id=' + recordId;
                window.location.href = url;
            }
        }

        function closeForm() {
            Bridge.close();
            if (!window.chrome || !window.chrome.webview) {
                window.close();
            }
        }

        // ============================================
        // HELPER-FUNKTIONEN
        // ============================================
        function formatDate(date) {
            if (!date) return '';
            const d = new Date(date);
            return d.toLocaleDateString('de-DE');
        }

        function formatDateShort(dateStr) {
            if (!dateStr) return '';
            const d = new Date(dateStr);
            return d.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: '2-digit' });
        }

        function formatDateTime(dateStr) {
            if (!dateStr) return '';
            const d = new Date(dateStr);
            return d.toLocaleString('de-DE');
        }

        function formatCurrency(value) {
            if (!value) return '';
            const num = parseFloat(value);
            return num.toFixed(2).replace('.', ',') + ' EUR';
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast ' + type;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Vollbild-Toggle Funktion (Browser Fullscreen API)
        function toggleFullscreen() {
            const btn = document.getElementById('fullscreenBtn');
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().then(() => {
                    btn.title = 'Vollbild beenden';
                }).catch(err => console.error('Fullscreen error:', err));
            } else {
                document.exitFullscreen().then(() => {
                    btn.title = 'Vollbild';
                }).catch(err => console.error('Exit fullscreen error:', err));
            }
        }

        document.addEventListener('fullscreenchange', () => {
            const btn = document.getElementById('fullscreenBtn');
            btn.title = document.fullscreenElement ? 'Vollbild beenden' : 'Vollbild';
        });

        console.log('[Kundenstammblatt] Script geladen');

        // ============================================
        // FEHLENDE ACCESS VBA EVENT-HANDLER
        // Implementiert basierend auf frm_KD_Kundenstamm.txt
        // ============================================

        // --- Form_Current equivalent: Umsatz-Statistiken laden ---
        async function loadKundenStatistik() {
            if (!state.currentRecord?.kun_Id) return;

            try {
                Bridge.loadData('kundenStatistik', state.currentRecord.kun_Id);
            } catch (e) {
                console.warn('[Kundenstamm] Statistik-Laden fehlgeschlagen:', e);
            }
        }

        Bridge.on('onKundenStatistikReceived', function(data) {
            // KD_Ges = Gesamt-Umsatz
            state.KD_Ges = data.KD_Ges || 0;
            // KD_VJ = Vorjahr
            state.KD_VJ = data.KD_VJ || 0;
            // KD_LJ = Laufendes Jahr
            state.KD_LJ = data.KD_LJ || 0;
            // KD_LM = Laufender Monat
            state.KD_LM = data.KD_LM || 0;

            // UI aktualisieren wenn Elemente vorhanden
            updateStatistikDisplay();
        });

        function updateStatistikDisplay() {
            const kdGesEl = document.getElementById('KD_Ges');
            const kdVJEl = document.getElementById('KD_VJ');
            const kdLJEl = document.getElementById('KD_LJ');
            const kdLMEl = document.getElementById('KD_LM');

            if (kdGesEl) kdGesEl.textContent = formatCurrency(state.KD_Ges);
            if (kdVJEl) kdVJEl.textContent = formatCurrency(state.KD_VJ);
            if (kdLJEl) kdLJEl.textContent = formatCurrency(state.KD_LJ);
            if (kdLMEl) kdLMEl.textContent = formatCurrency(state.KD_LM);
        }

        // --- kun_IstAktiv_AfterUpdate: Automatisches Speichern bei Aktiv-Änderung ---
        function onKunIstAktivChange() {
            if (!state.currentRecord?.kun_Id) return;

            // Automatisch speichern wie in VBA: DoCmd.RunCommand acCmdSaveRecord
            speichern();
        }

        // --- IstAlle_AfterUpdate: Alle/Nur Aktive Toggle ---
        function toggleAlleAnzeigen() {
            const checkbox = document.getElementById('chkNurAktive');
            const isAlle = !checkbox.checked;

            // Label aktualisieren (wie in VBA)
            const label = document.querySelector('label[for="chkNurAktive"]');
            if (label) {
                label.textContent = isAlle ? 'Alle anzeigen' : 'Nur Aktive';
            }

            loadKunden();
        }

        // --- btnAlle_Click: Auswahlfilter zurücksetzen ---
        function resetAuswahlfilter() {
            // Alle Filter zurücksetzen (wie in VBA: btnAlle_Click)
            const cboSuchOrt = document.getElementById('cboSuchOrt');
            const cboSuchPLZ = document.getElementById('cboSuchPLZ');
            const cboSuchSuchF = document.getElementById('cboSuchSuchF');
            const searchInput = document.getElementById('searchInput');

            if (cboSuchOrt) cboSuchOrt.value = '_ALLE';
            if (cboSuchPLZ) cboSuchPLZ.value = '_ALLE';
            if (cboSuchSuchF) cboSuchSuchF.value = '_ALLE';
            if (searchInput) searchInput.value = '';

            loadKunden();
            showToast('Filter zurückgesetzt', 'info');
        }

        // ============================================
        // KARTENANSICHT FUNKTIONEN
        // ============================================

        // Aktuelle Adresse fuer Karte speichern
        let currentKdMapAddress = '';

        /**
         * Karte mit Kundenadresse laden (Google Maps Embed)
         * @param {string} strasse - Strassenname
         * @param {string} plz - Postleitzahl
         * @param {string} ort - Stadt/Ort
         * @param {string} land - Laenderkennzeichen (DE, AT, CH)
         */
        function loadKdMap(strasse, plz, ort, land) {
            const mapContainer = document.getElementById('kdMapContainer');
            const mapFrame = document.getElementById('kdMapFrame');
            const mapPlaceholder = document.getElementById('kdMapPlaceholder');

            if (!mapContainer || !mapFrame || !mapPlaceholder) {
                console.warn('[Map] Map-Container nicht gefunden');
                return;
            }

            // Pruefe ob Adresse vorhanden
            if (!ort && !plz) {
                // Keine Adresse - Placeholder zeigen
                mapPlaceholder.style.display = 'flex';
                mapFrame.style.display = 'none';
                mapFrame.src = '';
                currentKdMapAddress = '';
                return;
            }

            // Adresse zusammenbauen
            const addressParts = [];
            if (strasse) {
                addressParts.push(strasse);
            }
            if (plz || ort) {
                addressParts.push([plz, ort].filter(Boolean).join(' '));
            }
            // Land aus Laenderkennzeichen
            const laenderMap = { 'DE': 'Deutschland', 'AT': 'Oesterreich', 'CH': 'Schweiz' };
            addressParts.push(laenderMap[land] || 'Deutschland');

            const address = addressParts.join(', ');
            currentKdMapAddress = address;

            // Google Maps Embed URL (ohne API-Key)
            const encodedAddress = encodeURIComponent(address);
            const mapUrl = `https://maps.google.com/maps?q=${encodedAddress}&output=embed&z=15`;

            console.log('[Map] Lade Karte fuer Kunde:', address);

            // Karte laden
            mapPlaceholder.style.display = 'none';
            mapFrame.style.display = 'block';
            mapFrame.src = mapUrl;
        }

        /**
         * Oeffnet Google Maps im neuen Tab mit der Kundenadresse
         */
        function openKdMapsFullscreen() {
            if (!currentKdMapAddress) {
                // Versuche Adresse aus aktuellen Feldern zu holen
                const strasse = document.getElementById('kun_Strasse')?.value || '';
                const plz = document.getElementById('kun_PLZ')?.value || '';
                const ort = document.getElementById('kun_Ort')?.value || '';
                const land = document.getElementById('kun_LKZ')?.value || 'DE';

                if (!ort && !plz) {
                    showToast('Keine Adresse vorhanden', 'warning');
                    return;
                }

                const addressParts = [];
                if (strasse) addressParts.push(strasse);
                if (plz || ort) addressParts.push([plz, ort].filter(Boolean).join(' '));
                const laenderMap = { 'DE': 'Deutschland', 'AT': 'Oesterreich', 'CH': 'Schweiz' };
                addressParts.push(laenderMap[land] || 'Deutschland');
                currentKdMapAddress = addressParts.join(', ');
            }

            // Google Maps in neuem Tab oeffnen
            const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(currentKdMapAddress)}`;
            window.open(url, '_blank');
        }

        // --- cboSuchOrt_AfterUpdate: Filter nach Ort ---
        function filterByOrt(ort) {
            if (!ort || ort === '_ALLE') {
                loadKunden();
                return;
            }

            // Lokale Filterung
            const filtered = state.kundenList.filter(k =>
                (k.kun_Ort || '').toLowerCase() === ort.toLowerCase()
            );

            if (filtered.length > 0) {
                renderFilteredList(filtered);
                showToast(`${filtered.length} Kunden in ${ort}`, 'info');
            } else {
                showToast('Keine Kunden in ' + ort, 'warning');
            }
        }

        // --- cboSuchPLZ_AfterUpdate: Filter nach PLZ ---
        function filterByPLZ(plz) {
            if (!plz || plz === '_ALLE') {
                loadKunden();
                return;
            }

            const filtered = state.kundenList.filter(k =>
                (k.kun_PLZ || '').startsWith(plz)
            );

            if (filtered.length > 0) {
                renderFilteredList(filtered);
                showToast(`${filtered.length} Kunden mit PLZ ${plz}`, 'info');
            } else {
                showToast('Keine Kunden mit PLZ ' + plz, 'warning');
            }
        }

        // --- cboSuchSuchF_AfterUpdate: Filter nach Sortfeld/Kategorie (VBA: kun_Sortfeld) ---
        function filterBySortfeld(sortfeld) {
            // Reset andere Filter
            const cboSuchOrt = document.getElementById('cboSuchOrt');
            const cboSuchPLZ = document.getElementById('cboSuchPLZ');
            if (cboSuchOrt) cboSuchOrt.value = '_ALLE';
            if (cboSuchPLZ) cboSuchPLZ.value = '_ALLE';

            if (!sortfeld || sortfeld === '_ALLE') {
                loadKunden();
                return;
            }

            console.log('[cboSuchSuchF] Filter nach Sortfeld:', sortfeld);

            const filtered = state.kundenList.filter(k =>
                (k.kun_Sortfeld || '') === sortfeld
            );

            if (filtered.length > 0) {
                renderFilteredList(filtered);
                showToast(`${filtered.length} Kunden mit Sortfeld "${sortfeld}"`, 'info');
            } else {
                showToast('Keine Kunden mit Sortfeld ' + sortfeld, 'warning');
                loadKunden(); // Fallback: Alle laden
            }
        }

        function renderFilteredList(filteredList) {
            const tbody = document.getElementById('kundenBody');
            tbody.innerHTML = '';

            filteredList.forEach((kunde, index) => {
                const tr = document.createElement('tr');
                tr.dataset.index = index;
                tr.innerHTML = `
                    <td>${kunde.kun_Id || ''}</td>
                    <td>${escapeHtml(kunde.kun_Firma || '')}</td>
                    <td>${escapeHtml(kunde.kun_Ort || '')}</td>
                    <td>${escapeHtml(kunde.kun_telefon || '')}</td>
                `;
                tr.addEventListener('click', () => {
                    state.currentIndex = state.kundenList.findIndex(k => k.kun_Id === kunde.kun_Id);
                    showRecord(state.currentIndex);
                });
                tbody.appendChild(tr);
            });

            document.getElementById('lblRecordInfo').textContent =
                `Gefiltert: ${filteredList.length} von ${state.kundenList.length}`;
        }

        // --- btnAuftrag_Click: Neue Auftragserfassung öffnen ---
        function openNeuerAuftrag() {
            if (!state.currentRecord?.kun_Id) {
                showToast('Bitte zuerst Kunde auswählen', 'warning');
                return;
            }

            // OpenArgs wie in VBA: "Kde" & kun_ID
            Bridge.navigate('frmHlp_AuftragsErfassung', {
                openArgs: 'Kde' + state.currentRecord.kun_Id,
                kunde_id: state.currentRecord.kun_Id
            });
        }

        // --- btnOutlook_Click: Outlook öffnen ---
        function openOutlook() {
            if (!state.currentRecord?.kun_Id) {
                showToast('Bitte zuerst Kunde auswählen', 'warning');
                return;
            }

            Bridge.navigate('frmOff_Outlook_aufrufen', {
                openArgs: 'frm_KD_Kundenstamm',
                email: state.currentRecord.kun_email || ''
            });
        }

        // --- btnWord_Click: Word öffnen ---
        function openWord() {
            if (!state.currentRecord?.kun_Id) {
                showToast('Bitte zuerst Kunde auswählen', 'warning');
                return;
            }

            Bridge.navigate('frmOff_WinWord_aufrufen', {
                openArgs: 'frm_KD_Kundenstamm'
            });
        }

        // --- btnPersonUebernehmen_Click: Ansprechpartner uebernehmen ---
        // VBA: INSERT INTO _tbl_AdrZuord (TabellenNr=40 fuer Kunde, Stamm_ID=kun_ID, Adr_ID=Person_ID)
        async function personUebernehmen() {
            const cboPerson = document.getElementById('cboPerson');
            if (!cboPerson || !cboPerson.value) {
                showToast('Bitte Person auswählen', 'warning');
                return;
            }

            if (!state.currentRecord?.kun_Id) {
                showToast('Kein Kunde ausgewaehlt', 'warning');
                return;
            }

            const kundeId = state.currentRecord.kun_Id;
            const personId = parseInt(cboPerson.value);
            const tabellenNr = 40; // TabellenNr fuer Kunde in _tbl_AdrZuord

            showToast('Person wird zugeordnet...', 'info');

            try {
                // REST-API: Adresszuordnung erstellen
                const response = await fetch(`http://localhost:5000/api/kunden/${kundeId}/ansprechpartner`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        adr_id: personId,
                        tabellen_nr: tabellenNr
                    })
                });

                if (response.ok) {
                    showToast('Person zugeordnet', 'success');
                    cboPerson.value = ''; // Dropdown zuruecksetzen
                    loadAnsprechpartner(); // Liste aktualisieren
                } else {
                    throw new Error('API-Fehler');
                }
            } catch (error) {
                console.warn('[personUebernehmen] REST-API Fehler, verwende Bridge:', error);
                // Fallback: Bridge fuer WebView2/Access
                if (typeof Bridge !== 'undefined' && Bridge.sendEvent) {
                    Bridge.sendEvent('personUebernehmen', {
                        kunde_id: kundeId,
                        person_id: personId,
                        tabellen_nr: tabellenNr
                    });
                } else {
                    showToast('Fehler beim Zuordnen der Person', 'error');
                }
            }
        }

        Bridge.on('onPersonUebernommen', function() {
            showToast('Person zugeordnet', 'success');
            document.getElementById('cboPerson').value = '';
            loadAnsprechpartner();
        });

        // --- kun_AdressArt_DblClick: Adressart-Dialog öffnen ---
        function openAdressartDialog() {
            Bridge.navigate('frmTop_KD_Adressart');
        }

        // --- IstAuftragsArt_AfterUpdate: Auftragsfilter ändern ---
        function filterAuftragsart(art) {
            if (!state.currentRecord?.kun_Id) return;

            // Art: 1=Alle, 2=Miete, 3=Verkauf, 4=Reparatur, 5=Datum
            Bridge.loadData('auftraege', null, {
                kunde_id: state.currentRecord.kun_Id,
                auftragsart: art
            });
        }

        // --- btnDate_Click: Datumsfilter aktivieren ---
        function activateDatumsfilter() {
            const datVon = document.getElementById('datAufträgeVon');
            const datBis = document.getElementById('datAufträgeBis');

            if (datVon) datVon.focus();

            // Setze Auftragsart auf "Datum" (5)
            filterAuftragsart(5);
        }

        // --- fReadDoc: PDF-Dokumente öffnen (Rechnung, Berechnungsliste, Einsatzliste) ---
        function openRechnungPDF() {
            if (!state.currentRecord?.kun_Id) {
                showToast('Kein Kunde ausgewaehlt', 'warning');
                return;
            }
            Bridge.sendEvent('openDocument', { type: 'rechnung', kunde_id: state.currentRecord.kun_Id });
        }

        function openBerechnungslistePDF() {
            if (!state.currentRecord?.kun_Id) {
                showToast('Kein Kunde ausgewaehlt', 'warning');
                return;
            }
            Bridge.sendEvent('openDocument', { type: 'berechnungsliste', kunde_id: state.currentRecord.kun_Id });
        }

        function openEinsatzlistePDF() {
            if (!state.currentRecord?.kun_Id) {
                showToast('Kein Kunde ausgewaehlt', 'warning');
                return;
            }
            Bridge.sendEvent('openDocument', { type: 'einsatzliste', kunde_id: state.currentRecord.kun_Id });
        }

        // --- Form_BeforeUpdate: Änderungsdatum setzen ---
        function setÄnderungsdaten() {
            // Wird automatisch beim Speichern aufgerufen
            const now = new Date();
            document.getElementById('geaendertAm').textContent = formatDateTime(now);

            // Benutzer wird vom Backend gesetzt
        }

        // --- Navigation Buttons (Befehl39-43) ---
        function gotoFirstRecord() {
            if (state.kundenList.length > 0) {
                showRecord(0);
            }
        }

        function gotoPrevRecord() {
            if (state.currentIndex > 0) {
                showRecord(state.currentIndex - 1);
            }
        }

        function gotoNextRecord() {
            if (state.currentIndex < state.kundenList.length - 1) {
                showRecord(state.currentIndex + 1);
            }
        }

        function gotoLastRecord() {
            if (state.kundenList.length > 0) {
                showRecord(state.kundenList.length - 1);
            }
        }

        // --- Ansprechpartner laden (sub_Ansprechpartner) ---
        async function loadAnsprechpartner() {
            if (!state.currentRecord?.kun_Id) return;

            Bridge.loadData('ansprechpartner', null, {
                kunde_id: state.currentRecord.kun_Id
            });
        }

        Bridge.on('onAnsprechpartnerReceived', function(data) {
            const partner = data.ansprechpartner || [];
            // Hier koennte eine Ansprechpartner-Tabelle befuellt werden
            console.log('[Kundenstamm] Ansprechpartner geladen:', partner.length);
        });

        // --- Standardleistungen anlegen (wie in VBA) ---
        function standardleistungenAnlegen() {
            if (!state.currentRecord?.kun_Id) return;

            Bridge.sendEvent('standardleistungenAnlegen', {
                kunde_id: state.currentRecord.kun_Id
            });
        }

        // ============================================
        // KUNDENPREISE-TAB FUNKTIONEN (pgPreise / sub_KD_Standardpreise)
        // ============================================
        let selectedPreisId = null;
        let kundenpreiseList = [];
        let preisartenList = [];

        // Kundenpreise laden
        async function loadKundenpreise() {
            const kunId = state.currentRecord?.kun_Id;
            if (!kunId) return;

            try {
                const response = await fetch(`http://localhost:5000/api/kunden/${kunId}/preise`);
                const result = await response.json();
                kundenpreiseList = result.data || result || [];
                renderKundenpreise(kundenpreiseList);
            } catch (error) {
                console.error('Fehler beim Laden der Kundenpreise:', error);
                // Bridge-Fallback
                Bridge.loadData('kundenpreise', kunId);
            }
        }

        // Preisarten fuer Dropdown laden (aus tbl_KD_Artikelbeschreibung)
        async function loadPreisarten() {
            try {
                const response = await fetch('http://localhost:5000/api/preisarten');
                const result = await response.json();
                preisartenList = result.data || result || [];
                renderPreisartenDropdown();
            } catch (error) {
                console.error('Fehler beim Laden der Preisarten:', error);
                // Bridge-Fallback
                Bridge.loadData('preisarten');
            }
        }

        function renderPreisartenDropdown() {
            const select = document.getElementById('preis_Preisart_ID');
            if (!select) return;

            // Bestehende Optionen (ausser erste) entfernen
            while (select.options.length > 1) {
                select.remove(1);
            }

            preisartenList.forEach(art => {
                const option = document.createElement('option');
                option.value = art.ID;
                option.textContent = art.Beschreibung || art.Bezeichnung || `Art ${art.ID}`;
                select.appendChild(option);
            });
        }

        Bridge.on('onPreisartenReceived', function(data) {
            preisartenList = data.preisarten || [];
            renderPreisartenDropdown();
        });

        function renderKundenpreise(records) {
            const tbody = document.getElementById('kundenpreiseBody');
            if (!tbody) return;

            tbody.innerHTML = '';
            if (!records || records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:20px; color:#666;">Keine Kundenpreise vorhanden. Klicken Sie auf "Standardpreise anlegen" um Preise zu erstellen.</td></tr>';
                clearPreisForm();
                return;
            }

            records.forEach((preis, index) => {
                const tr = document.createElement('tr');
                tr.dataset.id = preis.ID;
                tr.innerHTML = `
                    <td style="text-align: center;">${index + 1}</td>
                    <td>${escapeHtml(preis.Bezeichnung || getPreisartBezeichnung(preis.Preisart_ID) || '')}</td>
                    <td style="text-align: right;">${formatEuro(preis.StdPreis)}</td>
                    <td style="text-align: right;">${formatEuro(preis.TagPreis)}</td>
                    <td style="text-align: right;">${preis.Nachtzuschlag ? preis.Nachtzuschlag + ' %' : '-'}</td>
                    <td>${escapeHtml(preis.Bemerkung || '')}</td>
                    <td>${formatDateShort(preis.GeaendertAm)}</td>
                `;
                tr.onclick = () => selectPreis(preis, tr);
                tr.ondblclick = () => editPreisInline(preis, tr);
                if (preis.ID === selectedPreisId) tr.classList.add('selected');
                tbody.appendChild(tr);
            });
        }

        function getPreisartBezeichnung(preisartId) {
            if (!preisartId) return '';
            const art = preisartenList.find(a => a.ID === preisartId);
            return art ? (art.Beschreibung || art.Bezeichnung) : '';
        }

        function formatEuro(value) {
            if (value === null || value === undefined || value === '') return '-';
            const num = parseFloat(value);
            if (isNaN(num)) return '-';
            return num.toFixed(2).replace('.', ',') + ' EUR';
        }

        Bridge.on('onKundenpreiseReceived', function(data) {
            kundenpreiseList = data.kundenpreise || data.preise || [];
            renderKundenpreise(kundenpreiseList);
        });

        function selectPreis(preis, tr) {
            selectedPreisId = preis.ID;
            document.querySelectorAll('#kundenpreiseBody tr').forEach(r => r.classList.remove('selected'));
            tr.classList.add('selected');

            // Detail-Formular befuellen
            const preisartSelect = document.getElementById('preis_Preisart_ID');
            if (preisartSelect) preisartSelect.value = preis.Preisart_ID || '';

            document.getElementById('preis_Bemerkung').value = preis.Bemerkung || '';
            document.getElementById('preis_StdPreis').value = preis.StdPreis || '';
            document.getElementById('preis_TagPreis').value = preis.TagPreis || '';
            document.getElementById('preis_Nachtzuschlag').value = preis.Nachtzuschlag || '';
        }

        function clearPreisForm() {
            selectedPreisId = null;
            document.getElementById('preis_Preisart_ID').value = '';
            document.getElementById('preis_Bemerkung').value = '';
            document.getElementById('preis_StdPreis').value = '';
            document.getElementById('preis_TagPreis').value = '';
            document.getElementById('preis_Nachtzuschlag').value = '';
        }

        function neuerPreis() {
            clearPreisForm();
            document.querySelectorAll('#kundenpreiseBody tr').forEach(r => r.classList.remove('selected'));
            document.getElementById('preis_Preisart_ID').focus();
        }

        async function speicherePreis() {
            const kunId = state.currentRecord?.kun_Id;
            if (!kunId) {
                showToast('Erst Kunde auswaehlen', 'error');
                return;
            }

            const preisartId = document.getElementById('preis_Preisart_ID')?.value;
            if (!preisartId) {
                showToast('Bitte Preisart auswaehlen', 'warning');
                return;
            }

            const data = {
                kun_ID: kunId,
                Preisart_ID: parseInt(preisartId),
                Bemerkung: document.getElementById('preis_Bemerkung')?.value || '',
                StdPreis: parseFloat(document.getElementById('preis_StdPreis')?.value) || null,
                TagPreis: parseFloat(document.getElementById('preis_TagPreis')?.value) || null,
                Nachtzuschlag: parseFloat(document.getElementById('preis_Nachtzuschlag')?.value) || null,
                GeaendertAm: new Date().toISOString(),
                Aenderer: 'HTML-Form'
            };

            try {
                let url, method;
                if (selectedPreisId) {
                    url = `http://localhost:5000/api/kunden/${kunId}/preise/${selectedPreisId}`;
                    method = 'PUT';
                } else {
                    url = `http://localhost:5000/api/kunden/${kunId}/preise`;
                    method = 'POST';
                }

                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    showToast('Preis gespeichert', 'success');
                    loadKundenpreise();
                } else {
                    throw new Error('Speichern fehlgeschlagen');
                }
            } catch (error) {
                console.error('Fehler:', error);
                // Bridge-Fallback
                Bridge.sendEvent('saveKundenpreis', { id: selectedPreisId, ...data });
                showToast('Preis wird gespeichert...', 'info');
                setTimeout(loadKundenpreise, 500);
            }
        }

        async function preisLoeschen() {
            if (!selectedPreisId) {
                showToast('Bitte erst Preis auswaehlen', 'info');
                return;
            }
            if (!confirm('Preis wirklich loeschen?')) return;

            const kunId = state.currentRecord?.kun_Id;
            try {
                const response = await fetch(`http://localhost:5000/api/kunden/${kunId}/preise/${selectedPreisId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showToast('Preis geloescht', 'success');
                    clearPreisForm();
                    loadKundenpreise();
                } else {
                    throw new Error('Loeschen fehlgeschlagen');
                }
            } catch (error) {
                console.error('Fehler:', error);
                Bridge.sendEvent('deleteKundenpreis', { id: selectedPreisId });
                setTimeout(() => {
                    clearPreisForm();
                    loadKundenpreise();
                }, 500);
            }
        }

        // Standardpreise aus tbl_KD_Artikelbeschreibung fuer diesen Kunden anlegen
        async function standardpreiseAnlegen() {
            const kunId = state.currentRecord?.kun_Id;
            if (!kunId) {
                showToast('Erst Kunde auswaehlen', 'error');
                return;
            }

            if (!confirm('Standardpreise fuer diesen Kunden anlegen? Bestehende Preise bleiben erhalten.')) return;

            showLoading();
            try {
                const response = await fetch(`http://localhost:5000/api/kunden/${kunId}/preise/standard`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                    const result = await response.json();
                    showToast(`${result.count || 'Standardpreise'} Preise angelegt`, 'success');
                    loadKundenpreise();
                } else {
                    throw new Error('Standardpreise anlegen fehlgeschlagen');
                }
            } catch (error) {
                console.error('Fehler:', error);
                // Bridge-Fallback
                Bridge.sendEvent('standardpreiseAnlegen', { kunde_id: kunId });
                showToast('Standardpreise werden angelegt...', 'info');
                setTimeout(loadKundenpreise, 1000);
            } finally {
                hideLoading();
            }
        }

        Bridge.on('onStandardpreiseAngelegt', function(data) {
            showToast('Standardpreise angelegt', 'success');
            loadKundenpreise();
        });

        // Inline-Editing fuer Preise (Doppelklick)
        function editPreisInline(preis, tr) {
            // Preis auswaehlen und Focus auf StdPreis setzen
            selectPreis(preis, tr);
            document.getElementById('preis_StdPreis').focus();
            document.getElementById('preis_StdPreis').select();
        }

        // --- Dirty-State tracken ---
        function setupDirtyTracking() {
            document.querySelectorAll('[data-field]').forEach(el => {
                el.addEventListener('change', () => {
                    state.isDirty = true;
                });
                if (el.type !== 'checkbox') {
                    el.addEventListener('input', () => {
                        state.isDirty = true;
                    });
                }
            });
        }

        // --- Keyboard Shortcuts (wie in Access) ---
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey) {
                    switch(e.key.toLowerCase()) {
                        case 's':
                            e.preventDefault();
                            speichern();
                            break;
                        case 'n':
                            e.preventDefault();
                            neuerKunde();
                            break;
                        case 'f':
                            e.preventDefault();
                            document.getElementById('searchInput')?.focus();
                            break;
                    }
                }

                // Navigation ohne Ctrl
                if (e.key === 'F5') {
                    e.preventDefault();
                    refreshData();
                }
            });
        }

        // --- Init erweitern ---
        (function extendInit() {
            const originalOnLoad = window.onload || function(){};
            window.addEventListener('load', function() {
                setupDirtyTracking();
                setupKeyboardShortcuts();

                // Event-Listener für kun_IstAktiv Checkbox
                const kunIstAktiv = document.getElementById('kun_IstAktiv');
                if (kunIstAktiv) {
                    kunIstAktiv.addEventListener('change', onKunIstAktivChange);
                }
            });
        })();

        // ============================================
        // GLOBALE FUNKTIONEN FUER BUTTON ONCLICK
        // ============================================
        window.gotoFirstRecord = gotoFirstRecord;
        window.gotoPrevRecord = gotoPrevRecord;
        window.gotoNextRecord = gotoNextRecord;
        window.gotoLastRecord = gotoLastRecord;
        window.resetAuswahlfilter = resetAuswahlfilter;
        window.openNeuerAuftrag = openNeuerAuftrag;
        window.openOutlook = openOutlook;
        window.openWord = openWord;
        window.personUebernehmen = personUebernehmen;
        window.loadCboPerson = loadCboPerson;
        window.openAdressartDialog = openAdressartDialog;
        window.activateDatumsfilter = activateDatumsfilter;
        window.openRechnungPDF = openRechnungPDF;
        window.openBerechnungslistePDF = openBerechnungslistePDF;
        window.openEinsatzlistePDF = openEinsatzlistePDF;
        window.filterByOrt = filterByOrt;
        window.filterByPLZ = filterByPLZ;
        window.filterBySortfeld = filterBySortfeld;
        window.filterAuftragsart = filterAuftragsart;
        window.dateiLöschen = dateiLöschen;
        // btnAuswertung -> Kundenpreise Gueni
        window.openKundenpreiseGueni = openKundenpreiseGueni;
        // Karten-Funktionen
        window.loadKdMap = loadKdMap;
        window.openKdMapsFullscreen = openKdMapsFullscreen;
        // Kundenpreise-Funktionen
        window.loadKundenpreise = loadKundenpreise;
        window.standardpreiseAnlegen = standardpreiseAnlegen;
        window.neuerPreis = neuerPreis;
        window.speicherePreis = speicherePreis;
        window.preisLoeschen = preisLoeschen;

        // ============================================
        // cboKDNrSuche: Direkte Kunden-Nummer Suche
        // ============================================
        function sucheKundeNr() {
            const input = document.getElementById('cboKDNrSuche');
            const kdNr = parseInt(input?.value);

            if (!kdNr || isNaN(kdNr)) {
                showToast('Bitte gueltige Kunden-Nr. eingeben', 'warning');
                input?.focus();
                return;
            }

            // In der Liste suchen
            const index = state.kundenList.findIndex(k => k.kun_Id === kdNr);

            if (index >= 0) {
                showRecord(index);
                showToast(`Kunde ${kdNr} gefunden`, 'success');
            } else {
                // Versuche direkt vom Server zu laden
                Bridge.loadData('kunde', kdNr);
                showToast(`Suche Kunde ${kdNr}...`, 'info');
            }

            input.value = '';
        }

        window.sucheKundeNr = sucheKundeNr;

        // ============================================
        // Haupt-Ansprechpartner Dropdown (kun_IDF_PersonID)
        // ============================================
        let hauptAnsprechpartnerList = [];

        async function loadHauptAnsprechpartnerDropdown() {
            const kunId = state.currentRecord?.kun_Id;
            if (!kunId) return;

            const select = document.getElementById('kun_IDF_PersonID');
            if (!select) return;

            try {
                const response = await fetch(`http://localhost:5000/api/kunden/${kunId}/ansprechpartner`);
                const result = await response.json();
                hauptAnsprechpartnerList = result.data || result || [];

                // Dropdown befuellen
                select.innerHTML = '<option value="">-- Ansprechpartner waehlen --</option>';
                hauptAnsprechpartnerList.forEach(ap => {
                    const option = document.createElement('option');
                    option.value = ap.adr_ID;
                    option.textContent = `${ap.adr_Nachname || ''} ${ap.adr_Vorname || ''}`.trim() || `AP ${ap.adr_ID}`;
                    select.appendChild(option);
                });

                // Aktuellen Wert setzen falls vorhanden
                if (state.currentRecord?.kun_IDF_PersonID) {
                    select.value = state.currentRecord.kun_IDF_PersonID;
                    // Kontaktdaten laden
                    updateHauptAnsprechpartnerFelder(state.currentRecord.kun_IDF_PersonID);
                }
            } catch (error) {
                console.error('Fehler beim Laden der Ansprechpartner fuer Dropdown:', error);
                // Bridge-Fallback
                Bridge.loadData('ansprechpartner', null, { kunde_id: kunId });
            }
        }

        function onHauptAnsprechpartnerChange() {
            const select = document.getElementById('kun_IDF_PersonID');
            const personId = select?.value ? parseInt(select.value) : null;

            updateHauptAnsprechpartnerFelder(personId);
            state.isDirty = true;
        }

        function updateHauptAnsprechpartnerFelder(personId) {
            const adrTelefon = document.getElementById('adr_telefon');
            const adrMobil = document.getElementById('adr_mobil');
            const adrEmail = document.getElementById('adr_email_haupt');

            if (!personId) {
                if (adrTelefon) adrTelefon.value = '';
                if (adrMobil) adrMobil.value = '';
                if (adrEmail) adrEmail.value = '';
                return;
            }

            const ap = hauptAnsprechpartnerList.find(a => a.adr_ID === personId);
            if (ap) {
                if (adrTelefon) adrTelefon.value = ap.adr_Tel || '';
                if (adrMobil) adrMobil.value = ap.adr_Handy || '';
                if (adrEmail) adrEmail.value = ap.adr_eMail || '';
            }
        }

        window.onHauptAnsprechpartnerChange = onHauptAnsprechpartnerChange;

        // ============================================
        // ANGEBOTE-TAB FUNKTIONEN (pg_Ang / sub_Rch_Kopf_Ang)
        // ============================================
        let angeboteList = [];
        let selectedAngebotId = null;

        async function loadAngebote() {
            const kunId = state.currentRecord?.kun_Id;
            if (!kunId) return;

            const tbody = document.getElementById('angeboteBody');
            if (tbody) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; color:#666; padding:20px;">Lade Angebote...</td></tr>';
            }

            try {
                const response = await fetch(`http://localhost:5000/api/kunden/${kunId}/angebote`);
                const result = await response.json();
                angeboteList = result.data || result || [];
                renderAngebote(angeboteList);
            } catch (error) {
                console.error('Fehler beim Laden der Angebote:', error);
                // Bridge-Fallback
                Bridge.loadData('angebote', null, { kunde_id: kunId });

                // Demo-Daten als Fallback
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; color:#999; padding:20px;">API nicht erreichbar - keine Angebote verfuegbar</td></tr>';
                }
            }
        }

        function renderAngebote(records) {
            const tbody = document.getElementById('angeboteBody');
            if (!tbody) return;

            tbody.innerHTML = '';

            if (!records || records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; color:#666; padding:20px;">Keine Angebote vorhanden</td></tr>';
                updateAngeboteSummen(0, 0);
                return;
            }

            let gesamtwert = 0;

            records.forEach(ang => {
                const tr = document.createElement('tr');
                tr.dataset.id = ang.ID || ang.ang_ID;
                tr.innerHTML = `
                    <td>${formatDateShort(ang.Datum || ang.ang_Datum)}</td>
                    <td>${escapeHtml(ang.Nummer || ang.ang_Nummer || '')}</td>
                    <td>${escapeHtml(ang.Bezeichnung || ang.ang_Bezeichnung || '')}</td>
                    <td style="text-align: right;">${formatEuro(ang.Betrag || ang.ang_Betrag)}</td>
                    <td>${getAngebotStatusText(ang.Status || ang.ang_Status)}</td>
                    <td>${formatDateShort(ang.GueltigBis || ang.ang_GueltigBis)}</td>
                `;
                tr.onclick = () => selectAngebot(ang, tr);
                tr.ondblclick = () => openAngebot(ang);
                if ((ang.ID || ang.ang_ID) === selectedAngebotId) tr.classList.add('selected');
                tbody.appendChild(tr);

                gesamtwert += parseFloat(ang.Betrag || ang.ang_Betrag || 0);
            });

            updateAngeboteSummen(records.length, gesamtwert);
        }

        function getAngebotStatusText(status) {
            const statusMap = {
                0: 'Offen',
                1: 'Angenommen',
                2: 'Abgelehnt',
                3: 'Abgelaufen'
            };
            return statusMap[status] || status || 'Offen';
        }

        function updateAngeboteSummen(anzahl, gesamtwert) {
            const anzahlEl = document.getElementById('angeboteAnzahl');
            const gesamtwertEl = document.getElementById('angeboteGesamtwert');

            if (anzahlEl) anzahlEl.textContent = anzahl;
            if (gesamtwertEl) gesamtwertEl.textContent = formatEuro(gesamtwert);
        }

        function selectAngebot(ang, tr) {
            selectedAngebotId = ang.ID || ang.ang_ID;
            document.querySelectorAll('#angeboteBody tr').forEach(r => r.classList.remove('selected'));
            tr.classList.add('selected');
        }

        function openAngebot(ang) {
            const angId = ang?.ID || ang?.ang_ID || selectedAngebotId;
            if (angId) {
                Bridge.navigate('frm_Angebot', angId);
            } else {
                showToast('Bitte Angebot auswaehlen', 'info');
            }
        }

        function neuesAngebot() {
            if (!state.currentRecord?.kun_Id) {
                showToast('Bitte zuerst Kunde auswaehlen', 'warning');
                return;
            }
            Bridge.navigate('frm_Angebot', { kunde_id: state.currentRecord.kun_Id, mode: 'new' });
        }

        function openAngebotPDF() {
            if (!selectedAngebotId) {
                showToast('Bitte Angebot auswaehlen', 'warning');
                return;
            }
            Bridge.sendEvent('openDocument', { type: 'angebot', id: selectedAngebotId });
        }

        Bridge.on('onAngeboteReceived', function(data) {
            angeboteList = data.angebote || [];
            renderAngebote(angeboteList);
        });

        window.loadAngebote = loadAngebote;
        window.neuesAngebot = neuesAngebot;
        window.openAngebotPDF = openAngebotPDF;

        // ============================================
        // RECHNUNGSPOSITIONEN SUBFORM (sub_KD_Rch_Auftragspos)
        // ============================================
        let selectedAuftragId = null;
        let auftragspositionenList = [];

        function selectAuftrag(auftrag, tr) {
            selectedAuftragId = auftrag.ID || auftrag.VA_ID;
            document.querySelectorAll('#auftraegeBody tr').forEach(r => r.classList.remove('selected'));
            tr.classList.add('selected');

            // Auftragsnummer anzeigen
            const selectedLabel = document.getElementById('selectedAuftragNr');
            if (selectedLabel) {
                selectedLabel.textContent = auftrag.VA_Nummer || auftrag.Auftrag || `#${selectedAuftragId}`;
            }

            // Positionen laden
            loadAuftragsPositionen();
        }

        async function loadAuftragsPositionen() {
            if (!selectedAuftragId) {
                const tbody = document.getElementById('auftragspositionenBody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; color:#666; padding:10px;">Auftrag auswaehlen um Positionen zu sehen</td></tr>';
                }
                return;
            }

            const tbody = document.getElementById('auftragspositionenBody');
            if (tbody) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; color:#666; padding:10px;">Lade Positionen...</td></tr>';
            }

            try {
                const response = await fetch(`http://localhost:5000/api/auftraege/${selectedAuftragId}/positionen`);
                const result = await response.json();
                auftragspositionenList = result.data || result || [];
                renderAuftragsPositionen(auftragspositionenList);
            } catch (error) {
                console.error('Fehler beim Laden der Auftragspositionen:', error);
                // Bridge-Fallback
                Bridge.loadData('auftragspositionen', selectedAuftragId);

                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; color:#999; padding:10px;">Positionen konnten nicht geladen werden</td></tr>';
                }
            }
        }

        function renderAuftragsPositionen(records) {
            const tbody = document.getElementById('auftragspositionenBody');
            if (!tbody) return;

            tbody.innerHTML = '';

            if (!records || records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; color:#666; padding:10px;">Keine Positionen vorhanden</td></tr>';
                updatePositionenSumme(0);
                return;
            }

            let summe = 0;

            records.forEach((pos, index) => {
                const einzelpreis = parseFloat(pos.Einzelpreis || pos.pos_Einzelpreis || 0);
                const menge = parseFloat(pos.Menge || pos.pos_Menge || 1);
                const gesamt = einzelpreis * menge;
                summe += gesamt;

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="text-align: center;">${pos.PosNr || index + 1}</td>
                    <td>${escapeHtml(pos.Bezeichnung || pos.pos_Bezeichnung || '')}</td>
                    <td style="text-align: right;">${menge}</td>
                    <td style="text-align: right;">${formatEuro(einzelpreis)}</td>
                    <td style="text-align: right;">${formatEuro(gesamt)}</td>
                `;
                tbody.appendChild(tr);
            });

            updatePositionenSumme(summe);
        }

        function updatePositionenSumme(summe) {
            const summeEl = document.getElementById('PositionenSumme');
            if (summeEl) summeEl.textContent = formatEuro(summe);
        }

        Bridge.on('onAuftragspositionenReceived', function(data) {
            auftragspositionenList = data.positionen || [];
            renderAuftragsPositionen(auftragspositionenList);
        });

        window.loadAuftragsPositionen = loadAuftragsPositionen;

        // ============================================
        // PosGesamtsumme: Auftraege-Summe berechnen
        // ============================================
        function updatePosGesamtsumme(auftraege) {
            let summe = 0;
            if (auftraege && auftraege.length > 0) {
                auftraege.forEach(a => {
                    summe += parseFloat(a.Betrag || a.VA_Betrag || 0);
                });
            }
            const summeEl = document.getElementById('PosGesamtsumme');
            if (summeEl) summeEl.textContent = formatEuro(summe);
        }

        // ============================================
        // DETAILLIERTE STATISTIK (pg_Rch_Kopf)
        // ============================================
        let statistikData = {};

        async function loadStatistik() {
            const kunId = state.currentRecord?.kun_Id;
            if (!kunId) {
                showToast('Bitte zuerst Kunde auswaehlen', 'warning');
                return;
            }

            try {
                const response = await fetch(`http://localhost:5000/api/kunden/${kunId}/statistik`);
                const result = await response.json();
                statistikData = result.data || result || {};
                renderStatistik(statistikData);
            } catch (error) {
                console.error('Fehler beim Laden der Statistik:', error);
                Bridge.loadData('kundenStatistikDetail', kunId);
            }
        }

        function renderStatistik(data) {
            // Jahre-Header aktualisieren
            const currentYear = new Date().getFullYear();
            document.getElementById('statJahr1Header').textContent = currentYear;
            document.getElementById('statJahr2Header').textContent = currentYear - 1;
            document.getElementById('statJahr3Header').textContent = currentYear - 2;

            // Umsaetze
            setStatField('UmsNGes1', data.UmsNGes1, 'euro');
            setStatField('UmsNGes2', data.UmsNGes2, 'euro');
            setStatField('UmsNGes3', data.UmsNGes3, 'euro');
            setStatField('UmsGes1', data.UmsGes1, 'euro');
            setStatField('UmsGes2', data.UmsGes2, 'euro');
            setStatField('UmsGes3', data.UmsGes3, 'euro');

            // Stunden
            setStatField('StdGes1', data.StdGes1);
            setStatField('StdGes2', data.StdGes2);
            setStatField('StdGes3', data.StdGes3);

            // Auftraege
            setStatField('AufAnz1', data.AufAnz1);
            setStatField('AufAnz2', data.AufAnz2);
            setStatField('AufAnz3', data.AufAnz3);

            // Personal/Tage
            setStatField('PersGes1', data.PersGes1);
            setStatField('PersGes2', data.PersGes2);
            setStatField('PersGes3', data.PersGes3);

            // KW-Daten
            setStatField('Std51', data.Std51);
            setStatField('Std52', data.Std52);
            setStatField('Std53', data.Std53);
            setStatField('Pers51', data.Pers51);
            setStatField('Pers52', data.Pers52);
            setStatField('Pers53', data.Pers53);
        }

        function setStatField(id, value, type) {
            const el = document.getElementById(id);
            if (!el) return;

            if (type === 'euro') {
                el.textContent = formatEuro(value || 0);
            } else {
                el.textContent = value || 0;
            }
        }

        function exportStatistikExcel() {
            if (!state.currentRecord?.kun_Id) {
                showToast('Bitte zuerst Kunde auswaehlen', 'warning');
                return;
            }

            Bridge.sendEvent('exportStatistik', {
                kunde_id: state.currentRecord.kun_Id,
                format: 'excel'
            });
            showToast('Excel-Export wird erstellt...', 'info');
        }

        Bridge.on('onKundenStatistikDetailReceived', function(data) {
            statistikData = data;
            renderStatistik(data);
        });

        window.loadStatistik = loadStatistik;
        window.exportStatistikExcel = exportStatistikExcel;

        // ============================================
        // Tab-Wechsel erweitern fuer neue Tabs
        // ============================================
        const originalSwitchTab = switchTab;
        switchTab = function(tabName) {
            // Original aufrufen
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabName);
            });
            document.querySelectorAll('.tab-page').forEach(page => {
                page.classList.toggle('active', page.id === 'tab-' + tabName);
            });

            // Daten laden wenn Tab gewechselt wird
            if (state.currentRecord) {
                if (tabName === 'auftraguebersicht') {
                    loadAufträge();
                } else if (tabName === 'objekte') {
                    loadObjekte();
                } else if (tabName === 'zusatzdateien') {
                    loadZusatzdateien();
                } else if (tabName === 'ansprechpartner') {
                    loadAnsprechpartner();
                    loadCboPerson(); // Globale Personenliste fuer "Uebernehmen"-Button
                } else if (tabName === 'preise') {
                    loadKundenpreise();
                    loadPreisarten();
                } else if (tabName === 'angebote') {
                    loadAngebote();
                } else if (tabName === 'statistik') {
                    loadStatistik();
                } else if (tabName === 'stammdaten') {
                    loadHauptAnsprechpartnerDropdown();
                }
            }
        };

        // ============================================
        // Auftraege-Rendering erweitern fuer Auswahl
        // ============================================
        const originalOnAufträgeReceived = Bridge._handlers?.onAufträgeReceived;
        Bridge.on('onAufträgeReceived', function(data) {
            const auftraege = data.auftraege || [];
            const tbody = document.getElementById('auftraegeBody');
            tbody.innerHTML = '';

            auftraege.forEach(a => {
                const tr = document.createElement('tr');
                tr.dataset.id = a.ID;
                tr.innerHTML = `
                    <td>${a.ID || ''}</td>
                    <td>${escapeHtml(a.Auftrag || '')}</td>
                    <td>${formatDateShort(a.Dat_VA_Von)}</td>
                    <td>${escapeHtml(a.Objekt || '')}</td>
                    <td>${a.Veranst_Status_ID || ''}</td>
                    <td style="text-align: right;">${formatCurrency(a.Betrag)}</td>
                `;
                // Klick fuer Positionen-Anzeige
                tr.addEventListener('click', () => selectAuftrag(a, tr));
                // Doppelklick fuer Navigation
                tr.addEventListener('dblclick', () => {
                    Bridge.navigate('frm_va_Auftragstamm', a.ID);
                });
                tbody.appendChild(tr);
            });

            // Gesamtsumme aktualisieren
            updatePosGesamtsumme(auftraege);
        });

        // ============================================
        // showRecord erweitern fuer Haupt-AP Dropdown
        // ============================================
        const originalShowRecord = showRecord;
        const extendedShowRecord = async function(index) {
            await originalShowRecord(index);
            // Haupt-Ansprechpartner Dropdown laden
            loadHauptAnsprechpartnerDropdown();
        };
        // Nicht ueberschreiben da showRecord schon async ist

    </script>
    <!-- Debug Logger -->
    <script src="js/debug-logger.js" style="position: relative;"></script>
    <!-- Event Logger (erweitert debug-logger) -->
    <script src="js/logger.js" style="position: relative;"></script>
    <!-- Toast Notification System -->
    <script src="js/toast-system.js" style="position: relative;"></script>
    <!-- Shell-Detector: Versteckt Sidebar im iframe-Modus -->
    <script src="js/shell-detector.js" style="position: relative;"></script>
    <!-- Server Watchdog: Prüft API-Server-Verfügbarkeit -->
    <script src="js/server-watchdog.js" style="position: relative;"></script>





<script src="chrome-extension://lhannfkhjdhmibllojbbdjdbpegidojj/js/content/sm.js" data-pname="recorder-screenshot-v3" data-asset-path="chrome-extension://lhannfkhjdhmibllojbbdjdbpegidojj/" style="position: relative;"></script><div class="host-lopnbnfpjmgpbppclhclehhgafnifija" style="position: relative; z-index: 2147483647;"></div><script src="chrome-extension://lhannfkhjdhmibllojbbdjdbpegidojj/js/content/sm.js" data-pname="recorder-screenshot-v3" data-asset-path="chrome-extension://lhannfkhjdhmibllojbbdjdbpegidojj/" style="position: relative;"></script><div class="host-lopnbnfpjmgpbppclhclehhgafnifija" style="position: relative; z-index: 2147483647;"></div></body></html>