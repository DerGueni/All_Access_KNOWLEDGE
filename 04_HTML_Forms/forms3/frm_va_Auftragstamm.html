<!DOCTYPE html>
<html lang="de" data-yd-content-ready="true" style="position: relative;"><head style="position: relative;">
    <meta charset="UTF-8" style="position: relative;">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" style="position: relative;">
    <title style="position: relative;">Auftragsverwaltung</title>
    <link rel="stylesheet" href="css/unified-header.css" style="position: relative;">
    <link rel="stylesheet" href="css/form-titles.css" style="position: relative;">
    <script style="position: relative;">
    // Auto-Load in Shell (Sidebar-Integration)
    (function() {
        const urlParams = new URLSearchParams(window.location.search);
        const isInShell = urlParams.has('shell') || window.SHELL_PARAMS;
        const isInIframe = window.self !== window.top;
        if (!isInShell && !isInIframe) {
            const formName = window.location.pathname.split('/').pop();
            const recordId = urlParams.get('id') || urlParams.get('ma_id') || urlParams.get('kd_id') || urlParams.get('va_id');
            let shellUrl = 'shell.html?form=' + formName;
            if (recordId) shellUrl += '&id=' + recordId;
            for (const [key, value] of urlParams.entries()) {
                if (!['shell', 'id', 'ma_id', 'kd_id', 'va_id', '_t'].includes(key)) {
                    shellUrl += '&' + encodeURIComponent(key) + '=' + encodeURIComponent(value);
                }
            }
            console.log('[Auto-Redirect] Lade mit Sidebar:', shellUrl);
            window.location.replace(shellUrl);
        }
    })();
    </script>
    <style style="position: relative;">
        :root {
            --base-font-size: 11px;
            --small-font-size: 10px;
            --header-font-size: 12px;
            --title-font-size: 24px; /* Einheitliche Titelgröße (15.01.2026) */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: var(--base-font-size);
        }

        body {
            background-color: #8080c0;
            overflow: hidden;
            height: 100vh;
        }

        .window-frame {
            background-color: #8080c0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Title Bar - ausgeblendet gemaess Anforderung */
        .title-bar {
            display: none; /* Blauer Streifen oben entfernt */
        }

        .title-bar-left {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .title-bar-buttons {
            display: flex;
            gap: 2px;
        }

        .title-btn {
            width: 21px;
            height: 21px;
            background: #ece9d8;
            border: 1px solid;
            border-color: #ffffff #808080 #808080 #ffffff;
            font-size: var(--base-font-size);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .title-btn.close {
            background: #c75050;
            color: white;
        }

        /* Main Container */
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Left Menu */
        .left-menu {
            width: 185px;
            background-color: #6060a0;
            padding: 5px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .menu-header {
            background-color: #000080;
            color: white;
            padding: 6px;
            text-align: center;
            font-weight: bold;
            font-size: var(--base-font-size);
            margin-bottom: 8px;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            flex: 1;
            justify-content: space-between;
        }

        /* Menu-Buttons mit mehr vertikalem Abstand gemaess Anforderung - luftigeres Layout */
        .menu-btn {
            background: linear-gradient(to bottom, #d0d0e0, #a0a0c0);
            padding: 12px 10px; /* Mehr Padding vertikal fuer luftigeres Layout */
            text-align: center;
            cursor: pointer;
            font-size: var(--base-font-size);
            color: #000;
            font-weight: 500;
            position: relative;
            border: none;
            margin: 5px 0; /* Deutlich mehr Abstand zwischen Buttons - entzerrt */
            overflow: visible;
        }

        /* Obere helle Kante - 4px nach rechts versetzt */
        .menu-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: calc(100% - 4px);
            height: 2px;
            background: #ffffff;
            z-index: 1;
        }

        /* Untere dunkle Kante - 4px nach links versetzt */
        .menu-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: calc(100% - 4px);
            height: 2px;
            background: #404070;
            z-index: 1;
        }

        .menu-btn:hover {
            background: linear-gradient(to bottom, #e0e0f0, #b0b0d0);
        }

        .menu-btn:active {
            background: linear-gradient(to bottom, #b0b0d0, #9090b0);
        }

        .menu-btn:active::before {
            background: #404070;
            left: 4px;
            width: calc(100% - 4px);
        }

        .menu-btn:active::after {
            background: #ffffff;
            right: 4px;
            width: calc(100% - 4px);
        }

        .menu-btn.active {
            background: linear-gradient(to bottom, #a0a0d0, #8080b0);
        }

        .menu-btn.active::before {
            background: #505080;
            left: 4px;
            width: calc(100% - 4px);
        }

        .menu-btn.active::after {
            background: #c0c0d8;
            right: 4px;
            width: calc(100% - 4px);
        }

        /* Vollbild-Button oben rechts */
        .fullscreen-btn {
            position: fixed;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background: linear-gradient(to bottom, #e8e8e8, #c0c0c0);
            border: 2px solid;
            border-color: #ffffff #606060 #606060 #ffffff;
            cursor: pointer;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--title-font-size);
            color: #000080;
        }

        .fullscreen-btn:hover {
            background: linear-gradient(to bottom, #f0f0f0, #d0d0d0);
        }

        .fullscreen-btn:active {
            border-color: #606060 #ffffff #ffffff #606060;
        }

        /* Vollbild-Modus - nur Title-Bar ausblenden */
        body.fullscreen-mode .title-bar {
            display: none;
        }

        /* Content Area */
        .content-area {
            flex: 1;
            background-color: #d3d3d3;
            padding: 3px;
            display: flex;
            flex-direction: column;
            gap: 2px;
            overflow: hidden;
        }

        /* Header Row - ohne grauen Hintergrund gemaess Anforderung */
        .header-row {
            background-color: #d3d3d3; /* Passt zum Body-Hintergrund */
            border: none;
            padding: 4px 8px;
            display: flex;
            align-items: center;
            gap: 6px;
            flex-shrink: 0;
            flex-wrap: wrap;
        }

        .logo-box {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #4040a0, #8080c0);
            border: 2px solid #404080;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .title-text {
            font-size: var(--title-font-size);
            font-weight: bold;
            color: #000080;
        }

        .header-links {
            display: flex;
            gap: 8px;
            margin-left: 5px;
        }

        .header-link {
            color: #000080;
            text-decoration: underline;
            cursor: pointer;
            font-size: var(--base-font-size);
        }

        .btn {
            background: linear-gradient(to bottom, #e8e8e8, #c0c0c0);
            border: 1px solid #808080;
            height: 26px;
            padding: 4px 12px;
            cursor: pointer;
            font-size: var(--base-font-size);
            white-space: nowrap;
            line-height: 1.2;
            vertical-align: middle;
        }

        .btn:hover {
            background: linear-gradient(to bottom, #f0f0f0, #d0d0d0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-green {
            background: linear-gradient(to bottom, #60c060, #308030);
            color: white;
        }

        .btn-yellow {
            background: linear-gradient(to bottom, #e0e080, #c0c040);
        }

        .btn-red {
            background: linear-gradient(to bottom, #e06060, #c04040);
            color: white;
            border-color: #f08080 #902020 #902020 #f08080;
        }

        .btn-red:hover {
            background: linear-gradient(to bottom, #f07070, #d05050);
        }

        /* Einheitliche Buttons im Header-Bereich - alle gleiche Hoehe/Padding */
        .unified-btn {
            min-width: 100px; /* 85+15=100px breiter (14.01.2026) */
            height: 26px;
            padding: 4px 12px; /* Mehr Padding */
            text-align: center;
            font-size: var(--base-font-size);
            line-height: 1.2;
            /* Alle Buttons einheitlich grau (14.01.2026) */
            background: linear-gradient(to bottom, #e8e8e8, #c0c0c0) !important;
            color: #000 !important;
            border: 1px solid #808080 !important;
        }

        .unified-btn.btn-green {
            border-color: #80d080 #206020 #206020 #80d080;
        }

        .btn-green:hover {
            background: linear-gradient(to bottom, #70d070, #409040);
        }

        .unified-btn.btn-yellow {
            border-color: #f0f0a0 #909030 #909030 #f0f0a0;
        }

        .btn-yellow:hover {
            background: linear-gradient(to bottom, #f0f090, #d0d050);
        }

        /* Orange Button fuer Mitarbeiterauswahl (26.01.2026) */
        .btn-orange {
            background: linear-gradient(to bottom, #ffcc80, #ff9933);
            color: #000;
        }
        .unified-btn.btn-orange {
            border-color: #ffe0a0 #996600 #996600 #ffe0a0;
        }
        .btn-orange:hover {
            background: linear-gradient(to bottom, #ffd090, #ffaa44);
        }

        /* Kombinierter Button-Block */
        .combined-buttons {
            flex-wrap: wrap;
            padding: 4px 8px;
        }

        /* GPT Box - Deaktiviert (blockierte Buttons) */
        .gpt-box {
            display: none; /* Deaktiviert - blockierte Speichern-Button */
            background: #ffe0e0;
            border: 1px solid #a00000;
            padding: 2px 6px;
            font-size: var(--base-font-size);
            text-align: center;
            line-height: 1.2;
            position: absolute;
            right: 10px;
            top: 28px;
            pointer-events: none; /* Falls wieder aktiviert: Klicks durchlassen */
        }

        .header-row-wrapper {
            position: relative;
            min-height: auto;
            max-height: none;
            overflow: visible;
        }

        /* Button Row - 2 Reihen Layout */
        .button-row {
            background-color: #9090c0;
            border: 1px solid #606090;
            padding: 3px 8px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, auto));
            align-items: center;
            gap: 4px 6px;
            flex-shrink: 0;
        }

        /* Header mit Buttons in 2 Reihen - gemaess Anforderung */
        .header-row.combined-buttons {
            display: flex;
            flex-wrap: nowrap; /* KEINE Umbrueche in der Hauptzeile */
            align-items: flex-start;
            gap: 6px 8px;
            max-height: none;
            padding: 6px 8px;
        }

        /* Titel-Bereich - bleibt in erster Zeile links */
        .header-row.combined-buttons .logo-box {
            flex-shrink: 0;
        }

        .header-row.combined-buttons .title-text {
            flex-shrink: 0;
            margin-right: 10px;
        }

        .header-row.combined-buttons .header-links {
            flex-shrink: 0;
            margin-right: 15px;
        }

        /* Buttons-Container fuer exakt 2 Reihen a 6 Spalten - ab Position "Positionen" */
        .header-row.combined-buttons .buttons-grid {
            display: grid;
            grid-template-columns: repeat(6, minmax(105px, 1fr)); /* Breiter (14.01.2026) */
            grid-template-rows: auto auto; /* Exakt 2 Reihen */
            gap: 6px 10px; /* Mehr Abstand zwischen Buttons (14.01.2026) */
            flex: 0 0 auto; /* Nicht flexen, feste Groesse */
            max-width: 750px; /* Mehr Platz fuer breitere Buttons (14.01.2026) */
        }

        .header-row.combined-buttons .btn {
            min-width: 90px;
            height: 26px;
            padding: 4px 8px;
            font-size: var(--base-font-size);
            white-space: nowrap;
            line-height: 1.2;
        }

        /* Status-Gruppe unter den Buttons */
        .header-row.combined-buttons .status-group {
            flex-basis: 100%;
            margin-top: 4px;
            margin-left: 0;
            justify-content: flex-start;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 3px;
            font-size: var(--base-font-size);
        }

        .status-group {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: auto;
        }

        .form-label {
            font-size: var(--base-font-size);
        }

        .form-select, .form-input {
            border: 1px solid #808080;
            padding: 1px 3px;
            font-size: var(--base-font-size);
            background: white;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #000080;
            box-shadow: 0 0 2px #000080;
        }

        .form-input.readonly {
            background: #e0e0e0;
        }

        /* Form Section - CSS GRID fuer stabiles 3-Spalten-Layout */
        /* WICHTIG: !important noetig um app-layout.css zu ueberschreiben */
        .form-section {
            background-color: #b8b8d8;
            border: 1px solid #606090;
            padding: 8px 12px;
            display: flex !important;
            flex-direction: row !important;
            gap: 15px;
            flex-shrink: 0;
            align-items: flex-start;
            font-size: calc(var(--base-font-size) + 3px);
            font-weight: bold;
            height: auto;
            min-height: 110px;
            max-height: none; /* Keine Begrenzung (26.01.2026) */
        }

        .form-section .form-label,
        .form-section .form-input,
        .form-section .form-select {
            font-size: calc(var(--base-font-size) + 3px); /* +3px konsistent */
            font-weight: bold; /* Fett gemaess Anforderung */
        }

        .form-column {
            display: flex;
            flex-direction: column;
            gap: 4px; /* Vertikaler Abstand zwischen Feldern */
            justify-content: flex-start;
        }

        .form-row {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Labels einheitlich ausgerichtet gemaess Anforderung */
        .form-column.left .form-label {
            min-width: 55px;
            text-align: right;
        }

        .form-column.middle .form-label {
            min-width: 75px;
            text-align: right;
        }

        .form-column.right .form-label {
            min-width: 90px;
            text-align: right;
        }

        /* Spalten-Reihenfolge (26.01.2026 neu strukturiert) */
        .form-column.left {
            order: 1; /* Block 1: Datum, Auftrag, Ort, Objekt */
        }
        /* Block 2, 3, 4 haben inline order-Styles */

        /* Einheitliche Feldbreiten gemaess Anforderung - ALLE Felder gleich breit */
        .input-narrow { width: 80px; height: 22px; } /* Nur fuer Datums-/Zeitfelder */
        .input-medium { width: 195px; height: 22px; } /* 160+35=195px breiter (14.01.2026) */
        .input-wide { width: 245px; height: 22px; } /* 210+35=245px breiter (14.01.2026) */

        /* Alle Eingabefelder im Formular-Bereich einheitlich */
        .form-section .form-input,
        .form-section .form-select {
            height: 22px;
            padding: 2px 4px;
        }

        /* Ausnahme: Uhrzeitfeld etwas niedriger/flacher */
        .form-section input[type="time"] {
            height: 20px;
            padding: 1px 3px;
        }

        /* Work Area */
        .work-area {
            display: flex;
            flex: 1;
            gap: 3px;
            overflow: hidden;
        }

        /* Left Work Panel */
        .left-work-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
            overflow: hidden;
        }

        /* Tab Container */
        .tab-container {
            background-color: #9090c0;
            border: 1px solid #606090;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .tab-header {
            display: flex;
            background: #8080b0;
            border-bottom: 1px solid #606090;
            flex-shrink: 0;
            height: 28px; /* Feste Höhe für kompaktere Tabs */
        }

        .tab-btn {
            padding: 2px 12px; /* Reduziertes Padding vertikal */
            background: #a0a0c0;
            border: 1px solid #808080;
            border-bottom: none;
            cursor: pointer;
            font-size: var(--base-font-size);
            margin-right: -1px;
            color: white; /* Schriftfarbe weiß */
            line-height: 24px; /* Angepasste Line-Height für vertikale Zentrierung */
            height: 28px; /* Feste Höhe */
        }

        .tab-btn.active {
            background: #9090c0;
            border-bottom: 1px solid #9090c0;
            position: relative;
            top: 1px;
            color: white; /* Schriftfarbe weiß */
        }

        .tab-content {
            padding: 5px;
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .tab-page {
            display: none;
            flex: 1;
            flex-direction: column;
            overflow: hidden;
        }

        .tab-page.active {
            display: flex;
        }

        .bwn-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 5px;
            flex-shrink: 0;
        }

        .status-red {
            color: #c00000;
            font-weight: bold;
        }

        /* Eventdaten Tab */
        .event-form {
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .event-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .event-label {
            min-width: 100px;
            text-align: right;
            font-size: var(--base-font-size);
            font-weight: 500;
        }

        .event-input {
            border: 1px solid #808080;
            padding: 3px 6px;
            font-size: var(--base-font-size);
            background: white;
        }

        .event-input.readonly {
            background: #e0e0e0;
            color: #606060;
        }

        .event-input.from-web {
            background: #fff8e0;
            border-color: #c0a060;
        }

        .event-input.no-data {
            background: #f0f0f0;
            color: #999;
            font-style: italic;
        }

        .event-input-narrow { width: 120px; }
        .event-input-medium { width: 250px; }
        .event-input-wide { width: 400px; }

        .event-textarea {
            border: 1px solid #808080;
            padding: 6px;
            font-size: var(--base-font-size);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            resize: vertical;
            min-height: 80px;
            background: #fff8e0;
            border-color: #c0a060;
        }

        .event-textarea.no-data {
            background: #f0f0f0;
            color: #999;
            font-style: italic;
        }

        .event-link {
            color: #000080;
            text-decoration: underline;
            cursor: pointer;
            font-size: var(--base-font-size);
        }

        .event-link:hover {
            color: #1084d0;
        }

        .event-button-row {
            margin-top: 10px;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .loading-spinner {
            display: none;
            width: 16px;
            height: 16px;
            border: 2px solid #d0d0d0;
            border-top-color: #000080;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-spinner.active {
            display: inline-block;
        }

        /* Grid Area */
        .grid-area {
            display: flex;
            gap: 3px;
            flex: 1;
            overflow: hidden;
        }

        /* Left Subform - Schichten kleiner, Absagen groesser */
        .subform-left {
            width: 280px; /* Verbreitert (22.01.2026) - Platz von work-area Expansion */
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        /* Schichten-Grid begrenzen (330px weniger) */
        .subform-left > .grid-wrapper {
            flex: 0 0 auto;
            max-height: 150px;
            min-height: 80px;
        }

        .subform-right {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-width: 0;
        }

        .grid-wrapper {
            flex: 1;
            overflow: auto;
            border: 1px solid #808080;
            background: white;
        }

        /* Data Grid */
        .data-grid {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--base-font-size);
        }

        .data-grid th {
            background: linear-gradient(to bottom, #e0e0e0, #c0c0c0);
            border: 1px solid #808080;
            padding: 4px 6px;
            text-align: left;
            font-weight: bold;
            position: sticky;
            top: 0;
            white-space: nowrap;
            font-size: var(--base-font-size);
            cursor: pointer;
        }

        .data-grid th:hover {
            background: linear-gradient(to bottom, #e8e8e8, #d0d0d0);
        }

        .data-grid td {
            border: 1px solid #c0c0c0;
            padding: 3px 5px;
            height: 22px;
        }

        .data-grid tr:hover {
            background: #e0e0ff;
        }

        .data-grid tr.selected {
            background: #000080;
            color: white;
        }

        .data-grid input, .data-grid select {
            border: none;
            width: 100%;
            padding: 0;
            font-size: var(--base-font-size);
            background: transparent;
        }

        .cell-blue { background-color: transparent; }
        .cell-green { background-color: #90ee90; }
        .cell-yellow { background-color: #ffff90; }
        .cell-red { background-color: #ffb0b0; }

        /* Absagen Section - 330px hoeher */
        .absagen-section {
            margin-top: 8px;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .absagen-label {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: var(--base-font-size);
            flex-shrink: 0;
        }

        .absagen-grid-wrapper {
            height: 450px;
            min-height: 350px;
            flex: 1;
            overflow: auto;
            border: 1px solid #808080;
            background: white;
        }

        /* Right Panel - 80px breiter (26.01.2026) */
        .right-panel {
            flex: 0 0 auto; /* Nicht mehr flexibel wachsen */
            width: 560px; /* 80px breiter als vorher */
            min-width: 500px;
            max-width: 600px; /* Begrenzt */
            background: #9090c0;
            border: 1px solid #606090;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            overflow: hidden;
            /* 25.01.2026: padding-top/margin-top entfernt - right-header ist jetzt im Flow */
            position: relative;
            margin-right: 0; /* Kein Rand rechts - schliesst buendig mit Einsatzliste */
        }

        .right-header {
            padding: 5px;
            border-bottom: 1px solid #808080;
            flex-shrink: 0;
            /* 25.01.2026: Von absolute zu static geaendert - Status-Panel war nicht sichtbar */
            position: static;
            background: #b8b8d8; /* Hell-lila wie .form-section */
            z-index: 10;
        }

        .status-table {
            width: 100%;
            font-size: var(--base-font-size);
            border-collapse: collapse;
        }

        .status-table td {
            padding: 2px 4px;
        }

        .status-table .count {
            text-align: right;
            font-weight: bold;
        }

        .anzeigen-btn {
            background: #e0e0e0;
            border: 1px solid #808080;
            padding: 1px 6px;
            font-size: var(--base-font-size);
            cursor: pointer;
        }

        .date-nav {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 6px;
            background: #a0a0c0;
            border-bottom: 1px solid #808080;
            flex-shrink: 0;
            font-size: var(--base-font-size);
        }

        .date-input {
            width: 95px; /* 75+20=95px - breiter für komplettes Datum (22.01.2026) */
            border: 1px solid #808080;
            padding: 2px 4px;
            font-size: var(--base-font-size);
        }

        .nav-btn {
            background: #d0d0d0;
            border: 1px solid #808080;
            padding: 2px 8px;
            cursor: pointer;
            font-size: var(--base-font-size);
        }

        .nav-btn:hover {
            background: #e0e0e0;
        }

        .auftraege-wrapper {
            flex: 1;
            overflow: auto;
        }

        .auftraege-table {
            width: 100%;
            border-collapse: collapse;
            font-size: var(--base-font-size);
            table-layout: fixed; /* 26.01.2026: Feste Spaltenbreiten */
        }

        .auftraege-table th {
            background: linear-gradient(to bottom, #c0c0d0, #a0a0b0);
            border: 1px solid #808080;
            padding: 3px 5px;
            text-align: left;
            position: sticky;
            top: 0;
            font-weight: bold;
            white-space: nowrap;
            cursor: pointer;
            overflow: hidden;
        }

        .auftraege-table td {
            border: 1px solid #c0c0c0;
            padding: 2px 4px;
            white-space: nowrap;
            background: white;
            height: 20px;
            font-weight: normal;
            overflow: hidden;
            text-overflow: ellipsis; /* 26.01.2026: Lange Texte abschneiden */
        }

        .auftraege-table tr:nth-child(even) td {
            background: #f0f0ff;
        }

        .auftraege-table tr:hover td {
            background: #d0d0ff;
        }

        .auftraege-table tr.selected td {
            background: #000080;
            color: white;
        }

        /* Status Bar */
        .status-bar {
            background: #c0c0c0;
            border-top: 1px solid #808080;
            padding: 2px 5px;
            display: flex;
            gap: 10px;
            font-size: var(--base-font-size);
            flex-shrink: 0;
        }

        .status-section {
            border: 1px inset #808080;
            padding: 1px 8px;
            background: #e0e0e0;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(128, 128, 192, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #fff;
            border-top-color: #000080;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #c0c0c0;
            border: 2px solid;
            border-color: #fff #808080 #808080 #fff;
            padding: 10px;
            min-width: 300px;
        }

        .modal-header {
            background: linear-gradient(to right, #000080, #1084d0);
            color: white;
            padding: 4px 8px;
            margin: -10px -10px 10px -10px;
            display: flex;
            justify-content: space-between;
        }

        .modal-body {
            padding: 10px 0;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding-top: 10px;
            border-top: 1px solid #808080;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 16px;
            height: 16px;
        }

        ::-webkit-scrollbar-track {
            background: #c0c0c0;
        }

        ::-webkit-scrollbar-thumb {
            background: #a0a0a0;
            border: 1px solid;
            border-color: #e0e0e0 #606060 #606060 #e0e0e0;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 30px;
            right: 10px;
            z-index: 10000;
        }

        .toast {
            background: #333;
            color: white;
            padding: 10px 20px;
            margin-bottom: 5px;
            border-radius: 4px;
            animation: slideIn 0.3s ease;
        }

        .toast.success { background: #2e7d32; }
        .toast.error { background: #c62828; }
        .toast.warning { background: #f57f17; }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Pflichtfeld-Markierung */
        .required { color: #cc0000; font-weight: bold; }
        input:required:invalid { border-color: #cc0000; }
        input:required:valid { border-color: #008000; }
        input.invalid { border-color: #cc0000 !important; background-color: #fff8f8 !important; }

        /* gridZuordnungen - Konstante Zeilenhoehe und optimierte Spalten */
        #gridZuordnungen td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 0; /* Wichtig fuer text-overflow in table-layout: fixed */
            height: 22px;
            line-height: 22px;
            padding: 1px 3px;
        }
        #gridZuordnungen th {
            white-space: nowrap;
            padding: 2px 3px;
        }
        /* Kleinere Checkboxen in gridZuordnungen */
        #gridZuordnungen input[type="checkbox"] {
            width: 14px;
            height: 14px;
            margin: 0;
            vertical-align: middle;
        }
        /* Kleinere Zahlenfelder in gridZuordnungen */
        #gridZuordnungen input[type="number"] {
            width: 30px !important;
            padding: 0 2px;
            text-align: right;
        }
        /* Bedingte Spalten-Klassen */
        #gridZuordnungen .col-hidden {
            display: none;
        }
        /* Globale Hilfsklasse fuer versteckte Elemente */
        .is-hidden {
            display: none !important;
        }

        /* ========== BEDINGTE FORMATIERUNG (Access-Parität) ========== */
        /* IstFraglich = True → türkisblaue Hintergrundfarbe */
        tr.ist-fraglich,
        #zuordnungenBody tr.ist-fraglich {
            background-color: #C0FFFF !important;
        }

        /* Unterbuchung (leere Slots) → gelbe Hintergrundfarbe */
        tr.pos-unterbuchung,
        #zuordnungenBody tr.pos-unterbuchung {
            background-color: #FFFFFF !important; /* Gelb entfernt - 22.01.2026 */
        }

        /* Überbuchung (mehr MA als erlaubt) → rote Hintergrundfarbe */
        tr.pos-ueberbuchung,
        #zuordnungenBody tr.pos-ueberbuchung {
            background-color: #FFCCCC !important;
        }
    </style>
    <link rel="stylesheet" href="css/app-layout.css" style="position: relative;">
    <link rel="stylesheet" href="consys-common.css" style="position: relative;">
    <link rel="stylesheet" href="css/fonts_override.css" style="position: relative;">
    <link rel="stylesheet" href="css/visbug_overrides.css" style="position: relative;">
<style style="position: relative;">@keyframes loading {
    0% {
        transform: rotate(0);
    }

    to {
        transform: rotate(360deg);
    }
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar {
    height: 6px;
    width: 6px;
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar-track {
    background: transparent;
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar-thumb {
    background: #dfdfdf;
    border-radius: 4px;
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar-thumb:hover {
    background: #d4d4d4;
}
</style><style style="position: relative;">.translated-content .ytCoreImageHost {
    visibility: visible;
}
</style><style style="position: relative;">body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:rgba(0,0,0,.4)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:hsl(0,0%,33%);font-family:inherit;font-size:1rem}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1))}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2))}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):focus-visible{box-shadow:0 0 0 3px rgba(112,102,224,.5)}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):focus-visible{box-shadow:0 0 0 3px rgba(220,55,65,.5)}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):focus-visible{box-shadow:0 0 0 3px rgba(110,120,129,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-default-outline:focus-visible{box-shadow:0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:rgba(0,0,0,0);color:#ccc;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:none;background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:1em 1.6em .3em;overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid hsl(0,0%,85%);border-radius:.1875em;background:rgba(0,0,0,0);box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:1px solid #b4dbed;outline:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:#fff}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:rgba(0,0,0,0);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:#fff;color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:hsl(0,0%,94%);color:#666;font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}div:where(.swal2-icon).swal2-warning{border-color:rgb(249.95234375,205.965625,167.74765625);color:#f8bb86}div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}div:where(.swal2-icon).swal2-info{border-color:rgb(156.7033492823,224.2822966507,246.2966507177);color:#3fc3ee}div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}div:where(.swal2-icon).swal2-question{border-color:rgb(200.8064516129,217.9677419355,225.1935483871);color:#87adbd}div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:swal2-show .3s}.swal2-hide{animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}.swal2-toast.swal2-show{animation:swal2-toast-show .5s}.swal2-toast.swal2-hide{animation:swal2-toast-hide .1s forwards}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}</style><style style="position: relative;">@keyframes loading {
    0% {
        transform: rotate(0);
    }

    to {
        transform: rotate(360deg);
    }
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar {
    height: 6px;
    width: 6px;
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar-track {
    background: transparent;
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar-thumb {
    background: #dfdfdf;
    border-radius: 4px;
}

.ag-textarea .MuiInputBase-input::-webkit-scrollbar-thumb:hover {
    background: #d4d4d4;
}
</style><style style="position: relative;">.translated-content .ytCoreImageHost {
    visibility: visible;
}
</style><style style="position: relative;">body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:rgba(0,0,0,.4)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:hsl(0,0%,33%);font-family:inherit;font-size:1rem}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1))}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2))}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):focus-visible{box-shadow:0 0 0 3px rgba(112,102,224,.5)}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):focus-visible{box-shadow:0 0 0 3px rgba(220,55,65,.5)}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):focus-visible{box-shadow:0 0 0 3px rgba(110,120,129,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-default-outline:focus-visible{box-shadow:0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:rgba(0,0,0,0);color:#ccc;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:none;background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:1em 1.6em .3em;overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid hsl(0,0%,85%);border-radius:.1875em;background:rgba(0,0,0,0);box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:1px solid #b4dbed;outline:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:#fff}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:rgba(0,0,0,0);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:#fff;color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:hsl(0,0%,94%);color:#666;font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}div:where(.swal2-icon).swal2-warning{border-color:rgb(249.95234375,205.965625,167.74765625);color:#f8bb86}div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}div:where(.swal2-icon).swal2-info{border-color:rgb(156.7033492823,224.2822966507,246.2966507177);color:#3fc3ee}div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}div:where(.swal2-icon).swal2-question{border-color:rgb(200.8064516129,217.9677419355,225.1935483871);color:#87adbd}div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:swal2-show .3s}.swal2-hide{animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}.swal2-toast.swal2-show{animation:swal2-toast-show .5s}.swal2-toast.swal2-hide{animation:swal2-toast-hide .1s forwards}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}</style></head>
<body inmaintabuse="1" style="position: relative;">
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner" style="position: relative;"></div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Vollbild-Button -->
    <button class="fullscreen-btn tiny-btn" id="fullscreenBtn" onclick="toggleFullscreen()" title="Vollbild" data-testid="auftrag-btn-vollbild">?</button>

    <div class="window-frame" style="position: relative;">
        <!-- Title Bar -->
        <div class="title-bar" style="position: relative;">
            <div class="title-bar-left" style="position: relative;">
                <span style="position: relative;">📋</span>
                <span style="position: relative;">Auftragsverwaltung</span>
            </div>
            <div class="title-bar-buttons" style="position: relative;">
                <button class="title-btn tiny-btn" onclick="Bridge.sendEvent('minimize')" data-testid="auftrag-btn-minimieren" style="position: relative;">_</button>
                <button class="title-btn" onclick="toggleMaximize()" data-testid="auftrag-btn-maximieren" style="position: relative;">□</button>
                <button class="title-btn close" onclick="closeForm()" data-testid="auftrag-btn-schliessen" style="position: relative;">✕</button>
            </div>
        </div>

        <!-- Main Container -->
        <div class="main-container" style="position: relative;">
            <!-- Left Menu -->

            <!-- Content Area -->
            <div class="content-area" style="width: 100%; position: relative;">
                <!-- Zusammengefuegter Button-Block -->
                <div class="header-row-wrapper">
                    <div class="header-row combined-buttons" style="position: relative;">
                        <div class="logo-box" style="position: relative;">C</div>
                        <span class="title-text" style="position: relative;">Auftragsverwaltung</span>
                        <!-- Aktualisieren links nach Titel (14.01.2026) -->
                        <button class="btn unified-btn" id="btnAktualisieren" onclick="refreshData()" data-testid="auftrag-btn-aktualisieren" style="margin-left: 60px; position: relative;">Aktualisieren</button>
                        <!-- Mitarbeiterauswahl Button jetzt im lila Block (26.01.2026) -->
                        <!-- Buttons in exakt 2 Reihen - Beginn ab "Positionen" gemaess Anforderung -->
                        <div class="buttons-grid" style="margin-left: 10px; position: relative;">
                            <!-- Zeile 1: 5 Buttons (Positionen nach unten verschoben) -->
                            <button class="btn unified-btn" id="btnNeuAuftrag" onclick="neuerAuftrag()" data-testid="auftrag-btn-neu" style="position: relative;">Neuer Auftrag</button>
                            <button class="btn unified-btn" id="btn_VA_Neu_Aus_Vorlage" onclick="auftragAusVorlage()" data-testid="auftrag-btn-aus-vorlage" title="Auftrag aus Vorlage erstellen" style="position: relative;">Aus Vorlage</button>
                            <button class="btn unified-btn" id="btnKopieren" onclick="auftragKopieren()" data-testid="auftrag-btn-kopieren" style="position: relative;">Auftrag kopieren</button>
                            <button class="btn unified-btn btn-red" id="btnLoeschen" onclick="auftragLoeschen()" data-testid="auftrag-btn-loeschen" style="position: relative;">Auftrag löschen</button>
                            <button class="btn unified-btn" id="btnListeStd" onclick="namenslisteESS()" data-testid="auftrag-btn-namenslisteess" style="position: relative;">Namensliste ESS</button>
                            <button class="btn unified-btn" id="btnDruckZusage" onclick="einsatzlisteDrucken()" data-testid="auftrag-btn-einsatzliste-drucken" style="position: relative;">EL drucken</button>
                            <!-- Zeile 2: 6 Buttons/Elemente -->
                            <button class="btn unified-btn" id="btnMailEins" onclick="sendeEinsatzlisteMA()" data-testid="auftrag-btn-el-senden-ma" style="position: relative;">EL senden MA</button>
                            <button class="btn unified-btn btn-green" id="btnMailBOS" onclick="sendeEinsatzlisteBOS()" data-testid="auftrag-btn-el-senden-bos" style="position: relative;">EL senden BOS</button>
                            <button class="btn unified-btn btn-yellow" id="btnMailSub" onclick="sendeEinsatzlisteSUB()" data-testid="auftrag-btn-el-senden-sub" style="position: relative;">EL senden SUB</button>
                            <!-- EL senden POS entfernt (26.01.2026) -->
                            <div class="checkbox-group" style="position: relative;">
                                <input type="checkbox" id="cbAutosendEL" name="Autosend_EL" onchange="saveField('Autosend_EL', this.checked)" data-testid="auftrag-checkbox-autosendel" style="position: relative;">
                                <label for="cbAutosendEL" style="position: relative;">EL Autosend</label>
                            </div>
                            <button class="btn unified-btn" id="btnELGesendet" onclick="showELGesendet()" data-testid="auftrag-btn-el-gesendet" style="position: relative;">EL gesendet</button>
                            <!-- 25.01.2026: Fehlende Access-Buttons hinzugefuegt -->
                            <button class="btn unified-btn" id="btnSyncErr" onclick="syncfehlerChecken()" data-testid="auftrag-btn-syncfehler" style="position: relative;" title="Syncfehler checken">Sync Check</button>
                            <button class="btn unified-btn" id="btn_Ordnerkonzept" onclick="ordnerkonzeptOeffnen()" data-testid="auftrag-btn-ordnerkonzept" style="position: relative;" title="Ordnerkonzept oeffnen">Ordner</button>
                        </div>
                        <!-- Kunde nach unten in lila Block verschoben (26.01.2026) -->
                        <div class="status-group" style="position: relative; margin-left: 20px;">
                            <span class="form-label" style="font-weight: bold; position: relative;">Status:</span>
                            <select class="form-select" id="Veranst_Status_ID" name="Veranst_Status_ID" onchange="statusChanged()" data-testid="auftrag-select-status" style="width: 120px; position: relative;">
                                <option value="1">In Planung</option>
                                <option value="2">Versendet</option>
                                <option value="3">Beendet</option>
                            </select>
                        </div>
                        <!-- Rückmelde-Statistik und Syncfehler ganz rechts (14.01.2026) -->
                        <div class="header-links" style="margin-left: auto; position: relative;">
                            <span class="header-link" onclick="openRueckmeldStatistik()" data-testid="auftrag-link-rueckmeldestatistik" style="position: relative;">Rückmelde-Statistik</span>
                            <span class="header-link" onclick="openSyncfehler()" data-testid="auftrag-link-syncfehler" style="position: relative;">Syncfehler</span>
                        </div>
                    </div>
                    <div class="gpt-box">GPT | TEST<br style="position: relative;"><span id="lblDatum" style="position: relative;">20.1.2026</span></div>
                </div>

                <!-- Form Fields Section -->
                <div class="form-section" style="position: relative;">
                    <!-- Left Column -->
                    <div class="form-column left" style="position: relative;">
                        <div class="form-row" style="position: relative;">
                            <span class="form-label" style="position: relative;">Datum:</span>
                            <input type="date" class="form-input input-narrow" id="Dat_VA_Von" name="Dat_VA_Von" onchange="datumChanged()" data-testid="auftrag-date-von" style="width: 95px; position: relative;">
                            <span style="position: relative;">-</span>
                            <input type="date" class="form-input input-narrow" id="Dat_VA_Bis" name="Dat_VA_Bis" onchange="datumBisChanged()" data-testid="auftrag-date-bis" style="width: 95px; position: relative;">
                            <!-- Nr.-Feld entfernt - jetzt bei Objekt -->
                            <input type="hidden" id="ID" name="ID" data-testid="auftrag-input-id" value="9196" style="position: relative;">
                        </div>
                        <div class="form-row" style="position: relative;">
                            <span class="form-label" style="position: relative;">Auftrag: <span class="required" style="display: none; position: relative;">*</span></span>
                            <input type="text" class="form-input input-medium" id="Auftrag" name="Auftrag" list="auftragListe" onchange="auftragChanged()" onfocus="auftragGotFocus()" required="" data-testid="auftrag-input-auftrag" style="width: 205px; position: relative;">
                            <datalist id="auftragListe" style="position: relative;"><option value="01.11. SSV Ulm Anfahrtspauschale" style="position: relative;"></option><option value="01099" style="position: relative;"></option><option value="1. FC Nürnberg -  1.FC Köln" style="position: relative;"></option><option value="1. FC Nürnberg -  Eintracht Braunschweig" style="position: relative;"></option><option value="1. FC Nürnberg -  FC St. Pauli" style="position: relative;"></option><option value="1. FC Nürnberg -  Hansa Rostock" style="position: relative;"></option><option value="1. FC Nürnberg -  Holstein Kiel" style="position: relative;"></option><option value="1. FC Nürnberg -  Karlsruher SC" style="position: relative;"></option><option value="1. FC Nürnberg -  SC Paderborn" style="position: relative;"></option><option value="1. FC Nürnberg -  SV 07 Elversberg" style="position: relative;"></option></datalist>
                        </div>
                        <div class="form-row" style="position: relative;">
                            <span class="form-label" style="position: relative;">Ort:</span>
                            <input type="text" class="form-input input-medium" id="Ort" name="Ort" list="ortListe" onchange="ortChanged()" onfocus="ortGotFocus()" data-testid="auftrag-input-ort" style="width: 205px; position: relative;">
                            <datalist id="ortListe" style="position: relative;"><option value="Abenberg" style="position: relative;"></option><option value="Allmannsdorf" style="position: relative;"></option><option value="Altdorf" style="position: relative;"></option><option value="Bamberg" style="position: relative;"></option><option value="Bammersdorf" style="position: relative;"></option><option value="Beilngries" style="position: relative;"></option><option value="Berching" style="position: relative;"></option><option value="Berg" style="position: relative;"></option><option value="Berlin" style="position: relative;"></option><option value="Berngau" style="position: relative;"></option><option value="Buch am Wald" style="position: relative;"></option><option value="Burgfarrnbach" style="position: relative;"></option><option value="Cadolzburg" style="position: relative;"></option><option value="Coburg" style="position: relative;"></option><option value="Deberndorf" style="position: relative;"></option><option value="Dietfurt" style="position: relative;"></option><option value="Diverse" style="position: relative;"></option><option value="Enderndorf" style="position: relative;"></option><option value="Erlangen" style="position: relative;"></option><option value="Feucht" style="position: relative;"></option><option value="Fiegenstall" style="position: relative;"></option><option value="Freystadt" style="position: relative;"></option><option value="Fürth" style="position: relative;"></option><option value="Geiselwind" style="position: relative;"></option><option value="Hersbruck" style="position: relative;"></option><option value="Höchstadt a.d. Aisch" style="position: relative;"></option><option value="Köln" style="position: relative;"></option><option value="Konstanz" style="position: relative;"></option><option value="Köstlbach" style="position: relative;"></option><option value="Ladenburg" style="position: relative;"></option><option value="Mannheim" style="position: relative;"></option><option value="Meckenhausen" style="position: relative;"></option><option value="Meiersberg" style="position: relative;"></option><option value="München" style="position: relative;"></option><option value="Neumarkt" style="position: relative;"></option><option value="Nuernberg" style="position: relative;"></option><option value="Nürnberg" style="position: relative;"></option><option value="Oberasbach" style="position: relative;"></option><option value="Pavelsbach" style="position: relative;"></option><option value="Pilsach" style="position: relative;"></option><option value="Pleinfeld" style="position: relative;"></option><option value="Postbauer Heng" style="position: relative;"></option><option value="Prölsdorf" style="position: relative;"></option><option value="Pyras" style="position: relative;"></option><option value="Raitersaich" style="position: relative;"></option><option value="Regensburg" style="position: relative;"></option><option value="Reichelsdorf" style="position: relative;"></option><option value="Röckersbühl" style="position: relative;"></option><option value="Roth" style="position: relative;"></option><option value="Röthenbach an der Pegnitz" style="position: relative;"></option><option value="Schwabach" style="position: relative;"></option><option value="Schwaig" style="position: relative;"></option><option value="Schwarzenbruck" style="position: relative;"></option><option value="Seitendorf" style="position: relative;"></option><option value="Seligenporten" style="position: relative;"></option><option value="Seukendorf" style="position: relative;"></option><option value="Stein" style="position: relative;"></option><option value="Titting" style="position: relative;"></option><option value="Ulm" style="position: relative;"></option><option value="Unterfarrnbach" style="position: relative;"></option><option value="Unterferrieden" style="position: relative;"></option><option value="Weiden" style="position: relative;"></option><option value="Weissenburg" style="position: relative;"></option><option value="Wendelstein" style="position: relative;"></option><option value="Würzburg" style="position: relative;"></option></datalist>
                        </div>
                        <div class="form-row" style="position: relative;">
                            <span class="form-label" style="position: relative;">Objekt:</span>
                            <input type="text" class="form-input input-medium" id="Objekt" name="Objekt" list="objektListe" onchange="objektChanged()" data-testid="auftrag-input-objekt" style="width: 205px; position: relative;">
                            <datalist id="objektListe" style="position: relative;"><option value="11111111111111111111111111111111110" style="position: relative;"></option><option value="Arena Nürnberger Versicherungen" style="position: relative;"></option><option value="E-Werk" style="position: relative;"></option><option value="Frankenhalle" style="position: relative;"></option><option value="Grundig Stadion" style="position: relative;"></option><option value="Heinrich-Lades-Halle" style="position: relative;"></option><option value="Löwensaal" style="position: relative;"></option><option value="Messezentrum" style="position: relative;"></option><option value="Serenadenhof" style="position: relative;"></option><option value="Stadion am Laubenweg" style="position: relative;"></option><option value="Stadthalle" style="position: relative;"></option><option value="Terminal 90" style="position: relative;"></option></datalist>
                            <datalist id="kleidungListe" style="position: relative;"></datalist>
                            <!-- Auftragsnummer an Stelle des entfernten Objekt-Kombos -->
                            <span style="margin-left: 10px; position: relative; right: -705px; left: 600px;">Nr.</span>
                            <input type="text" class="form-input readonly input-xs" id="VA_ID_Display" name="VA_ID_Display" readonly="" data-testid="auftrag-input-vanr" style="width: 83px; position: relative; right: -890px; top: 0px; left: 615px;">
                        </div>
                    </div>

                    <!-- Block 2: Treffpunkt, PLZ, Ansprechp., Dienstkleidung, Kunde -->
                    <div class="form-column" style="order: 2;">
                        <div class="form-row">
                            <span class="form-label" style="min-width: 85px; text-align: right;">Treffpunkt:</span>
                            <input type="time" class="form-input" id="Treffp_Zeit" name="Treffp_Zeit" onchange="saveField('Treffp_Zeit', this.value)" style="width: 60px;">
                            <input type="text" class="form-input" id="Treffpunkt" name="Treffpunkt" onchange="saveField('Treffpunkt', this.value)" style="width: 180px;">
                        </div>
                        <div class="form-row">
                            <span class="form-label" style="min-width: 85px; text-align: right;">Ansprechp.:</span>
                            <input type="text" class="form-input" id="Ansprechpartner" name="Ansprechpartner" onchange="saveField('Ansprechpartner', this.value)" style="width: 180px;">
                        </div>
                        <div class="form-row">
                            <span class="form-label" style="min-width: 85px; text-align: right;">Dienstkleidung:</span>
                            <input type="text" class="form-input" id="Dienstkleidung" name="Dienstkleidung" list="kleidungListe" onchange="saveField('Dienstkleidung', this.value)" style="width: 180px;">
                        </div>
                        <div class="form-row">
                            <span class="form-label" style="min-width: 85px; text-align: right;">Kunde:</span>
                            <select class="form-select" id="Veranstalter_ID" name="Veranstalter_ID" onchange="veranstalterChanged()" style="width: 180px;">
                                <option value="">-- Kunde waehlen --</option>
                            </select>
                        </div>
                    </div>

                    <!-- Block 3: Fahrtkosten, PKW, Datum-Nav, Mitarbeiterauswahl, Positionen -->
                    <div class="form-column" style="order: 3; display: flex; flex-direction: column; gap: 3px; align-items: flex-start;">
                        <div class="form-row">
                            <span class="form-label" style="min-width: 75px; text-align: right;">Fahrtkosten:</span>
                            <input type="text" class="form-input" id="Fahrtkosten" name="Fahrtkosten" value="0,00" onchange="saveField('Fahrtkosten', this.value)" style="width: 70px;">
                        </div>
                        <div class="form-row">
                            <span class="form-label" style="min-width: 75px; text-align: right;">PKW:</span>
                            <input type="number" class="form-input" id="PKW_Anzahl" name="PKW_Anzahl" value="0" min="0" style="width: 50px;">
                        </div>
                        <div class="form-row">
                            <button class="nav-btn" id="btnDatumLeft" onclick="datumNavLeft()" style="padding: 2px 6px;">◀</button>
                            <select class="form-select" id="cboVADatum" style="width: 95px;" onchange="vaDatumChanged()">
                                <option value="">-- Datum --</option>
                            </select>
                            <button class="nav-btn" id="btnDatumRight" onclick="datumNavRight()" style="padding: 2px 6px;">▶</button>
                        </div>
                        <div class="form-row" style="gap: 5px;">
                            <button class="btn unified-btn btn-orange" id="btnSchnellPlan" onclick="openMitarbeiterauswahl()" style="padding: 3px 8px;">Mitarbeiterauswahl</button>
                            <button class="btn unified-btn" id="btnPositionen" onclick="openPositionen()" style="padding: 3px 8px;">Positionen</button>
                        </div>
                    </div>

                    <!-- Block 4: Statusblock (ganz rechts) -->
                    <div class="status-block" style="order: 4; margin-left: auto; padding: 5px; background: #b8b8d8; border: 1px solid #808080;">
                        <table class="status-table" id="statusOverview">
                            <tbody>
                                <tr>
                                    <td><strong>Auftragsstatus</strong></td>
                                    <td class="count"><strong>Anzahl</strong></td>
                                    <td><strong>Aktion</strong></td>
                                </tr>
                                <tr data-status="1">
                                    <td>In Planung</td>
                                    <td class="count" id="countPlanung">0</td>
                                    <td><button class="anzeigen-btn" onclick="filterByStatus(1)">Anzeigen</button></td>
                                </tr>
                                <tr data-status="3">
                                    <td>Auftrag beendet, Zeiten noch in Bearb.</td>
                                    <td class="count" id="countBeendet">0</td>
                                    <td><button class="anzeigen-btn" onclick="filterByStatus(3)">Anzeigen</button></td>
                                </tr>
                                <tr data-status="2">
                                    <td>Einsatzliste versendet</td>
                                    <td class="count" id="countVersendet">0</td>
                                    <td><button class="anzeigen-btn" onclick="filterByStatus(2)">Anzeigen</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Work Area -->
                <div class="work-area" style="width: 100%; position: relative; top: 0px;">
                    <!-- Left Work Panel -->
                    <div class="left-work-panel" style="position: relative;">
                        <div class="tab-container" style="position: relative;">
                            <div class="tab-header" style="position: relative; top: -5px;">
                                <!-- Tabs in Access-Reihenfolge (5 sichtbar wie in Access) -->
                                <button class="tab-btn active" data-tab="einsatzliste" data-testid="auftrag-tab-einsatzliste" style="color: rgb(1, 15, 25); height: 33.5938px;">Einsatzliste</button>
                                <button class="tab-btn" data-tab="antworten" data-testid="auftrag-tab-antworten" style="background-color: rgb(247, 247, 247); width: 158.688px; height: 33.5938px; position: relative; top: 0px;">Antworten ausstehend</button>
                                <button class="tab-btn" data-tab="zusatzdateien" data-testid="auftrag-tab-zusatzdateien" style="position: relative;">Zusatzdateien</button>
                                <button class="tab-btn" data-tab="rechnung" data-testid="auftrag-tab-rechnung" style="position: relative;">Rechnung</button>
                                <button class="tab-btn" data-tab="bemerkungen" data-testid="auftrag-tab-bemerkungen" style="position: relative;">Bemerkungen</button>
                                <!-- Versteckte Tabs (nur in HTML, nicht in Access) -->
                                <button class="tab-btn" data-tab="eventdaten" data-testid="auftrag-tab-eventdaten" hidden="" style="position: relative;">Eventdaten</button>
                            </div>
                            <div class="tab-content" style="position: relative;">
                                <!-- Tab 1: Einsatzliste -->
                                <div class="tab-page active" id="tab-einsatzliste" style="position: relative;">
                                    <div class="bwn-row" style="position: relative;">
                                        <button class="btn bwn-btn is-hidden" id="btn_BWN_Druck" onclick="bwnDrucken()" data-testid="auftrag-btn-bwn-drucken" style="position: relative;">BWN drucken</button>
                                        <button class="btn bwn-btn is-hidden" id="cmd_BWN_send" onclick="bwnSenden()" data-testid="auftrag-btn-bwn-senden" style="width: 78.9375px; position: relative;">BWN senden</button>
                                        <button class="btn unified-btn" id="btnVAPlanCrea" onclick="initZuordnungen()" data-testid="auftrag-btn-init-zuordnungen" title="Erstellt leere Zuordnungs-Slots fuer alle Schichten des aktuellen Tages" style="position: relative;">Zuordnungen init.</button>
                                        <span class="status-red" id="lblKeineEingabe" style="display: none; position: relative;">Auftrag bereits berechnet</span>
                                    </div>

                                    <div class="grid-area" style="position: relative;">
                                        <!-- Left Subform: Schichten -->
                                        <div class="subform-left" style="position: relative;">
                                            <div class="grid-wrapper" style="position: relative;">
                                                <table class="data-grid" id="gridSchichten" data-testid="auftrag-table-schichten" style="position: relative;">
                                                    <thead style="position: relative;">
                                                        <tr style="position: relative;">
                                                            <th style="width: 28px; text-align: right;">Anz</th>
                                                            <th style="width: 49px; text-align: center;">von</th>
                                                            <th style="width: 49px; text-align: center;">bis</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="schichtenBody" style="position: relative;"><tr style="position: relative;">
                    <td style="text-align: right; position: relative;">1</td>
                    <td style="text-align: center; position: relative;">17:30</td>
                    <td style="text-align: center; position: relative;" class="cell-blue">23:30</td>
                </tr><tr style="position: relative;">
                    <td style="text-align: right; position: relative;">1</td>
                    <td style="text-align: center; position: relative;">18:00</td>
                    <td style="text-align: center; position: relative;" class="cell-blue">23:30</td>
                </tr><tr style="position: relative;">
                    <td style="text-align: right; position: relative;">11</td>
                    <td style="text-align: center; position: relative;">18:30</td>
                    <td style="text-align: center; position: relative;" class="cell-blue">23:30</td>
                </tr><tr style="position: relative;">
                <td style="position: relative;">*</td>
                <td style="position: relative;"><input type="time" class="schicht-input" data-field="VA_Start" style="position: relative;"></td>
                <td style="position: relative;"><input type="time" class="schicht-input" data-field="VA_Ende" style="position: relative;"></td>
            </tr></tbody>
                                                </table>
                                            </div>
                                            <!-- Absagen -->
                                            <div class="absagen-section" style="position: relative;">
                                                <div class="absagen-label" style="position: relative;">Absagen:</div>
                                                <div class="absagen-grid-wrapper" style="position: relative;">
                                                    <table class="data-grid" id="gridAbsagen" data-testid="auftrag-table-absagen" style="position: relative;">
                                                        <thead style="position: relative;">
                                                            <tr style="position: relative;">
                                                                <th style="width: 20px;"></th>
                                                                <th style="width: 120px;">Mitarbeiter</th>
                                                                <th>Bemerkung</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="absagenBody" style="position: relative;"><tr style="position: relative;">
                <td style="position: relative;">*</td>
                <td style="position: relative;"><select class="form-select" style="width: 100%; position: relative;"></select></td>
                <td style="position: relative;"><input type="text" style="width: 100%; position: relative;"></td>
            </tr></tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Right Subform: MA-Zuordnungen (iframe) -->
                                        <div class="subform-right" style="position: relative;">
                                            <iframe id="sub_MA_VA_Zuordnung" src="sub_MA_VA_Zuordnung.html?v=20260114_1710" style="width: 100%; height: 100%; border: none; display: block; position: relative;" data-testid="auftrag-iframe-einsatzliste">
                                            </iframe>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab 2: Antworten ausstehend -->
                                <div class="tab-page" id="tab-antworten" style="position: relative;">
                                    <div class="bwn-row" style="position: relative;">
                                        <span class="form-label" style="position: relative;">Mitarbeiter geplant:</span>
                                    </div>
                                    <div class="grid-wrapper" style="flex: 1 1 0%; position: relative;">
                                        <table class="data-grid" id="gridStatus" data-testid="auftrag-table-status" style="position: relative;">
                                            <thead style="position: relative;">
                                                <tr style="position: relative;">
                                                    <th>Mitarbeiter</th>
                                                    <th>Status</th>
                                                    <th>Angefragt am</th>
                                                    <th>Antwort</th>
                                                </tr>
                                            </thead>
                                            <tbody id="statusBody" style="position: relative;">
                                                <!-- Wird dynamisch gefullt -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Tab 3: Zusatzdateien -->
                                <div class="tab-page" id="tab-zusatzdateien" style="position: relative;">
                                    <div class="bwn-row" style="position: relative;">
                                        <span class="form-label" style="position: relative;">Doppelklick auf Dateinamen zeigt Inhalt an bzw. offnet Office-Pgm</span>
                                        <button class="btn" id="btnNeuAttach" onclick="neuenAttachHinzufuegen()" data-testid="auftrag-btn-attach-hinzufuegen" style="position: relative;" title="Neuen Attach hinzufuegen">Neuen Attach hinzufuegen</button>
                                    </div>
                                    <div class="grid-wrapper" style="flex: 1 1 0%; position: relative;">
                                        <table class="data-grid" id="gridAttach" data-testid="auftrag-table-attach" style="position: relative;">
                                            <thead style="position: relative;">
                                                <tr style="position: relative;">
                                                    <th>Dateiname</th>
                                                    <th>Typ</th>
                                                    <th>Grose</th>
                                                    <th>Datum</th>
                                                </tr>
                                            </thead>
                                            <tbody id="attachBody" style="position: relative;">
                                                <!-- Wird dynamisch gefullt -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Tab 4: Rechnung -->
                                <div class="tab-page" id="tab-rechnung" style="position: relative;">
                                    <div class="bwn-row" style="position: relative;">
                                        <button class="btn" onclick="rechnungPDF()" data-testid="auftrag-btn-rechnung-pdf" style="position: relative;">Rechnung PDF</button>
                                        <button class="btn" onclick="berechnungslistePDF()" data-testid="auftrag-btn-berechnungsliste-pdf" style="position: relative;">Berechnungsliste PDF</button>
                                        <button class="btn" onclick="rechnungDatenLaden()" data-testid="auftrag-btn-rechnung-daten-laden" style="position: relative;">Daten laden</button>
                                        <button class="btn" onclick="rechnungLexware()" data-testid="auftrag-btn-rechnung-lexware" style="position: relative;">Rechnung in Lexware erstellen</button>
                                    </div>
                                    <div class="form-row" style="margin: 10px 0px; position: relative;">
                                        <span class="form-label" style="position: relative;">Rechnungspositionen:</span>
                                    </div>
                                    <div class="grid-wrapper" style="height: 100px; position: relative;">
                                        <table class="data-grid" id="gridRechPos" data-testid="auftrag-table-rechnungspositionen" style="position: relative;">
                                            <thead style="position: relative;">
                                                <tr style="position: relative;">
                                                    <th>Pos</th>
                                                    <th>Beschreibung</th>
                                                    <th>Menge</th>
                                                    <th>Einzelpreis</th>
                                                    <th>Summe</th>
                                                </tr>
                                            </thead>
                                            <tbody id="rechPosBody" style="position: relative;"></tbody>
                                        </table>
                                    </div>
                                    <div class="form-row" style="margin: 10px 0px; position: relative;">
                                        <span class="form-label" style="position: relative;">Berechnungsliste:</span>
                                        <span style="margin-left: auto; position: relative;">Gesamtsumme Netto:</span>
                                        <input type="text" class="form-input readonly" id="PosGesamtsumme" style="width: 100px; text-align: right; position: relative;" readonly="">
                                    </div>
                                    <div class="grid-wrapper" style="flex: 1 1 0%; position: relative;">
                                        <table class="data-grid" id="gridBerech" data-testid="auftrag-table-berechnung" style="position: relative;">
                                            <thead style="position: relative;">
                                                <tr style="position: relative;">
                                                    <th>Datum</th>
                                                    <th>Mitarbeiter</th>
                                                    <th>von</th>
                                                    <th>bis</th>
                                                    <th>Stunden</th>
                                                    <th>Satz</th>
                                                    <th>Summe</th>
                                                </tr>
                                            </thead>
                                            <tbody id="berechBody" style="position: relative;"></tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Tab 5: Bemerkungen -->
                                <div class="tab-page" id="tab-bemerkungen" style="position: relative;">
                                    <textarea id="Bemerkungen" name="Bemerkungen" style="width: 100%; height: 100%; resize: none; font-size: var(--base-font-size); position: relative;" onchange="saveField('Bemerkungen', this.value)" data-testid="auftrag-textarea-bemerkungen"></textarea>
                                </div>

                                <!-- Tab 6: Eventdaten -->
                                <div class="tab-page" id="tab-eventdaten" style="position: relative;">
                                    <div class="event-form" style="position: relative;">
                                        <div class="event-row" style="position: relative;">
                                            <span class="event-label" style="position: relative;">Datum:</span>
                                            <input type="text" class="event-input event-input-narrow readonly" id="eventDatum" readonly="" style="position: relative;">
                                        </div>
                                        <div class="event-row" style="position: relative;">
                                            <span class="event-label" style="position: relative;">Auftrag:</span>
                                            <input type="text" class="event-input event-input-medium readonly" id="eventAuftrag" readonly="" style="position: relative;">
                                        </div>
                                        <div class="event-row" style="position: relative;">
                                            <span class="event-label" style="position: relative;">Ort:</span>
                                            <input type="text" class="event-input event-input-medium readonly" id="eventOrt" readonly="" style="position: relative;">
                                        </div>
                                        <div class="event-row" style="position: relative;">
                                            <span class="event-label" style="position: relative;">Objekt:</span>
                                            <input type="text" class="event-input event-input-medium readonly" id="eventObjekt" readonly="" style="position: relative;">
                                        </div>
                                        <div class="event-row" style="position: relative;">
                                            <span class="event-label" style="position: relative;">Adresse:</span>
                                            <input type="text" class="event-input event-input-wide readonly" id="eventAdresse" readonly="" style="position: relative;">
                                        </div>
                                        <div class="event-row" style="position: relative;">
                                            <span class="event-label" style="position: relative;">Einlass (Web):</span>
                                            <input type="text" class="event-input event-input-narrow from-web" id="eventEinlass" placeholder="HH:MM" style="position: relative;">
                                        </div>
                                        <div class="event-row" style="position: relative;">
                                            <span class="event-label" style="position: relative;">Beginn (Web):</span>
                                            <input type="text" class="event-input event-input-narrow from-web" id="eventBeginn" placeholder="HH:MM" style="position: relative;">
                                        </div>
                                        <div class="event-row" style="position: relative;">
                                            <span class="event-label" style="position: relative;">Ende (Web):</span>
                                            <input type="text" class="event-input event-input-narrow from-web" id="eventEnde" placeholder="HH:MM" style="position: relative;">
                                        </div>
                                        <div class="event-row" style="position: relative;">
                                            <span class="event-label" style="align-self: flex-start; padding-top: 6px; position: relative;">Informationen (Web):</span>
                                            <textarea class="event-textarea" id="eventInfo" placeholder="Keine Informationen verfügbar" style="position: relative;"></textarea>
                                        </div>
                                        <div class="event-row" style="position: relative;">
                                            <span class="event-label" style="position: relative;">Link (Web):</span>
                                            <a class="event-link" id="eventLink" href="#" target="_blank" style="display: none; position: relative;">Zum Event</a>
                                            <input type="url" class="event-input event-input-wide from-web" id="eventLinkInput" placeholder="https://" pattern="https?://.+" title="Gueltige URL eingeben (http:// oder https://)" style="position: relative;">
                                        </div>
                                        <div class="event-button-row" style="position: relative;">
                                            <button class="btn btn-green" onclick="webDatenLaden()" data-testid="auftrag-btn-webdaten-laden" style="position: relative;">Web-Daten laden</button>
                                            <button class="btn" onclick="eventdatenSpeichern()" data-testid="auftrag-btn-eventdaten-speichern" style="position: relative;">Speichern</button>
                                            <div class="loading-spinner" id="eventSpinner" style="position: relative;"></div>
                                            <span id="eventStatus" style="font-size: var(--base-font-size); color: rgb(96, 96, 96); margin-left: 10px; position: relative;"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Auftragsliste -->
                    <div class="right-panel">
                        <!-- right-header: Statusblock nach oben in lila Block verschoben (26.01.2026) -->

                        <div class="date-nav" style="position: relative;">
                            <span style="position: relative;">Aufträge ab:</span>
                            <input type="date" class="date-input" id="Auftraege_ab" onchange="filterAuftraege()" data-testid="auftrag-date-auftraege-ab" style="position: relative;">

                            <button class="nav-btn tiny-btn" onclick="filterAuftraege()" data-testid="auftrag-btn-filter-go" style="position: relative;">Go</button>
                            <button class="nav-btn" id="btnTgBack" onclick="tageZurueck()" data-testid="auftrag-btn-tage-zurueck" style="position: relative;" title="Tage zurueck">&lt;&lt;</button>
                            <button class="nav-btn" id="btnTgVor" onclick="tageVor()" data-testid="auftrag-btn-tage-vor" style="position: relative;" title="Tage vor">&gt;&gt;</button>
                            <button class="nav-btn" onclick="abHeute()" data-testid="auftrag-btn-ab-heute" style="position: relative;">Ab Heute</button>
                        </div>

                        <div class="auftraege-wrapper" style="position: relative;">
                            <table class="auftraege-table" id="auftraegeTable" data-testid="auftrag-table-auftragsliste" style="position: relative;">
                                <thead style="position: relative;">
                                    <tr style="position: relative;">
                                        <th onclick="sortAuftraege('datum')" style="width: 65px; text-align: center;">Datum</th>
                                        <th onclick="sortAuftraege('auftrag')" style="width: 120px;">Auftrag</th>
                                        <th onclick="sortAuftraege('objekt')" style="width: 90px;">Objekt</th>
                                        <th onclick="sortAuftraege('soll')" style="width: 25px; text-align: center;">Soll</th>
                                        <th onclick="sortAuftraege('ist')" style="width: 25px; text-align: center;">Ist</th>
                                        <th onclick="sortAuftraege('status')" style="width: 50px; text-align: center;">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="auftraegeBody" style="position: relative;">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar" style="position: relative;">
            <span class="status-section" style="position: relative;">Erstellt</span>
            <span class="status-section" id="Erst_von" style="position: relative;">Excel-Import</span>
            <span class="status-section" id="Erst_am" style="position: relative;">12.11.2025, 17:13:16</span>
            <span class="status-section" style="position: relative;">Geandert</span>
            <span class="status-section" id="Aend_von" style="position: relative;"></span>
            <span class="status-section" id="Aend_am" style="position: relative;"></span>
        </div>
    </div>

    <!-- Bestatigungsdialog -->
    <div class="modal" id="confirmModal">
        <div class="modal-content" style="position: relative;">
            <div class="modal-header" style="position: relative;">
                <span id="confirmTitle" style="position: relative;">Bestatigung</span>
                <button class="title-btn close" onclick="closeModal('confirmModal')" style="position: relative;">✕</button>
            </div>
            <div class="modal-body" style="position: relative;">
                <p id="confirmMessage" style="position: relative;"></p>
            </div>
            <div class="modal-footer" style="position: relative;">
                <button class="btn tiny-btn" id="confirmYes" data-testid="auftrag-btn-confirm-ja" style="position: relative;">Ja</button>
                <button class="btn" onclick="closeModal('confirmModal')" data-testid="auftrag-btn-confirm-nein" style="position: relative;">Nein</button>
            </div>
        </div>
    </div>

    <!-- Logger -->
    <script src="js/debug-logger.js" style="position: relative;"></script>
    <script src="js/logger.js" style="position: relative;"></script>

    <!-- WebView2 Bridge -->
    <script src="js/webview2-bridge.js?v=20260116" style="position: relative;"></script>

    <script style="position: relative;">
        'use strict';

        // ============================================
        // KONFIGURATION
        // ============================================
        // API_BASE wird bereits in webview2-bridge.js definiert
        // Falls nicht vorhanden, hier als Fallback definieren
        const API_BASE_LOCAL = (typeof API_BASE !== 'undefined') ? API_BASE : 'http://localhost:5000/api';

        // Aktueller State
        const state = {
            currentAuftragId: null,
            currentVADatumId: null,
            currentVAStartId: null,  // Fix: VA Start ID für Mitarbeiterauswahl
            selectedRowIndex: null,  // FIX 16.01.2026: Für Mehrtages-Aufträge - nur angeklickte Zeile markieren
            auftraege: [],
            schichten: [],
            zuordnungen: [],
            absagen: [],
            lookups: {
                status: [],
                kunden: [],
                objekte: [],
                orte: [],
                auftraege: [],
                dienstkleidung: []
            },
            filterStatus: null,
            sortColumn: 'datum',
            sortDir: 'asc',  // Aufsteigend: nächster/aktuellster Auftrag zuerst
            einsatzlisteReady: false,  // Flag: iframe sub_MA_VA_Zuordnung bereit
            pendingSubformData: null   // Wartende Daten für iframe
        };

        // Message-Listener für iframe-Kommunikation
        window.addEventListener('message', function(event) {
            const data = event.data;
            if (!data || !data.type) return;

            console.log('[Parent] Message von iframe empfangen:', data.type);

            switch (data.type) {
                case 'subform_ready':
                    if (data.name === 'sub_MA_VA_Zuordnung') {
                        console.log('[Parent] Einsatzliste-iframe ist bereit');
                        state.einsatzlisteReady = true;
                        // Falls Daten warten, jetzt senden
                        if (state.pendingSubformData) {
                            sendToEinsatzliste(state.pendingSubformData.VA_ID, state.pendingSubformData.VADatum_ID);
                            state.pendingSubformData = null;
                        }
                    }
                    break;

                case 'subform_changed':
                    // Subform hat Daten geändert - neu laden
                    console.log('[Parent] Subform hat Daten geändert:', data.name);
                    if (state.currentAuftragId) {
                        loadSubformData(state.currentAuftragId, state.currentVADatumId);
                    }
                    break;

                case 'subform_recalc_request':
                    // Subform fordert Neuberechnung an
                    console.log('[Parent] Subform fordert Recalc an:', data.name);
                    break;
            }
        });

        // Hilfsfunktion: Daten an Einsatzliste-iframe senden
        function sendToEinsatzliste(vaId, vadatumId) {
            const iframeEinsatzliste = document.getElementById('sub_MA_VA_Zuordnung');
            if (iframeEinsatzliste && iframeEinsatzliste.contentWindow) {
                iframeEinsatzliste.contentWindow.postMessage({
                    type: 'set_link_params',
                    VA_ID: vaId,
                    VADatum_ID: vadatumId
                }, '*');
                console.log('[sendToEinsatzliste] PostMessage gesendet:', { VA_ID: vaId, VADatum_ID: vadatumId });
            } else {
                console.warn('[sendToEinsatzliste] iframe nicht gefunden oder nicht bereit');
            }
        }

        // iframe-Load Handler - Mehrfach-Retry für robuste Kommunikation
        document.addEventListener('DOMContentLoaded', function() {
            const iframeEinsatzliste = document.getElementById('sub_MA_VA_Zuordnung');
            if (iframeEinsatzliste) {
                iframeEinsatzliste.addEventListener('load', function() {
                    console.log('[iframe] Einsatzliste geladen - starte Retry-Sequenz');

                    // Retry-Sequenz: Mehrmals Daten senden falls iframe noch nicht bereit
                    const retryDelays = [200, 500, 1000, 2000];
                    let retryCount = 0;

                    function retrySendData() {
                        const vaId = state.currentAuftragId || (state.pendingSubformData && state.pendingSubformData.VA_ID);
                        const vadatumId = state.currentVADatumId || (state.pendingSubformData && state.pendingSubformData.VADatum_ID);

                        if (vaId) {
                            console.log(`[iframe] Retry #${retryCount + 1}: Sende Daten VA_ID=${vaId}, VADatum_ID=${vadatumId}`);
                            state.einsatzlisteReady = true;
                            sendToEinsatzliste(vaId, vadatumId);
                        } else {
                            console.log(`[iframe] Retry #${retryCount + 1}: Keine Daten vorhanden`);
                        }

                        // Weitere Retries falls noch ausstehend
                        retryCount++;
                        if (retryCount < retryDelays.length) {
                            setTimeout(retrySendData, retryDelays[retryCount] - retryDelays[retryCount - 1]);
                        }
                    }

                    // Erste Übertragung nach 200ms
                    setTimeout(retrySendData, retryDelays[0]);
                });
            }
        });

        // ============================================
        // INITIALISIERUNG
        // ============================================
        document.addEventListener('DOMContentLoaded', async function() {
            // Formular-Open loggen
            if (typeof Logger !== 'undefined' && Logger.formOpen) {
                const urlParams = new URLSearchParams(window.location.search);
                Logger.formOpen('frm_va_Auftragstamm', {
                    va_id: urlParams.get('id') || urlParams.get('va_id'),
                    shell: urlParams.get('shell') === '1'
                });
            }

            // Datum setzen
            document.getElementById('lblDatum').textContent = formatDate(new Date());
            // Auftraege ab aktuellem Datum filtern (aufsteigend, nächster zuerst)
            // FIX 19.01.2026: Lokales Datum verwenden (toISOString gibt UTC zurück!)
            const now = new Date();
            const today = now.getFullYear() + '-' +
                String(now.getMonth() + 1).padStart(2, '0') + '-' +
                String(now.getDate()).padStart(2, '0');
            document.getElementById('Auftraege_ab').value = today;

            // Status-Filter initial auf "Offen" (entspricht Dropdown-Default)
            // WICHTIG: IMMER auf 1 setzen - Dropdown hat "Offen" als Default selected
            state.filterStatus = 1; // Offen (Veranst_Status_ID = 1)
            console.log('[Init] state.filterStatus initial gesetzt auf:', state.filterStatus);

            // Tab-Wechsel
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });

            // Menu-Navigation
            document.querySelectorAll('.menu-btn[data-form]').forEach(btn => {
                btn.addEventListener('click', function() {
                    navigateToForm(this.dataset.form);
                });
            });

            // Bridge-Events registrieren
            Bridge.on('onDataReceived', function(data) {
                if (data.auftrag) {
                    loadAuftragData(data.auftrag);
                }
                if (data.action === 'load' && data.va_id) {
                    loadAuftrag(data.va_id, data.vadatum_id);
                }
            });

            // Lookups und Daten laden
            await loadLookups();
            await loadAuftraegeListe();

            // URL-Parameter prüfen (va_id)
            const params = new URLSearchParams(window.location.search);
            const vaId = params.get('va_id');
            if (vaId) {
                await loadAuftrag(parseInt(vaId));
            } else if (state.auftraege.length > 0) {
                // Ersten (aktuellsten) Auftrag laden - API liefert ID + VADatum_ID
                const firstAuftrag = getSortedAuftraege()[0];
                await loadAuftrag(firstAuftrag.ID || firstAuftrag.VA_ID, firstAuftrag.VADatum_ID);
            }

            hideLoading();
        });

        // ============================================
        // API-FUNKTIONEN
        // ============================================
        async function apiCall(endpoint, method = 'GET', data = null) {
            const options = {
                method: method,
                headers: { 'Content-Type': 'application/json' }
            };
            if (data && method !== 'GET') {
                options.body = JSON.stringify(data);
            }

            try {
                const response = await fetch(`${API_BASE_LOCAL}${endpoint}`, options);
                const result = await response.json();
                if (!response.ok) {
                    throw new Error(result.error || 'API-Fehler');
                }
                return result;
            } catch (e) {
                console.error('API Error:', e);
                showToast('API-Fehler: ' + e.message, 'error');
                throw e;
            }
        }

        async function loadLookups() {
            try {
                // Parallel laden
                const [statusRes, kundenRes] = await Promise.all([
                    apiCall('/status').catch(() => ({ data: [] })),
                    apiCall('/kunden?aktiv=true').catch(() => ({ data: [] }))
                ]);

                state.lookups.status = statusRes.data || [];
                state.lookups.kunden = kundenRes.data || [];

                // Status-Dropdown fullen
                fillStatusDropdown();
                fillKundenDropdown();

                // Vorschläge laden
                await loadVorschlaege();

            } catch (e) {
                console.error('Lookups laden fehlgeschlagen:', e);
            }
        }

        async function loadVorschlaege() {
            try {
                const [orteRes, objRes, auftrRes, kleidRes] = await Promise.all([
                    apiCall('/auftraege/vorschlaege?feld=ort').catch(() => ({ data: [] })),
                    apiCall('/auftraege/vorschlaege?feld=objekt').catch(() => ({ data: [] })),
                    apiCall('/auftraege/vorschlaege?feld=auftrag').catch(() => ({ data: [] })),
                    apiCall('/auftraege/vorschlaege?feld=dienstkleidung').catch(() => ({ data: [] }))
                ]);

                fillDatalist('ortListe', orteRes.data || []);
                fillDatalist('objektListe', objRes.data || []);
                fillDatalist('auftragListe', auftrRes.data || []);
                fillDatalist('kleidungListe', kleidRes.data || []);
            } catch (e) {
                console.error('Vorschläge laden fehlgeschlagen:', e);
            }
        }

        async function loadAuftraegeListe() {
            showLoading();
            try {
                const datumAb = document.getElementById('Auftraege_ab').value;
                // NEU 16.01.2026: expand_days=true für Mehrtages-Aufträge (jeder Tag separat)
                let url = '/auftraege?limit=200&expand_days=true';
                if (datumAb) {
                    url += `&datum_von=${datumAb}`;
                }
                if (state.filterStatus) {
                    url += `&status=${state.filterStatus}`;
                }

                console.log('[loadAuftraegeListe] API-URL:', url, 'filterStatus:', state.filterStatus);

                const result = await apiCall(url);
                let auftraege = result.data || [];

                // FIX 19.01.2026: CLIENTSEITIGE FILTERUNG (API ignoriert datum_von!)
                if (datumAb) {
                    auftraege = auftraege.filter(a => {
                        const datum = (a.Dat_VA_Von || a.VA_DatumVon || a.Datum || '').substring(0, 10);
                        return datum >= datumAb;
                    });
                    console.log('[loadAuftraegeListe] Clientseitig gefiltert auf >= ' + datumAb + ':', auftraege.length);
                }
                state.auftraege = auftraege;

                console.log('[loadAuftraegeListe] Aufträge geladen:', state.auftraege.length);
                if (state.auftraege.length > 0) {
                    const sorted = getSortedAuftraege();
                    console.log('[loadAuftraegeListe] Erster sortierter Auftrag:', sorted[0].VA_ID, sorted[0].Auftrag, 'VADatum_ID:', sorted[0].VADatum_ID);
                }

                renderAuftraegeListe();
                updateStatusCounts();
            } catch (e) {
                console.error('Auftragsliste laden fehlgeschlagen:', e);
            }
            hideLoading();
        }

        async function loadAuftrag(vaId, vadatumId = null) {
            console.log('[loadAuftrag] Starte mit VA_ID:', vaId, 'VADatum_ID:', vadatumId);
            if (!vaId) {
                console.warn('[loadAuftrag] Abbruch: vaId ist leer');
                return;
            }

            // Kein Loading-Overlay bei Auftragswechsel (verhindert Blinken)
            state.currentAuftragId = vaId;

            try {
                // Auftragsdaten laden
                const result = await apiCall(`/auftraege/${vaId}`);
                const auftrag = result.data?.auftrag || result.data;
                // FIX: Einsatztage kommen bereits mit dem Auftrag
                const einsatztage = result.data?.einsatztage || [];

                if (auftrag) {
                    loadAuftragData(auftrag);

                    // Einsatztage aus dem bereits geladenen Result verwenden
                    fillVADatumDropdown(einsatztage);

                    // Wenn vadatumId gegeben, diesen wahlen
                    if (vadatumId) {
                        document.getElementById('cboVADatum').value = vadatumId;
                        state.currentVADatumId = vadatumId;
                    } else if (einsatztage.length > 0) {
                        state.currentVADatumId = einsatztage[0].ID;
                        document.getElementById('cboVADatum').value = state.currentVADatumId;
                    }

                    // Subformular-Daten laden
                    await loadSubformData();

                    // Zeile in Liste markieren (verwendet state.selectedRowIndex)
                    markSelectedAuftrag(state.selectedRowIndex);
                }
            } catch (e) {
                console.error('Auftrag laden fehlgeschlagen:', e);
                showToast('Auftrag konnte nicht geladen werden', 'error');
            }
        }

        // FIX 16.01.2026: Wrapper-Funktion für Zeilen-Klick mit rowIndex und VADatum_ID
        async function loadAuftragByRow(vaId, rowIndex, vadatumId = null) {
            state.selectedRowIndex = rowIndex;
            // NEU 16.01.2026: VADatum_ID übergeben für korrekten Tag bei Mehrtages-Aufträgen
            console.log('[loadAuftragByRow] VA_ID:', vaId, 'rowIndex:', rowIndex, 'VADatum_ID:', vadatumId);
            await loadAuftrag(vaId, vadatumId);
        }

        function loadAuftragData(auftrag) {
            // Felder fullen - FIX: API liefert VA_ID, nicht ID
            const vaId = auftrag.VA_ID || auftrag.ID || '';
            document.getElementById('ID').value = vaId;
            // Auftragsnummer auch im neuen Anzeigefeld (bei Objekt)
            const vaIdDisplay = document.getElementById('VA_ID_Display');
            if (vaIdDisplay) vaIdDisplay.value = vaId;
            document.getElementById('Dat_VA_Von').value = auftrag.Dat_VA_Von ? auftrag.Dat_VA_Von.substring(0, 10) : '';
            document.getElementById('Dat_VA_Bis').value = auftrag.Dat_VA_Bis ? auftrag.Dat_VA_Bis.substring(0, 10) : '';
            document.getElementById('Auftrag').value = auftrag.Auftrag || '';
            document.getElementById('Ort').value = auftrag.Ort || '';
            document.getElementById('Objekt').value = auftrag.Objekt || '';
            // Objekt_ID-Select entfernt gemaess Layout-Anforderung
            // Felder mit Null-Check (nicht alle Elemente existieren immer)
            const setVal = (id, val) => { const el = document.getElementById(id); if (el) el.value = val; };
            setVal('Treffp_Zeit', auftrag.Treffp_Zeit || '');
            setVal('Treffpunkt', auftrag.Treffpunkt || '');
            setVal('Dienstkleidung', auftrag.Dienstkleidung || '');
            setVal('Ansprechpartner', auftrag.Ansprechpartner || '');
            setVal('PLZ', auftrag.PLZ || '');
            setVal('Veranstalter_ID', auftrag.Veranstalter_ID || '');
            setVal('Veranst_Status_ID', auftrag.Veranst_Status_ID || '1');
            setVal('PKW_Anzahl', auftrag.PKW_Anzahl || 0);
            setVal('Fahrtkosten', formatCurrency(auftrag.Fahrtkosten));
            // Rech_NR nur setzen wenn Element existiert
            const rechNrEl = document.getElementById('Rech_NR');
            if (rechNrEl) rechNrEl.value = auftrag.Rech_NR || '';
            document.getElementById('cbAutosendEL').checked = auftrag.Autosend_EL || false;
            document.getElementById('Bemerkungen').value = auftrag.Bemerkungen || '';

            // Audit-Felder
            document.getElementById('Erst_von').textContent = auftrag.Erst_von || '';
            document.getElementById('Erst_am').textContent = formatDateTime(auftrag.Erst_am);
            document.getElementById('Aend_von').textContent = auftrag.Aend_von || '';
            document.getElementById('Aend_am').textContent = formatDateTime(auftrag.Aend_am);

            // Status prüfen: Read-Only wenn >= 3
            const statusId = parseInt(auftrag.Veranst_Status_ID) || 1;
            setFormReadOnly(statusId >= 3);

            // Bridge informieren (state für WebView2 Event-Kommunikation)
            if (typeof Bridge !== 'undefined' && Bridge.sendEvent) {
                Bridge.sendEvent('formValueChanged', { field: 'va_id', value: auftrag.ID });
            }
        }

        async function loadSubformData(paramVaId, paramVadatumId) {
            // Verwende Parameter falls übergeben, sonst state
            const vaId = paramVaId || state.currentAuftragId;
            let vadatumId = paramVadatumId || state.currentVADatumId;
            if (!vaId) {
                console.log('[loadSubformData] Abbruch: keine vaId');
                return;
            }

            // FIX: vadatumId kann ISO-Datetime sein (2026-01-14T00:00:00) - nur Datum extrahieren
            if (vadatumId && typeof vadatumId === 'string' && vadatumId.includes('T')) {
                vadatumId = vadatumId.split('T')[0];
            }

            console.log('[loadSubformData] Lade Subforms für VA_ID:', vaId, 'VADatum_ID:', vadatumId);

            // State auch aktualisieren wenn Parameter übergeben wurden
            if (paramVaId) state.currentAuftragId = paramVaId;
            if (paramVadatumId) state.currentVADatumId = vadatumId;

            try {
                // Parallel laden
                const [schichtenRes, zuordRes, absagenRes] = await Promise.all([
                    apiCall(`/auftraege/${vaId}/schichten${vadatumId ? '?vadatum_id=' + vadatumId : ''}`).catch(e => { console.error('[loadSubformData] Schichten-Fehler:', e); return { data: [] }; }),
                    apiCall(`/auftraege/${vaId}/zuordnungen${vadatumId ? '?vadatum_id=' + vadatumId : ''}`).catch(e => { console.error('[loadSubformData] Zuordnungen-Fehler:', e); return { data: [] }; }),
                    apiCall(`/auftraege/${vaId}/absagen${vadatumId ? '?vadatum_id=' + vadatumId : ''}`).catch(e => { console.error('[loadSubformData] Absagen-Fehler:', e); return { data: [] }; })
                ]);

                state.schichten = schichtenRes.data || [];
                state.zuordnungen = zuordRes.data || [];
                state.absagen = absagenRes.data || [];

                console.log('[loadSubformData] Ergebnis - Schichten:', state.schichten.length, 'Zuordnungen:', state.zuordnungen.length, 'Absagen:', state.absagen.length);

                renderSchichten();
                renderZuordnungen();
                renderAbsagen();

                // Einsatzliste-iframe benachrichtigen
                if (state.einsatzlisteReady) {
                    // iframe ist bereit - direkt senden
                    sendToEinsatzliste(vaId, vadatumId);
                } else {
                    // iframe noch nicht bereit - Daten zwischenspeichern
                    console.log('[loadSubformData] iframe noch nicht bereit - Daten werden gespeichert');
                    state.pendingSubformData = { VA_ID: vaId, VADatum_ID: vadatumId };
                }

            } catch (e) {
                console.error('Subform-Daten laden fehlgeschlagen:', e);
            }
        }
        // Global exportieren fuer Logic-Modul
        window.loadSubformData = loadSubformData;

        // ============================================
        // RENDERING-FUNKTIONEN
        // ============================================

        // Hilfsfunktion: Sortiertes Aufträge-Array zurückgeben
        function getSortedAuftraege() {
            return [...state.auftraege].sort((a, b) => {
                let aVal = a[state.sortColumn] || '';
                let bVal = b[state.sortColumn] || '';
                if (state.sortColumn === 'datum') {
                    // NEU 16.01.2026: Datum aus tbl_VA_AnzTage (Datum) oder fallback auf Dat_VA_Von
                    aVal = a.Datum || a.Dat_VA_Von || '';
                    bVal = b.Datum || b.Dat_VA_Von || '';
                }
                const cmp = aVal.localeCompare(bVal);
                return state.sortDir === 'asc' ? cmp : -cmp;
            });
        }

        function renderAuftraegeListe() {
            const tbody = document.getElementById('auftraegeBody');
            tbody.innerHTML = '';

            const sortedAuftraege = getSortedAuftraege();

            sortedAuftraege.forEach((a, rowIndex) => {
                const tr = document.createElement('tr');
                // NEU 16.01.2026: VA_ID und VADatum_ID für Mehrtages-Aufträge
                const vaId = a.VA_ID || a.ID;
                const vadatumId = a.VADatum_ID || null;
                // Das Datum aus tbl_VA_AnzTage (Datum) oder fallback auf Dat_VA_Von
                const displayDatum = a.Datum || a.Dat_VA_Von;

                tr.dataset.id = vaId;
                tr.dataset.vadatumId = vadatumId || '';
                tr.dataset.rowIndex = rowIndex;
                if (rowIndex === state.selectedRowIndex) {
                    tr.classList.add('selected');
                }
                tr.innerHTML = `
                    <td style="text-align: center;">${formatDateShort(displayDatum)}</td>
                    <td>${escapeHtml(a.Auftrag || '')}</td>
                    <td>${escapeHtml(a.Objekt || '')}</td>
                    <td style="text-align: center;">${a.MA_Anzahl_Soll ?? a.Soll ?? 0}</td>
                    <td style="text-align: center;">${a.MA_Anzahl_Ist ?? a.Ist ?? 0}</td>
                    <td style="text-align: center;">${getStatusText(a.Veranst_Status_ID)}</td>
                `;
                // NEU 16.01.2026: VADatum_ID übergeben für korrekten Tag
                tr.addEventListener('click', () => loadAuftragByRow(vaId, rowIndex, vadatumId));
                tbody.appendChild(tr);
            });
        }

        function renderSchichten() {
            const tbody = document.getElementById('schichtenBody');
            tbody.innerHTML = '';

            state.schichten.forEach((s, idx) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="text-align: right;">${s.MA_Anzahl || ''}</td>
                    <td style="text-align: center;">${formatTime(s.VA_Start)}</td>
                    <td style="text-align: center;" class="cell-blue">${formatTime(s.VA_Ende)}</td>
                `;
                tr.addEventListener('click', () => selectSchicht(idx));
                tbody.appendChild(tr);
            });

            // Neue Zeile fur Eingabe
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>*</td>
                <td><input type="time" class="schicht-input" data-field="VA_Start"></td>
                <td><input type="time" class="schicht-input" data-field="VA_Ende"></td>
            `;
            tbody.appendChild(newRow);
        }

        function renderZuordnungen() {
            const tbody = document.getElementById('zuordnungenBody');
            // SKIP: zuordnungenBody existiert nicht im Hauptdokument
            // Die Einsatzliste wird vom iframe sub_MA_VA_Zuordnung.html gerendert
            if (!tbody) {
                console.log('[renderZuordnungen] tbody nicht gefunden - wird vom iframe gehandelt');
                return;
            }
            tbody.innerHTML = '';

            // Gruppiere Zuordnungen nach Schicht (VA_Start/VA_Ende)
            // Normalisiere Zeit-Format für korrektes Matching (HH:MM)
            function normalizeTimeKey(val) {
                if (!val) return '';
                // Falls ISO-Datetime (z.B. "1899-12-30T16:45:00"), nur Zeit extrahieren
                if (typeof val === 'string' && val.includes('T')) {
                    val = val.split('T')[1];
                }
                // Falls "HH:MM:SS", zu "HH:MM" kürzen
                if (typeof val === 'string' && val.length >= 5) {
                    return val.substring(0, 5);
                }
                return String(val);
            }

            const zuordnungenBySchicht = {};
            state.zuordnungen.forEach(z => {
                const key = `${normalizeTimeKey(z.VA_Start)}_${normalizeTimeKey(z.VA_Ende)}`;
                if (!zuordnungenBySchicht[key]) {
                    zuordnungenBySchicht[key] = [];
                }
                zuordnungenBySchicht[key].push(z);
            });


            let lfdNr = 0;

            // Iteriere über ALLE Schichten und zeige MA_Anzahl Zeilen pro Schicht
            state.schichten.forEach((schicht, schichtIdx) => {
                const key = `${normalizeTimeKey(schicht.VA_Start)}_${normalizeTimeKey(schicht.VA_Ende)}`;
                const zuordnungen = zuordnungenBySchicht[key] || [];
                const maAnzahl = schicht.MA_Anzahl || 1;
                // ÜBERBUCHUNG-FIX: Zeige MAX(maAnzahl, zuordnungen.length) Zeilen
                // damit überbuchte Zeilen (mehr zugeordnet als erlaubt) sichtbar sind
                const rowCount = Math.max(maAnzahl, zuordnungen.length);

                // Erstelle Zeilen für diese Schicht (inkl. Überbuchungen)
                for (let i = 0; i < rowCount; i++) {
                    lfdNr++;
                    const z = zuordnungen[i]; // Kann undefined sein wenn kein MA zugeordnet
                    const tr = document.createElement('tr');

                    // BEDINGTE FORMATIERUNG (Access-Parität):
                    // - IstFraglich → türkisblaue Hintergrundfarbe
                    // - Unterbuchung (leere Slots) → gelbe Hintergrundfarbe
                    // - Überbuchung (mehr MA als MA_Anzahl) → rote Hintergrundfarbe

                    if (z) {
                        // Zeile MIT zugeordnetem Mitarbeiter
                        const stunden = calculateStunden(z.VA_Start, z.VA_Ende);
                        const maName = z.MA_Name || ((z.Vorname || '') + ' ' + (z.Nachname || '')).trim() || '';
                        const stdFormatted = stunden > 0 ? stunden.toFixed(1) : '';

                        // Bedingte Formatierung anwenden
                        if (z.IstFraglich) {
                            tr.classList.add('ist-fraglich');
                        }
                        // Überbuchung: Wenn mehr MA zugeordnet als MA_Anzahl erlaubt
                        if (i >= maAnzahl) {
                            tr.classList.add('pos-ueberbuchung');
                        }

                        tr.innerHTML = `
                            <td style="text-align: right;">${lfdNr}</td>
                            <td>${escapeHtml(maName)}</td>
                            <td style="text-align: center;">${formatTime(z.VA_Start)}</td>
                            <td style="text-align: center;">${formatTime(z.VA_Ende)}</td>
                            <td style="text-align: right;">${stdFormatted}</td>
                            <td style="text-align: center;">${escapeHtml(z.Bemerkung || '')}</td>
                            <td style="text-align: center;"><input type="checkbox" data-id="${z.ID}" data-field="IstFraglich" ${z.IstFraglich ? 'checked' : ''} onchange="saveZuordnungField(this)"></td>
                            <td style="text-align: center;"><input type="number" data-id="${z.ID}" data-field="PKW" value="${z.PKW || ''}" style="width: 35px; text-align: right;" onchange="saveZuordnungField(this)"></td>
                            <td style="text-align: center;"><input type="checkbox" data-id="${z.ID}" data-field="Einsatzleitung" ${z.Einsatzleitung ? 'checked' : ''} onchange="saveZuordnungField(this)"></td>
                            <td style="text-align: center;"><input type="checkbox" data-id="${z.ID}" data-field="Rch_Erstellt" ${z.Rch_Erstellt ? 'checked' : ''} onchange="saveZuordnungField(this)"></td>
                        `;
                        tr.dataset.id = z.ID;
                        tr.addEventListener('click', () => selectZuordnung(lfdNr - 1));
                    } else {
                        // Leere Zeile OHNE zugeordneten Mitarbeiter (Platzhalter)
                        // UNTERBUCHUNG: Leere Slots → gelbe Hintergrundfarbe (Access-Parität)
                        tr.classList.add('pos-unterbuchung');

                        tr.innerHTML = `
                            <td style="text-align: right;">${lfdNr}</td>
                            <td></td>
                            <td style="text-align: center;">${formatTime(schicht.VA_Start)}</td>
                            <td style="text-align: center;">${formatTime(schicht.VA_Ende)}</td>
                            <td style="text-align: right;"></td>
                            <td style="text-align: center;"></td>
                            <td style="text-align: center;"></td>
                            <td style="text-align: center;"></td>
                            <td style="text-align: center;"></td>
                            <td style="text-align: center;"></td>
                        `;
                        tr.dataset.schichtIdx = schichtIdx;
                        tr.dataset.slotIdx = i;
                        // Klick auf leere Zeile könnte Schnellplanung öffnen
                        tr.addEventListener('click', () => {
                            selectSchicht(schichtIdx);
                        });
                    }
                    tbody.appendChild(tr);
                }
            });

            // Falls keine Schichten definiert sind, zeige die bisherigen Zuordnungen
            if (state.schichten.length === 0 && state.zuordnungen.length > 0) {
                state.zuordnungen.forEach((z, idx) => {
                    const tr = document.createElement('tr');
                    const stunden = calculateStunden(z.VA_Start, z.VA_Ende);
                    const maName = z.MA_Name || ((z.Vorname || '') + ' ' + (z.Nachname || '')).trim() || '';
                    const stdFormatted = stunden > 0 ? stunden.toFixed(1) : '';
                    tr.innerHTML = `
                        <td style="text-align: right;">${idx + 1}</td>
                        <td>${escapeHtml(maName)}</td>
                        <td style="text-align: center;">${formatTime(z.VA_Start)}</td>
                        <td style="text-align: center;">${formatTime(z.VA_Ende)}</td>
                        <td style="text-align: right;">${stdFormatted}</td>
                        <td style="text-align: center;">${escapeHtml(z.Bemerkung || '')}</td>
                        <td style="text-align: center;"><input type="checkbox" data-id="${z.ID}" data-field="IstFraglich" ${z.IstFraglich ? 'checked' : ''} onchange="saveZuordnungField(this)"></td>
                        <td style="text-align: center;"><input type="number" data-id="${z.ID}" data-field="PKW" value="${z.PKW || ''}" style="width: 35px; text-align: right;" onchange="saveZuordnungField(this)"></td>
                        <td style="text-align: center;"><input type="checkbox" data-id="${z.ID}" data-field="Einsatzleitung" ${z.Einsatzleitung ? 'checked' : ''} onchange="saveZuordnungField(this)"></td>
                        <td style="text-align: center;"><input type="checkbox" data-id="${z.ID}" data-field="Rch_Erstellt" ${z.Rch_Erstellt ? 'checked' : ''} onchange="saveZuordnungField(this)"></td>
                    `;
                    tr.dataset.id = z.ID;
                    tr.addEventListener('click', () => selectZuordnung(idx));
                    tbody.appendChild(tr);
                });
            }

            // Nach dem Rendern: Spalten-Sichtbarkeit basierend auf Veranstalter_ID anwenden
            const veranstalterId = state.auftrag?.Veranstalter_ID || state.auftrag?.VA_KD_ID || 0;
            if (typeof window.applyGridZuordnungenColumnRules === 'function') {
                window.applyGridZuordnungenColumnRules(veranstalterId);
            }
        }

        // Funktion zum Speichern von Zuordnungs-Feldern
        async function saveZuordnungField(input) {
            const id = input.dataset.id;
            const field = input.dataset.field;
            const value = input.type === 'checkbox' ? input.checked : input.value;

            // Bedingte Formatierung live aktualisieren (Access-Parität)
            const row = input.closest('tr');
            if (row && field === 'IstFraglich') {
                row.classList.toggle('ist-fraglich', value);
            }

            try {
                const apiBase = (typeof API_BASE_LOCAL !== 'undefined') ? API_BASE_LOCAL : 'http://localhost:5000/api';
                const response = await fetch(apiBase + '/zuordnungen/' + id, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ [field]: value })
                });
                if (!response.ok) throw new Error('Speichern fehlgeschlagen');
            } catch (e) {
                console.error('Fehler beim Speichern:', e);
            }
        }

        function renderAbsagen() {
            const tbody = document.getElementById('absagenBody');
            tbody.innerHTML = '';

            state.absagen.forEach(a => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td></td>
                    <td>${escapeHtml(a.MA_Name || '')}</td>
                    <td>${escapeHtml(a.Bemerkung || '')}</td>
                `;
                tbody.appendChild(tr);
            });

            // Neue Zeile
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>*</td>
                <td><select class="form-select" style="width: 100%;"></select></td>
                <td><input type="text" style="width: 100%;"></td>
            `;
            tbody.appendChild(newRow);
        }

        function fillStatusDropdown() {
            const sel = document.getElementById('Veranst_Status_ID');
            sel.innerHTML = '';
            state.lookups.status.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s.ID;
                opt.textContent = s.Fortschritt;
                sel.appendChild(opt);
            });
        }

        function fillKundenDropdown() {
            const sel = document.getElementById('Veranstalter_ID');
            sel.innerHTML = '<option value="">-- Wahlen --</option>';
            state.lookups.kunden.forEach(k => {
                const opt = document.createElement('option');
                opt.value = k.kun_Id;
                opt.textContent = k.kun_Firma;
                sel.appendChild(opt);
            });
        }

        function fillVADatumDropdown(tage) {
            const sel = document.getElementById('cboVADatum');
            sel.innerHTML = '';
            tage.forEach(t => {
                const opt = document.createElement('option');
                opt.value = t.ID;
                opt.textContent = formatDateShort(t.VADatum);
                sel.appendChild(opt);
            });
        }

        function fillDatalist(id, items) {
            const dl = document.getElementById(id);
            if (!dl) return;
            dl.innerHTML = '';
            items.forEach(item => {
                const opt = document.createElement('option');
                opt.value = typeof item === 'string' ? item : item.value;
                dl.appendChild(opt);
            });
        }

        // FIX 16.01.2026: Verwendet rowIndex statt VA_ID für Mehrtages-Aufträge
        function markSelectedAuftrag(rowIndex) {
            document.querySelectorAll('#auftraegeBody tr').forEach(tr => {
                tr.classList.toggle('selected', parseInt(tr.dataset.rowIndex) === rowIndex);
            });
        }

        function updateStatusCounts() {
            // Einfache Zahlung basierend auf lokalen Daten
            let planung = 0, beendet = 0, versendet = 0;
            state.auftraege.forEach(a => {
                const status = parseInt(a.Veranst_Status_ID) || 1;
                if (status === 1) planung++;
                else if (status === 2) versendet++;
                else if (status === 3) beendet++;
            });
            // Original-Elemente (dunkel-lila Bereich)
            document.getElementById('countPlanung').textContent = planung;
            document.getElementById('countBeendet').textContent = beendet;
            document.getElementById('countVersendet').textContent = versendet;
            // Kompakt-Elemente (hell-lila Bereich, 16.01.2026)
            const planungCompact = document.getElementById('countPlanungCompact');
            const beendetCompact = document.getElementById('countBeendetCompact');
            const versendetCompact = document.getElementById('countVersendetCompact');
            if (planungCompact) planungCompact.textContent = planung;
            if (beendetCompact) beendetCompact.textContent = beendet;
            if (versendetCompact) versendetCompact.textContent = versendet;
        }

        // ============================================
        // EVENT-HANDLER
        // ============================================
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tabName);
            });
            document.querySelectorAll('.tab-page').forEach(page => {
                page.classList.toggle('active', page.id === 'tab-' + tabName);
            });

            // Lazy Loading: Daten laden wenn Tab aktiviert wird
            switch (tabName) {
                case 'antworten':
                    loadAntworten();
                    break;
                case 'zusatzdateien':
                    loadAttachments();
                    break;
                case 'rechnung':
                    loadRechnungsdaten();
                    break;
                case 'eventdaten':
                    loadEventdaten();
                    break;
            }
        }

        function navigateToForm(formName, recordId) {
            // WebView2 Modus
            if (window.chrome && window.chrome.webview && typeof Bridge !== 'undefined') {
                Bridge.navigate(formName, recordId);
                return;
            }
            // Verwende shell-detector.js Funktion wenn verfuegbar
            if (typeof window._shellNavigateToForm === 'function') {
                window._shellNavigateToForm(formName, recordId);
            } else if (window.parent && window.parent !== window) {
                window.parent.postMessage({ type: 'NAVIGATE', formName: formName, id: recordId }, '*');
            } else {
                var url = formName + '.html';
                if (recordId) url += '?id=' + recordId;
                window.location.href = url;
            }
        }

        async function saveField(fieldName, value) {
            if (!state.currentAuftragId) return;

            try {
                await apiCall(`/auftraege/${state.currentAuftragId}`, 'PUT', { [fieldName]: value });
                showToast('Gespeichert', 'success');
            } catch (e) {
                showToast('Speichern fehlgeschlagen', 'error');
            }
        }

        async function statusChanged() {
            const statusId = document.getElementById('Veranst_Status_ID').value;
            await saveField('Veranst_Status_ID', statusId);
            setFormReadOnly(parseInt(statusId) >= 3);
            await loadAuftraegeListe();
        }

        function setFormReadOnly(readonly) {
            const lblKeine = document.getElementById('lblKeineEingabe');
            lblKeine.style.display = readonly ? 'inline' : 'none';

            // Buttons deaktivieren
            const btns = ['btnNeuAuftrag', 'btnKopieren', 'btnLoeschen'];
            btns.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) btn.disabled = readonly;
            });

            // ACCESS-PARITÄT: Veranst_Status_ID_AfterUpdate
            // Me!sub_MA_VA_Zuordnung.Locked = True/False bei Status > 3
            const iframeEinsatzliste = document.getElementById('sub_MA_VA_Zuordnung');
            if (iframeEinsatzliste && iframeEinsatzliste.contentWindow) {
                iframeEinsatzliste.contentWindow.postMessage({
                    type: 'lock_subform',
                    locked: readonly
                }, '*');
            }
        }

        async function datumChanged() {
            const datVon = document.getElementById('Dat_VA_Von').value;
            await saveField('Dat_VA_Von', datVon);
        }

        async function datumBisChanged() {
            const datBis = document.getElementById('Dat_VA_Bis').value;
            await saveField('Dat_VA_Bis', datBis);

            // Einsatztage generieren (wie Access Dat_VA_Bis_AfterUpdate)
            const datVon = document.getElementById('Dat_VA_Von').value;
            if (datVon && datBis && state.currentAuftragId) {
                try {
                    const response = await fetch(`http://localhost:5000/api/auftraege/${state.currentAuftragId}/generate_days`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            von_datum: datVon,
                            bis_datum: datBis,
                            clear_existing: true
                        })
                    });
                    const result = await response.json();
                    if (result.success) {
                        console.log(`[Auftragstamm] ${result.created_count} Einsatztage generiert`);
                        showToast(`${result.created_count} Einsatztage erstellt`, 'success');
                    } else {
                        console.error('[Auftragstamm] Einsatztage-Fehler:', result.error);
                        showToast('Fehler beim Erstellen der Einsatztage: ' + result.error, 'error');
                    }
                } catch (err) {
                    console.error('[Auftragstamm] Einsatztage-Fehler:', err);
                }
            }

            // Tage neu laden wenn sich Datumsbereich andert
            await loadAuftrag(state.currentAuftragId);
        }

        async function vaDatumChanged() {
            state.currentVADatumId = document.getElementById('cboVADatum').value;
            await loadSubformData();
        }

        function datumNavLeft() {
            const sel = document.getElementById('cboVADatum');
            if (sel.selectedIndex > 0) {
                sel.selectedIndex--;
                vaDatumChanged();
            }
        }

        function datumNavRight() {
            const sel = document.getElementById('cboVADatum');
            if (sel.selectedIndex < sel.options.length - 1) {
                sel.selectedIndex++;
                vaDatumChanged();
            }
        }

        // Template-Erkennung bei Auftragsnamen
        function auftragChanged() {
            const auftrag = document.getElementById('Auftrag').value.toLowerCase();
            applyTemplate(auftrag);
            saveField('Auftrag', document.getElementById('Auftrag').value);
        }

        function ortGotFocus() {
            // Template-Erkennung aktivieren
            const auftrag = document.getElementById('Auftrag').value.toLowerCase();
            applyTemplate(auftrag);
        }

        function applyTemplate(auftrag) {
            const templates = {
                'kaufland': { Treffpunkt: '15 min vor Ort', Dienstkleidung: 'Schwarz neutral', Veranstalter_ID: 20770 },
                'greuther': { Ort: 'Furth', Objekt: 'Sportpark am Ronhof', Treffpunkt: '15 min vor DB Tor F', Dienstkleidung: 'Schwarz neutral', Veranstalter_ID: 20737 },
                '1.fcn': { Ort: 'Nurnberg', Objekt: 'Max-Morlock-Stadion', Treffpunkt: '15 min vor DB Eingang Nord West', Dienstkleidung: 'Schwarz neutral', Veranstalter_ID: 20771 },
                'konzert': { Ort: 'Nurnberg', Objekt: 'Hirsch', Treffpunkt: '15 min vor DB vor Ort', Dienstkleidung: 'Consec', Veranstalter_ID: 10233 },
                'clubbing': { Ort: 'Nurnberg', Objekt: 'Hirsch', Treffpunkt: '15 min vor DB vor Ort', Dienstkleidung: 'Consec', Veranstalter_ID: 10337 },
                'hc erlangen': { Ort: 'Nurnberg', Objekt: 'Arena', Treffpunkt: '15 min vor DB Arena Ecke Kurt-Leucht', Dienstkleidung: 'Schwarz neutral', Veranstalter_ID: 20761 }
            };

            for (const [key, template] of Object.entries(templates)) {
                if (auftrag.includes(key)) {
                    for (const [field, value] of Object.entries(template)) {
                        const el = document.getElementById(field);
                        if (el && !el.value) {
                            el.value = value;
                        }
                    }
                    break;
                }
            }
        }

        // Auftragsliste-Filter
        // WICHTIG: Nach jedem Filter-Vorgang den ersten Auftrag laden!
        async function filterAuftraege() {
            // IstStatus-Filter übernehmen (numerische Werte für API)
            const istStatus = parseInt(document.getElementById('IstStatus').value);
            if (istStatus === 0) {
                state.filterStatus = null; // Alle
            } else if (istStatus === 1) {
                state.filterStatus = 1; // Offen (Veranst_Status_ID = 1)
            } else if (istStatus === 2) {
                state.filterStatus = 3; // Abgeschlossen (Veranst_Status_ID >= 3)
            }

            await loadAuftraegeListe();
            // Nach Filtern den ersten Auftrag laden damit Schichten/Einsatzliste angezeigt werden
            if (state.auftraege && state.auftraege.length > 0) {
                { const fa = getSortedAuftraege()[0]; await loadAuftrag(fa.ID || fa.VA_ID, fa.VADatum_ID); }
            }
        }

        /**
         * Auftrag-ID Direktsuche
         * Access: cboID_AfterUpdate
         */
        function handleAuftragIDSearch() {
            const idValue = document.getElementById('cboID').value.trim();
            if (idValue === '') return;

            const id = parseInt(idValue);
            if (isNaN(id)) return;

            // Auftrag direkt laden
            loadAuftrag(id);
        }

        async function filterByStatus(status) {
            state.filterStatus = status;
            await loadAuftraegeListe();
            if (state.auftraege && state.auftraege.length > 0) {
                { const fa = getSortedAuftraege()[0]; await loadAuftrag(fa.ID || fa.VA_ID, fa.VADatum_ID); }
            }
        }

        async function tageZurueck() {
            const input = document.getElementById('Auftraege_ab');
            const date = new Date(input.value);
            date.setDate(date.getDate() - 7);
            input.value = formatDateISO(date);
            await loadAuftraegeListe();
            if (state.auftraege && state.auftraege.length > 0) {
                { const fa = getSortedAuftraege()[0]; await loadAuftrag(fa.ID || fa.VA_ID, fa.VADatum_ID); }
            }
        }

        async function tageVor() {
            const input = document.getElementById('Auftraege_ab');
            const date = new Date(input.value);
            date.setDate(date.getDate() + 7);
            input.value = formatDateISO(date);
            await loadAuftraegeListe();
            if (state.auftraege && state.auftraege.length > 0) {
                { const fa = getSortedAuftraege()[0]; await loadAuftrag(fa.ID || fa.VA_ID, fa.VADatum_ID); }
            }
        }

        async function abHeute() {
            document.getElementById('Auftraege_ab').value = formatDateISO(new Date());
            state.filterStatus = null;
            await loadAuftraegeListe();
            if (state.auftraege && state.auftraege.length > 0) {
                { const fa = getSortedAuftraege()[0]; await loadAuftrag(fa.ID || fa.VA_ID, fa.VADatum_ID); }
            }
        }

        function sortAuftraege(column) {
            if (state.sortColumn === column) {
                state.sortDir = state.sortDir === 'asc' ? 'desc' : 'asc';
            } else {
                state.sortColumn = column;
                state.sortDir = 'asc';
            }
            renderAuftraegeListe();
        }

        // ============================================
        // AKTIONS-FUNKTIONEN
        // ============================================
        async function neuerAuftrag() {
            showLoading();
            try {
                const today = formatDateISO(new Date());
                const result = await apiCall('/auftraege', 'POST', {
                    Auftrag: 'Neuer Auftrag',
                    Dat_VA_Von: today,
                    Dat_VA_Bis: today,
                    Veranst_Status_ID: 1
                });
                if (result.data && result.data.ID) {
                    await loadAuftraegeListe();
                    await loadAuftrag(result.data.ID);
                    showToast('Neuer Auftrag erstellt', 'success');
                }
            } catch (e) {
                showToast('Auftrag konnte nicht erstellt werden', 'error');
            }
            hideLoading();
        }

        // auftragAusVorlage - Auftrag aus Vorlage erstellen
        // Entspricht Access btn_VA_Neu_Aus_Vorlage_Click -> oeffnet frm_Crea_VA_Aus_Vorlage
        async function auftragAusVorlage() {
            // Versuche VBA Bridge
            const result = await callVBAFunction('HTML_btn_VA_Neu_Aus_Vorlage_Click');

            if (result.success) {
                showToast('Vorlage-Dialog geoeffnet', 'success');
            } else {
                // Fallback: Zeige Dialog zur Vorlagenauswahl
                console.log('[Vorlage] VBA Bridge nicht verfuegbar');

                // Lade Vorlagen aus API
                try {
                    const response = await fetch('http://localhost:5000/api/auftraege?ist_vorlage=1&limit=50');
                    const data = await response.json();
                    const vorlagen = data.data || data || [];

                    if (vorlagen.length === 0) {
                        showToast('Keine Vorlagen gefunden', 'warning');
                        return;
                    }

                    // Einfache Auswahl via prompt (TODO: Modal-Dialog)
                    let optionen = 'Vorlage auswaehlen:\\n\\n';
                    vorlagen.forEach((v, i) => {
                        optionen += `${i + 1}. ${v.Auftrag || v.Bezeichnung || 'Vorlage ' + v.ID}\\n`;
                    });
                    optionen += '\\nNummer eingeben:';

                    const auswahl = prompt(optionen);
                    if (!auswahl) return;

                    const idx = parseInt(auswahl) - 1;
                    if (idx < 0 || idx >= vorlagen.length) {
                        showToast('Ungueltige Auswahl', 'error');
                        return;
                    }

                    // Kopiere die ausgewaehlte Vorlage
                    const vorlageId = vorlagen[idx].ID;
                    showToast('Kopiere Vorlage...', 'info');

                    const copyResult = await apiCall(`/auftraege/${vorlageId}/copy`, 'POST', {
                        Dat_VA_Von: new Date().toISOString().split('T')[0]
                    });

                    if (copyResult.data?.ID) {
                        await loadAuftraegeListe();
                        await loadAuftrag(copyResult.data.ID);
                        showToast('Auftrag aus Vorlage erstellt', 'success');
                    }
                } catch (e) {
                    console.error('[Vorlage] Fehler:', e);
                    showToast('Vorlagen konnten nicht geladen werden', 'error');
                }
            }
        }

        async function auftragKopieren() {
            if (!state.currentAuftragId) {
                showToast('Kein Auftrag ausgewahlt', 'warning');
                return;
            }

            // Startdatum abfragen (wie im Original Access mit InputBox)
            const heute = new Date().toISOString().split('T')[0];
            const neuesDatum = prompt('Startdatum für die Kopie eingeben (TT.MM.JJJJ):',
                new Date().toLocaleDateString('de-DE'));

            if (!neuesDatum) {
                showToast('Kopieren abgebrochen', 'warning');
                return;
            }

            showLoading();
            try {
                // VBA Bridge aufrufen: HTML_AuftragKopieren(VA_ID, NeuesStartdatum)
                const response = await fetch('http://localhost:5002/api/vba/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        function: 'HTML_AuftragKopieren',
                        args: [state.currentAuftragId, neuesDatum]
                    })
                });
                const result = await response.json();

                if (result.success && result.result && result.result.startsWith('OK:')) {
                    const neueId = parseInt(result.result.split(':')[1]);
                    await loadAuftraegeListe();
                    await loadAuftrag(neueId);
                    showToast('Auftrag kopiert (ID: ' + neueId + ')', 'success');
                } else {
                    showToast('Kopieren fehlgeschlagen: ' + (result.result || result.error), 'error');
                }
            } catch (e) {
                console.error('[auftragKopieren] Fehler:', e);
                showToast('Kopieren fehlgeschlagen: ' + e.message, 'error');
            }
            hideLoading();
        }

        async function auftragLoeschen() {
            if (!state.currentAuftragId) {
                showToast('Kein Auftrag ausgewahlt', 'warning');
                return;
            }

            const auftragName = document.getElementById('Auftrag')?.value || '';
            showConfirm('Auftrag löschen', `Auftrag "${auftragName}" wirklich löschen?`, async () => {
                showLoading();
                try {
                    // VBA Bridge aufrufen: HTML_AuftragLoeschen(VA_ID)
                    const response = await fetch('http://localhost:5002/api/vba/execute', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            function: 'HTML_AuftragLoeschen',
                            args: [state.currentAuftragId]
                        })
                    });
                    const result = await response.json();

                    if (result.success && result.result && result.result.startsWith('OK')) {
                        state.currentAuftragId = null;
                        await loadAuftraegeListe();
                        if (state.auftraege.length > 0) {
                            { const fa = getSortedAuftraege()[0]; await loadAuftrag(fa.ID || fa.VA_ID, fa.VADatum_ID); }
                        }
                        showToast('Auftrag gelöscht', 'success');
                    } else {
                        showToast('Löschen fehlgeschlagen: ' + (result.result || result.error), 'error');
                    }
                } catch (e) {
                    console.error('[auftragLoeschen] Fehler:', e);
                    showToast('Löschen fehlgeschlagen: ' + e.message, 'error');
                }
                hideLoading();
            });
        }

        async function refreshData() {
            await loadAuftraegeListe();
            if (state.currentAuftragId) {
                await loadAuftrag(state.currentAuftragId, state.currentVADatumId);
            }
            showToast('Daten aktualisiert', 'success');
        }

        // Email-Funktionen - Einsatzliste senden MA
        // Verwendet direkt API-Endpoint (24.01.2026) mit VBA-Bridge als Fallback
        async function sendeEinsatzlisteMA() {
            if (!state.currentAuftragId) {
                showToast('Bitte zuerst einen Auftrag auswählen', 'warning');
                return;
            }

            showToast('Einsatzliste wird an MA gesendet...', 'info');

            try {
                // Zuerst direkt über API versuchen
                const response = await fetch(`${API_BASE}/einsatzliste/senden`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        va_id: state.currentAuftragId,
                        vadatum_id: state.currentVADatumId || null,
                        sender_name: 'Günther Siegert',
                        test_mode: false
                    })
                });

                const result = await response.json();

                if (result.success) {
                    const gesendetCount = result.gesendet?.length || 0;
                    const fehlerCount = result.fehler?.length || 0;
                    const ohneEmailCount = result.ohne_email?.length || 0;

                    let msg = `${gesendetCount} E-Mail(s) gesendet`;
                    if (ohneEmailCount > 0) {
                        msg += `, ${ohneEmailCount} ohne E-Mail-Adresse`;
                    }
                    if (fehlerCount > 0) {
                        msg += `, ${fehlerCount} Fehler`;
                    }

                    showToast(msg, fehlerCount > 0 ? 'warning' : 'success');
                    console.log('[Einsatzliste] Ergebnis:', result);
                } else {
                    throw new Error(result.error || 'Unbekannter Fehler');
                }
            } catch (apiError) {
                console.warn('[Einsatzliste] API-Fehler, versuche VBA-Bridge:', apiError.message);

                // Fallback: VBA Bridge aufrufen
                if (typeof callVBAFunction === 'function') {
                    const result = await callVBAFunction('HTML_btnMailEins_Click',
                        state.currentAuftragId,
                        state.currentVADatumId || 0
                    );

                    if (result.success) {
                        showToast(result.result || 'E-Mails werden versendet (VBA)', 'success');
                    } else {
                        showToast('Fehler: ' + (result.error || apiError.message), 'error');
                    }
                } else {
                    showToast('Fehler: ' + apiError.message, 'error');
                }
            }
        }

        // GESCHÜTZT 16.01.2026 - VBA Bridge (Port 5002)!
        async function sendeEinsatzlisteBOS() {
            if (!state.currentAuftragId) {
                showToast('Bitte zuerst einen Auftrag auswählen', 'warning');
                return;
            }

            // Veranstalter_ID aus aktuellem Auftrag holen
            const currentAuftrag = state.auftraege.find(a => a.ID === state.currentAuftragId);
            const veranstalterId = currentAuftrag?.Veranstalter_ID || 0;

            showToast('Einsatzliste wird an BOS gesendet...', 'info');

            // VBA Bridge aufrufen: HTML_btn_Autosend_BOS_Click(VA_ID, VADatum_ID, Veranstalter_ID)
            const result = await callVBAFunction('HTML_btn_Autosend_BOS_Click',
                state.currentAuftragId,
                state.currentVADatumId || 0,
                veranstalterId
            );

            if (result.success) {
                showToast(result.result || 'BOS E-Mails werden versendet', 'success');
            } else {
                showToast('Fehler: ' + (result.error || 'Unbekannt'), 'error');
            }
        }

        // GESCHÜTZT 16.01.2026 - VBA Bridge (Port 5002)!
        async function sendeEinsatzlisteSUB() {
            if (!state.currentAuftragId) {
                showToast('Bitte zuerst einen Auftrag auswählen', 'warning');
                return;
            }

            showToast('Einsatzliste wird an SUB gesendet...', 'info');

            // VBA Bridge aufrufen: HTML_btnMailSub_Click(VA_ID, VADatum_ID)
            const result = await callVBAFunction('HTML_btnMailSub_Click',
                state.currentAuftragId,
                state.currentVADatumId || 0
            );

            if (result.success) {
                showToast(result.result || 'SUB E-Mails werden versendet', 'success');
            } else {
                showToast('Fehler: ' + (result.error || 'Unbekannt'), 'error');
            }
        }

        // sendeEinsatzlistePOS - Einsatzliste an Positionen senden
        // Entspricht Access btnMailPos_Click -> oeffnet frm_MA_Serien_eMail_Auftrag mit Autosend(3)
        async function sendeEinsatzlistePOS() {
            if (!state.currentAuftragId) {
                showToast('Bitte zuerst einen Auftrag auswaehlen', 'warning');
                return;
            }

            if (!state.currentVADatumId) {
                showToast('Bitte zuerst einen Einsatztag auswaehlen', 'warning');
                return;
            }

            showToast('Einsatzliste wird an Positionen gesendet...', 'info');

            // VBA Bridge aufrufen: HTML_btnMailPos_Click(VA_ID, VADatum_ID)
            const result = await callVBAFunction('HTML_btnMailPos_Click',
                state.currentAuftragId,
                state.currentVADatumId
            );

            if (result.success) {
                showToast(result.result || 'POS E-Mails werden versendet', 'success');
            } else {
                // Fallback: Serien-Mail-Formular direkt oeffnen
                console.log('[POS] VBA Bridge nicht verfuegbar, oeffne Formular direkt');
                const url = `frm_MA_Serien_eMail_Auftrag.html?va_id=${state.currentAuftragId}&vadatum_id=${state.currentVADatumId}&mode=position`;
                window.open(url, '_blank', 'width=900,height=700');
                showToast('Serien-Mail-Formular geoeffnet', 'info');
            }
        }

        // ============================================
        // VBA BRIDGE FUNCTIONS
        // Ruft Access VBA-Funktionen via VBA Bridge Server auf
        // ============================================

        async function callVBAFunction(funcName, ...args) {
            try {
                const response = await fetch('http://localhost:5002/api/vba/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        function: funcName,
                        args: args
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log(`[VBA] ${funcName} Ergebnis:`, result);
                    return result;
                } else {
                    console.error(`[VBA] ${funcName} HTTP-Fehler:`, response.status);
                    return { success: false, error: `HTTP ${response.status}` };
                }
            } catch (e) {
                console.error(`[VBA] ${funcName} Fehler:`, e);
                showToast('VBA Bridge nicht erreichbar!', 'error');
                return { success: false, error: e.message };
            }
        }

        // GESCHÜTZT 16.01.2026 - VBA Bridge (Port 5002)!
        async function einsatzlisteDrucken() {
            if (!state.currentAuftragId) {
                showToast('Bitte zuerst einen Auftrag auswählen', 'warning');
                return;
            }

            // Auftragsdaten aus state holen
            const currentAuftrag = state.auftraege.find(a => a.ID === state.currentAuftragId);
            const auftrag = currentAuftrag?.Auftrag || '';
            const objekt = currentAuftrag?.Objekt || '';
            const datVaVon = currentAuftrag?.Dat_VA_Von || currentAuftrag?.VADatum || '';

            showToast('Einsatzliste wird erstellt (Excel-Export + Status auf Beendet)...', 'info');

            // VBA Bridge aufrufen: HTML_btnDruckZusage_Click(VA_ID, Auftrag, Objekt, Dat_VA_Von)
            const result = await callVBAFunction('HTML_btnDruckZusage_Click',
                state.currentAuftragId,
                auftrag,
                objekt,
                datVaVon
            );

            if (result.success) {
                showToast(result.result || 'Einsatzliste erfolgreich erstellt', 'success');
                // Daten aktualisieren (Status wurde auf Beendet gesetzt)
                await loadAuftraege();
            } else {
                showToast('Fehler: ' + (result.error || 'Unbekannt'), 'error');
            }
        }

        async function namenslisteESS() {
            if (!state.currentAuftragId) {
                showToast('Bitte zuerst einen Auftrag auswählen', 'warning');
                return;
            }

            showToast('Namensliste ESS wird erstellt...', 'info');

            // VBA: Stundenliste_erstellen(VA_ID, MA_ID, kun_ID)
            // Veranstalter_ID aus state.currentAuftrag holen
            const kunId = state.currentAuftrag?.Veranstalter_ID || 0;

            const result = await callVBAFunction('Stundenliste_erstellen',
                state.currentAuftragId,
                0,  // MA_ID (optional)
                kunId
            );

            if (result.success) {
                showToast('Namensliste ESS erfolgreich erstellt', 'success');
            } else {
                // Fallback
                Bridge.sendEvent('print', {
                    type: 'namensliste_ess',
                    va_id: state.currentAuftragId
                });
            }
        }

        async function bwnDrucken() {
            if (!state.currentAuftragId) {
                showToast('Bitte zuerst einen Auftrag auswählen', 'warning');
                return;
            }

            showToast('BWN wird gedruckt...', 'info');

            // Veranstalter_ID aus Formular (muss 20760 fuer ESS sein)
            const veranstalterId = parseInt(document.getElementById('Veranstalter_ID')?.value) || 0;

            try {
                // VBA Bridge Server Call (Port 5002) - Original Access Funktion
                // Ruft HTML_btn_BWN_Druck_Click auf, welche BWN_Beschriften_und_Drucken aufruft
                const response = await fetch('http://localhost:5002/api/vba/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        function: 'HTML_btn_BWN_Druck_Click',
                        args: [state.currentAuftragId, veranstalterId]
                    })
                });
                const result = await response.json();

                if (result.success) {
                    showToast('BWN erfolgreich gedruckt', 'success');
                } else {
                    showToast(result.error || 'BWN Drucken fehlgeschlagen', 'error');
                }
            } catch (error) {
                console.error('[Auftragstamm] BWN Drucken Fehler:', error);
                showToast('VBA Bridge nicht erreichbar', 'error');
            }
        }

        async function bwnSenden() {
            if (!state.currentAuftragId) {
                showToast('Bitte zuerst einen Auftrag auswählen', 'warning');
                return;
            }

            showToast('BWN wird gesendet...', 'info');

            // Veranstalter_ID aus Formular (muss 20760 fuer ESS sein)
            const veranstalterId = parseInt(document.getElementById('Veranstalter_ID')?.value) || 0;

            try {
                // VBA Bridge Server Call (Port 5002) - Original Access Funktion
                // Ruft HTML_cmd_BWN_send_Click auf, welche BWN_Beschriften_und_Senden aufruft
                const response = await fetch('http://localhost:5002/api/vba/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        function: 'HTML_cmd_BWN_send_Click',
                        args: [state.currentAuftragId, veranstalterId]
                    })
                });
                const result = await response.json();

                if (result.success) {
                    showToast('BWN erfolgreich gesendet', 'success');
                } else {
                    showToast(result.error || 'BWN Senden fehlgeschlagen', 'error');
                }
            } catch (error) {
                console.error('[Auftragstamm] BWN Senden Fehler:', error);
                showToast('VBA Bridge nicht erreichbar', 'error');
            }
        }

        /**
         * Initialisiert Zuordnungs-Slots fuer alle Schichten des aktuellen Tages.
         * Entspricht btnVAPlanCrea_Click -> Zuord_Fill() in Access VBA.
         * Erstellt leere Platzhalter-Saetze (MA_ID=0) in tbl_MA_VA_Zuordnung.
         */
        async function initZuordnungen() {
            if (!state.currentAuftragId) {
                showToast('Bitte zuerst einen Auftrag auswaehlen', 'warning');
                return;
            }

            // VADatum_ID ermitteln (aus cboVADatum oder state)
            const cboVADatum = document.getElementById('cboVADatum');
            const vadatumId = cboVADatum?.value || state.currentVADatum_ID;

            if (!vadatumId) {
                showToast('Bitte zuerst ein Datum auswaehlen', 'warning');
                return;
            }

            console.log('[Auftragstamm] initZuordnungen gestartet - VA_ID:', state.currentAuftragId, 'VADatum_ID:', vadatumId);

            try {
                const response = await fetch(`http://localhost:5000/api/auftraege/${state.currentAuftragId}/init_zuordnungen`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ vadatum_id: parseInt(vadatumId) })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();

                if (result.success) {
                    const msg = result.message || `${result.created} Saetze erstellt`;
                    showToast(msg, 'success');
                    console.log('[Auftragstamm] initZuordnungen Ergebnis:', result);

                    // Einsatzliste (iframe) aktualisieren
                    const iframeEinsatzliste = document.getElementById('sub_MA_VA_Zuordnung');
                    if (iframeEinsatzliste?.contentWindow) {
                        iframeEinsatzliste.contentWindow.postMessage({
                            type: 'LOAD_DATA',
                            va_id: state.currentAuftragId,
                            vadatum_id: vadatumId
                        }, '*');
                    }
                } else {
                    showToast(result.error || 'Fehler beim Initialisieren', 'error');
                }

            } catch (error) {
                console.error('[Auftragstamm] initZuordnungen Fehler:', error);
                showToast('API Server nicht erreichbar (Port 5000)', 'error');
            }
        }

        async function openMitarbeiterauswahl() {
            console.log('[openMitarbeiterauswahl] AUFGERUFEN mit state:', {
                currentAuftragId: state.currentAuftragId,
                currentVADatumId: state.currentVADatumId,
                currentVAStartId: state.currentVAStartId,
                currentAuftrag: state.currentAuftrag ? state.currentAuftrag.Auftrag : 'n/a'
            });
            if (!state.currentAuftragId) {
                alert('Bitte zuerst einen Auftrag auswählen!');
                return;
            }

            // VBA Bridge Server pruefen und ggf. starten (fuer E-Mail-Anfragen)
            let vbaBridgeOk = false;
            for (let attempt = 0; attempt < 3; attempt++) {
                try {
                    const healthCheck = await fetch('http://localhost:5002/api/health', {
                        method: 'GET',
                        signal: AbortSignal.timeout(2000)
                    });
                    if (healthCheck.ok) {
                        vbaBridgeOk = true;
                        console.log('[Auftragstamm] VBA Bridge Server erreichbar');
                        break;
                    }
                } catch (e) {
                    if (attempt === 0) {
                        console.warn('[Auftragstamm] VBA Bridge nicht erreichbar, starte Server...');
                        // Versuche Server via Shell zu starten
                        if (window.parent && window.parent !== window) {
                            window.parent.postMessage({ type: 'START_VBA_BRIDGE' }, '*');
                        }
                    }
                    // Warten und erneut versuchen
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
            }

            // Warnung nur wenn nach allen Versuchen nicht erreichbar
            if (!vbaBridgeOk) {
                console.warn('[Auftragstamm] VBA Bridge Server nicht gestartet - E-Mail-Funktion evtl. eingeschränkt');
            }

            // Schnellauswahl in Shell öffnen mit Auftragsdaten
            // Shell erwartet: type: 'NAVIGATE', formName, id, params
            if (window.parent && window.parent !== window) {
                // Im iframe - an Shell senden mit allen relevanten Parametern
                const navMessage = {
                    type: 'NAVIGATE',
                    formName: 'frm_MA_VA_Schnellauswahl',
                    id: state.currentAuftragId,
                    params: {
                        vadatum_id: state.currentVADatumId || null,
                        vastart_id: state.currentVAStartId || null
                    }
                };
                console.log('[openMitarbeiterauswahl] SENDE NAVIGATE:', JSON.stringify(navMessage));
                window.parent.postMessage(navMessage, '*');
            } else {
                // Standalone-Modus: Direkt öffnen mit URL-Parametern
                const url = 'frm_MA_VA_Schnellauswahl.html?va_id=' + state.currentAuftragId +
                           '&vadatum_id=' + (state.currentVADatumId || '') +
                           '&shell=1';
                window.location.href = url;
            }
        }

        function openPositionen() {
            // Objekt_ID aus state
            const objektId = state.currentAuftrag?.Objekt_ID;
            if (!objektId) {
                showToast('Kein Objekt ausgewählt', 'warning');
                return;
            }
            // Browser-Modus: Navigation via Shell
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                    type: 'NAVIGATE',
                    formName: 'sub_OB_Objekt_Positionen',
                    params: { objekt_id: objektId }
                }, '*');
            } else {
                // WebView2-Modus
                Bridge.sendEvent('openPositionen', { objekt_id: objektId });
            }
        }

        function openRueckmeldStatistik() {
            Bridge.navigate('zfrm_Rueckmeldungen');
        }

        function openSyncfehler() {
            Bridge.navigate('zfrm_SyncError');
        }

        function showELGesendet() {
            // Zeigt Dialog mit gesendeten Einsatzlisten fuer aktuellen Auftrag
            if (!state.currentAuftragId) {
                showToast('Kein Auftrag ausgewaehlt', 'warning');
                return;
            }

            // Modal erstellen falls noch nicht vorhanden
            let modal = document.getElementById('elGesendetModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'elGesendetModal';
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-content" style="width: 600px; max-height: 80vh;">
                        <div class="modal-header">
                            <span>Gesendete Einsatzlisten</span>
                            <button onclick="document.getElementById('elGesendetModal').style.display='none'">&times;</button>
                        </div>
                        <div class="modal-body" id="elGesendetBody" style="overflow-y: auto; max-height: 60vh;">
                            <p>Lade Daten...</p>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            modal.style.display = 'flex';
            const body = document.getElementById('elGesendetBody');
            body.innerHTML = '<p>Lade gesendete Einsatzlisten...</p>';

            // API-Aufruf fuer gesendete Listen
            apiCall('/einsatzlisten/gesendet?va_id=' + state.currentAuftragId)
                .then(result => {
                    if (result.data && result.data.length > 0) {
                        let html = '<table class="data-table" style="width: 100%;"><thead><tr>';
                        html += '<th>Datum</th><th>Empfaenger</th><th>Typ</th><th>Status</th></tr></thead><tbody>';
                        result.data.forEach(el => {
                            html += `<tr>
                                <td>${formatDateShort(el.gesendet_am)}</td>
                                <td>${escapeHtml(el.empfaenger || '')}</td>
                                <td>${escapeHtml(el.typ || 'MA')}</td>
                                <td>${el.erfolgreich ? '? Gesendet' : '? Fehler'}</td>
                            </tr>`;
                        });
                        html += '</tbody></table>';
                        body.innerHTML = html;
                    } else {
                        body.innerHTML = '<p>Keine gesendeten Einsatzlisten fuer diesen Auftrag gefunden.</p>';
                    }
                })
                .catch(err => {
                    body.innerHTML = '<p style="color: red;">Fehler beim Laden: ' + err.message + '</p>';
                });
        }

        function openHtmlAnsicht() {
            window.open('frm_va_Auftragstamm.html?va_id=' + state.currentAuftragId, '_blank');
        }

        function closeForm() {
            Bridge.close();
            if (!window.chrome || !window.chrome.webview) {
                window.close();
            }
        }

        function toggleMaximize() {
            // WebView2: Maximize/Restore via Bridge
            if (window.chrome && window.chrome.webview) {
                Bridge.sendEvent('toggleMaximize');
            } else {
                // Browser-Fallback: Fullscreen API
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log('Fullscreen nicht verfuegbar:', err);
                    });
                } else {
                    document.exitFullscreen();
                }
            }
        }

        // Rechnung-Funktionen
        function rechnungPDF() {
            Bridge.sendEvent('pdf', { type: 'rechnung', va_id: state.currentAuftragId });
        }

        function berechnungslistePDF() {
            Bridge.sendEvent('pdf', { type: 'berechnungsliste', va_id: state.currentAuftragId });
        }

        async function rechnungDatenLaden() {
            // Rechnungsdaten vom Backend laden und in Formularfelder eintragen
            if (!state.currentAuftragId) {
                showToast('Kein Auftrag ausgewaehlt', 'warning');
                return;
            }

            showToast('Rechnungsdaten werden geladen...', 'info');

            try {
                const result = await apiCall('/auftraege/' + state.currentAuftragId + '/rechnung');
                if (result.success && result.data) {
                    const rd = result.data;
                    // Felder befuellen
                    setFieldValue('Rechnungsnr', rd.Rechnungsnr || '');
                    setFieldValue('Rch_Datum', rd.Rch_Datum ? formatDateInput(rd.Rch_Datum) : '');
                    setFieldValue('Rch_Betrag', rd.Rch_Betrag || '');
                    setFieldValue('Rch_Erstellt', rd.Rch_Erstellt || false);
                    showToast('Rechnungsdaten geladen', 'success');
                } else {
                    showToast('Keine Rechnungsdaten vorhanden', 'info');
                }
            } catch (err) {
                console.error('Fehler beim Laden der Rechnungsdaten:', err);
                showToast('Fehler: ' + err.message, 'error');
            }
        }

        function formatDateInput(dateStr) {
            // Konvertiert Datum zu YYYY-MM-DD fuer input[type=date]
            if (!dateStr) return '';
            const d = new Date(dateStr);
            return d.toISOString().substring(0, 10);
        }

        function rechnungLexware() {
            Bridge.sendEvent('lexware', { va_id: state.currentAuftragId });
        }

        // 25.01.2026: Fehlende Access-Funktionen hinzugefuegt
        function syncfehlerChecken() {
            // Prueft Synchronisationsfehler fuer aktuellen Auftrag
            if (!state.currentAuftragId) {
                showToast('Kein Auftrag ausgewaehlt', 'warning');
                return;
            }
            // API-Aufruf oder Bridge-Event
            Bridge.sendEvent('syncCheck', { va_id: state.currentAuftragId });
            showToast('Synchronisation wird geprueft...', 'info');
        }

        function ordnerkonzeptOeffnen() {
            // Oeffnet Ordnerstruktur fuer aktuellen Auftrag
            if (!state.currentAuftragId) {
                showToast('Kein Auftrag ausgewaehlt', 'warning');
                return;
            }
            // Bridge-Event zum Oeffnen des Ordnerkonzepts
            Bridge.sendEvent('openFolder', { va_id: state.currentAuftragId, type: 'ordnerkonzept' });
        }

        async function neuenAttachHinzufuegen() {
            if (!state.currentAuftragId) {
                showToast('Kein Auftrag ausgewählt', 'warning');
                return;
            }

            // File-Input erstellen und Klick simulieren
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.accept = '.pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.txt';

            input.onchange = async (e) => {
                const files = e.target.files;
                if (!files || files.length === 0) return;

                showLoading();
                for (const file of files) {
                    try {
                        const formData = new FormData();
                        formData.append('file', file);
                        formData.append('va_id', state.currentAuftragId);

                        const response = await fetch(`${API_BASE_LOCAL}/auftraege/${state.currentAuftragId}/attachments`, {
                            method: 'POST',
                            body: formData
                        });

                        if (!response.ok) {
                            throw new Error('Upload fehlgeschlagen');
                        }

                        showToast(`${file.name} hochgeladen`, 'success');
                    } catch (err) {
                        showToast(`Fehler bei ${file.name}: ${err.message}`, 'error');
                    }
                }
                hideLoading();
                await loadAttachments();
            };

            input.click();
        }

        async function loadAttachments() {
            if (!state.currentAuftragId) return;

            try {
                const result = await apiCall(`/auftraege/${state.currentAuftragId}/attachments`);
                const attachments = result.data || [];

                const tbody = document.getElementById('attachBody');
                tbody.innerHTML = '';

                attachments.forEach(att => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td style="cursor: pointer; color: #000080; text-decoration: underline;"
                            ondblclick="openAttachment(${att.ID})">${escapeHtml(att.Dateiname || '')}</td>
                        <td>${escapeHtml(att.Typ || '')}</td>
                        <td>${formatFileSize(att.Groesse)}</td>
                        <td>${formatDateShort(att.Erstellt_am)}</td>
                    `;
                    tr.dataset.id = att.ID;

                    // Kontextmenü
                    tr.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        showAttachContextMenu(e, att.ID, att.Dateiname);
                    });

                    tbody.appendChild(tr);
                });
            } catch (e) {
                console.error('Attachments laden fehlgeschlagen:', e);
            }
        }

        function openAttachment(attachId) {
            if (window.chrome && window.chrome.webview) {
                Bridge.sendEvent('openAttachment', { attachment_id: attachId });
            } else {
                // Fallback: Download
                window.open(`${API_BASE_LOCAL}/auftraege/${state.currentAuftragId}/attachments/${attachId}/download`, '_blank');
            }
        }

        async function deleteAttachment(attachId) {
            showConfirm('Datei löschen', 'Möchten Sie diese Datei wirklich löschen?', async () => {
                try {
                    await apiCall(`/auftraege/${state.currentAuftragId}/attachments/${attachId}`, 'DELETE');
                    showToast('Datei gelöscht', 'success');
                    await loadAttachments();
                } catch (e) {
                    showToast('Löschen fehlgeschlagen', 'error');
                }
            });
        }

        function downloadAttachment(attachId) {
            window.open(`${API_BASE_LOCAL}/auftraege/${state.currentAuftragId}/attachments/${attachId}/download`, '_blank');
        }

        function showAttachContextMenu(event, attachId, filename) {
            // Bestehendes Menü entfernen
            const existing = document.querySelector('.context-menu');
            if (existing) existing.remove();

            const menu = document.createElement('div');
            menu.className = 'context-menu';
            menu.style.cssText = `
                position: fixed;
                left: ${event.clientX}px;
                top: ${event.clientY}px;
                background: #c0c0c0;
                border: 2px solid;
                border-color: #fff #808080 #808080 #fff;
                padding: 2px;
                z-index: 2000;
            `;
            menu.innerHTML = `
                <div class="ctx-item" onclick="openAttachment(${attachId})">Öffnen</div>
                <div class="ctx-item" onclick="downloadAttachment(${attachId})">Herunterladen</div>
                <hr style="margin: 2px 0; border: 0; border-top: 1px solid #808080;">
                <div class="ctx-item" onclick="deleteAttachment(${attachId})">Löschen</div>
            `;

            // Styling für Items
            menu.querySelectorAll('.ctx-item').forEach(item => {
                item.style.cssText = 'padding: 4px 20px; cursor: pointer; font-size: var(--base-font-size);';
                item.onmouseover = () => item.style.background = '#000080'; item.style.color = 'white';
                item.onmouseout = () => { item.style.background = ''; item.style.color = ''; };
            });

            document.body.appendChild(menu);

            // Menü schließen bei Klick außerhalb
            document.addEventListener('click', function closeMenu() {
                menu.remove();
                document.removeEventListener('click', closeMenu);
            }, { once: true });
        }

        function formatFileSize(bytes) {
            if (!bytes) return '';
            const kb = bytes / 1024;
            if (kb < 1024) return kb.toFixed(1) + ' KB';
            return (kb / 1024).toFixed(1) + ' MB';
        }

        // ============================================
        // ANTWORTEN-TAB FUNKTIONEN
        // ============================================
        async function loadAntworten() {
            if (!state.currentAuftragId) return;

            try {
                const result = await apiCall(`/auftraege/${state.currentAuftragId}/anfragen`);
                const anfragen = result.data || [];

                const tbody = document.getElementById('statusBody');
                tbody.innerHTML = '';

                anfragen.forEach(a => {
                    const tr = document.createElement('tr');

                    // Status-Farbe - ACCESS-PARITÄT: Status_ID statt Status
                    let statusColor = '';
                    let statusText = '';
                    switch (a.Status_ID) {
                        case 0: statusText = 'Geplant'; statusColor = ''; break;
                        case 1: statusText = 'Angefragt'; statusColor = 'cell-yellow'; break;
                        case 2: statusText = 'Benachrichtigt'; statusColor = 'cell-yellow'; break;
                        case 3: statusText = 'Zugesagt'; statusColor = 'cell-green'; break;
                        case 4: statusText = 'Abgesagt'; statusColor = 'cell-red'; break;
                        default: statusText = '-'; break;
                    }

                    tr.innerHTML = `
                        <td>${escapeHtml(a.MA_Name || (a.Nachname + ', ' + a.Vorname) || '')}</td>
                        <td class="${statusColor}">${statusText}</td>
                        <td>${formatDateTime(a.Anfragezeitpunkt)}</td>
                        <td>${formatDateTime(a.Rueckmeldezeitpunkt)}</td>
                    `;
                    tr.dataset.id = a.ID;
                    tbody.appendChild(tr);
                });

                // Anzahl ausstehende Antworten aktualisieren - Status_ID < 3 = ausstehend
                const ausstehend = anfragen.filter(a => a.Status_ID < 3).length;
                const headerLabel = document.querySelector('#tab-antworten .form-label');
                if (headerLabel) {
                    headerLabel.textContent = `Mitarbeiter geplant: ${anfragen.length} | Ausstehend: ${ausstehend}`;
                }

            } catch (e) {
                console.error('Antworten laden fehlgeschlagen:', e);
            }
        }

        // ============================================
        // RECHNUNG-TAB FUNKTIONEN
        // ============================================
        async function loadRechnungsdaten() {
            if (!state.currentAuftragId) return;

            try {
                // Rechnungspositionen laden
                const posResult = await apiCall(`/auftraege/${state.currentAuftragId}/rechnungspositionen`).catch(() => ({ data: [] }));
                renderRechnungspositionen(posResult.data || []);

                // Berechnungsliste laden
                const berechResult = await apiCall(`/auftraege/${state.currentAuftragId}/berechnungsliste`).catch(() => ({ data: [] }));
                renderBerechnungsliste(berechResult.data || []);

            } catch (e) {
                console.error('Rechnungsdaten laden fehlgeschlagen:', e);
            }
        }

        function renderRechnungspositionen(positionen) {
            const tbody = document.getElementById('rechPosBody');
            tbody.innerHTML = '';

            let gesamtsumme = 0;

            positionen.forEach((pos, idx) => {
                const summe = (pos.Menge || 0) * (pos.Einzelpreis || 0);
                gesamtsumme += summe;

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${idx + 1}</td>
                    <td>${escapeHtml(pos.Beschreibung || '')}</td>
                    <td style="text-align: right;">${pos.Menge || 0}</td>
                    <td style="text-align: right;">${formatCurrency(pos.Einzelpreis)}</td>
                    <td style="text-align: right;">${formatCurrency(summe)}</td>
                `;
                tbody.appendChild(tr);
            });

            document.getElementById('PosGesamtsumme').value = formatCurrency(gesamtsumme) + ' â‚¬';
        }

        function renderBerechnungsliste(eintraege) {
            const tbody = document.getElementById('berechBody');
            tbody.innerHTML = '';

            eintraege.forEach(e => {
                const tr = document.createElement('tr');
                const stunden = calculateStunden(e.VA_Start, e.VA_Ende);
                const summe = stunden * (e.Verrechnungssatz || 0);

                tr.innerHTML = `
                    <td>${formatDateShort(e.VADatum)}</td>
                    <td>${escapeHtml(e.MA_Name || '')}</td>
                    <td>${formatTime(e.VA_Start)}</td>
                    <td>${formatTime(e.VA_Ende)}</td>
                    <td style="text-align: right;">${stunden.toFixed(2)}</td>
                    <td style="text-align: right;">${formatCurrency(e.Verrechnungssatz)}</td>
                    <td style="text-align: right;">${formatCurrency(summe)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // rechnungDatenLaden() wurde bereits früher definiert (Zeile 3464)
        // Diese doppelte Definition wurde entfernt

        // ============================================
        // HELPER-FUNKTIONEN
        // ============================================
        function formatDate(date) {
            if (!date) return '';
            const d = new Date(date);
            return d.toLocaleDateString('de-DE');
        }

        function formatDateISO(date) {
            if (!date) return '';
            const d = new Date(date);
            return d.toISOString().substring(0, 10);
        }

        function formatDateShort(dateStr) {
            if (!dateStr) return '';
            const d = new Date(dateStr);
            const days = ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'];
            return days[d.getDay()] + '. ' + d.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: '2-digit' });
        }

        function getStatusText(statusId) {
            const status = parseInt(statusId) || 1;
            switch(status) {
                case 1: return 'Planung';
                case 2: return 'Vers.';
                case 3: return 'Beendet';
                default: return status;
            }
        }

        function formatDateTime(dateStr) {
            if (!dateStr) return '';
            const d = new Date(dateStr);
            return d.toLocaleString('de-DE');
        }

        function formatTime(timeStr) {
            if (!timeStr) return '';
            if (typeof timeStr === 'string') {
                // ISO-DateTime Format: "1899-12-30T18:00:00" -> "18:00"
                if (timeStr.includes('T')) {
                    const timePart = timeStr.split('T')[1];
                    return timePart ? timePart.substring(0, 5) : '';
                }
                // Einfaches Zeit-Format: "18:00:00" -> "18:00"
                if (timeStr.includes(':')) {
                    return timeStr.substring(0, 5);
                }
            }
            return timeStr;
        }

        function formatCurrency(value) {
            if (!value) return '0,00';
            const num = parseFloat(value);
            return num.toFixed(2).replace('.', ',');
        }

        function calculateStunden(von, bis) {
            if (!von || !bis) return 0;
            const [vh, vm] = von.split(':').map(Number);
            const [bh, bm] = bis.split(':').map(Number);
            let diff = (bh * 60 + bm) - (vh * 60 + vm);
            if (diff < 0) diff += 24 * 60; // Uber Mitternacht
            return diff / 60;
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = 'toast ' + type;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function showConfirm(title, message, onConfirm) {
            const modal = document.getElementById('confirmModal');
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmYes').onclick = () => {
                closeModal('confirmModal');
                onConfirm();
            };
            modal.classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function selectSchicht(idx) {
            // Schicht auswaehlen und markieren
            state.selectedSchichtIdx = idx;
            const schicht = state.schichten[idx];

            // Fix: VA Start ID für Mitarbeiterauswahl setzen
            if (schicht && schicht.VAStart_ID) {
                state.currentVAStartId = schicht.VAStart_ID;
                console.log('[selectSchicht] VA Start ID gesetzt:', state.currentVAStartId);
            }

            // Alle Zeilen deselektieren, aktuelle markieren
            document.querySelectorAll('#schichtenBody tr').forEach((tr, i) => {
                tr.classList.toggle('selected', i === idx);
            });

            // Bei Doppelklick: Schicht bearbeiten
            if (event && event.detail === 2 && schicht) {
                editSchichtModal(schicht);
            }
        }

        function selectZuordnung(idx) {
            // Zuordnung auswaehlen und markieren
            state.selectedZuordnungIdx = idx;
            const zuordnung = state.zuordnungen[idx];

            // Alle Zeilen deselektieren, aktuelle markieren
            document.querySelectorAll('#zuordnungenBody tr').forEach((tr, i) => {
                tr.classList.toggle('selected', i === idx);
            });

            // Bei Doppelklick: Zuordnung bearbeiten
            if (event && event.detail === 2 && zuordnung) {
                editZuordnungModal(zuordnung);
            }
        }

        function editSchichtModal(schicht) {
            // Oeffnet Modal zum Bearbeiten einer Schicht
            showToast('Schicht ' + (schicht.ID || '') + ' wird bearbeitet...', 'info');
            Bridge.sendEvent('editSchicht', { schicht_id: schicht.ID, va_id: state.currentAuftragId });
        }

        function editZuordnungModal(zuordnung) {
            // Oeffnet Modal zum Bearbeiten einer Zuordnung
            showToast('Zuordnung ' + (zuordnung.ID || '') + ' wird bearbeitet...', 'info');
            Bridge.sendEvent('editZuordnung', { zuordnung_id: zuordnung.ID, va_id: state.currentAuftragId });
        }

        // Placeholder fur ungenutzte Funktionen
        function auftragGotFocus() {}
        function ortChanged() { saveField('Ort', document.getElementById('Ort').value); }
        function objektChanged() { saveField('Objekt', document.getElementById('Objekt').value); }
        // objektIdChanged entfernt - Objekt_ID-Select wurde entfernt
        function veranstalterChanged() {
            const veranstalterId = parseInt(document.getElementById('Veranstalter_ID').value) || 0;
            saveField('Veranstalter_ID', veranstalterId);

            // BWN-Buttons nur bei Kunde ID 20760 sichtbar (14.01.2026)
            const isBWNKunde = veranstalterId === 20760;
            const btnBWNDruck = document.getElementById('btn_BWN_Druck');
            const btnBWNSend = document.getElementById('cmd_BWN_send');
            if (btnBWNDruck) btnBWNDruck.style.display = isBWNKunde ? '' : 'none';
            if (btnBWNSend) btnBWNSend.style.display = isBWNKunde ? '' : 'none';

            // Einsatzliste: RE-Spalte nur bei ID 20760, PKW/EL versteckt bei ID 20760
            const einsatzlisteFrame = document.querySelector('iframe[src*="sub_MA_VA_Zuordnung"]');
            if (einsatzlisteFrame && einsatzlisteFrame.contentWindow) {
                einsatzlisteFrame.contentWindow.postMessage({
                    type: 'set_veranstalter',
                    veranstalter_id: veranstalterId
                }, '*');
            }
        }

        console.log('[Auftragsverwaltung] Script geladen');

        // Vollbild-Toggle Funktion (Browser Fullscreen API)
        function toggleFullscreen() {
            const btn = document.getElementById('fullscreenBtn');
            if (!document.fullscreenElement) {
                // Vollbild aktivieren
                document.documentElement.requestFullscreen().then(() => {
                    btn.title = 'Vollbild beenden';
                }).catch(err => {
                    console.error('Fullscreen error:', err);
                });
            } else {
                // Vollbild beenden
                document.exitFullscreen().then(() => {
                    btn.title = 'Vollbild';
                }).catch(err => {
                    console.error('Exit fullscreen error:', err);
                });
            }
        }

        // Fullscreen-Change Event Listener
        document.addEventListener('fullscreenchange', () => {
            const btn = document.getElementById('fullscreenBtn');
            btn.title = document.fullscreenElement ? 'Vollbild beenden' : 'Vollbild';
        });

        // ============================================
        // EVENTDATEN-FUNKTIONEN
        // ============================================
        function loadEventdaten() {
            if (!currentRecord || !currentRecord.Auftrag) {
                return;
            }

            // Readonly-Felder aus Hauptformular füllen
            document.getElementById('eventDatum').value = formatDate(new Date(currentRecord.VADatum || Date.now()));
            document.getElementById('eventAuftrag').value = currentRecord.Auftrag || '';
            document.getElementById('eventOrt').value = currentRecord.Ort || '';
            document.getElementById('eventObjekt').value = currentRecord.Objekt || '';

            // Adresse zusammenstellen
            const adresse = [
                currentRecord.Objekt_Strasse,
                currentRecord.Objekt_PLZ,
                currentRecord.Objekt_Ort
            ].filter(Boolean).join(', ');
            document.getElementById('eventAdresse').value = adresse;

            // Web-Daten laden falls vorhanden
            loadEventdatenFromDB();
        }

        async function loadEventdatenFromDB() {
            if (!currentRecord || !currentRecord.Auftrag_ID) {
                return;
            }

            try {
                const response = await fetch(`http://localhost:5000/api/eventdaten/${currentRecord.Auftrag_ID}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data) {
                        document.getElementById('eventEinlass').value = data.Einlass || '';
                        document.getElementById('eventBeginn').value = data.Beginn || '';
                        document.getElementById('eventEnde').value = data.Ende || '';
                        document.getElementById('eventInfo').value = data.Informationen || '';
                        document.getElementById('eventLinkInput').value = data.Link || '';

                        // Link-Anzeige aktualisieren
                        updateEventLink();
                    }
                }
            } catch (error) {
                console.error('Fehler beim Laden der Eventdaten:', error);
            }
        }

        async function webDatenLaden() {
            if (!currentRecord || !currentRecord.Auftrag) {
                showEventStatus('Kein Auftrag ausgewählt', 'error');
                return;
            }

            const spinner = document.getElementById('eventSpinner');
            const statusEl = document.getElementById('eventStatus');

            spinner.classList.add('active');
            statusEl.textContent = 'Suche läuft...';
            statusEl.style.color = '#000080';

            try {
                // Simuliere Web-Scraping/API-Aufruf
                const response = await fetch('http://localhost:5000/api/eventdaten/scrape', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        auftrag: currentRecord.Auftrag,
                        ort: currentRecord.Ort,
                        objekt: currentRecord.Objekt,
                        datum: currentRecord.VADatum
                    })
                });

                if (response.ok) {
                    const data = await response.json();

                    if (data.found) {
                        // Daten gefunden - Felder füllen
                        document.getElementById('eventEinlass').value = data.einlass || '';
                        document.getElementById('eventBeginn').value = data.beginn || '';
                        document.getElementById('eventEnde').value = data.ende || '';
                        document.getElementById('eventInfo').value = data.informationen || '';
                        document.getElementById('eventLinkInput').value = data.link || '';

                        updateEventLink();
                        showEventStatus('Daten erfolgreich geladen', 'success');
                    } else {
                        // Keine Daten gefunden
                        clearEventWebFields();
                        showEventStatus('Keine Informationen verfügbar', 'warning');
                    }
                } else {
                    showEventStatus('Fehler beim Laden der Daten', 'error');
                }
            } catch (error) {
                console.error('Web-Daten Fehler:', error);
                showEventStatus('Verbindungsfehler', 'error');
            } finally {
                spinner.classList.remove('active');
            }
        }

        async function eventdatenSpeichern() {
            if (!currentRecord || !currentRecord.Auftrag_ID) {
                showEventStatus('Kein Auftrag ausgewählt', 'error');
                return;
            }

            const eventData = {
                Auftrag_ID: currentRecord.Auftrag_ID,
                Einlass: document.getElementById('eventEinlass').value,
                Beginn: document.getElementById('eventBeginn').value,
                Ende: document.getElementById('eventEnde').value,
                Informationen: document.getElementById('eventInfo').value,
                Link: document.getElementById('eventLinkInput').value
            };

            try {
                const response = await fetch('http://localhost:5000/api/eventdaten', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(eventData)
                });

                if (response.ok) {
                    showEventStatus('Gespeichert', 'success');
                } else {
                    showEventStatus('Fehler beim Speichern', 'error');
                }
            } catch (error) {
                console.error('Speicher-Fehler:', error);
                showEventStatus('Verbindungsfehler', 'error');
            }
        }

        function updateEventLink() {
            const linkInput = document.getElementById('eventLinkInput').value;
            const linkEl = document.getElementById('eventLink');

            if (linkInput && linkInput.startsWith('http')) {
                linkEl.href = linkInput;
                linkEl.style.display = 'inline';
            } else {
                linkEl.style.display = 'none';
            }
        }

        function clearEventWebFields() {
            document.getElementById('eventEinlass').value = '';
            document.getElementById('eventEinlass').classList.add('no-data');
            document.getElementById('eventBeginn').value = '';
            document.getElementById('eventBeginn').classList.add('no-data');
            document.getElementById('eventEnde').value = '';
            document.getElementById('eventEnde').classList.add('no-data');
            document.getElementById('eventInfo').value = 'Keine Informationen verfügbar';
            document.getElementById('eventInfo').classList.add('no-data');
            document.getElementById('eventLinkInput').value = '';
            document.getElementById('eventLink').style.display = 'none';
        }

        function showEventStatus(message, type) {
            const statusEl = document.getElementById('eventStatus');
            statusEl.textContent = message;

            switch (type) {
                case 'success':
                    statusEl.style.color = '#008000';
                    break;
                case 'error':
                    statusEl.style.color = '#c00000';
                    break;
                case 'warning':
                    statusEl.style.color = '#c08000';
                    break;
                default:
                    statusEl.style.color = '#606060';
            }

            // Status nach 3 Sekunden ausblenden
            setTimeout(() => {
                statusEl.textContent = '';
            }, 3000);
        }

        // Link-Input Change-Handler
        document.addEventListener('DOMContentLoaded', () => {
            const linkInput = document.getElementById('eventLinkInput');
            if (linkInput) {
                linkInput.addEventListener('change', updateEventLink);
                linkInput.addEventListener('input', updateEventLink);
            }
        });
    </script>
    <!-- API-Server Lifecycle (Auto-Start/Stop) -->
    <script src="js/api-lifecycle.js" style="position: relative;"></script>
    <!-- Server Watchdog: Prüft API-Server-Verfügbarkeit -->
    <script src="js/server-watchdog.js" style="position: relative;"></script>
    <!-- Formular-Logik (Button-Handler, API-Calls) -->
    <script type="module" src="logic/frm_va_Auftragstamm.logic.js?v=20260122_2040"></script>




</body></html>
