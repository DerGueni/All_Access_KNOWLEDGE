{"id":"MOD_mdlClipboard","name":"mdlClipboard","kind":"standard","procedures":["Function ClipBoard_GetData()","Function ClipBoard_SetData(MyString As String)","Function ScreenDump()","Function PrtScn(Alles As Boolean)","Function ClipBoard_Clear()"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n     \n'MS KB Artikel Q138910\n'INF: How to Retrieve Information from the Clipboard (ACC 7.0, 97)\n'   Function ClipBoard_GetData()\n\n'MS KB Artikel Q138909\n'INF: How to Send Information to the Clipboard (ACC 7.0, 97)\n'   Function ClipBoard_SetData(MyString As String)\n           \n'MS KB Artikel Q148392\n'INF: How to Capture Screens of Your Forms (ACC 7.0/97) into Clipboard\n'   Function ScreenDump()\n           \n'Function PrtScn(Alles As Boolean)\n    ' Alles = True - Gesamter Bildschirm\n    ' Alles = False - Aktives Fenster\n    \n'Function ClipBoard_Clear()\n      \n      Declare PtrSafe Function OpenClipboard Lib \"user32\" (ByVal hwnd As Long) As Long\n      Declare PtrSafe Function CloseClipboard Lib \"user32\" () As Long\n      Declare PtrSafe Function GetClipboardData Lib \"user32\" (ByVal wFormat As Long) As Long\n      Declare PtrSafe Function SetClipboardData Lib \"user32\" (ByVal wFormat As Long, ByVal hMem As Long) As Long\n      Declare PtrSafe Function EmptyClipboard Lib \"user32\" () As Long\n      \n      Declare PtrSafe Function GlobalAlloc Lib \"kernel32\" (ByVal wFlags&, ByVal dwBytes As Long) As Long\n      Declare PtrSafe Function GlobalLock Lib \"kernel32\" (ByVal hMem As Long) As Long\n      Declare PtrSafe Function GlobalUnlock Lib \"kernel32\" (ByVal hMem As Long) As Long\n      Declare PtrSafe Function GlobalSize Lib \"kernel32\" (ByVal hMem As Long) As Long\n      Declare PtrSafe Function lstrcpy Lib \"kernel32\" (ByVal lpString1 As Any, ByVal lpString2 As Any) As Long\n\n      Declare PtrSafe Sub keybd_event Lib \"user32\" (ByVal bVk As Byte, ByVal bScan As Byte, ByVal dwFlags As Long, ByVal dwExtraInfo As Long)\n  \n      Public Const VK_SNAPSHOT = &H2C\n   \n   Type RECT_Type\n      Left As Long\n      Top As Long\n      Right As Long\n      Bottom As Long\n   End Type\n\n   Declare PtrSafe Function GetActiveWindow Lib \"user32\" () As Long\n   Declare PtrSafe Function GetDesktopWindow Lib \"user32\" () As Long\n   Declare PtrSafe Sub GetWindowRect Lib \"user32\" (ByVal hwnd As Long, lpRect As RECT_Type)\n\n   Declare PtrSafe Function GetDC Lib \"user32\" (ByVal hwnd As Long) As Long\n   Declare PtrSafe Function CreateCompatibleDC Lib \"gdi32\" (ByVal hdc As Long) As Long\n   Declare PtrSafe Function CreateCompatibleBitmap Lib \"gdi32\" (ByVal hdc _\n                                       As Long, ByVal nWidth As Long, _\n                                       ByVal nHeight As Long) As Long\n   Declare PtrSafe Function SelectObject Lib \"gdi32\" (ByVal hdc As Long, _\n                                       ByVal hObject As Long) As Long\n\n   Declare PtrSafe Function BitBlt Lib \"gdi32\" (ByVal hDestDC As Long, _\n                                       ByVal X As Long, ByVal Y _\n                                       As Long, ByVal nWidth As Long, _\n                                       ByVal nHeight As Long, _\n                                       ByVal hSrcDC As Long, _\n                                       ByVal xSrc As Long, _\n                                       ByVal ySrc As Long, _\n                                       ByVal dwRop As Long) As Long\n\n   Declare PtrSafe Function ReleaseDC Lib \"user32\" (ByVal hwnd As Long, ByVal hdc As Long) As Long\n   Declare PtrSafe Function DeleteDC Lib \"gdi32\" (ByVal hdc As Long) As Long\n\n   Public Const GHND = &H42\n   Public Const CF_TEXT = 1\n   Public Const MAXSIZE = 4096\n\n   Global Const SRCCOPY = &HCC0020\n   Global Const CF_BITMAP = 2\n\n\n\n'MS KB Artikel Q138910\n      \n    Function ClipBoard_GetData()\n         \n         Dim hClipMemory As Long\n         Dim lpClipMemory As Long\n         Dim MyString As String\n         Dim Retval As Long\n\n         If OpenClipboard(0&) = 0 Then\n            MsgBox \"Cannot open Clipboard. Another app. may have it open\"\n\n            Exit Function\n         End If\n\n         ' Obtain the handle to the global memory\n         ' block that is referencing the text.\n         hClipMemory = GetClipboardData(CF_TEXT)\n         If IsNull(hClipMemory) Then\n            MsgBox \"Could not allocate memory\"\n            GoTo OutOfHere\n         End If\n\n         ' Lock Clipboard memory so we can reference\n         ' the actual data string.\n         lpClipMemory = GlobalLock(hClipMemory)\n\n         If Not IsNull(lpClipMemory) Then\n\n            MyString = Space$(MAXSIZE)\n            Retval = lstrcpy(MyString, lpClipMemory)\n            Retval = GlobalUnlock(hClipMemory)\n\n            ' Peel off the null terminating character.\n            MyString = Mid(MyString, 1, InStr(1, MyString, Chr$(0), 0) - 1)\n         Else\n            MsgBox \"Could not lock memory to copy string from.\"\n         End If\n\nOutOfHere:\n\n         Retval = CloseClipboard()\n         ClipBoard_GetData = MyString\n\n      End Function\n      \n'MS KB Artikel Q138909\n\n    Function ClipBoard_SetData(MyString As String)\n            \n         Dim hGlobalMemory As Long, lpGlobalMemory As Long\n\n         Dim hClipMemory As Long, X As Long\n\n         ' Allocate moveable global memory.\n         '-------------------------------------------\n         hGlobalMemory = GlobalAlloc(GHND, Len(MyString) + 1)\n\n         ' Lock the block to get a far pointer\n         ' to this memory.\n         lpGlobalMemory = GlobalLock(hGlobalMemory)\n\n         ' Copy the string to this global memory.\n         lpGlobalMemory = lstrcpy(lpGlobalMemory, MyString)\n\n         ' Unlock the memory.\n\n         If GlobalUnlock(hGlobalMemory) <> 0 Then\n            MsgBox \"Could not unlock memory location. Copy aborted.\"\n            GoTo OutOfHere2\n         End If\n\n         ' Open the Clipboard to copy data to.\n         If OpenClipboard(0&) = 0 Then\n            MsgBox \"Could not open the Clipboard. Copy aborted.\"\n            Exit Function\n         End If\n\n         ' Clear the Clipboard.\n         X = EmptyClipboard()\n\n         ' Copy the data to the Clipboard.\n\n         hClipMemory = SetClipboardData(CF_TEXT, hGlobalMemory)\n\nOutOfHere2:\n\n         If CloseClipboard() = 0 Then\n            MsgBox \"Could not close Clipboard.\"\n         End If\n\n         End Function\n\n\n'MS KB Artikel Q148392\n\n   Function ScreenDump()\n      Dim AccessHwnd As Long, DeskHwnd As Long\n      Dim hdc As Long\n      Dim hdcMem As Long\n      Dim RECT As RECT_Type\n      Dim Junk As Long\n      Dim fwidth As Long, fheight As Long\n      Dim hBitmap As Long\n \n      DoCmd.Hourglass True\n \n      '---------------------------------------------------\n      ' Get window handle to Windows and Microsoft Access\n      '---------------------------------------------------\n      DeskHwnd = GetDesktopWindow()\n      AccessHwnd = GetActiveWindow()\n \n      '---------------------------------------------------\n      ' Get screen coordinates of Microsoft Access\n      '---------------------------------------------------\n      Call GetWindowRect(AccessHwnd, RECT)\n      fwidth = RECT.Right - RECT.Left\n      fheight = RECT.Bottom - RECT.Top\n \n      '---------------------------------------------------\n      ' Get the device context of Desktop and allocate memory\n      '---------------------------------------------------\n      hdc = GetDC(DeskHwnd)\n      hdcMem = CreateCompatibleDC(hdc)\n      hBitmap = CreateCompatibleBitmap(hdc, fwidth, fheight)\n \n      If hBitmap <> 0 Then\n         Junk = SelectObject(hdcMem, hBitmap)\n \n         '---------------------------------------------\n         ' Copy the Desktop bitmap to memory location\n         ' based on Microsoft Access coordinates.\n         '---------------------------------------------\n         Junk = BitBlt(hdcMem, 0, 0, fwidth, fheight, hdc, RECT.Left, _\n                       RECT.Top, SRCCOPY)\n \n         '---------------------------------------------\n         ' Set up the Clipboard and copy bitmap\n         '---------------------------------------------\n         Junk = OpenClipboard(DeskHwnd)\n         Junk = EmptyClipboard()\n         Junk = SetClipboardData(CF_BITMAP, hBitmap)\n         Junk = CloseClipboard()\n      End If\n \n      '---------------------------------------------\n      ' Clean up handles\n      '---------------------------------------------\n      Junk = DeleteDC(hdcMem)\n      Junk = ReleaseDC(DeskHwnd, hdc)\n \n      DoCmd.Hourglass False\n \n   End Function\n\nFunction PrtScn(Alles As Boolean)\n\n' Alles = True Gesamter Bildschirm\n' Alles = False - Aktives Fenster\n\n'Tip aus www.basicworld.com\n  ' 32 Bit\n'Die Prozedur keybd_event schafft lässig, was SendKeys nicht kann - beachten Sie\n'bitte, daß das SDK die Verwendung für diese Zwecke fälschlicherweise genau\n'vertauscht dokumentiert: Übergeben Sie ihr im Parameter bVk den virtuellen\n'Tastencode VB_SNAPSHOT für die \"PrintScreen\"-Taste, so erhalten Sie eine Kopie\n'des aktiven Fensters in der Zwischenablage:\n\nIf Not Alles Then\n    keybd_event VK_SNAPSHOT, 0, 0, 0\n'Wünschen Sie, den gesamten Desktop zu kopieren, so setzen Sie den Parameter\n'bScan einfach auf 1:\nElse\n    keybd_event VK_SNAPSHOT, 1, 0, 0\nEnd If\n\nEnd Function\n\n'***** Code start  ********\n'code courtesy of\n'Terry Kreft\n'\nFunction ClipBoard_Clear()\n  Call OpenClipboard(0&)\n  Call EmptyClipboard\n  Call CloseClipboard\nEnd Function\n'***** Code End ********\n"}
