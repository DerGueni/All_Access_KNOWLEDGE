{"id":"MOD_mdlDateinamenAlsTabelle_CL","name":"mdlDateinamenAlsTabelle_CL","kind":"standard","procedures":["Sub ReadFileInfos_CL(strTblName As String, ByVal strFolderName As String, _","Private Sub ReadFolderInfo(rs As DAO.Recordset, strFolderName As String)"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n\nGlobal IstVB_Einlesen As Boolean\nGlobal actyp As String\n\nDim giMainFolderStrLen As Integer\n\nConst gcMaxSubfolders = 250\n'* nur die ersten 250 Unterverzeichnisse pro Ebene berücksichtigen\n\n\n'**********************************************************************************\n'* Hauptfunktion:\n'**********************************************************************************\nSub ReadFileInfos_CL(strTblName As String, ByVal strFolderName As String, _\n    Optional strDatabaseName As String = \"[Current]\")\n'**********************************************************************************\n'* Beispiel:\n'* Call ReadFileInfos(\"tblNeuDateinamen\", \"C:\\Eigene Dateien\")\n'* Call ReadFileInfos(\"tblNeuDateinamen\", \"C:\\Eigene Dateien\", \"C:\\Programme\\Microsoft Office\\Office\\Nordwind.mdb\")\n'*\n'* Änderung am 7.3.1999 strDatabaseName ans Ende und Optional\n'*                      Sofern die Tabelle bereits existiert, wird sie vorher gelöscht\n'*\n'* Öffnet die ACCESS-Datenbank mit dem in strDatabaseName_\n'* übergebenen Namen, bzw. legt diese neu an, wenn nicht vorhanden. _\n'* Legt dort eine neue Tabelle mit dem in strTblName übergebenen _\n'* Namen an und speichert darin die Datei-Informationen des _\n'* Verzeichnisbaums mit der in strFolderName _\n'* übergebenen Wurzel.\n'*\n'**********************************************************************************\n\nDim db As DAO.Database\nDim rs As DAO.Recordset\nDim td As TableDef\nDim fld As field\nDim tbl As DAO.Recordset\n\nDoCmd.Hourglass True\n\ngiMainFolderStrLen = Len(strFolderName)\n\n'* Das if [Current] habe ich eingefügt, um die Tabelle\n'* ggf. in der laufenden DB einfügen zu können\nIf strDatabaseName = \"[Current]\" Then   ' Verwende CurrentDb\n    Set db = CurrentDb\nElse\n    If Dir(strDatabaseName) = \"\" Then ' Datenbank existiert nicht\n        Set db = DBEngine.CreateDatabase(strDatabaseName, dbLangGeneral)\n    Else    ' Datenbank existiert\n        Set db = DBEngine.OpenDatabase(strDatabaseName)\n    End If\nEnd If\n\nSet rs = db.OpenRecordset(strTblName)\n\nIf Right(strFolderName, 1) <> \"\\\" Then strFolderName = strFolderName & \"\\\"\nReadFolderInfo rs, strFolderName\nrs.Close\n\n'* Von mir eingefügt, um die aktuelle DB nicht zu schließen\nIf strDatabaseName <> \"[Current]\" Then\n    db.Close\nElse\n    Set db = Nothing\nEnd If\n\nDoCmd.Hourglass False\n\nEnd Sub\n\n'**********************************************************************************\n'* Rekursionsfunktion:\n'**********************************************************************************\n'* Diese Funktion wird von ReadFileInfos(..) aufgerufen und ruft sich\n'* jedesmal selber auf, wenn der untersuchte Verzeichniseintrag ein\n'* Unterverzeichnis ist. Alle übrigen Dateieinträge werden im übergebenen\n'* Recordset-Objekt gespeichert.\n'* Modified speziell für Code-Lurker - 12.10.2013 K.Obd\n'**********************************************************************************\n\nPrivate Sub ReadFolderInfo(rs As DAO.Recordset, strFolderName As String)\n\nDim arrFoldernames(gcMaxSubfolders)\nDim fileName As String\n'Dim X As FileInfo\n'Dim FileVer As String\n'Dim dwHandle&, BUFSIZE&, lpvData$, r&\nDim iLoop As Long, iLoop2 As Long, Types As String\nDim i As Long\n\nfileName = Dir(strFolderName, vbDirectory)\niLoop = -1\n\n\n'* nur die ersten 250 Unterverzeichnisse berücksichtigen\n'* (Const gcMaxSubfolders = 250)\nWhile fileName <> \"\" And iLoop < gcMaxSubfolders\n    If fileName <> \".\" And fileName <> \"..\" And fileName <> \"\" Then\n        '* Mit bitweisem Vergleich sicherstellen, daß Name1 ein\n        '* Verzeichnis ist.\n        If (GetAttr(strFolderName & fileName) And vbDirectory) = vbDirectory Then\n            iLoop = iLoop + 1\n            arrFoldernames(iLoop) = fileName\n        Else\n''############# nur bestimmte Dateitypen selektieren (siehe auch weiter unten)\n'          ' Um nur bestimmte Dateitypen einzulesen: (auskommentiert, daher alle Dateien)\n'            Types = UCase(Right(FileName, 3))\n'            Select Case Types\n'                Case \"JPG\", \"PCD\", \"PCX\", \"WMF\", \"EMF\", \"DIB\", \"BMP\", \"ICO\", \"EPS\", \"PCT\", \"DXF\", \"CGM\", \"CDR\", \"TGA\", \"GIF\", \"PNG\", \"WPG\", \"DRW\", \"TIF\"\n'                ' Es handelt sich um eine Bild-Datei\n            \n''#############\n                 \n                If IstVB_Einlesen = False Then\n                    actyp = LCase(Right(strFolderName, 4))\n                    actyp = Left(actyp, 3) ' Ohne \"\\\" am Ende\n                    If actyp = \"mac\" Or actyp = \"mdl\" Or actyp = \"rpt\" Or actyp = \"qry\" Or actyp = \"frm\" Then\n                        rs.AddNew\n                            rs!IsUsed = True\n                            If actyp = \"mac\" Then\n                                rs!IsUsed = False\n                            End If\n                            If actyp = \"qry\" Then\n                                rs!IsUsed = False\n                            End If\n                            If actyp = \"mdl\" Or actyp = \"mac\" Or actyp = \"qry\" Then\n                                rs!IstModul = True\n                            End If\n                            rs!Type = actyp\n                            rs!fileName = strFolderName & fileName\n                            rs!formName = Left(fileName, Len(fileName) - 4)\n                        rs.update\n                    End If\n                Else\n                    i = Len(actyp)\n                    If actyp = LCase(Right(fileName, i)) Then\n                        rs.AddNew\n                            If actyp = \"cls\" Or actyp = \"bas\" Then\n                                rs!IstModul = True\n                            End If\n                            rs!Type = actyp\n                            rs!fileName = strFolderName & fileName\n                            rs!formName = Left(fileName, Len(fileName) - 4)\n                        rs.update\n                    End If\n                End If\n\n''############# nur bestimmte Dateitypen selektieren\n'                Case Else\n'            End Select\n''################\n        End If\n    End If\n    fileName = Dir\n    DoEvents\nWend\n\nFor iLoop2 = 0 To iLoop\n    ReadFolderInfo rs, strFolderName & arrFoldernames(iLoop2) & \"\\\"\n    DoEvents\nNext iLoop2\n\nEnd Sub\n"}
