{"id":"MOD_mdlAttach","name":"mdlAttach","kind":"standard","procedures":["Function f_btnNeuAttach(iID As Long, iTable As Long)"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n\nFunction f_btnNeuAttach(iID As Long, iTable As Long)\n\nDim fn As String\nDim Dlen As Long\nDim dtfdate As Date\nDim Drive As String, DirName As String, fname As String, Ext As String\nDim db As DAO.Database\nDim rst As DAO.Recordset\n\n\nfn = AlleSuch()\n\nIf File_exist(fn) = False Then\n\n    MsgBox \" Keine / Falsche Datei ausgewählt \", vbCritical + vbOKOnly, \"Zuordnung fehlgeschlagen\"\n    Exit Function\n\nEnd If\n\n\nCall FParsePath(fn, Drive, DirName, fname, Ext)\n\nSet db = CurrentDb\nSet rst = db.OpenRecordset(\"SELECT TOP 1 * FROM tbl_Zusatzdateien\")\n\n    Dlen = fileLen(fn)\n    dtfdate = FileDateTime(fn)\n\n    rst.AddNew\n        rst.fields(1) = iTable\n        rst.fields(2) = iID\n        rst.fields(3) = fn\n        rst.fields(4) = dtfdate\n        rst.fields(5) = Dlen\n        rst.fields(6) = Ext\n        rst.fields(7) = \"\"\n        rst.fields(8) = \"\"\n        rst.fields(9) = 0\n        rst.fields(10) = atCNames(1)\n        rst.fields(11) = Date\n        rst.fields(12) = atCNames(1)\n        rst.fields(13) = Date\n    rst.update\n\nrst.Close\nSet rst = Nothing\n\nMsgBox \" Dateiname zugeordnet \"\n\nEnd Function\n'\n'\n'Function f_Artikelbilder_Attach()\n'\n'Dim xstr As String\n'Dim xstr1 As String\n'Dim xstr2 As String\n'\n'Dim myArray\n'Dim fn As String\n'Dim i As Long\n'Dim j As Long\n'Dim k As Long\n'\n'Dim iID As Long\n'Dim dtfdate As Date\n'Dim Dlen As Long\n'\n'Dim artnr As String\n'Dim dtnam As String\n'\n'Dim db As DAO.Database\n'Dim rst As DAO.Recordset\n'Dim FullPath As String, Drive As String, DirName As String, fname As String, Ext As String, Ext1 As String\n'\n'xstr2 = TLookup(\"Pfad\", \"_tblEigeneFirma_Pfade\", \"PfadArt = 'Artikelbilder'\")\n'If Right(xstr2, 1) = \"\\\" Then\n'    xstr = Left(xstr2, Len(xstr2) - 1)\n'Else\n'    xstr = xstr2\n'End If\n'xstr1 = \"DIR /S /B \" & Chr$(34) & xstr & Chr$(34) & \" > \" & Chr$(34) & xstr & \"\\x.xxx\" & Chr$(34)\n'Call LaunchApp32DOS(xstr1, True)\n'\n'CurrentDb.Execute (\"DELETE * FROM tbl_Zusatzdateien WHERE TabellenID = 2\")\n'\n'Set db = CurrentDb\n'Set rst = db.OpenRecordset(\"SELECT TOP 1 * FROM tbl_Zusatzdateien\")\n'\n'TextFileLesen xstr & \"\\x.xxx\", myArray\n'DoEvents\n'For i = LBound(myArray) To UBound(myArray)\n'    fn = myArray(i)\n'' Beispiel fn = C:\\Kunden\\Kloy GmbH\\Bilder\\Artikel\\01-001\\Hugo.docx\n'    If File_exist(fn) Then  ' File oder Directory existiert\n'        If Not Dir_Exist(fn) Then ' Datei aber nicht Directory\n'            j = InStrRev(fn, \"\\\")\n'            k = InStrRev(fn, \"\\\", j - 1)\n'            artnr = Mid(fn, k + 1, j - k - 1)\n'            dtnam = Mid(fn, j + 1)\n'            If dtnam <> \"x.xxx\" Then\n''                Debug.Print fn\n''                Debug.Print artnr, dtnam\n'                j = InStr(1, artnr, \"-\")\n'                If j > 0 Then\n'                    artnr = Trim(Left(artnr, j - 1) & Nz(Mid(artnr, j + 1)))\n''                    Debug.Print artnr\n'                End If\n'                iID = TLookup(\"a_int_ID\", \"tblStamm_Artikel\", \"a_strArtikelID = '\" & artnr & \"'\")\n'\n'                If LCase(Left(Nz(fn), 4)) = \"www.\" Then fn = \"http://\" & fn\n'                If LCase(Left(Nz(fn), 4)) = \"http\" Then\n'                    Ext1 = \"HTM\"\n'                ElseIf LCase(Left(Nz(fn), 7)) = \"mailto:\" Then\n'                    Ext1 = \"MAIL\"\n'                Else\n'                    Call FParsePath(fn, Drive, DirName, fname, Ext)\n'                    Ext1 = UCase(Mid(Ext, 2))\n'                End If\n'                If IsNull(TLookup(\"[Typ]\", \"tbl_Texttyp\", \"[Typ] = '\" & UCase(Ext1) & \"'\")) Then Ext1 = \"SONST\"\n'\n'                Dlen = FileLen(fn)\n'                dtfdate = FileDateTime(fn)\n'\n'                rst.AddNew\n'                    rst.Fields(1) = 2\n'                    rst.Fields(2) = iID\n'                    rst.Fields(3) = fn\n'                    rst.Fields(4) = dtfdate\n'                    rst.Fields(5) = Dlen\n'                    rst.Fields(6) = Ext1\n'                    rst.Fields(7) = \"\"\n'                    rst.Fields(8) = \"\"\n'                    rst.Fields(9) = 0\n'                    rst.Fields(10) = atCNames(1)\n'                    rst.Fields(11) = Date\n'                    rst.Fields(12) = atCNames(1)\n'                    rst.Fields(13) = Date\n'                rst.Update\n'\n'            End If\n'        End If\n'    End If\n'Next i\n'rst.Close\n'Set rst = Nothing\n'Kill xstr & \"\\x.xxx\"\n'Set myArray = Nothing\n'MsgBox \"Ferdsch\"\n'\n'\n'End Function\n'\n'"}
