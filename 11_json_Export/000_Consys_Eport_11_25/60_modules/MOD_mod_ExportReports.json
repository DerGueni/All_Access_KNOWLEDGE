{"id":"MOD_mod_ExportReports","name":"mod_ExportReports","kind":"standard","procedures":["Public Sub ExportReportsToJSON(ByVal exportPath As String)","Private Function ExportSingleReportSafe(fileNum As Integer, reportName As String) As Boolean","Private Function GetGroupLevelCount(rpt As Report) As Long","Private Function SafeGetProperty(obj As Object, propName As String, defaultValue As Variant) As Variant","Private Sub ExportReportControl(fileNum As Integer, ctl As control)","Private Sub ExportReportEvent(fileNum As Integer, rpt As Report, eventName As String, ByRef isFirst As Boolean)","Private Function GetControlTypeName(ctrlType As Integer) As String","Private Function GetControlProperty(ctl As control, propName As String) As Variant"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n\n'------------------------------------------------------------------------------\n'  HAUPT-EXPORT-FUNKTION\n'------------------------------------------------------------------------------\nPublic Sub ExportReportsToJSON(ByVal exportPath As String)\n    On Error GoTo ErrorHandler\n\n    Dim f As Integer\n    Dim filePath As String\n    Dim i As Long\n    Dim firstReport As Boolean\n    Dim reportCount As Long\n    Dim skippedCount As Long\n    Dim ar As Access.AccessObject\n\n    filePath = exportPath & \"\\reports.json\"\n    f = FreeFile\n    Open filePath For Output As #f\n\n    ' JSON-Array starten\n    Print #f, \"[\"\n    firstReport = True\n    reportCount = 0\n    skippedCount = 0\n\n    ' Alle Reports durchgehen\n    For i = 0 To CurrentProject.AllReports.Count - 1\n        Set ar = CurrentProject.AllReports(i)\n\n        ' Report im Design-Modus öffnen (hidden)\n        On Error Resume Next\n        DoCmd.OpenReport ar.Name, Access.acViewDesign, , , Access.acHidden\n\n        If err.Number = 0 Then\n            On Error GoTo ErrorHandler\n\n            ' Komma vor weiteren Einträgen\n            If Not firstReport Then Print #f, \",\"\n            firstReport = False\n            reportCount = reportCount + 1\n\n            ' Report-Objekt exportieren\n            If Not ExportSingleReportSafe(f, ar.Name) Then\n                Debug.Print \"      ? Report '\" & ar.Name & \"' teilweise exportiert (mit Fehlern)\"\n                skippedCount = skippedCount + 1\n            End If\n\n            ' Report schließen ohne Speichern\n            DoCmd.Close Access.acReport, ar.Name, Access.acSaveNo\n        Else\n            ' Fehler beim Öffnen – Placeholder schreiben\n            Debug.Print \"      ? Report '\" & ar.Name & \"' konnte nicht geöffnet werden: \" & err.description\n\n            If Not firstReport Then Print #f, \",\"\n            firstReport = False\n\n            Print #f, \"  {\"\n            Print #f, \"    \"\"name\"\": \"\"\" & mod_ExportConsys.EscapeJSON(ar.Name) & \"\"\",\"\n            Print #f, \"    \"\"error\"\": \"\"Could not open report - \" & mod_ExportConsys.EscapeJSON(err.description) & \"\"\",\"\n            Print #f, \"    \"\"recordSource\"\": \"\"ERROR\"\",\"\n            Print #f, \"    \"\"controls\"\": []\"\n            Print #f, \"  }\"\n\n            skippedCount = skippedCount + 1\n            err.clear\n            On Error GoTo ErrorHandler\n        End If\n    Next i\n\n    ' JSON-Array schließen\n    Print #f, \"]\"\n    Close #f\n\n    Debug.Print \"      ? \" & reportCount & \" Reports exportiert\"\n    If skippedCount > 0 Then Debug.Print \"      ? \" & skippedCount & \" Reports mit Fehlern/Warnungen\"\n    Exit Sub\n\nErrorHandler:\n    On Error Resume Next\n    Close #f\n    DoCmd.Close Access.acReport, , Access.acSaveNo\n    Debug.Print \"      ? Fehler: \" & err.description\n    err.Raise err.Number, \"ExportReportsToJSON\", err.description\nEnd Sub\n\n'------------------------------------------------------------------------------\n'  EINZELNEN REPORT EXPORTIEREN (MIT FEHLERBEHANDLUNG)\n'------------------------------------------------------------------------------\nPrivate Function ExportSingleReportSafe(fileNum As Integer, reportName As String) As Boolean\n    On Error GoTo ReportError\n\n    Dim rpt As Report\n    Dim ctl As control\n    Dim firstCtrl As Boolean\n    Dim firstEvent As Boolean\n    Dim hadError As Boolean\n\n    hadError = False\n    Set rpt = Reports(reportName)\n\n    ' Report-Basis-Infos\n    Print #fileNum, \"  {\"\n    Print #fileNum, \"    \"\"name\"\": \"\"\" & mod_ExportConsys.EscapeJSON(reportName) & \"\"\",\"\n    Print #fileNum, \"    \"\"caption\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(SafeGetProperty(rpt, \"Caption\", \"\"), \"\")) & \"\"\",\"\n\n    ' RecordSource mit Fehlerbehandlung\n    Dim recordSource As String\n    On Error Resume Next\n    recordSource = rpt.recordSource\n    If err.Number <> 0 Then\n        recordSource = \"ERROR: \" & err.description\n        hadError = True\n        err.clear\n    End If\n    On Error GoTo ReportError\n\n    Print #fileNum, \"    \"\"recordSource\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(recordSource, \"\")) & \"\"\",\"\n    Print #fileNum, \"    \"\"filter\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(SafeGetProperty(rpt, \"Filter\", \"\"), \"\")) & \"\"\",\"\n    Print #fileNum, \"    \"\"orderBy\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(SafeGetProperty(rpt, \"OrderBy\", \"\"), \"\")) & \"\"\",\"\n    Print #fileNum, \"    \"\"filterOnLoad\"\": \" & LCase$(CStr(SafeGetProperty(rpt, \"FilterOnLoad\", False))) & \",\"\n    Print #fileNum, \"    \"\"orderByOnLoad\"\": \" & LCase$(CStr(SafeGetProperty(rpt, \"OrderByOnLoad\", False))) & \",\"\n\n    ' Sections-Info\n    Print #fileNum, \"    \"\"sections\"\": {\"\n    On Error Resume Next\n    Print #fileNum, \"      \"\"hasReportHeader\"\": \" & LCase$(CStr(rpt.Section(Access.acHeader).Visible)) & \",\"\n    Print #fileNum, \"      \"\"hasReportFooter\"\": \" & LCase$(CStr(rpt.Section(Access.acFooter).Visible)) & \",\"\n    Print #fileNum, \"      \"\"hasPageHeader\"\": \" & LCase$(CStr(rpt.Section(Access.acPageHeader).Visible)) & \",\"\n    Print #fileNum, \"      \"\"hasPageFooter\"\": \" & LCase$(CStr(rpt.Section(Access.acPageFooter).Visible)) & \",\"\n    Print #fileNum, \"      \"\"hasDetail\"\": \" & LCase$(CStr(rpt.Section(Access.acDetail).Visible))\n    If err.Number <> 0 Then err.clear\n    On Error GoTo ReportError\n    Print #fileNum, \"    },\"\n\n    ' Grouping & Sorting\n    Print #fileNum, \"    \"\"grouping\"\": {\"\n    Print #fileNum, \"      \"\"groupLevelCount\"\": \" & GetGroupLevelCount(rpt)\n    Print #fileNum, \"    },\"\n\n    ' Events exportieren\n    Print #fileNum, \"    \"\"events\"\": {\"\n    firstEvent = True\n    ExportReportEvent fileNum, rpt, \"OnOpen\", firstEvent\n    ExportReportEvent fileNum, rpt, \"OnClose\", firstEvent\n    ExportReportEvent fileNum, rpt, \"OnActivate\", firstEvent\n    ExportReportEvent fileNum, rpt, \"OnDeactivate\", firstEvent\n    ExportReportEvent fileNum, rpt, \"OnNoData\", firstEvent\n    ExportReportEvent fileNum, rpt, \"OnPage\", firstEvent\n    Print #fileNum, \"    },\"\n\n    ' Controls exportieren\n    Print #fileNum, \"    \"\"controls\"\": [\"\n    firstCtrl = True\n\n    On Error Resume Next\n    For Each ctl In rpt.controls\n        If err.Number = 0 Then\n            If Not firstCtrl Then Print #fileNum, \",\"\n            firstCtrl = False\n            ExportReportControl fileNum, ctl\n        Else\n            err.clear\n        End If\n    Next ctl\n    On Error GoTo ReportError\n\n    Print #fileNum, \"    ]\"\n    Print #fileNum, \"  }\"\n\n    ExportSingleReportSafe = Not hadError\n    Exit Function\n\nReportError:\n    Print #fileNum, \"  {\"\n    Print #fileNum, \"    \"\"name\"\": \"\"\" & mod_ExportConsys.EscapeJSON(reportName) & \"\"\",\"\n    Print #fileNum, \"    \"\"error\"\": \"\"Export failed - \" & mod_ExportConsys.EscapeJSON(err.description) & \"\"\",\"\n    Print #fileNum, \"    \"\"recordSource\"\": \"\"ERROR\"\",\"\n    Print #fileNum, \"    \"\"controls\"\": []\"\n    Print #fileNum, \"  }\"\n    ExportSingleReportSafe = False\nEnd Function\n\n' Zählt GroupLevels robust (0-basierter Index)\nPrivate Function GetGroupLevelCount(rpt As Report) As Long\n    Dim i As Long\n    Dim gl As GroupLevel\n    On Error Resume Next\n    i = 0\n    Do\n        Set gl = rpt.GroupLevel(i)     ' erfordert Index; löst Fehler aus wenn out of range\n        If err.Number <> 0 Then Exit Do\n        i = i + 1\n        err.clear\n    Loop\n    On Error GoTo 0\n    GetGroupLevelCount = i\nEnd Function\n\n'------------------------------------------------------------------------------\n'  SICHERE PROPERTY-ABFRAGE\n'------------------------------------------------------------------------------\nPrivate Function SafeGetProperty(obj As Object, propName As String, defaultValue As Variant) As Variant\n    On Error Resume Next\n    SafeGetProperty = obj.Properties(propName)\n    If err.Number <> 0 Then\n        SafeGetProperty = defaultValue\n        err.clear\n    End If\n    On Error GoTo 0\nEnd Function\n\n'------------------------------------------------------------------------------\n'  CONTROL EXPORTIEREN\n'------------------------------------------------------------------------------\nPrivate Sub ExportReportControl(fileNum As Integer, ctl As control)\n    On Error Resume Next\n\n    Print #fileNum, \"      {\"\n    Print #fileNum, \"        \"\"name\"\": \"\"\" & mod_ExportConsys.EscapeJSON(ctl.Name) & \"\"\",\"\n    Print #fileNum, \"        \"\"controlType\"\": \" & ctl.ControlType & \",\"\n    Print #fileNum, \"        \"\"controlTypeName\"\": \"\"\" & GetControlTypeName(ctl.ControlType) & \"\"\",\"\n    Print #fileNum, \"        \"\"controlSource\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(GetControlProperty(ctl, \"ControlSource\"), \"\")) & \"\"\",\"\n    Print #fileNum, \"        \"\"section\"\": \" & ctl.Section & \",\"\n    Print #fileNum, \"        \"\"visible\"\": \" & LCase$(CStr(GetControlProperty(ctl, \"Visible\")))\n\n    ' Spezielle Properties für bestimmte Control-Typen\n    Select Case ctl.ControlType\n        Case Access.acLabel, Access.acTextBox\n            Dim caption As Variant\n            caption = GetControlProperty(ctl, \"Caption\")\n            If Not IsNull(caption) And Len(Nz(caption, \"\")) > 0 Then\n                Print #fileNum, \",\"\n                Print #fileNum, \"        \"\"caption\"\": \"\"\" & mod_ExportConsys.EscapeJSON(caption) & \"\"\"\"\n            End If\n\n        Case Access.acSubform\n            Print #fileNum, \",\"\n            Print #fileNum, \"        \"\"sourceObject\"\": \"\"\" & mod_ExportConsys.EscapeJSON(Nz(GetControlProperty(ctl, \"SourceObject\"), \"\")) & \"\"\"\"\n    End Select\n\n    Print #fileNum, \"      }\"\n    On Error GoTo 0\nEnd Sub\n\n'------------------------------------------------------------------------------\n'  EVENT EXPORTIEREN\n'------------------------------------------------------------------------------\nPrivate Sub ExportReportEvent(fileNum As Integer, rpt As Report, eventName As String, ByRef isFirst As Boolean)\n    Dim eventValue As String\n    On Error Resume Next\n    eventValue = rpt.Properties(eventName)\n    If err.Number = 0 And Len(Nz(eventValue, \"\")) > 0 Then\n        If Not isFirst Then Print #fileNum, \",\"\n        isFirst = False\n        Print #fileNum, \"      \"\"\" & eventName & \"\"\": \"\"\" & mod_ExportConsys.EscapeJSON(eventValue) & \"\"\"\"\n    End If\n    err.clear\n    On Error GoTo 0\nEnd Sub\n\n'------------------------------------------------------------------------------\n'  HILFSFUNKTIONEN\n'------------------------------------------------------------------------------\nPrivate Function GetControlTypeName(ctrlType As Integer) As String\n    Select Case ctrlType\n        Case Access.acLabel:            GetControlTypeName = \"Label\"\n        Case Access.acRectangle:        GetControlTypeName = \"Rectangle\"\n        Case Access.acLine:             GetControlTypeName = \"Line\"\n        Case Access.acImage:            GetControlTypeName = \"Image\"\n        Case Access.acTextBox:          GetControlTypeName = \"TextBox\"\n        Case Access.acComboBox:         GetControlTypeName = \"ComboBox\"\n        Case Access.acListBox:          GetControlTypeName = \"ListBox\"\n        Case Access.acCommandButton:    GetControlTypeName = \"CommandButton\"\n        Case Access.acOptionGroup:      GetControlTypeName = \"OptionGroup\"\n        Case Access.acCheckBox:         GetControlTypeName = \"CheckBox\"\n        Case Access.acSubform:          GetControlTypeName = \"Subreport\"\n        Case Access.acPageBreak:        GetControlTypeName = \"PageBreak\"\n        Case Access.acToggleButton:     GetControlTypeName = \"ToggleButton\"\n        Case Access.acTabCtl:           GetControlTypeName = \"TabControl\"\n        Case Access.acPage:             GetControlTypeName = \"Page\"\n        Case Else:                      GetControlTypeName = \"Unknown (\" & ctrlType & \")\"\n    End Select\nEnd Function\n\nPrivate Function GetControlProperty(ctl As control, propName As String) As Variant\n    On Error Resume Next\n    GetControlProperty = ctl.Properties(propName)\n    If err.Number <> 0 Then\n        GetControlProperty = Null\n        err.clear\n    End If\n    On Error GoTo 0\nEnd Function\n"}
