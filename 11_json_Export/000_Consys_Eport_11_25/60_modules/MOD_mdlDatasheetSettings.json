{"id":"MOD_mdlDatasheetSettings","name":"mdlDatasheetSettings","kind":"standard","procedures":["Public Sub LoadUserColumnSetup(ByRef frm As Form)","Private Sub GetOrderedColumns(ByVal strData As String, _","Public Sub SaveUserColumnSetup(ByRef frm As Form)"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n\n'The data for each datasheet's settings are stored in the Windows Registry under a key with the name\n'of the datasheet. The LoadUserColumnSetup pulls that data and applies it, while the\n'SaveUserColumnSetup writes the latest data back to the Registry. Each of those\n'functions take an Access.Form variable, which can be identified by the Me object to\n'simplify the application of the code. Below is a listing of all the code involved.\n'Comments interspersed will explain the process.\n\n' Author: Danny Lesandrini\n\n'The code\n  \n  Public Sub LoadUserColumnSetup(ByRef frm As Form)\n      Dim ctl As control\n      Dim strBlob As String\n      Dim strColumns() As String\n      Dim intColumns As Integer\n      Dim intColumn As Integer\n      Dim strValues() As String\n      Const cDatasheetView As Long = 2\n      \n      On Error Resume Next\n      \n      ' Only apply to forms in datasheet view.\n      ' Otherwise, exit the sub to cease processing\n      If frm.CurrentView <> cDatasheetView Then Exit Sub\n      \n      ' Grab previous settings from Registry as a blob of data\n      strBlob = GetSetting(\"Demo\", \"Settings\", frm.Name, \"\")\n      \n      ' Blob data looks like this:\n      '    name : postion : hidden : size\n      '    ------------------------------\n      '    fname:1:False:855\n      '    lname:3:False:870\n      '    hire_date:4:False:3090\n      '    minit:2:False:840\n      ' Only continue if blob contains data.\n      If strBlob <> \"\" Then\n        ' This is the clever bit.  For the code to work right,\n        ' the columns must be assigned in correct order.  This\n        ' method reorders the blob entries.\n        Call GetOrderedColumns(strBlob, strColumns)\n        \n        ' Loop through the columns (if any exist) and set the\n        ' properties of the corresponding control\n        intColumns = UBound(strColumns) + 1\n        If intColumns <> 0 Then\n          For intColumn = 0 To intColumns - 1\n            If Trim(strColumns(intColumn)) <> \"\" Then\n               ' Split the line into values and assign properties\n               strValues = Split(strColumns(intColumn), \":\")\n               Set ctl = frm.controls(strValues(0))\n               \n               ctl.ColumnOrder = CInt(strValues(1))\n               ctl.ColumnHidden = CBool(strValues(2))\n               ctl.ColumnWidth = CLng(strValues(3))\n            End If\n          Next\n        End If\n      End If\n  End Sub\n  Private Sub GetOrderedColumns(ByVal strData As String, _\n                                ByRef strColumns() As String)\n      \n      ' The data is passed, along with the empty array.\n      ' I tried returning an array, but couldn't get it\n      ' to work, so fell back to passing the array ByRef.\n      \n      Dim strTemp() As String\n      Dim intCols As Integer\n      Dim intCol As Integer\n      Dim intCurr As Integer\n      Dim strValues() As String\n      \n      On Error Resume Next\n      \n      ' Each datasheet control's info is on its own line,\n      ' so split the blob by Line Feed/Carriage Returns\n      strTemp = Split(strData, vbCrLf)\n      intCols = UBound(strTemp) - 1\n      ReDim strColumns(intCols)\n      \n      ' Loop through the unordered array and convert it into a\n      ' sorted list: Col 1 at the top and Col n at the bottom.\n      For intCol = 0 To intCols\n          For intCurr = 0 To intCols\n              strValues = Split(strTemp(intCurr), \":\")\n              If CInt(strValues(1)) = intCol + 1 Then\n                  strColumns(intCol) = strTemp(intCurr)\n                  Exit For\n              End If\n          Next\n      Next\n      \n  End Sub\n  Public Sub SaveUserColumnSetup(ByRef frm As Form)\n      Dim ctl As control\n      Dim strBlob As String\n      Dim strCtl As String\n      Const cDatasheetView As Long = 2\n      \n      On Error Resume Next\n      \n      ' Only apply to forms in datasheet view.\n      If frm.CurrentView <> cDatasheetView Then Exit Sub\n      \n      ' Loop through the controls, processing only those that matter.\n      For Each ctl In frm.controls\n        Select Case ctl.ControlType ' 108 acTextbox\n          Case acLabel, acLine, acSubform, acCommandButton\n              ' do nothing for these controls.\n          Case Else\n            strCtl = ctl.Name & \":\" & _\n                     ctl.ColumnOrder & \":\" & _\n                     ctl.ColumnHidden & \":\" & _\n                     ctl.ColumnWidth & vbCrLf\n            strBlob = strBlob & strCtl\n        End Select\n      Next\n      \n      SaveSetting \"Demo\", \"Settings\", frm.Name, strBlob\n  End Sub\n\n\n'Conclusion\n'This code took a little tinkering to get it to work, but once it was working, it was a simple matter\n'to apply it and my users are happy again. True, it is an obscure little problem, but if it happens\n'to be a problem you're currently facing then this little block of code will be a welcome\n'addition to your toolbox.\n"}
