{"id":"MOD_mdlCreateTextFromMDB","name":"mdlCreateTextFromMDB","kind":"standard","procedures":["Public Function DocDatabaseCrea()","Public Function DocDatabaseMrge()","Private Function Path_erzeugen(ByVal Pathnamen As String, Optional CreatWarn As Boolean = False, Optional WarnOnErr As Boolean = True) As Boolean"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n\n' Author Arvin Meyer\n' Enhancements: Klaus Oberdalhoff\n\n'################## IMPORTANT - WICHTIG ##############\n' On recreation of the mdb, the processs would stop if you would\n' try to override the module which is currently used\n\n' This (the own) modulename must be named like this\n\nPrivate Const CONST_mdlCreateTxtFromMDB As String = \"mdlCreateTxtFromMDB\"\n'#####################################################\n\n\nPrivate Const Const_DaBaPath As String = \"C:\\dabadoc\\\"\n\nPrivate Declare PtrSafe Function MakePath Lib \"imagehlp.dll\" Alias _\n    \"MakeSureDirectoryPathExists\" (ByVal lpPath As String) As Long\n\nPublic Function DocDatabaseCrea()\n '====================================================================\n ' Name:    DocDatabase\n ' Purpose: Documents the database to a series of text files\n '\n ' Author:  Arvin Meyer\n ' Date:    June 02, 1999\n ' Comment: Uses the undocumented [Application.SaveAsText] syntax\n '          To reload use the syntax [Application.LoadFromText]\n '====================================================================\nOn Error GoTo Err_DocDatabase\nDim dbs As DAO.Database\nDim cnt As Container\nDim doc As Document\nDim i As Integer\n\nCall Path_erzeugen(Const_DaBaPath & \"frm\\\")\nCall Path_erzeugen(Const_DaBaPath & \"rep\\\")\nCall Path_erzeugen(Const_DaBaPath & \"mac\\\")\nCall Path_erzeugen(Const_DaBaPath & \"mod\\\")\nCall Path_erzeugen(Const_DaBaPath & \"qry\\\")\n\nSet dbs = CurrentDb() ' use CurrentDb() to refresh Collections\n\nSet cnt = dbs.Containers(\"Forms\")\nFor Each doc In cnt.Documents\n    Application.SaveAsText acForm, doc.Name, Const_DaBaPath & \"frm\\\" & doc.Name & \".txt\"\nNext doc\n\nSet cnt = dbs.Containers(\"Reports\")\nFor Each doc In cnt.Documents\n    Application.SaveAsText acReport, doc.Name, Const_DaBaPath & \"rep\\\" & doc.Name & \".txt\"\nNext doc\n\nSet cnt = dbs.Containers(\"Scripts\")\nFor Each doc In cnt.Documents\n    Application.SaveAsText acMacro, doc.Name, Const_DaBaPath & \"mac\\\" & doc.Name & \".txt\"\nNext doc\n\nSet cnt = dbs.Containers(\"Modules\")\nFor Each doc In cnt.Documents\n    If Not doc.Name = CONST_mdlCreateTxtFromMDB Then\n        Application.SaveAsText acModule, doc.Name, Const_DaBaPath & \"mod\\\" & doc.Name & \".txt\"\n    Else\n        Application.SaveAsText acModule, doc.Name, Const_DaBaPath & \"mod\\\" & doc.Name & \".txx\"\n    End If\nNext doc\n\nFor i = 0 To dbs.QueryDefs.Count - 1\n    Application.SaveAsText acQuery, dbs.QueryDefs(i).Name, Const_DaBaPath & \"qry\\\" & dbs.QueryDefs(i).Name & \".txt\"\nNext i\n\nSet doc = Nothing\nSet cnt = Nothing\nSet dbs = Nothing\n\nExit_DocDatabase:\n    Exit Function\n\n\nErr_DocDatabase:\n    Select Case err\n\n    Case Else\n        MsgBox err.description\n        Resume Exit_DocDatabase\n    End Select\n\nEnd Function\n\n\nPublic Function DocDatabaseMrge()\n '====================================================================\n ' Name:    DocDatabase\n ' Purpose: Reimports the created documents to a database\n '\n ' Author:  Arvin Meyer\n ' Date:    June 02, 1999\n ' Comment: Uses the undocumented [Application.SaveAsText] syntax\n '          To reload use the syntax [Application.LoadFromText]\n '====================================================================\nOn Error GoTo Err_DocDatabase\n\nDim dbs As DAO.Database\nDim fileName As String\nDim Docname As String\n\nSet dbs = CurrentDb() ' use CurrentDb() to refresh Collections\n\nfileName = Dir(Const_DaBaPath & \"frm\\*.txt\", vbDirectory)\nWhile fileName <> \"\"\n    Docname = Left(fileName, Len(fileName) - 4)\n    Application.LoadFromText acForm, Docname, Const_DaBaPath & \"frm\\\" & fileName\n    fileName = Dir\n    DoEvents\nWend\n\nfileName = Dir(Const_DaBaPath & \"rep\\*.txt\", vbDirectory)\nWhile fileName <> \"\"\n    Docname = Left(fileName, Len(fileName) - 4)\n    Application.LoadFromText acReport, Docname, Const_DaBaPath & \"rep\\\" & fileName\n    fileName = Dir\n    DoEvents\nWend\n\nfileName = Dir(Const_DaBaPath & \"mac\\*.txt\", vbDirectory)\nWhile fileName <> \"\"\n    Docname = Left(fileName, Len(fileName) - 4)\n    Application.LoadFromText acMacro, Docname, Const_DaBaPath & \"mac\\\" & fileName\n    fileName = Dir\n    DoEvents\nWend\n\nfileName = Dir(Const_DaBaPath & \"mod\\*.txt\", vbDirectory)\nWhile fileName <> \"\"\n    Docname = Left(fileName, Len(fileName) - 4)\n    Application.LoadFromText acModule, Docname, Const_DaBaPath & \"mod\\\" & fileName\n    fileName = Dir\n    DoEvents\nWend\n\nfileName = Dir(Const_DaBaPath & \"qry\\*.txt\", vbDirectory)\nWhile fileName <> \"\"\n    Docname = Left(fileName, Len(fileName) - 4)\n    Application.LoadFromText acQuery, Docname, Const_DaBaPath & \"qry\\\" & fileName\n    fileName = Dir\n    DoEvents\nWend\n\nExit_DocDatabase:\n    Exit Function\n\n\nErr_DocDatabase:\n    Select Case err\n\n    Case Else\n        MsgBox err.description\n        Resume Exit_DocDatabase\n    End Select\n\nEnd Function\n\n\nPrivate Function Path_erzeugen(ByVal Pathnamen As String, Optional CreatWarn As Boolean = False, Optional WarnOnErr As Boolean = True) As Boolean\n' Path mit mehreren Subs auf einmal erzeugen\n' Idee aus VB-Tips & Tricks in der BasicWorld\n' www.basicworld.com\n' Der optionale Parameter NoWarnOnErr wird als \"False\" interpretiert, wenn nicht vorhanden.\n' Wenn WarnOnErr = False, dann wird keine Fehlermeldungs-Messagebox ausgegeben\n' Wenn CreatWarn = True, dann wird gefragt, ob das Directory erzeugt werden soll, wenn es nicht existiert.\n' Wenn versucht wird, ein Directory anzulegen, das bereits existiert, so erfolgt keine Fehlermeldung\n\n' Declare PtrSafe Function MakePath Lib \"imagehlp.dll\" Alias _\n'    \"MakeSureDirectoryPathExists\" (ByVal lpPath As String) As Long\n\n  \nDim nix\n  \n'Pfadnamen muﬂ immer mit einem \"\\\" enden\nIf Right(Pathnamen, 1) <> \"\\\" Then\n    Pathnamen = Pathnamen & \"\\\"\nEnd If\n\nnix = Dir(Pathnamen, vbDirectory)\n\nIf CreatWarn And Len(Nz(nix)) = 0 Then ' Pfad existiert nicht und Warnungs-MsgBox on\n    nix = MsgBox(\"Verzeichnis existiert nicht, soll es erstellt werden ?\", vbQuestion + vbOKCancel, _\n                  \"Verzeichnis erstellen\")\n    If nix = vbCancel Then 'Abbruch der Funktion\n        Path_erzeugen = False\n        Exit Function\n    End If\nEnd If\n        \n'Pfad erstellen\nIf MakePath(Pathnamen) = 0 Then\n    If WarnOnErr Then\n        Path_erzeugen = False\n        MsgBox \"Verzeichnis konnte nicht erstellt werden.\", vbCritical\n    End If\nElse\n    Path_erzeugen = True\nEnd If\n\n    \nEnd Function\n"}
