{"id":"MOD_mdlSommerzeit","name":"mdlSommerzeit","kind":"standard","procedures":["Function PreciseDateDiff(Interval As String, ByVal Date1, ByVal Date2, _","Private Function DateForSQL(dteDate) As String","Public Function SummerTime(Optional intYear As Long = -1) As Date","Public Function StandardTime(Optional intYear As Long = -1) As Date","Private Function GetSundate(intMonth As Integer, _","Function ISSummerTime(Optional dtDate1) As Boolean"],"calls":{"DoCmd.OpenForm":[],"DoCmd.OpenReport":[],"DoCmd.RunSQL":[],"CurrentDb.Execute":[],"DLookup":[],"DCount":[],"DMax":[],"DMin":[]},"source":"Option Compare Database\nOption Explicit\n\n'************************** Code Start ***********************\n'This code was originally written by Terry Kreft & Michel Walsh\n'It is not to be altered or distributed,\n'except as part of an application.\n'You are free to use it in any application,\n'provided the copyright notice is left unchanged.\n'\n'Code courtesy of\n'Terry Kreft & Michel Walsh\n'\nType SYSTEMTIME\n  wYear As Integer\n  wMonth As Integer\n  wDayOfWeek As Integer\n  wDay As Integer\n  wHour As Integer\n  wMinute As Integer\n  wSecond As Integer\n  wMilliseconds As Integer\nEnd Type\n\nType TIME_ZONE_INFORMATION\n  Bias As Long\n  StandardName(31) As Integer\n  StandardDate As SYSTEMTIME\n  StandardBias As Long\n  DaylightName(31) As Integer\n  DaylightDate As SYSTEMTIME\n  DaylightBias As Long\nEnd Type\n\nDeclare PtrSafe Function GetTimeZoneInformation Lib \"kernel32\" _\n  (lpTimeZoneInformation As TIME_ZONE_INFORMATION) As Long\n\nFunction PreciseDateDiff(Interval As String, ByVal Date1, ByVal Date2, _\n                        Optional FirstDayOfWeek As Integer = vbSunday, _\n                        Optional FirstWeekOfYear As Integer = vbFirstJan1) _\n                        As Long\n'From an original idea by Michel Walsh\n'Get a DateDiff, taking into account the time light saving\n'\n'Usage Example:\n'\n'   ? PreciseDateDiff(\"h\", #1/1/90#, #5/5/98#)\n'\n  Dim lngRet As Long\n  Dim tzi As TIME_ZONE_INFORMATION\n  Dim strEval As String\n  If Eval(\"'\" & Interval & \"' in ('h','n','s')\") Then\n    If FirstDayOfWeek >= 0 And FirstDayOfWeek <= 7 Then\n      If FirstWeekOfYear >= 0 And FirstWeekOfYear <= 3 Then\n        lngRet = GetTimeZoneInformation(tzi)\n        strEval = DateForSQL(Date1) & \" between \" _\n                & DateForSQL(SummerTime(year(Date1))) & \" and \" _\n                & DateForSQL(StandardTime(year(Date1)))\n        If Eval(strEval) Then\n          Date1 = DateAdd(\"n\", tzi.DaylightBias, Date1)\n        End If\n        strEval = DateForSQL(Date2) & \" between \" _\n                & DateForSQL(SummerTime(year(Date2))) & \" and \" _\n                & DateForSQL(StandardTime(year(Date2)))\n        If Eval(strEval) Then\n          Date2 = DateAdd(\"n\", tzi.DaylightBias, Date2)\n        End If\n        lngRet = DateDiff(Interval, Date1, Date2, _\n                                    FirstDayOfWeek, FirstWeekOfYear)\n        PreciseDateDiff = lngRet\n      End If\n    End If\n  Else\n    PreciseDateDiff = DateDiff(Interval, Date1, Date2, FirstDayOfWeek, FirstWeekOfYear)\n  End If\nEnd Function\n\nPrivate Function DateForSQL(dteDate) As String\n  DateForSQL = Format(dteDate, \"\\#m/dd/yyyy h:nn:ss AM/PM \\#\")\nEnd Function\n\n\nPublic Function SummerTime(Optional intYear As Long = -1) As Date\n    ' Originally submitted by Terry Kreft\n    '   modified to accept an optional year\n\n    If -1 = intYear Then intYear = year(Date)\n    ' Get this year, by defaut, not -1\n    \n    Dim lngRet As Long\n    Dim tzi As TIME_ZONE_INFORMATION\n    lngRet = GetTimeZoneInformation(tzi)\n    With tzi.DaylightDate\n        SummerTime = CVDate(GetSundate(.wMonth, .wDay, _\n                                    intYear) + (.wHour / 24))\n    End With\nEnd Function\n\nPublic Function StandardTime(Optional intYear As Long = -1) As Date\n    ' Originally submitted by Terry Kreft\n    '   modified to accept an optinal year\n\n    If -1 = intYear Then intYear = year(Date)\n    ' Get this year, by defaut, not -1\n    \n    Dim lngRet As Long\n    Dim tzi As TIME_ZONE_INFORMATION\n    lngRet = GetTimeZoneInformation(tzi)\n    With tzi.StandardDate\n        StandardTime = CVDate(GetSundate(.wMonth, .wDay, _\n                                    intYear) + (.wHour / 24))\n    End With\nEnd Function\n\nPrivate Function GetSundate(intMonth As Integer, _\n                            intSun As Integer, _\n                            Optional intYear As Long = -1) _\n                            As Date\n' Originally submitted by Terry Kreft\n'   Modified to set any Year\n\n    If intYear = -1 Then intYear = year(Date)\n    ' if not supplied, get this Year\n    \n    Dim varRet As Variant\n    Dim intDayOfWeek As Integer\n    \n    varRet = DateSerial(intYear, intMonth, 1)\n    ' avoid regional setting problem\n    \n    intDayOfWeek = Weekday(varRet)\n    If intDayOfWeek <> 1 Then\n        varRet = DateAdd(\"d\", 8 - intDayOfWeek, varRet)\n    End If\n    varRet = DateAdd(\"ww\", intSun - 1, varRet)\n    GetSundate = varRet\nEnd Function\n'************************** Code End ***********************\n\nFunction ISSummerTime(Optional dtDate1) As Boolean\nDim iYear As Long\nDim dtDate As Date\n\nIf IsNull(dtDate1) Then\n    dtDate = Now()\nElse\n    If Not IsDate(dtDate1) Then\n        dtDate = Now()\n    Else\n        dtDate = dtDate1\n    End If\nEnd If\niYear = year(dtDate)\nIf dtDate >= SummerTime(iYear) And dtDate < StandardTime(iYear) Then\n    ISSummerTime = True\nElse\n    ISSummerTime = False\nEnd If\nEnd Function\n"}
